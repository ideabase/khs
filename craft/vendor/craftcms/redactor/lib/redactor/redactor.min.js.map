{"version":3,"sources":["redactor.js"],"names":["$","Redactor","el","options","prototype","init","Function","bind","scope","fn","this","apply","uuid","redactor","val","args","Array","slice","call","arguments","each","func","instance","data","search","split","isFunction","methodVal","undefined","push","error","length","VERSION","modules","settings","opts","animation","lang","direction","spellcheck","overrideStyles","stylesClass","scrollTarget","document","focus","focusEnd","clickToEdit","structure","tabindex","minHeight","maxHeight","maxWidth","plugins","callbacks","placeholder","linkify","enterKey","pastePlainText","pasteImages","pasteLinks","pasteBlockTags","pasteInlineTags","preClass","preSpaces","tabAsSpaces","tabKey","autosave","autosaveName","autosaveFields","imageUpload","imageUploadParam","imageUploadFields","imageUploadForms","imageTag","imageEditable","imageCaption","imagePosition","imageResizable","imageFloatMargin","dragImageUpload","multipleImageUpload","clipboardImageUpload","fileUpload","fileUploadParam","fileUploadFields","fileUploadForms","dragFileUpload","s3","linkNewTab","linkTooltip","linkNofollow","linkSize","linkValidation","pasteLinkTarget","videoContainerClass","toolbar","toolbarFixed","toolbarFixedTarget","toolbarFixedTopOffset","toolbarExternal","toolbarOverflow","air","airWidth","formatting","formattingAdd","buttons","buttonsTextLabeled","buttonsHide","buttonsHideOnMobile","script","removeNewlines","removeComments","replaceTags","b","i","strike","keepStyleAttr","keepInlineOnEnter","shortcuts","ctrl+shift+m, meta+shift+m","ctrl+b, meta+b","params","ctrl+i, meta+i","ctrl+h, meta+h","ctrl+l, meta+l","ctrl+k, meta+k","ctrl+shift+7","ctrl+shift+8","shortcutsAdd","activeButtons","activeButtonsStates","strong","em","del","langs","en","format","image","file","link","bold","italic","deleted","underline","bold-abbr","italic-abbr","deleted-abbr","underline-abbr","lists","link-insert","link-edit","link-in-new-tab","unlink","cancel","close","insert","save","delete","text","edit","title","paragraph","quote","code","heading1","heading2","heading3","heading4","heading5","heading6","filename","optional","unorderedlist","orderedlist","outdent","indent","horizontalrule","upload-label","caption","bulletslist","numberslist","image-position","none","left","right","center","accessibility-help-label","type","inline","inlineTags","blockTags","paragraphize","paragraphizeBlocks","emptyHtml","invisibleSpace","emptyHtmlRendered","html","imageTypes","userAgent","navigator","toLowerCase","observe","dropdowns","regexps","linkyoutube","linkvimeo","linkimage","url","keyCode","BACKSPACE","DELETE","UP","DOWN","ENTER","SPACE","ESC","TAB","CTRL","META","SHIFT","ALT","RIGHT","LEFT","LEFT_WIN","$element","sBuffer","sRebuffer","loadOptions","loadModules","hasClass","loadToEdit","removeClass","reIsBlock","RegExp","join","toUpperCase","reIsInline","load","extend","$editor","detectType","core","callback","start","build","isInline","isTag","on","proxy","initToEdit","addClass","startToEdit","node","marker","get","selection","restore","clickToCancelStorage","clickToCancel","off","show","e","preventDefault","destroy","events","syncFire","hide","clickToSave","namespace","getModuleMethods","object","Object","getOwnPropertyNames","filter","property","len","bindModuleMethods","module","methods","z","enabled","collapsed","collapseToStart","collapsedEnd","collapseToEnd","detect","isMobile","button","hideButtons","hideButtonsOnMobile","$air","createContainer","css","append","$toolbar","setFormatting","editor","appendTo","attr","id","role","saveInstant","leftFix","width","innerWidth","window","clientX","top","clientY","scrollTop","bindHide","dropdown","target","closest","remove","key","which","utils","isRedactorParent","sel","range","deleteContents","ctrlKey","metaKey","shiftKey","altKey","setInactiveAll","fadeOut","name","$textarea","is","send","source","getHiddenFields","ajax","done","success","k","v","toString","indexOf","json","JSON","parse","callbackName","disable","clearInterval","autosaveTimeout","block","tag","value","tags","inArray","buffer","set","isCollapsed","formatCollapsed","formatUncollapsed","currentTag","tagName","clearAllAttrs","removeAllClass","removeAllAttr","replaced","isEndOfElement","createElement","innerHTML","after","caret","$last","children","last","replaceToTag","setAttr","trim","removeInlineTags","blocks","find","first","s","index","splice","not","contents","unwrap","getBlocks","nodes","isBlock","replaceClass","removeAttr","toggleClass","replaceAttr","toggleAttr","self","returned","addAttr","attributes","removeAttribute","clear","setUndo","setRedo","saved","current","add","undo","pop","restoreInstant","redo","buildTextarea","startTextarea","setIn","setId","enableEditor","setOptions","callEditor","createContainerBox","$box","getName","setStartAttrs","loadFromTextarea","insertAfter","prepend","aria-labelledby","textarea","clean","onSync","contenteditable","toolbarMobile","box","max-width","margin","disableBrowsersEditing","setHelpers","toolbarsButtons","element","modal","templates","cleaned","storage","setTimeout","end","execCommand","RedactorPlugins","curLang","icon","p","blockquote","pre","h1","h2","h3","h4","h5","h6","label","out","class","aria-disabled","ul","ol","in","hideButtonsSlicer","btnName","buildButtonTooltip","$btn","$tooltip","pos","offset","position","height","innerHeight","posBox","scrollFix","btnObject","$button","aria-label","$icon","command","setEvent","$dropdown","getButtons","getButtonsKeys","toggle","isIe","isDesktop","freezeScroll","returnValue","clickCallback","hideAll","unfreezeScroll","all","isAdded","btn","addFirst","addAfter","afterkey","parent","addBefore","beforekey","before","setIcon","changeIcon","newIconClass","addCallback","addDropdown","setActive","setInactive","$btns","enable","disableAll","enableAll","node1","node2","cs","setStart","setEnd","update","prepare","isFirefox","$first","isInlineTag","setStartEmptyOrInline","getSelection","removeAllRanges","createRange","selectNodeContents","collapse","addRange","textNode","createTextNode","insertNode","setStartAfter","space","className","setStartBefore","setEndBefore","replaceWith","lastChild","nodeType","getRangeAt","rangeCount","isBlockTag","next","prev","$next","$prev","onSet","savePreCode","saveFormTags","replace","$div","parseHTML","replacement","keys","$el","stripTags","onGet","restoreFormTags","chars","™","©","…","—","‐","onPaste","isHtmlMsWord","cleanMsWord","replaceBrToNl","removeTagsInsidePre","removeEmptyInlineTags","encode","convertTags","getPlainText","reconvertTags","replaceNbspToSpaces","encodeHtml","getCurrentType","line","isHtmlLine","isHtmlBlocked","links","images","isCurrentOrParent","match1","match","match2","matchBR","matchNL","$spans","$tags","tagHtml","isEmpty","lastList","lastLevel","listsIds","matches","currentList","parseInt","currentLevel","listType","$li","$list","data-level","data-list","$lastList","$prevList","replaceNlToBr","$links","href","tmp","j","item","outerHTML","concat","spanMarker","cleanPre","str","textContent","innerText","savePreFormatting","saveCodeFormatting","restoreSelectionMarkers","attr1","attr2","arr","codeTag","encodeEntities","String","input","denied","$0","$1","removeMarkers","removeSpaces","removeSpacesHard","normalizeCurrentHeading","heading","isCurrentOrParentHeader","normalize","stopDetectChanges","startDetectChanges","sync","htmlCleaned","isSync","startSync","addEvent","event","getEvent","_data","handler","destroyed","progress","removeData","$modalBox","$modalOverlay","isWebkit","test","documentMode","ie","isNaN","isIpad","active","getDropdown","dropdownObject","buildFormatting","$item","buildItem","$itemContainer","classname","$itemSpan","buildClick","buildCommand","body","getButtonPosition","showIsFixedToolbar","showIsUnFixedToolbar","disableBodyScroll","enableBodyScroll","stopPropagation","redactorAnimation","duration","enableCallback","enableEvents","closeHandler","dropdownWidth","Math","max","$buttons","$elements","hideOut","focused","blured","dropImage","stopChanges","dragover","dragleave","drop","originalEvent","FormData","dataTransfer","files","onDrop","onDropUpload","click","disableSelectAll","rtePaste","isCallback","blur","touchImageEditing","scrollTimer","imageEditing","clearTimeout","paste","keydown","keyup","createObserver","setupObserver","observer","MutationObserver","mutations","forEach","iterateObserver","mutation","stop","attributeName","changeHandler","subtree","childList","characterData","characterDataOldValue","upload","directUpload","stopDetect","startDetect","direct","release","$link","nodeToPoint","lastNode","activeElement","$img","src","$figure","nextNode","nextSibling","$nextFigure","isNextEmpty","isNextFigureEmpty","setEditable","$image","resizer","loadEditableControls","hideResize","setResizable","showEdit","resizeHandle","x","pageX","y","pageY","ratio","h","targetTouches","startResize","moveResize","stopResize","round","handle","imageBox","marginTop","style","marginBottom","marginLeft","marginRight","loadResizableControls","imageResizer","display","editter","editerWidth","$container","buttonDelete","getDeleteButton","buttonSave","getActionButton","$ficaption","floatValue","prop","setFloating","pattern","re","re2","linkProtocol","a","getOuterHtml","addCaption","imageFloat","imageDisplay","imageMargin","textAlign","float","text-align","$target","$figcaption","restoreScroll","increase","list","$current","listTag","$newList","$ol","removeEmpty","decrease","repositionItem","parents","$parent","$lists","$items","removeItemEmpty","getParams","arrangeTag","newInline","insertBreakpoint","insertInline","setParams","getClearedNodes","setNodesStriked","$inside","$parentAround","cleanInsideOrParent","removeSpecificAttr","newNodes","started","isConvertableAttr","nodeAttrValue","rules","count","ruleName","ruleValue","rgb2hex","isConvertable","nodeTag","parentNode","parentTag","convertable","breakpoint","endTag","$code","cloneAttributes","getStyleParams","result","rule","$node","eachInline","inlines","removeEmptyAttr","hasParentStyle","addParentStyle","replaceStyle","toggleStyle","newVal","oldVal","isRgb","addStyle","removeStyle","removeAllStyle","removeStyleRule","removeStyleRuleAttr","removeFormat","endNode","appendLists","isSelectAll","breaked","breakBlockTag","placeHtml","$block","wrap","raw","frag","createDocumentFragment","firstChild","appendChild","cloneRange","deleteContent","gap","placeNode","isStartOfElement","endOfNode","extractEndOfNode","caretPositionFromPoint","offsetNode","caretRangeFromPoint","createTextRange","moveToPoint","endRange","duplicate","setEndPoint","select","nodeToCaretPositionFromPoint","arrow","ctrl","figcaption","figure","checkEvents","setupBuffer","addArrowsEvent","setupSelectAll","onArrowDown","onArrowUp","wrapToParagraph","lastShiftKey","onShiftSpace","onShiftEnter","onEnter","onTab","onBackspaceAndDeleteBefore","$nextList","removeOnBackspace","combineAfterAndBefore","removeInvisibleSpace","removeEmptyListInTable","onBackspaceAndDeleteAfter","insertNewLine","saveScroll","removeEmptyLists","formatEmpty","exitFromBlockquote","insertBreakLine","replaceToParagraph","insertParagraph","checkKeyEvents","insertAfterLastElement","insertBeforeFirstElement","isList","isListStart","enableSelectAll","insertBreakLineProcessing","insertDblBreakLine","dbl","br1","br2","clone","blockElem","blockHtml","setCaretToParagraph","td","removeIt","$newTag","setUnfixed","$marker","animate","isContainImage","isKey","getLineHtml","$hr","replaceLinksToText","closeAllTooltip","buildLinkFromObject","buildModal","buildLinkFromElement","removeSelfHostFromUrl","setModalValues","buildLinkFromModal","cleanUrl","cleanText","getText","truncateUrl","isUrl","isMailto","substring","buildTarget","location","$unlinked","isLink","nodeValue","isFiltered","convertVideoLinks","convertImages","convertLinks","addBack","$objects","iframeStart","iframeEnd","grep","decodeURIComponent","regexB","regexp","inBlocks","_getBlocks","_isUnformat","_unformat","_format","isEmptyBlock","isBlockWrapped","finalBlocks","countLists","_uniteBlocks","0","lastcell","$cell","_isUniteBlock","_createList","_createListItem","items","selectedItems","_unformatEntire","_getItemsPosition","_unformatAtSide","reverse","ci","$secondList","_createUnformatContainer","$innerLists","sFirst","sLast","num","iterateRemove","image-edit","addTemplate","template","getTemplate","getModal","$modalBody","getCancelButton","templateName","setTitle","setDraggable","setContent","buildTabber","buildWidth","$modal","timing","setEnter","windowHeight","windowWidth","number","margin-bottom","outerHeight","tabs","$tabsBox","showTab","eq","$modalHeader","draggable","buildOverlay","$modalClose","disableEvents","isCurrent","parentEl","currentEl","toggleActive","finded","isRedactor","inValues","outValues","setDropdownProperties","addProperties","deleteProperties","setDropdownAttr","properties","isDelete","img","showTooltip","getTooltipPosition","tooltip","aLink","aEdit","aUnlink","lineHeight","lineClicked","ceil","closeTooltip","cloned","div","cloneContents","endContainer","endOffset","walker","createTreeWalker","NodeFilter","SHOW_TEXT","Infinity","safes","getSafes","convert","restoreSafes","re1","re3","detectClipboardUpload","clipboardUpload","createPasteBox","saveBodyScroll","getPasteBoxCode","$pasteBox","appendPasteBox","$visibleModals","clipboard","clipboardData","types","getAsFile","reader","FileReader","readAsDataURL","onload","insertFromClipboard","imgs","formData","blob","dataURItoBlob","isEditorEmpty","isEditorRelative","setEditorRelative","buildPosition","isAttr","$style","getPosition","states","$bar","startContainer","anchorNode","previousSibling","isArray","resultNodes","commonAncestorContainer","unshift","hasChildNodes","savedSel","ownerDocument","defaultView","selectionRange","startOffset","doc","win","charIndex","nodeStack","foundStart","nextCharIndex","childNodes","container","clonedRange","extractContents","markerHtml","hotkeysSpecialKeys","8","9","10","13","16","17","18","19","20","27","32","33","34","35","36","37","38","39","40","45","46","59","61","96","97","98","99","100","101","102","103","104","105","106","107","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","144","145","173","186","187","188","189","190","191","192","219","220","221","222","hotkeysShiftNums","`","1","2","3","4","5","6","7","-","=",";","'",",",".","/","\\","buildHandler","origHandler","special","character","fromCharCode","modif","possible","specialKey","status","decodeURI","_this","changes","$toolbarBox","setOverflow","setFixed","toolbarOffsetTop","late","observeScroll","observeScrollDisable","getBoxTop","tolerance","boxTop","observeScrollEnable","observeScrollResize","fullscreen","isOpened","setDropdownsFixed","visibility","unsetDropdownsFixed","setDropdownPosition","$droparea","$placeholdler","$input","onDrag","onDragLeave","traverseFile","setConfig","uploads3","getType","obj","fd","appendFields","appendForms","imageFields","fileFields","xhr","XMLHttpRequest","open","setRequestHeader","onreadystatechange","readyState","responseText","err","clearImageFields","addImageFields","removeImageFields","clearFileFields","addFileFields","removeFileFields","executeOnSignedUrl","signedURL","sendToS3","mark","overrideMimeType","that","createCORSRequest","method","XDomainRequest","s3file","onerror","onprogress","isElement","HTMLElement","strpos","haystack","needle","dataURI","byteString","atob","unescape","mimeString","ia","Uint8Array","charCodeAt","Blob","from","to","attrs","$nextPart","contains","inInlines","matched","isCurrentOrParentOne","getScrollTarget","$scrollTarget","freezeScrollTop","tmpScrollTop","selectAll","$body","documentElementRect","documentElement","getBoundingClientRect","abs","isOverflowing","clientWidth","scrollbarWidth","measureScrollbar","scrollDiv","offsetWidth","removeChild","overflow","padding-right","$fields","$forms","serializeArray","f","rgb","isPad","browser","webkit","ff","jQuery","iterate","delay","prefix","slide","prefixes","queue","_callback","complete","shift","make","one","effects"],"mappings":"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","file":"redactor.min.js","sourcesContent":["/*\n\tRedactor II\n\tVersion 2.12\n\tUpdated: December 4, 2017\n\n\thttp://imperavi.com/redactor/\n\n\tCopyright (c) 2009-2017, Imperavi LLC.\n\tLicense: http://imperavi.com/redactor/license/\n\n\tUsage: $('#content').redactor();\n*/\n\n(function($)\n{\n\t'use strict';\n\n\tif (!Function.prototype.bind)\n\t{\n\t\tFunction.prototype.bind = function(scope)\n\t\t{\n\t\t\tvar fn = this;\n\t\t\treturn function()\n\t\t\t{\n\t\t\t\treturn fn.apply(scope);\n\t\t\t};\n\t\t};\n\t}\n\n\tvar uuid = 0;\n\n\t// Plugin\n\t$.fn.redactor = function(options)\n\t{\n\t\tvar val = [];\n\t\tvar args = Array.prototype.slice.call(arguments, 1);\n\n\t\tif (typeof options === 'string')\n\t\t{\n\t\t\tthis.each(function()\n\t\t\t{\n\t\t\t\tvar instance = $.data(this, 'redactor');\n\t\t\t\tvar func;\n\n\t\t\t\tif (options.search(/\\./) !== '-1')\n\t\t\t\t{\n\t\t\t\t\tfunc = options.split('.');\n\t\t\t\t\tif (typeof instance[func[0]] !== 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\tfunc = instance[func[0]][func[1]];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tfunc = instance[options];\n\t\t\t\t}\n\n\t\t\t\tif (typeof instance !== 'undefined' && $.isFunction(func))\n\t\t\t\t{\n\t\t\t\t\tvar methodVal = func.apply(instance, args);\n\t\t\t\t\tif (methodVal !== undefined && methodVal !== instance)\n\t\t\t\t\t{\n\t\t\t\t\t\tval.push(methodVal);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t$.error('No such method \"' + options + '\" for Redactor');\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.each(function()\n\t\t\t{\n\t\t\t\t$.data(this, 'redactor', {});\n\t\t\t\t$.data(this, 'redactor', Redactor(this, options));\n\t\t\t});\n\t\t}\n\n\t\tif (val.length === 0)\n\t\t{\n\t\t\treturn this;\n\t\t}\n\t\telse if (val.length === 1)\n\t\t{\n\t\t\treturn val[0];\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn val;\n\t\t}\n\n\t};\n\n\t// Initialization\n\tfunction Redactor(el, options)\n\t{\n\t\treturn new Redactor.prototype.init(el, options);\n\t}\n\n\t// Options\n\t$.Redactor = Redactor;\n\t$.Redactor.VERSION = '2.12';\n\t$.Redactor.modules = ['air', 'autosave', 'block', 'buffer', 'build', 'button', 'caret', 'clean', 'code', 'core', 'detect', 'dropdown',\n\t\t\t\t\t\t  'events', 'file', 'focus', 'image', 'indent', 'inline', 'insert', 'keydown', 'keyup',\n\t\t\t\t\t\t  'lang', 'line', 'link', 'linkify', 'list', 'marker', 'modal', 'observe', 'offset', 'paragraphize', 'paste', 'placeholder',\n\t\t\t\t\t\t  'progress', 'selection', 'shortcuts', 'storage', 'toolbar', 'upload', 'uploads3', 'utils',\n\n\t\t\t\t\t\t  'browser' // deprecated\n\t\t\t\t\t\t  ];\n\n\t$.Redactor.settings = {};\n\t$.Redactor.opts = {\n\n\t\t// settings\n\t\tanimation: false,\n\t\tlang: 'en',\n\t\tdirection: 'ltr',\n\t\tspellcheck: true,\n\t\toverrideStyles: true,\n\t\tstylesClass: false,\n\t\tscrollTarget: document,\n\n\t\tfocus: false,\n\t\tfocusEnd: false,\n\n\t\tclickToEdit: false,\n\t\tstructure: false,\n\n\t\ttabindex: false,\n\n\t\tminHeight: false, // string\n\t\tmaxHeight: false, // string\n\n\t\tmaxWidth: false, // string\n\n\t\tplugins: false, // array\n\t\tcallbacks: {},\n\n\t\tplaceholder: false,\n\n\t\tlinkify: true,\n\t\tenterKey: true,\n\n\t\tpastePlainText: false,\n\t\tpasteImages: true,\n\t\tpasteLinks: true,\n\t\tpasteBlockTags: ['pre', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'table', 'tbody', 'thead', 'tfoot', 'th', 'tr', 'td', 'ul', 'ol', 'li', 'blockquote', 'p', 'figure', 'figcaption'],\n\t\tpasteInlineTags: ['br', 'strong', 'ins', 'code', 'del', 'span', 'samp', 'kbd', 'sup', 'sub', 'mark', 'var', 'cite', 'small', 'b', 'u', 'em', 'i'],\n\n\t\tpreClass: false, // string\n\t\tpreSpaces: 4, // or false\n\t\ttabAsSpaces: false, // true or number of spaces\n\t\ttabKey: true,\n\n\t\tautosave: false, // false or url\n\t\tautosaveName: false,\n\t\tautosaveFields: false,\n\n\t\timageUpload: null,\n\t\timageUploadParam: 'file',\n\t\timageUploadFields: false,\n\t\timageUploadForms: false,\n        imageTag: 'figure',\n        imageEditable: true,\n\t\timageCaption: true,\n\n\t\timagePosition: false,\n\t\timageResizable: false,\n\t\timageFloatMargin: '10px',\n\n\t\tdragImageUpload: true,\n\t\tmultipleImageUpload: true,\n\t\tclipboardImageUpload: true,\n\n\t\tfileUpload: null,\n\t\tfileUploadParam: 'file',\n\t\tfileUploadFields: false,\n\t\tfileUploadForms: false,\n\t\tdragFileUpload: true,\n\n\t\ts3: false,\n\n        linkNewTab: false,\n\t\tlinkTooltip: true,\n\t\tlinkNofollow: false,\n\t\tlinkSize: 30,\n\t\tlinkValidation: true,\n\t\tpasteLinkTarget: false,\n\n\t\tvideoContainerClass: 'video-container',\n\n\t\ttoolbar: true,\n\t\ttoolbarFixed: true,\n\t\ttoolbarFixedTarget: document,\n\t\ttoolbarFixedTopOffset: 0, // pixels\n\t\ttoolbarExternal: false, // ID selector\n\t\ttoolbarOverflow: false,\n\n\t\tair: false,\n\t\tairWidth: false,\n\n\t\tformatting: ['p', 'blockquote', 'pre', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6'],\n\t\tformattingAdd: false,\n\n\t\tbuttons: ['format', 'bold', 'italic', 'deleted', 'lists', 'image', 'file', 'link', 'horizontalrule'], // + 'horizontalrule', 'underline', 'ol', 'ul', 'indent', 'outdent'\n        buttonsTextLabeled: false,\n\t\tbuttonsHide: [],\n\t\tbuttonsHideOnMobile: [],\n\n\t\tscript: true,\n\t\tremoveNewlines: false,\n\t\tremoveComments: true,\n\t\treplaceTags: {\n\t\t\t'b': 'strong',\n\t\t\t'i': 'em',\n\t\t\t'strike': 'del'\n\t\t},\n\n        keepStyleAttr: [], // tag name array\n        keepInlineOnEnter: false,\n\n\t\t// shortcuts\n\t\tshortcuts: {\n\t\t\t'ctrl+shift+m, meta+shift+m': { func: 'inline.removeFormat' },\n\t\t\t'ctrl+b, meta+b': { func: 'inline.format', params: ['bold'] },\n\t\t\t'ctrl+i, meta+i': { func: 'inline.format', params: ['italic'] },\n\t\t\t'ctrl+h, meta+h': { func: 'inline.format', params: ['superscript'] },\n\t\t\t'ctrl+l, meta+l': { func: 'inline.format', params: ['subscript'] },\n\t\t\t'ctrl+k, meta+k': { func: 'link.show' },\n\t\t\t'ctrl+shift+7':   { func: 'list.toggle', params: ['orderedlist'] },\n\t\t\t'ctrl+shift+8':   { func: 'list.toggle', params: ['unorderedlist'] }\n\t\t},\n\t\tshortcutsAdd: false,\n\n\t\tactiveButtons: ['deleted', 'italic', 'bold'],\n\t\tactiveButtonsStates: {\n\t\t\tb: 'bold',\n\t\t\tstrong: 'bold',\n\t\t\ti: 'italic',\n\t\t\tem: 'italic',\n\t\t\tdel: 'deleted',\n\t\t\tstrike: 'deleted'\n\t\t},\n\n\t\t// private lang\n\t\tlangs: {\n\t\t\ten: {\n\n\t\t\t\t\"format\": \"Format\",\n\t\t\t\t\"image\": \"Image\",\n\t\t\t\t\"file\": \"File\",\n\t\t\t\t\"link\": \"Link\",\n\t\t\t\t\"bold\": \"Bold\",\n\t\t\t\t\"italic\": \"Italic\",\n\t\t\t\t\"deleted\": \"Strikethrough\",\n\t\t\t\t\"underline\": \"Underline\",\n\t\t\t\t\"bold-abbr\": \"B\",\n\t\t\t\t\"italic-abbr\": \"I\",\n\t\t\t\t\"deleted-abbr\": \"S\",\n\t\t\t\t\"underline-abbr\": \"U\",\n\t\t\t\t\"lists\": \"Lists\",\n\t\t\t\t\"link-insert\": \"Insert link\",\n\t\t\t\t\"link-edit\": \"Edit link\",\n\t\t\t\t\"link-in-new-tab\": \"Open link in new tab\",\n\t\t\t\t\"unlink\": \"Unlink\",\n\t\t\t\t\"cancel\": \"Cancel\",\n\t\t\t\t\"close\": \"Close\",\n\t\t\t\t\"insert\": \"Insert\",\n\t\t\t\t\"save\": \"Save\",\n\t\t\t\t\"delete\": \"Delete\",\n\t\t\t\t\"text\": \"Text\",\n\t\t\t\t\"edit\": \"Edit\",\n\t\t\t\t\"title\": \"Title\",\n\t\t\t\t\"paragraph\": \"Normal text\",\n\t\t\t\t\"quote\": \"Quote\",\n\t\t\t\t\"code\": \"Code\",\n\t\t\t\t\"heading1\": \"Heading 1\",\n\t\t\t\t\"heading2\": \"Heading 2\",\n\t\t\t\t\"heading3\": \"Heading 3\",\n\t\t\t\t\"heading4\": \"Heading 4\",\n\t\t\t\t\"heading5\": \"Heading 5\",\n\t\t\t\t\"heading6\": \"Heading 6\",\n\t\t\t\t\"filename\": \"Name\",\n\t\t\t\t\"optional\": \"optional\",\n\t\t\t\t\"unorderedlist\": \"Unordered List\",\n\t\t\t\t\"orderedlist\": \"Ordered List\",\n\t\t\t\t\"outdent\": \"Outdent\",\n\t\t\t\t\"indent\": \"Indent\",\n\t\t\t\t\"horizontalrule\": \"Line\",\n\t\t\t\t\"upload-label\": \"Drop file here or \",\n\t\t\t\t\"caption\": \"Caption\",\n\n\t\t\t\t\"bulletslist\": \"Bullets\",\n\t\t\t\t\"numberslist\": \"Numbers\",\n\n\t\t\t\t\"image-position\": \"Position\",\n\t\t\t\t\"none\": \"None\",\n\t\t\t\t\"left\": \"Left\",\n\t\t\t\t\"right\": \"Right\",\n\t\t\t\t\"center\": \"Center\",\n\n\t\t\t\t\"accessibility-help-label\": \"Rich text editor\"\n\t\t\t}\n\t\t},\n\n\t\t// private\n\t\ttype: 'textarea', // textarea, div, inline, pre\n\t\tinline: false,\n\t\tinlineTags: ['a', 'span', 'strong', 'strike', 'b', 'u', 'em', 'i', 'code', 'del', 'ins', 'samp', 'kbd', 'sup', 'sub', 'mark', 'var', 'cite', 'small'],\n\t\tblockTags: ['pre', 'ul', 'ol', 'li', 'p', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6',  'dl', 'dt', 'dd', 'div', 'td', 'blockquote', 'output', 'figcaption', 'figure', 'address', 'section', 'header', 'footer', 'aside', 'article', 'iframe'],\n\t\tparagraphize: true,\n\t\tparagraphizeBlocks: ['table', 'div', 'pre', 'form', 'ul', 'ol', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'dl', 'blockquote', 'figcaption',\n\t\t\t\t\t\t\t'address', 'section', 'header', 'footer', 'aside', 'article', 'object', 'style', 'script', 'iframe', 'select', 'input', 'textarea',\n\t\t\t\t\t\t\t'button', 'option', 'map', 'area', 'math', 'hr', 'fieldset', 'legend', 'hgroup', 'nav', 'figure', 'details', 'menu', 'summary', 'p'],\n\t\temptyHtml: '<p>&#x200b;</p>',\n\t\tinvisibleSpace: '&#x200b;',\n\t\temptyHtmlRendered: $('').html('​').html(),\n\t\timageTypes: ['image/png', 'image/jpeg', 'image/gif'],\n\t\tuserAgent: navigator.userAgent.toLowerCase(),\n\t\tobserve: {\n\t\t\tdropdowns: []\n\t\t},\n\t\tregexps: {\n\t\t\tlinkyoutube: /https?:\\/\\/(?:[0-9A-Z-]+\\.)?(?:youtu\\.be\\/|youtube\\.com\\S*[^\\w\\-\\s])([\\w\\-]{11})(?=[^\\w\\-]|$)(?![?=&+%\\w.\\-]*(?:['\"][^<>]*>|<\\/a>))[?=&+%\\w.-]*/ig,\n\t\t\tlinkvimeo: /https?:\\/\\/(www\\.)?vimeo.com\\/(\\d+)($|\\/)/,\n\t\t\tlinkimage: /((https?|www)[^\\s]+\\.)(jpe?g|png|gif)(\\?[^\\s-]+)?/ig,\n\t\t\turl: /(https?:\\/\\/(?:www\\.|(?!www))[^\\s\\.]+\\.[^\\s]{2,}|www\\.[^\\s]+\\.[^\\s]{2,})/ig\n\t\t}\n\n\t};\n\n\t// Functionality\n\tRedactor.fn = $.Redactor.prototype = {\n\n\t\tkeyCode: {\n\t\t\tBACKSPACE: 8,\n\t\t\tDELETE: 46,\n\t\t\tUP: 38,\n\t\t\tDOWN: 40,\n\t\t\tENTER: 13,\n\t\t\tSPACE: 32,\n\t\t\tESC: 27,\n\t\t\tTAB: 9,\n\t\t\tCTRL: 17,\n\t\t\tMETA: 91,\n\t\t\tSHIFT: 16,\n\t\t\tALT: 18,\n\t\t\tRIGHT: 39,\n\t\t\tLEFT: 37,\n\t\t\tLEFT_WIN: 91\n\t\t},\n\n\t\t// =init\n\t\tinit: function(el, options)\n\t\t{\n\t\t\tthis.$element = $(el);\n\t\t\tthis.uuid = uuid++;\n\t\t\tthis.sBuffer = [];\n            this.sRebuffer = [];\n\n\t\t\tthis.loadOptions(options);\n\t\t\tthis.loadModules();\n\n\t\t\t// click to edit\n\t\t\tif (this.opts.clickToEdit && !this.$element.hasClass('redactor-click-to-edit'))\n\t\t\t{\n\t\t\t\treturn this.loadToEdit(options);\n\t\t\t}\n\t\t\telse if (this.$element.hasClass('redactor-click-to-edit'))\n\t\t\t{\n\t\t\t\tthis.$element.removeClass('redactor-click-to-edit');\n\t\t\t}\n\n\t\t\t// block & inline test tag regexp\n\t\t\tthis.reIsBlock = new RegExp('^(' + this.opts.blockTags.join('|' ).toUpperCase() + ')$', 'i');\n\t\t\tthis.reIsInline = new RegExp('^(' + this.opts.inlineTags.join('|' ).toUpperCase() + ')$', 'i');\n\n\t\t\t// set up drag upload\n\t\t\tthis.opts.dragImageUpload = (this.opts.imageUpload === null) ? false : this.opts.dragImageUpload;\n\t\t\tthis.opts.dragFileUpload = (this.opts.fileUpload === null) ? false : this.opts.dragFileUpload;\n\n\t\t\t// formatting storage\n\t\t\tthis.formatting = {};\n\n\t\t\t// load lang\n\t\t\tthis.lang.load();\n\n\t\t\t// extend shortcuts\n\t\t\t$.extend(this.opts.shortcuts, this.opts.shortcutsAdd);\n\n\t\t\t// set editor\n\t\t\tthis.$editor = this.$element;\n\n\t\t\t// detect type of editor\n\t\t\tthis.detectType();\n\n\t\t\t// start callback\n\t\t\tthis.core.callback('start');\n\t\t\tthis.core.callback('startToEdit');\n\n\t\t\t// build\n\t\t\tthis.start = true;\n\t\t\tthis.build.start();\n\n\t\t},\n\t\tdetectType: function()\n\t\t{\n\t\t\tif (this.build.isInline() || this.opts.inline)\n\t\t\t{\n\t\t\t\tthis.opts.type = 'inline';\n\t\t\t}\n\t\t\telse if (this.build.isTag('DIV'))\n\t\t\t{\n\t\t\t\tthis.opts.type = 'div';\n\t\t\t}\n\t\t\telse if (this.build.isTag('PRE'))\n\t\t\t{\n\t\t\t\tthis.opts.type = 'pre';\n\t\t\t}\n\t\t},\n\t\tloadToEdit: function(options)\n\t\t{\n\n\t\t\tthis.$element.on('click.redactor-click-to-edit', $.proxy(function()\n\t\t\t{\n\t\t\t\tthis.initToEdit(options);\n\n\t\t\t}, this));\n\n\t\t\tthis.$element.addClass('redactor-click-to-edit');\n\n\t\t\treturn;\n\t\t},\n\t\tinitToEdit: function(options)\n\t\t{\n\t\t\t$.extend(options.callbacks,  {\n\t\t\t\tstartToEdit: function()\n\t\t\t\t{\n\t\t\t\t\tthis.insert.node(this.marker.get(), false);\n\t\t\t\t},\n\t\t\t\tinitToEdit: function()\n\t\t\t\t{\n\t\t\t\t\tthis.selection.restore();\n\t\t\t\t\tthis.clickToCancelStorage = this.code.get();\n\n\t\t\t\t\t// cancel\n\t\t\t\t\t$(this.opts.clickToCancel).off('.redactor-click-to-edit');\n\t\t\t\t\t$(this.opts.clickToCancel).show().on('click.redactor-click-to-edit', $.proxy(function(e)\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\tthis.core.destroy();\n\t\t\t\t\t\tthis.events.syncFire = false;\n\t\t\t\t\t\tthis.$element.html(this.clickToCancelStorage);\n\t\t\t\t\t\tthis.core.callback('cancel', this.clickToCancelStorage);\n\t\t\t\t\t\tthis.events.syncFire = true;\n\t\t\t\t\t\tthis.clickToCancelStorage = '';\n\t\t\t\t\t\t$(this.opts.clickToCancel).hide();\n\t\t\t\t\t\t$(this.opts.clickToSave).hide();\n\n\t\t\t\t\t\tthis.$element.on('click.redactor-click-to-edit', $.proxy(function()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.initToEdit(options);\n\t\t\t\t\t\t}, this));\n\n\t\t\t\t\t\tthis.$element.addClass('redactor-click-to-edit');\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t\t// save\n\t\t\t\t\t$(this.opts.clickToSave).off('.redactor-click-to-edit');\n\t\t\t\t\t$(this.opts.clickToSave).show().on('click.redactor-click-to-edit', $.proxy(function(e)\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\tthis.core.destroy();\n\t\t\t\t\t\tthis.core.callback('save', this.code.get());\n\t\t\t\t\t\t$(this.opts.clickToCancel).hide();\n\t\t\t\t\t\t$(this.opts.clickToSave).hide();\n\t\t\t\t\t\tthis.$element.on('click.redactor-click-to-edit', $.proxy(function()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.initToEdit(options);\n\t\t\t\t\t\t}, this));\n\t\t\t\t\t\tthis.$element.addClass('redactor-click-to-edit');\n\n\t\t\t\t\t}, this));\n\t\t\t\t}\n\n\t\t\t});\n\n\t\t\tthis.$element.redactor(options);\n\t\t\tthis.$element.off('.redactor-click-to-edit');\n\n\t\t},\n\t\tloadOptions: function(options)\n\t\t{\n\t\t\tvar settings = {};\n\n\t\t\t// check namespace\n\t\t\tif (typeof $.Redactor.settings.namespace !== 'undefined')\n\t\t\t{\n\t\t\t\t if (this.$element.hasClass($.Redactor.settings.namespace))\n\t\t\t\t {\n\t\t\t\t\t settings = $.Redactor.settings;\n\t\t\t\t }\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tsettings = $.Redactor.settings;\n\t\t\t}\n\n\t\t\tthis.opts = $.extend(\n\t\t\t\t{},\n\t\t\t\t$.Redactor.opts,\n\t\t\t\tthis.$element.data(),\n\t\t\t\toptions\n\t\t\t);\n\n\t\t\tthis.opts = $.extend({}, this.opts, settings);\n\n\t\t},\n\t\tgetModuleMethods: function(object)\n\t\t{\n\t\t\treturn Object.getOwnPropertyNames(object).filter(function(property)\n\t\t\t{\n\t\t\t\treturn typeof object[property] === 'function';\n\t\t\t});\n\t\t},\n\t\tloadModules: function()\n\t\t{\n\t\t\tvar len = $.Redactor.modules.length;\n\t\t\tfor (var i = 0; i < len; i++)\n\t\t\t{\n\t\t\t\tthis.bindModuleMethods($.Redactor.modules[i]);\n\t\t\t}\n\t\t},\n\t\tbindModuleMethods: function(module)\n\t\t{\n\t\t\tif (typeof this[module] === 'undefined')\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// init module\n\t\t\tthis[module] = this[module]();\n\n\t\t\tvar methods = this.getModuleMethods(this[module]);\n\t\t\tvar len = methods.length;\n\n\t\t\t// bind methods\n\t\t\tfor (var z = 0; z < len; z++)\n\t\t\t{\n\t\t\t\tthis[module][methods[z]] = this[module][methods[z]].bind(this);\n\t\t\t}\n\t\t},\n\n\t\t// =air\n\t\tair: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tenabled: false,\n\t\t\t\tcollapsed: function()\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.air)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.selection.get().collapseToStart();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tcollapsedEnd: function()\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.air)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.selection.get().collapseToEnd();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tbuild: function()\n\t\t\t\t{\n\t\t\t\t\tif (this.detect.isMobile())\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.button.hideButtons();\n\t\t\t\t\tthis.button.hideButtonsOnMobile();\n\n\t\t\t\t\tif (this.opts.buttons.length === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.$air = this.air.createContainer();\n\n\t\t\t\t\tif (this.opts.airWidth !== false)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$air.css('width', this.opts.airWidth);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.air.append();\n\t\t\t\t\tthis.button.$toolbar = this.$air;\n\t\t\t\t\tthis.button.setFormatting();\n\t\t\t\t\tthis.button.load(this.$air);\n\n\t\t\t\t\tthis.core.editor().on('mouseup.redactor', this, $.proxy(function(e)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.selection.text() !== '')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.air.show(e);\n\t\t\t\t\t\t}\n\t\t\t\t\t}, this));\n\n\t\t\t\t},\n\t\t\t\tappend: function()\n\t\t\t\t{\n\t\t\t\t\tthis.$air.appendTo('body');\n\t\t\t\t},\n\t\t\t\tcreateContainer: function()\n\t\t\t\t{\n\t\t\t\t\treturn $('<ul>').addClass('redactor-air').attr({ 'id': 'redactor-air-' + this.uuid, 'role': 'toolbar' }).hide();\n\t\t\t\t},\n\t\t\t\tshow: function (e)\n\t\t\t\t{\n\t\t\t\t\t//this.marker.remove();\n\t\t\t\t\tthis.selection.saveInstant();\n\t\t\t\t\t//this.selection.restore(false);\n\n\t\t\t\t\t$('.redactor-air').hide();\n\n\t\t\t\t\tvar leftFix = 0;\n\t\t\t\t\tvar width = this.$air.innerWidth();\n\n\t\t\t\t\tif ($(window).width() < (e.clientX + width))\n\t\t\t\t\t{\n\t\t\t\t\t\tleftFix = 200;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.$air.css({\n\t\t\t\t\t\tleft: (e.clientX - leftFix) + 'px',\n\t\t\t\t\t\ttop: (e.clientY + 10 + $(document).scrollTop()) + 'px'\n\t\t\t\t\t}).show();\n\n\t\t\t\t\tthis.air.enabled = true;\n\t\t\t\t\tthis.air.bindHide();\n\t\t\t\t},\n\t\t\t\tbindHide: function()\n\t\t\t\t{\n\t\t\t\t\t$(document).on('mousedown.redactor-air.' + this.uuid, $.proxy(function(e)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar dropdown = $(e.target).closest('.redactor-dropdown').length;\n\n\t\t\t\t\t\tif ($(e.target).closest(this.$air).length === 0 && dropdown === 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar hide = this.air.hide(e);\n\t\t\t\t\t\t\tif (hide !== false)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.marker.remove();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}, this)).on('keydown.redactor-air.' + this.uuid, $.proxy(function(e)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar key = e.which;\n\t\t\t\t\t\tif ((!this.utils.isRedactorParent(e.target) && !$(e.target).hasClass('redactor-in')) || $(e.target).closest('#redactor-modal').length !== 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (key === this.keyCode.ESC)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.selection.get().collapseToStart();\n\t\t\t\t\t\t\t//this.marker.remove();\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (key === this.keyCode.BACKSPACE || key === this.keyCode.DELETE)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar sel = this.selection.get();\n\t\t\t\t\t\t\tvar range = this.selection.range(sel);\n\t\t\t\t\t\t\trange.deleteContents();\n\t\t\t\t\t\t\t//this.marker.remove();\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (key === this.keyCode.ENTER)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.selection.get().collapseToEnd();\n\t\t\t\t\t\t\t//this.marker.remove();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (this.air.enabled)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.air.hide(e);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.selection.get().collapseToStart();\n\t\t\t\t\t\t\t//this.marker.remove();\n\t\t\t\t\t\t}\n\n\n\t\t\t\t\t}, this));\n\t\t\t\t},\n\t\t\t\thide: function(e)\n\t\t\t\t{\n\t\t\t\t\tvar ctrl = e.ctrlKey || e.metaKey || (e.shiftKey && e.altKey);\n\t\t\t\t\tif (ctrl)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.button.setInactiveAll();\n\t\t\t\t\tthis.$air.fadeOut(100);\n\t\t\t\t\tthis.air.enabled = false;\n\t\t\t\t\t$(document).off('mousedown.redactor-air.' + this.uuid);\n\t\t\t\t\t$(document).off('keydown.redactor-air.' + this.uuid);\n\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =autosave\n\t\tautosave: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tenabled: false,\n\t\t\t\thtml: false,\n\t\t\t\tinit: function()\n\t\t\t\t{\n\t\t\t\t\tif (!this.opts.autosave)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.autosave.enabled = true;\n\t\t\t\t\tthis.autosave.name = (this.opts.autosaveName) ? this.opts.autosaveName : this.$textarea.attr('name');\n\n\t\t\t\t},\n\t\t\t\tis: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.autosave.enabled;\n\t\t\t\t},\n\t\t\t\tsend: function()\n\t\t\t\t{\n\t\t\t\t\tif (!this.opts.autosave)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.autosave.source = this.code.get();\n\n\t\t\t\t\tif (this.autosave.html === this.autosave.source)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// data\n\t\t\t\t\tvar data = {};\n\t\t\t\t\tdata.name = this.autosave.name;\n\t\t\t\t\tdata[this.autosave.name] = this.autosave.source;\n\t\t\t\t\tdata = this.autosave.getHiddenFields(data);\n\n\t\t\t\t\t// ajax\n\t\t\t\t\tvar jsxhr = $.ajax({\n\t\t\t\t\t\turl: this.opts.autosave,\n\t\t\t\t\t\ttype: 'post',\n\t\t\t\t\t\tdata: data\n\t\t\t\t\t});\n\n\t\t\t\t\tjsxhr.done(this.autosave.success);\n\t\t\t\t},\n\t\t\t\tgetHiddenFields: function(data)\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.autosaveFields === false || typeof this.opts.autosaveFields !== 'object')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn data;\n\t\t\t\t\t}\n\n\t\t\t\t\t$.each(this.opts.autosaveFields, $.proxy(function(k, v)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (v !== null && v.toString().indexOf('#') === 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tv = $(v).val();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdata[k] = v;\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t\treturn data;\n\n\t\t\t\t},\n\t\t\t\tsuccess: function(data)\n\t\t\t\t{\n\t\t\t\t\tvar json;\n\t\t\t\t\ttry\n\t\t\t\t\t{\n\t\t\t\t\t\tjson = JSON.parse(data);\n\t\t\t\t\t}\n\t\t\t\t\tcatch(e)\n\t\t\t\t\t{\n\t\t\t\t\t\t//data has already been parsed\n\t\t\t\t\t\tjson = data;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar callbackName = (typeof json.error === 'undefined') ? 'autosave' :  'autosaveError';\n\n\t\t\t\t\tthis.core.callback(callbackName, this.autosave.name, json);\n\t\t\t\t\tthis.autosave.html = this.autosave.source;\n\t\t\t\t},\n\t\t\t\tdisable: function()\n\t\t\t\t{\n\t\t\t\t\tthis.autosave.enabled = false;\n\n\t\t\t\t\tclearInterval(this.autosaveTimeout);\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =block\n\t\tblock: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tformat: function(tag, attr, value, type)\n\t\t\t\t{\n\t\t\t\t\ttag = (tag === 'quote') ? 'blockquote' : tag;\n\n\t\t\t\t\tthis.block.tags = ['p', 'blockquote', 'pre', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'div', 'figure'];\n\t\t\t\t\tif ($.inArray(tag, this.block.tags) === -1)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (tag === 'p' && typeof attr === 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\t// remove all\n\t\t\t\t\t\tattr = 'class';\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.placeholder.hide();\n\t\t\t\t\tthis.buffer.set();\n\n\t\t\t\t\treturn (this.utils.isCollapsed()) ? this.block.formatCollapsed(tag, attr, value, type) : this.block.formatUncollapsed(tag, attr, value, type);\n\t\t\t\t},\n\t\t\t\tformatCollapsed: function(tag, attr, value, type)\n\t\t\t\t{\n\t\t\t\t\tthis.selection.save();\n\n\t\t\t\t\tvar block = this.selection.block();\n\t\t\t\t\tvar currentTag = block.tagName.toLowerCase();\n\t\t\t\t\tif ($.inArray(currentTag, this.block.tags) === -1)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.selection.restore();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n                    var clearAllAttrs = false;\n\t\t\t\t\tif (currentTag === tag && attr === undefined)\n\t\t\t\t\t{\n\t\t\t\t\t\ttag = 'p';\n\t\t\t\t\t\tclearAllAttrs = true;\n\t\t\t\t\t}\n\n\n                    if (clearAllAttrs)\n                    {\n                        this.block.removeAllClass();\n                        this.block.removeAllAttr();\n                    }\n\n\n                    var replaced;\n                    if (currentTag === 'blockquote' && this.utils.isEndOfElement(block))\n                    {\n                        this.marker.remove();\n\n                        replaced = document.createElement('p');\n                        replaced.innerHTML = this.opts.invisibleSpace;\n\n                        $(block).after(replaced);\n                        this.caret.start(replaced);\n                        var $last = $(block).children().last();\n\n                        if ($last.length !== 0 && $last[0].tagName === 'BR')\n                        {\n                            $last.remove();\n                        }\n                    }\n                    else\n                    {\n\t\t\t\t\t    replaced = this.utils.replaceToTag(block, tag);\n                    }\n\n\n\t\t\t\t\tif (typeof attr === 'object')\n\t\t\t\t\t{\n\t\t\t\t\t\ttype = value;\n\t\t\t\t\t\tfor (var key in attr)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treplaced = this.block.setAttr(replaced, key, attr[key], type);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\treplaced = this.block.setAttr(replaced, attr, value, type);\n\t\t\t\t\t}\n\n\n\t\t\t\t\t// trim pre\n\t\t\t\t\tif (tag === 'pre' && replaced.length === 1)\n\t\t\t\t\t{\n\t\t\t\t\t\t$(replaced).html($.trim($(replaced).html()));\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.selection.restore();\n\t\t\t\t\tthis.block.removeInlineTags(replaced);\n\n\t\t\t\t\treturn replaced;\n\t\t\t\t},\n\t\t\t\tformatUncollapsed: function(tag, attr, value, type)\n\t\t\t\t{\n                    this.selection.save();\n\n\t\t\t\t\tvar replaced = [];\n\t\t\t\t\tvar blocks = this.selection.blocks();\n\n                    if (blocks[0] && ($(blocks[0]).hasClass('redactor-in') || $(blocks[0]).hasClass('redactor-box')))\n                    {\n                        blocks = this.core.editor().find(this.opts.blockTags.join(', '));\n\t\t\t\t\t}\n\n\t\t\t\t\tvar len = blocks.length;\n\t\t\t\t\tfor (var i = 0; i < len; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar currentTag = blocks[i].tagName.toLowerCase();\n\t\t\t\t\t\tif ($.inArray(currentTag, this.block.tags) !== -1 && currentTag !== 'figure')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar block = this.utils.replaceToTag(blocks[i], tag);\n\n\t\t\t\t\t\t\tif (typeof attr === 'object')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttype = value;\n\t\t\t\t\t\t\t\tfor (var key in attr)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tblock = this.block.setAttr(block, key, attr[key], type);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tblock = this.block.setAttr(block, attr, value, type);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treplaced.push(block);\n\t\t\t\t\t\t\tthis.block.removeInlineTags(block);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.selection.restore();\n\n\t\t\t\t\t// combine pre\n\t\t\t\t\tif (tag === 'pre' && replaced.length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar first = replaced[0];\n\t\t\t\t\t\t$.each(replaced, function(i,s)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (i !== 0)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$(first).append(\"\\n\" + $.trim(s.html()));\n\t\t\t\t\t\t\t\t$(s).remove();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treplaced = [];\n\t\t\t\t\t\treplaced.push(first);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn replaced;\n\t\t\t\t},\n\t\t\t\tremoveInlineTags: function(node)\n\t\t\t\t{\n\t\t\t\t\tnode = node[0] || node;\n\n\t\t\t\t\tvar tags = this.opts.inlineTags;\n\t\t\t\t\tvar blocks = ['PRE', 'H1', 'H2', 'H3', 'H4', 'H5', 'H6'];\n\n\t\t\t\t\tif ($.inArray(node.tagName, blocks) === - 1)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (node.tagName !== 'PRE')\n\t\t\t\t\t{\n\t\t\t\t\t\tvar index = tags.indexOf('a');\n\t\t\t\t\t\ttags.splice(index, 1);\n\t\t\t\t\t}\n\n\t\t\t\t\t$(node).find(tags.join(',')).not('.redactor-selection-marker').contents().unwrap();\n\t\t\t\t},\n\t\t\t\tsetAttr: function(block, attr, value, type)\n\t\t\t\t{\n\t\t\t\t\tif (typeof attr === 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn block;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar func = (typeof type === 'undefined') ? 'replace' : type;\n\n\t\t\t\t\tif (attr === 'class')\n\t\t\t\t\t{\n\t\t\t\t\t\tblock = this.block[func + 'Class'](value, block);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tif (func === 'remove')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tblock = this.block[func + 'Attr'](attr, block);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (func === 'removeAll')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tblock = this.block[func + 'Attr'](attr, block);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tblock = this.block[func + 'Attr'](attr, value, block);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn block;\n\n\t\t\t\t},\n\t\t\t\tgetBlocks: function(block)\n\t\t\t\t{\n\t\t\t\t\tblock = (typeof block === 'undefined') ? this.selection.blocks() : block;\n\n    \t\t\t\tif ($(block).hasClass('redactor-box'))\n    \t\t\t\t{\n        \t\t\t\tvar blocks = [];\n        \t\t\t\tvar nodes = this.core.editor().children();\n        \t\t\t    $.each(nodes, $.proxy(function(i,node)\n    \t\t\t\t\t{\n    \t\t\t\t\t\tif (this.utils.isBlock(node))\n    \t\t\t\t\t\t{\n    \t\t\t\t\t\t\tblocks.push(node);\n    \t\t\t\t\t\t}\n\n    \t\t\t\t\t}, this));\n\n    \t\t\t\t\treturn blocks;\n    \t\t\t\t}\n\n    \t\t\t\treturn block\n\t\t\t\t},\n\t\t\t\treplaceClass: function(value, block)\n\t\t\t\t{\n\t\t\t\t\treturn $(this.block.getBlocks(block)).removeAttr('class').addClass(value)[0];\n\t\t\t\t},\n\t\t\t\ttoggleClass: function(value, block)\n\t\t\t\t{\n\t\t\t\t\treturn $(this.block.getBlocks(block)).toggleClass(value)[0];\n\t\t\t\t},\n\t\t\t\taddClass: function(value, block)\n\t\t\t\t{\n\t\t\t\t\treturn $(this.block.getBlocks(block)).addClass(value)[0];\n\t\t\t\t},\n\t\t\t\tremoveClass: function(value, block)\n\t\t\t\t{\n\t\t\t\t\treturn $(this.block.getBlocks(block)).removeClass(value)[0];\n\t\t\t\t},\n\t\t\t\tremoveAllClass: function(block)\n\t\t\t\t{\n\t\t\t\t\treturn $(this.block.getBlocks(block)).removeAttr('class')[0];\n\t\t\t\t},\n\t\t\t\treplaceAttr: function(attr, value, block)\n\t\t\t\t{\n\t\t\t\t\tblock = this.block.removeAttr(attr, block);\n\n\t\t\t\t\treturn $(block).attr(attr, value)[0];\n\t\t\t\t},\n\t\t\t\ttoggleAttr: function(attr, value, block)\n\t\t\t\t{\n\t\t\t\t\tblock = this.block.getBlocks(block);\n\n\t\t\t\t\tvar self = this;\n\t\t\t\t\tvar returned = [];\n\t\t\t\t\t$.each(block, function(i,s)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar $el = $(s);\n\t\t\t\t\t\tif ($el.attr(attr))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturned.push(self.block.removeAttr(attr, s));\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturned.push(self.block.addAttr(attr, value, s));\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\treturn returned;\n\n\t\t\t\t},\n\t\t\t\taddAttr: function(attr, value, block)\n\t\t\t\t{\n\t\t\t\t\treturn $(this.block.getBlocks(block)).attr(attr, value)[0];\n\t\t\t\t},\n\t\t\t\tremoveAttr: function(attr, block)\n\t\t\t\t{\n\t\t\t\t\treturn $(this.block.getBlocks(block)).removeAttr(attr)[0];\n\t\t\t\t},\n\t\t\t\tremoveAllAttr: function(block)\n\t\t\t\t{\n\t\t\t\t\tblock = this.block.getBlocks(block);\n\n\t\t\t\t\tvar returned = [];\n\t\t\t\t\t$.each(block, function(i,s)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (typeof s.attributes !== 'undefined')\n                        {\n    \t\t\t\t\t\twhile (s.attributes.length)\n    \t\t\t\t\t\t{\n                                s.removeAttribute(s.attributes[0].name);\n                            }\n                        }\n\n\t\t\t\t\t\treturned.push(s);\n\t\t\t\t\t});\n\n\t\t\t\t\treturn returned;\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// buffer\n\t\tbuffer: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tset: function(type)\n\t\t\t\t{\n    \t\t\t\tif (typeof type === 'undefined')\n                    {\n                        this.buffer.clear();\n                    }\n\n\t\t\t\t\tif (typeof type === 'undefined' || type === 'undo')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buffer.setUndo();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buffer.setRedo();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tsetUndo: function()\n\t\t\t\t{\n                    var saved = this.selection.saveInstant();\n\n\t\t\t\t\tvar last = this.sBuffer[this.sBuffer.length-1];\n\t\t\t\t\tvar current = this.core.editor().html();\n\n\t\t\t\t\tvar save = (typeof last !== 'undefined' && (last[0] === current)) ? false : true;\n    \t\t\t\tif (save)\n    \t\t\t\t{\n\t\t\t\t\t\tthis.sBuffer.push([current, saved]);\n\t\t\t\t\t}\n\n\t\t\t\t\t//this.selection.restore();\n\t\t\t\t},\n\t\t\t\tsetRedo: function()\n\t\t\t\t{\n\t\t\t\t\tvar saved = this.selection.saveInstant();\n\t\t\t\t\tthis.sRebuffer.push([this.core.editor().html(), saved]);\n\t\t\t\t\t//this.selection.restore();\n\t\t\t\t},\n\t\t\t\tadd: function()\n\t\t\t\t{\n\t\t\t\t\tthis.sBuffer.push([this.core.editor().html(), 0]);\n\t\t\t\t},\n\t\t\t\tundo: function()\n\t\t\t\t{\n\t\t\t\t\tif (this.sBuffer.length === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar buffer = this.sBuffer.pop();\n\n\t\t\t\t\tthis.buffer.set('redo');\n\t\t\t\t\tthis.core.editor().html(buffer[0]);\n\n\t\t\t\t\tthis.selection.restoreInstant(buffer[1]);\n\t\t\t\t\tthis.selection.restore();\n\t\t\t\t\tthis.observe.load();\n\t\t\t\t},\n\t\t\t\tredo: function()\n\t\t\t\t{\n\t\t\t\t\tif (this.sRebuffer.length === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar buffer = this.sRebuffer.pop();\n\n\t\t\t\t\tthis.buffer.set('undo');\n\t\t\t\t\tthis.core.editor().html(buffer[0]);\n\n\t\t\t\t\tthis.selection.restoreInstant(buffer[1]);\n\t\t\t\t\tthis.selection.restore();\n\t\t\t\t\tthis.observe.load();\n\t\t\t\t},\n\t\t\t\tclear: function()\n\t\t\t\t{\n    \t\t\t\tthis.sRebuffer = [];\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =build\n\t\tbuild: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tstart: function()\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.type === 'inline')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.opts.type = 'inline';\n\t\t\t\t\t}\n\t\t\t\t\telse if (this.opts.type === 'div')\n\t\t\t\t\t{\n\t\t\t\t\t\t// empty\n\t\t\t\t\t\tvar html = $.trim(this.$editor.html());\n\t\t\t\t\t\tif (html === '')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.$editor.html(this.opts.emptyHtml);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.build.buildTextarea();\n\t\t\t\t\t}\n\t\t\t\t\telse if (this.opts.type === 'textarea')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.build.startTextarea();\n\t\t\t\t\t}\n\n\t\t\t\t\t// set in\n\t\t\t\t\tthis.build.setIn();\n\n\t\t\t\t\t// set id\n\t\t\t\t\tthis.build.setId();\n\n\t\t\t\t\t// enable\n\t\t\t\t\tthis.build.enableEditor();\n\n\t\t\t\t\t// options\n\t\t\t\t\tthis.build.setOptions();\n\n\t\t\t\t\t// call\n\t\t\t\t\tthis.build.callEditor();\n\n\n\t\t\t\t},\n\t\t\t\tcreateContainerBox: function()\n\t\t\t\t{\n\t\t\t\t\tthis.$box = $('<div class=\"redactor-box\" role=\"application\" />');\n\t\t\t\t},\n\t\t\t\tsetIn: function()\n\t\t\t\t{\n\t\t\t\t\tthis.core.editor().addClass('redactor-in');\n\t\t\t\t},\n\t\t\t\tsetId: function()\n\t\t\t\t{\n\t\t\t\t\tvar id = (this.opts.type === 'textarea') ? 'redactor-uuid-' + this.uuid : this.$element.attr('id');\n\n\t\t\t\t\tthis.core.editor().attr('id', (typeof id === 'undefined') ? 'redactor-uuid-' + this.uuid : id);\n\t\t\t\t},\n\t\t\t\tgetName: function()\n\t\t\t\t{\n\t\t\t\t\tvar name = this.$element.attr('name');\n\n\t\t\t\t\treturn (typeof name === 'undefined') ? 'content-' + this.uuid : name;\n\t\t\t\t},\n\t\t\t\tbuildTextarea: function()\n\t\t\t\t{\n    \t\t\t\tthis.$textarea = $('<textarea>');\n    \t\t\t\tthis.$textarea.attr('name', this.build.getName());\n    \t\t\t\tthis.$textarea.hide();\n    \t\t\t\tthis.$element.after(this.$textarea);\n\n    \t\t\t\tthis.build.setStartAttrs();\n\t\t\t\t},\n\t\t\t\tloadFromTextarea: function()\n\t\t\t\t{\n\t\t\t\t\tthis.$editor = $('<div />');\n\n\t\t\t\t\t// textarea\n\t\t\t\t\tthis.$textarea = this.$element;\n\t\t\t\t\tthis.$element.attr('name', this.build.getName());\n\n\t\t\t\t\t// place\n\t\t\t\t\tthis.$box.insertAfter(this.$element).append(this.$editor).append(this.$element);\n\n                    this.build.setStartAttrs();\n\n                    // styles\n                    this.$editor.addClass('redactor-layer');\n                    if (this.opts.overrideStyles) this.$editor.addClass('redactor-styles');\n\n\t\t\t\t\tthis.$element.hide();\n\n\t\t\t\t\tthis.$box.prepend('<span class=\"redactor-voice-label\" id=\"redactor-voice-' + this.uuid +'\" aria-hidden=\"false\">' + this.lang.get('accessibility-help-label') + '</span>');\n\n\t\t\t\t},\n\t\t\t\tsetStartAttrs: function()\n\t\t\t\t{\n                    this.$editor.attr({ 'aria-labelledby': 'redactor-voice-' + this.uuid, 'role': 'presentation' });\n\t\t\t\t},\n\t\t\t\tstartTextarea: function()\n\t\t\t\t{\n\t\t\t\t\tthis.build.createContainerBox();\n\n\t\t\t\t\t// load\n\t\t\t\t\tthis.build.loadFromTextarea();\n\n\t\t\t\t\t// set code\n\t\t\t\t\tthis.code.start(this.core.textarea().val());\n\n\t\t\t\t\t// set value\n\t\t\t\t\tthis.core.textarea().val(this.clean.onSync(this.$editor.html()));\n\t\t\t\t},\n\t\t\t\tisTag: function(tag)\n\t\t\t\t{\n\t\t\t\t\treturn (this.$element[0].tagName === tag);\n\t\t\t\t},\n\t\t\t\tisInline: function()\n\t\t\t\t{\n\t\t\t\t\treturn (!this.build.isTag('TEXTAREA') && !this.build.isTag('DIV') && !this.build.isTag('PRE'));\n\t\t\t\t},\n\t\t\t\tenableEditor: function()\n\t\t\t\t{\n\t\t\t\t\tthis.core.editor().attr({ 'contenteditable': true });\n\t\t\t\t},\n\t\t\t\tsetOptions: function()\n\t\t\t\t{\n\t\t\t\t\t// inline\n\t\t\t\t\tif (this.opts.type === 'inline')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.opts.enterKey = false;\n\t\t\t\t\t}\n\n\t\t\t\t\t// inline & pre\n\t\t\t\t\tif (this.opts.type === 'inline' || this.opts.type === 'pre')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.opts.toolbarMobile = false;\n\t\t\t\t\t\tthis.opts.toolbar = false;\n\t\t\t\t\t\tthis.opts.air = false;\n\t\t\t\t\t\tthis.opts.linkify = false;\n\n\t\t\t\t\t}\n\n\t\t\t\t\t// spellcheck\n\t\t\t\t\tthis.core.editor().attr('spellcheck', this.opts.spellcheck);\n\n\t\t\t\t\t// structure\n\t\t\t\t\tif (this.opts.structure)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.editor().addClass('redactor-structure');\n\t\t\t\t\t}\n\n\t\t\t\t\t// styles class\n\t\t\t\t\tif (this.opts.stylesClass)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.editor().addClass(this.opts.stylesClass);\n\t\t\t\t\t}\n\n\t\t\t\t\t// options sets only in textarea mode\n\t\t\t\t\tif (this.opts.type !== 'textarea')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// direction\n\t\t\t\t\tthis.core.box().attr('dir', this.opts.direction);\n\t\t\t\t\tthis.core.editor().attr('dir', this.opts.direction);\n\n\t\t\t\t\t// tabindex\n\t\t\t\t\tif (this.opts.tabindex)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.editor().attr('tabindex', this.opts.tabindex);\n\t\t\t\t\t}\n\n\t\t\t\t\t// min height\n\t\t\t\t\tif (this.opts.minHeight)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.editor().css('min-height', this.opts.minHeight);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.editor().css('min-height', '40px');\n\t\t\t\t\t}\n\n\t\t\t\t\t// max height\n\t\t\t\t\tif (this.opts.maxHeight)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.editor().css('max-height', this.opts.maxHeight);\n\t\t\t\t\t}\n\n\t\t\t\t\t// max width\n\t\t\t\t\tif (this.opts.maxWidth)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.editor().css({ 'max-width': this.opts.maxWidth, 'margin': 'auto' });\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\tcallEditor: function()\n\t\t\t\t{\n\t\t\t\t\tthis.build.disableBrowsersEditing();\n\n\t\t\t\t\tthis.events.init();\n\t\t\t\t\tthis.build.setHelpers();\n\n\t\t\t\t\t// init buttons\n\t\t\t\t\tif (this.opts.toolbar || this.opts.air)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.toolbarsButtons = this.button.init();\n\t\t\t\t\t}\n\n\t\t\t\t\t// load toolbar\n\t\t\t\t\tif (this.opts.air)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.air.build();\n\t\t\t\t\t}\n\t\t\t\t\telse if (this.opts.toolbar)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.toolbar.build();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.detect.isMobile() && this.opts.toolbarMobile && this.opts.air)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.opts.toolbar = true;\n\t\t\t\t\t\tthis.toolbar.build();\n\t\t\t\t\t}\n\n\t\t\t\t\t// observe dropdowns\n\t\t\t\t\tif (this.opts.air || this.opts.toolbar)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.editor().on('mouseup.redactor-observe.' + this.uuid + ' keyup.redactor-observe.' + this.uuid + ' focus.redactor-observe.' + this.uuid + ' touchstart.redactor-observe.' + this.uuid, $.proxy(this.observe.toolbar, this));\n\t\t\t\t\t\tthis.core.element().on('blur.callback.redactor', $.proxy(function()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.button.setInactiveAll();\n\n\t\t\t\t\t\t}, this));\n\t\t\t\t\t}\n\n\t\t\t\t\t// modal templates init\n\t\t\t\t\tthis.modal.templates();\n\n\t\t\t\t\t// plugins\n\t\t\t\t\tthis.build.plugins();\n\n\t\t\t\t\t// autosave\n\t\t\t\t\tthis.autosave.init();\n\n\t\t\t\t\t// sync code\n\t\t\t\t\tthis.code.html = this.code.cleaned(this.core.editor().html());\n\n\t\t\t\t\t// init callback\n\t\t\t\t\tthis.core.callback('init');\n\t\t\t\t\tthis.core.callback('initToEdit');\n\n\t\t\t\t\t// get images & files list\n\t\t\t\t\tthis.storage.observe();\n\n\t\t\t\t\t// started\n\t\t\t\t\tthis.start = false;\n\n\t\t\t\t},\n\t\t\t\tsetHelpers: function()\n\t\t\t\t{\n\t\t\t\t\t// linkify\n\t\t\t\t\tif (this.opts.linkify)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.linkify.format();\n\t\t\t\t\t}\n\n\t\t\t\t\t// placeholder\n\t\t\t\t\tthis.placeholder.init();\n\n\t\t\t\t\t// focus\n\t\t\t\t\tif (this.opts.focus)\n\t\t\t\t\t{\n\t\t\t\t\t\tsetTimeout(this.focus.start, 100);\n\t\t\t\t\t}\n\t\t\t\t\telse if (this.opts.focusEnd)\n\t\t\t\t\t{\n\t\t\t\t\t\tsetTimeout(this.focus.end, 100);\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\tdisableBrowsersEditing: function()\n\t\t\t\t{\n\t\t\t\t\ttry {\n\t\t\t\t\t\t// FF fix\n\t\t\t\t\t\tdocument.execCommand('enableObjectResizing', false, false);\n\t\t\t\t\t\tdocument.execCommand('enableInlineTableEditing', false, false);\n\t\t\t\t\t\t// IE prevent converting links\n\t\t\t\t\t\tdocument.execCommand(\"AutoUrlDetect\", false, false);\n\t\t\t\t\t} catch (e) {}\n\t\t\t\t},\n\t\t\t\tplugins: function()\n\t\t\t\t{\n\t\t\t\t\tif (!this.opts.plugins)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t$.each(this.opts.plugins, $.proxy(function(i, s)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar func = (typeof RedactorPlugins !== 'undefined' && typeof RedactorPlugins[s] !== 'undefined') ? RedactorPlugins : Redactor.fn;\n\n\t\t\t\t\t\tif (!$.isFunction(func[s]))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis[s] = func[s]();\n\n\t\t\t\t\t\t// get methods\n\t\t\t\t\t\tvar methods = this.getModuleMethods(this[s]);\n\t\t\t\t\t\tvar len = methods.length;\n\n\t\t\t\t\t\t// bind methods\n\t\t\t\t\t\tfor (var z = 0; z < len; z++)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis[s][methods[z]] = this[s][methods[z]].bind(this);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// append lang\n\t\t\t\t\t\tif (typeof this[s].langs !== 'undefined')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar lang = {};\n\t\t\t\t\t\t\tif (typeof this[s].langs[this.opts.lang] !== 'undefined')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlang = this[s].langs[this.opts.lang];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse if (typeof this[s].langs[this.opts.lang] === 'undefined' && typeof this[s].langs.en !== 'undefined')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlang = this[s].langs.en;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// extend\n\t\t\t\t\t\t\tvar self = this;\n\t\t\t\t\t\t\t$.each(lang, function(i,s)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (typeof self.opts.curLang[i] === 'undefined')\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tself.opts.curLang[i] = s;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// init\n\t\t\t\t\t\tif ($.isFunction(this[s].init))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis[s].init();\n\t\t\t\t\t\t}\n\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =button\n\t\tbutton: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\ttoolbar: function()\n\t\t\t\t{\n\t\t\t\t\treturn (typeof this.button.$toolbar === 'undefined' || !this.button.$toolbar) ? this.$toolbar : this.button.$toolbar;\n\t\t\t\t},\n\t\t\t\tinit: function()\n\t\t\t\t{\n\t\t\t\t\treturn {\n\t\t\t\t\t\tformat:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: this.lang.get('format'),\n\t\t\t\t\t\t\ticon: true,\n\t\t\t\t\t\t\tdropdown:\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tp:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttitle: this.lang.get('paragraph'),\n\t\t\t\t\t\t\t\t\tfunc: 'block.format'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tblockquote:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttitle: this.lang.get('quote'),\n\t\t\t\t\t\t\t\t\tfunc: 'block.format'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tpre:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttitle: this.lang.get('code'),\n\t\t\t\t\t\t\t\t\tfunc: 'block.format'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\th1:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttitle: this.lang.get('heading1'),\n\t\t\t\t\t\t\t\t\tfunc: 'block.format'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\th2:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttitle: this.lang.get('heading2'),\n\t\t\t\t\t\t\t\t\tfunc: 'block.format'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\th3:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttitle: this.lang.get('heading3'),\n\t\t\t\t\t\t\t\t\tfunc: 'block.format'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\th4:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttitle: this.lang.get('heading4'),\n\t\t\t\t\t\t\t\t\tfunc: 'block.format'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\th5:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttitle: this.lang.get('heading5'),\n\t\t\t\t\t\t\t\t\tfunc: 'block.format'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\th6:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttitle: this.lang.get('heading6'),\n\t\t\t\t\t\t\t\t\tfunc: 'block.format'\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tbold:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: this.lang.get('bold-abbr'),\n\t\t\t\t\t\t\ticon: true,\n\t\t\t\t\t\t\tlabel: this.lang.get('bold'),\n\t\t\t\t\t\t\tfunc: 'inline.format'\n\t\t\t\t\t\t},\n\t\t\t\t\t\titalic:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: this.lang.get('italic-abbr'),\n\t\t\t\t\t\t\ticon: true,\n\t\t\t\t\t\t\tlabel: this.lang.get('italic'),\n\t\t\t\t\t\t\tfunc: 'inline.format'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdeleted:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: this.lang.get('deleted-abbr'),\n\t\t\t\t\t\t\ticon: true,\n\t\t\t\t\t\t\tlabel: this.lang.get('deleted'),\n\t\t\t\t\t\t\tfunc: 'inline.format'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tunderline:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: this.lang.get('underline-abbr'),\n\t\t\t\t\t\t\ticon: true,\n\t\t\t\t\t\t\tlabel: this.lang.get('underline'),\n\t\t\t\t\t\t\tfunc: 'inline.format'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tlists:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: this.lang.get('lists'),\n\t\t\t\t\t\t\ticon: true,\n\t\t\t\t\t\t\tdropdown:\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tunorderedlist:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttitle: '&bull; ' + this.lang.get('unorderedlist'),\n\t\t\t\t\t\t\t\t\tfunc: 'list.toggle'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\torderedlist:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttitle: '1. ' + this.lang.get('orderedlist'),\n\t\t\t\t\t\t\t\t\tfunc: 'list.toggle'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\toutdent:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttitle: '< ' + this.lang.get('outdent'),\n\t\t\t\t\t\t\t\t\tfunc: 'indent.decrease',\n\t\t\t\t\t\t\t\t\tobserve: {\n\t\t\t\t\t\t\t\t\t\telement: 'li',\n\t\t\t\t\t\t\t\t\t\tout: {\n\t\t\t\t\t\t\t\t\t\t\tattr: {\n\t\t\t\t\t\t\t\t\t\t\t\t'class': 'redactor-dropdown-link-inactive',\n\t\t\t\t\t\t\t\t\t\t\t\t'aria-disabled': true\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tindent:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttitle: '> ' + this.lang.get('indent'),\n\t\t\t\t\t\t\t\t\tfunc: 'indent.increase',\n\t\t\t\t\t\t\t\t\tobserve: {\n\t\t\t\t\t\t\t\t\t\telement: 'li',\n\t\t\t\t\t\t\t\t\t\tout: {\n\t\t\t\t\t\t\t\t\t\t\tattr: {\n\t\t\t\t\t\t\t\t\t\t\t\t'class': 'redactor-dropdown-link-inactive',\n\t\t\t\t\t\t\t\t\t\t\t\t'aria-disabled': true\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tul:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: '&bull; ' + this.lang.get('bulletslist'),\n\t\t\t\t\t\t\ticon: true,\n\t\t\t\t\t\t\tfunc: 'list.toggle'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tol:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: '1. ' + this.lang.get('numberslist'),\n\t\t\t\t\t\t\ticon: true,\n\t\t\t\t\t\t\tfunc: 'list.toggle'\n\t\t\t\t\t\t},\n\t\t\t\t\t\toutdent:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: this.lang.get('outdent'),\n\t\t\t\t\t\t\ticon: true,\n\t\t\t\t\t\t\tfunc: 'indent.decrease'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tindent:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: this.lang.get('indent'),\n\t\t\t\t\t\t\ticon: true,\n\t\t\t\t\t\t\tfunc: 'indent.increase'\n\t\t\t\t\t\t},\n\t\t\t\t\t\timage:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: this.lang.get('image'),\n\t\t\t\t\t\t\ticon: true,\n\t\t\t\t\t\t\tfunc: 'image.show'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfile:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: this.lang.get('file'),\n\t\t\t\t\t\t\ticon: true,\n\t\t\t\t\t\t\tfunc: 'file.show'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tlink:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: this.lang.get('link'),\n\t\t\t\t\t\t\ticon: true,\n\t\t\t\t\t\t\tdropdown:\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlink:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttitle: this.lang.get('link-insert'),\n\t\t\t\t\t\t\t\t\tfunc: 'link.show',\n\t\t\t\t\t\t\t\t\tobserve: {\n\t\t\t\t\t\t\t\t\t\telement: 'a',\n\t\t\t\t\t\t\t\t\t\t'in': {\n\t\t\t\t\t\t\t\t\t\t\ttitle: this.lang.get('link-edit')\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tout: {\n\t\t\t\t\t\t\t\t\t\t\ttitle: this.lang.get('link-insert')\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tunlink:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttitle: this.lang.get('unlink'),\n\t\t\t\t\t\t\t\t\tfunc: 'link.unlink',\n\t\t\t\t\t\t\t\t\tobserve: {\n\t\t\t\t\t\t\t\t\t\telement: 'a',\n\t\t\t\t\t\t\t\t\t\tout: {\n\t\t\t\t\t\t\t\t\t\t\tattr: {\n\t\t\t\t\t\t\t\t\t\t\t\t'class': 'redactor-dropdown-link-inactive',\n\t\t\t\t\t\t\t\t\t\t\t\t'aria-disabled': true\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\thorizontalrule:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: this.lang.get('horizontalrule'),\n\t\t\t\t\t\t\ticon: true,\n\t\t\t\t\t\t\tfunc: 'line.insert'\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t\tsetFormatting: function()\n\t\t\t\t{\n\t\t\t\t\t$.each(this.toolbarsButtons.format.dropdown, $.proxy(function (i, s)\n\t\t\t\t\t{\n\t\t\t\t\t\tif ($.inArray(i, this.opts.formatting) === -1)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdelete this.toolbarsButtons.format.dropdown[i];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t},\n\t\t\t\thideButtons: function()\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.buttonsHide.length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.button.hideButtonsSlicer(this.opts.buttonsHide);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\thideButtonsOnMobile: function()\n\t\t\t\t{\n\t\t\t\t\tif (this.detect.isMobile() && this.opts.buttonsHideOnMobile.length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.button.hideButtonsSlicer(this.opts.buttonsHideOnMobile);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\thideButtonsSlicer: function(buttons)\n\t\t\t\t{\n\t\t\t\t\t$.each(buttons, $.proxy(function(i, s)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar index = this.opts.buttons.indexOf(s);\n\t\t\t\t\t\tif (index !== -1)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t    this.opts.buttons.splice(index, 1);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}, this));\n\t\t\t\t},\n\t\t\t\tload: function($toolbar)\n\t\t\t\t{\n\t\t\t\t\tthis.button.buttons = [];\n\n\t\t\t\t\t$.each(this.opts.buttons, $.proxy(function(i, btnName)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!this.toolbarsButtons[btnName]\n\t\t\t\t\t\t\t|| (btnName === 'file' && !this.file.is())\n\t\t\t\t\t\t\t|| (btnName === 'image' && !this.image.is()))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t$toolbar.append($('<li>').append(this.button.build(btnName, this.toolbarsButtons[btnName])));\n\n\t\t\t\t\t}, this));\n\t\t\t\t},\n\t\t\t\tbuildButtonTooltip: function($btn, title)\n\t\t\t\t{\n    \t\t\t\tif (typeof this.button.toolbar() === 'undefined') return;\n    \t\t\t\tif (this.opts.air || this.detect.isMobile()) return;\n\n                    var $tooltip = $('<span>');\n\t\t\t\t    $tooltip.addClass('re-button-tooltip');\n\t\t\t\t    $tooltip.html(title);\n\n                    var self = this;\n                    var $toolbar = this.button.toolbar();\n                    var $box = $toolbar.closest('.redactor-toolbar-box');\n                    $box = ($box.length === 0) ? $toolbar : $box;\n                    $box.prepend($tooltip);\n                    $btn.on('mouseover', function()\n                    {\n                        if ($(this).hasClass('redactor-button-disabled'))\n                        {\n                            return;\n                        }\n\n                        var pos = ($toolbar.hasClass('toolbar-fixed-box')) ? $btn.offset() : $btn.position();\n                        pos = (self.opts.toolbarFixedTarget !== document) ? $btn.position() : pos;\n                        var top = ($toolbar.hasClass('toolbar-fixed-box')) ? $btn.position().top : pos.top;\n                        var height = $btn.innerHeight();\n                        var width = $btn.innerWidth();\n                        var posBox = ($toolbar.hasClass('toolbar-fixed-box')) ? 'fixed' : 'absolute';\n                        posBox = (self.opts.toolbarFixedTarget !== document) ? 'absolute' : posBox;\n                        var scrollFix = (self.opts.toolbarFixedTarget !== document) ? $toolbar.position().top : 0;\n\n                        $tooltip.show();\n                        $tooltip.css({\n                            top: (top + height + scrollFix) + 'px',\n                            left: (pos.left + width/2 - $tooltip.innerWidth()/2) + 'px',\n                            position: posBox\n                        });\n\n                    }).on('mouseout', function()\n                    {\n                        $tooltip.hide();\n                    });\n\t\t\t\t},\n\t\t\t\tbuild: function(btnName, btnObject)\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.toolbar === false)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n                    var title = (typeof btnObject.label !== 'undefined') ? btnObject.label : btnObject.title;\n\t\t\t\t\tvar $button = $('<a href=\"javascript:void(null);\" alt=\"' + title + '\" rel=\"' + btnName + '\" />')\n\n                    $button.addClass('re-button re-' + btnName);\n\t\t\t\t\t$button.attr({ 'role': 'button', 'aria-label': title, 'tabindex': '-1' });\n\n                    if (typeof btnObject.icon !== 'undefined' && !this.opts.buttonsTextLabeled)\n                    {\n    \t\t\t\t\tvar $icon = $('<i>');\n\t\t\t\t\t    $icon.addClass('re-icon-' + btnName);\n\n\t\t\t\t\t    $button.append($icon);\n\t\t\t\t\t    $button.addClass('re-button-icon');\n\n                        this.button.buildButtonTooltip($button, title);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n    \t\t\t\t\t$button.html(btnObject.title);\n\t\t\t\t\t}\n\n\t\t\t\t\t// click\n\t\t\t\t\tif (btnObject.func || btnObject.command || btnObject.dropdown)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.button.setEvent($button, btnName, btnObject);\n\t\t\t\t\t}\n\n\t\t\t\t\t// dropdown\n\t\t\t\t\tif (btnObject.dropdown)\n\t\t\t\t\t{\n\t\t\t\t\t\t$button.addClass('redactor-toolbar-link-dropdown').attr('aria-haspopup', true);\n\n\t\t\t\t\t\tvar $dropdown = $('<ul class=\"redactor-dropdown redactor-dropdown-' + this.uuid + ' redactor-dropdown-box-' + btnName + '\" style=\"display: none;\">');\n\t\t\t\t\t\t$button.data('dropdown', $dropdown);\n\t\t\t\t\t\tthis.dropdown.build(btnName, $dropdown, btnObject.dropdown);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.button.buttons.push($button);\n\n\t\t\t\t\treturn $button;\n\t\t\t\t},\n\t\t\t\tgetButtons: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.button.toolbar().find('a.re-button');\n\t\t\t\t},\n\t\t\t\tgetButtonsKeys: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.button.buttons;\n\t\t\t\t},\n\t\t\t\tsetEvent: function($button, btnName, btnObject)\n\t\t\t\t{\n\t\t\t\t\t$button.on('mousedown', $.proxy(function(e)\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\tif ($button.hasClass('redactor-button-disabled'))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar type = 'func';\n\t\t\t\t\t\tvar callback = btnObject.func;\n\n\t\t\t\t\t\tif (btnObject.command)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttype = 'command';\n\t\t\t\t\t\t\tcallback = btnObject.command;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (btnObject.dropdown)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttype = 'dropdown';\n\t\t\t\t\t\t\tcallback = false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.button.toggle(e, btnName, type, callback);\n\n\t\t\t\t\t\treturn false;\n\n\t\t\t\t\t}, this));\n\t\t\t\t},\n\t\t\t\ttoggle: function(e, btnName, type, callback, args)\n\t\t\t\t{\n\n\t\t\t\t\tif (this.detect.isIe() || !this.detect.isDesktop())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.utils.freezeScroll();\n\t\t\t\t\t\te.returnValue = false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (type === 'command')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.inline.format(callback);\n\t\t\t\t\t}\n\t\t\t\t\telse if (type === 'dropdown')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.dropdown.show(e, btnName);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.button.clickCallback(e, callback, btnName, args);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (type !== 'dropdown')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.dropdown.hideAll(false);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.opts.air && type !== 'dropdown')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.air.hide(e);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.detect.isIe() || !this.detect.isDesktop())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.utils.unfreezeScroll();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tclickCallback: function(e, callback, btnName, args)\n\t\t\t\t{\n\t\t\t\t\tvar func;\n\n\t\t\t\t\targs = (typeof args === 'undefined') ? btnName : args;\n\n\t\t\t\t\tif ($.isFunction(callback))\n\t\t\t\t\t{\n\t\t\t\t\t\tcallback.call(this, btnName);\n\t\t\t\t\t}\n\t\t\t\t\telse if (callback.search(/\\./) !== '-1')\n\t\t\t\t\t{\n\t\t\t\t\t\tfunc = callback.split('.');\n\t\t\t\t\t\tif (typeof this[func[0]] === 'undefined')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (typeof args === 'object')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis[func[0]][func[1]].apply(this, args);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis[func[0]][func[1]].call(this, args);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\n\t\t\t\t\t\tif (typeof args === 'object')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis[callback].apply(this, args);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis[callback].call(this, args);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.observe.buttons(e, btnName);\n\n\t\t\t\t},\n\t\t\t\tall: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.button.buttons;\n\t\t\t\t},\n\t\t\t\tget: function(key)\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.toolbar === false)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn this.button.toolbar().find('a.re-' + key);\n\t\t\t\t},\n\t\t\t\tset: function(key, title)\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.toolbar === false)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar $btn = this.button.toolbar().find('a.re-' + key);\n\n\t\t\t\t\t$btn.html(title).attr('aria-label', title);\n\n\t\t\t\t\treturn $btn;\n\t\t\t\t},\n\t\t\t\tadd: function(key, title)\n\t\t\t\t{\n\t\t\t\t\tif (this.button.isAdded(key) !== true)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn $();\n\t\t\t\t\t}\n\n\t\t\t\t\tvar btn = this.button.build(key, { title: title });\n\n\t\t\t\t\tthis.button.toolbar().append($('<li>').append(btn));\n\n\t\t\t\t\treturn btn;\n\t\t\t\t},\n\t\t\t\taddFirst: function(key, title)\n\t\t\t\t{\n\t\t\t\t\tif (this.button.isAdded(key) !== true)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn $();\n\t\t\t\t\t}\n\n\t\t\t\t\tvar btn = this.button.build(key, { title: title });\n\n\t\t\t\t\tthis.button.toolbar().prepend($('<li>').append(btn));\n\n\t\t\t\t\treturn btn;\n\t\t\t\t},\n\t\t\t\taddAfter: function(afterkey, key, title)\n\t\t\t\t{\n\t\t\t\t\tif (this.button.isAdded(key) !== true)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn $();\n\t\t\t\t\t}\n\n\t\t\t\t\tvar btn = this.button.build(key, { title: title });\n\t\t\t\t\tvar $btn = this.button.get(afterkey);\n\n\t\t\t\t\tif ($btn.length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\t$btn.parent().after($('<li>').append(btn));\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.button.toolbar().append($('<li>').append(btn));\n\t\t\t\t\t}\n\n\t\t\t\t\treturn btn;\n\t\t\t\t},\n\t\t\t\taddBefore: function(beforekey, key, title)\n\t\t\t\t{\n\t\t\t\t\tif (this.button.isAdded(key) !== true)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn $();\n\t\t\t\t\t}\n\n\t\t\t\t\tvar btn = this.button.build(key, { title: title });\n\t\t\t\t\tvar $btn = this.button.get(beforekey);\n\n\t\t\t\t\tif ($btn.length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\t$btn.parent().before($('<li>').append(btn));\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.button.toolbar().append($('<li>').append(btn));\n\t\t\t\t\t}\n\n\t\t\t\t\treturn btn;\n\t\t\t\t},\n\t\t\t\tisAdded: function(key)\n\t\t\t\t{\n\t                var index = this.opts.buttonsHideOnMobile.indexOf(key);\n                    if (this.opts.toolbar === false || (index !== -1 && this.detect.isMobile()))\n                    {\n\t\t\t\t\t    return false;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn true;\n\t\t\t\t},\n\t\t\t\tsetIcon: function($btn, icon)\n\t\t\t\t{\n    \t\t\t\tif (!this.opts.buttonsTextLabeled)\n    \t\t\t\t{\n    \t\t\t\t\t$btn.html(icon).addClass('re-button-icon');\n\t\t\t\t\t    this.button.buildButtonTooltip($btn, $btn.attr('alt'));\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tchangeIcon: function(key, newIconClass)\n\t\t\t\t{\n                    var $btn = this.button.get(key);\n                    if ($btn.length !== 0)\n\t\t\t\t\t{\n    \t\t\t\t\t$btn.find('i').removeAttr('class').addClass('re-icon-' + newIconClass);\n    \t\t\t\t}\n\t\t\t\t},\n\t\t\t\taddCallback: function($btn, callback)\n\t\t\t\t{\n\t\t\t\t\tif (typeof $btn === 'undefined' || this.opts.toolbar === false)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar type = (callback === 'dropdown') ? 'dropdown' : 'func';\n\t\t\t\t\tvar key = $btn.attr('rel');\n\t\t\t\t\t$btn.on('mousedown', $.proxy(function(e)\n\t\t\t\t\t{\n\t\t\t\t\t\tif ($btn.hasClass('redactor-button-disabled'))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.button.toggle(e, key, type, callback);\n\n\t\t\t\t\t}, this));\n\t\t\t\t},\n\t\t\t\taddDropdown: function($btn, dropdown)\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.toolbar === false)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t$btn.addClass('redactor-toolbar-link-dropdown').attr('aria-haspopup', true);\n\n\t\t\t\t\tvar key = $btn.attr('rel');\n\t\t\t\t\tthis.button.addCallback($btn, 'dropdown');\n\n\t\t\t\t\tvar $dropdown = $('<div class=\"redactor-dropdown redactor-dropdown-' + this.uuid + ' redactor-dropdown-box-' + key + '\" style=\"display: none;\">');\n\t\t\t\t\t$btn.data('dropdown', $dropdown);\n\n\t\t\t\t\t// build dropdown\n\t\t\t\t\tif (dropdown)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.dropdown.build(key, $dropdown, dropdown);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn $dropdown;\n\t\t\t\t},\n\t\t\t\tsetActive: function(key)\n\t\t\t\t{\n\t\t\t\t\tthis.button.get(key).addClass('redactor-act');\n\t\t\t\t},\n\t\t\t\tsetInactive: function(key)\n\t\t\t\t{\n\t\t\t\t\tthis.button.get(key).removeClass('redactor-act');\n\t\t\t\t},\n\t\t\t\tsetInactiveAll: function(key)\n\t\t\t\t{\n\t\t\t\t\tvar $btns = this.button.toolbar().find('a.re-button');\n\n\t\t\t\t\tif (typeof key !== 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\t$btns = $btns.not('.re-' + key);\n\t\t\t\t\t}\n\n\t\t\t\t\t$btns.removeClass('redactor-act');\n\t\t\t\t},\n\t\t\t\tdisable: function(key)\n\t\t\t\t{\n\t\t\t\t\tthis.button.get(key).addClass('redactor-button-disabled');\n\t\t\t\t},\n\t\t\t\tenable: function(key)\n\t\t\t\t{\n\t\t\t\t\tthis.button.get(key).removeClass('redactor-button-disabled');\n\t\t\t\t},\n\t\t\t\tdisableAll: function(key)\n\t\t\t\t{\n\t\t\t\t\tvar $btns = this.button.toolbar().find('a.re-button');\n\t\t\t\t\tif (typeof key !== 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\t$btns = $btns.not('.re-' + key);\n\t\t\t\t\t}\n\n\t\t\t\t\t$btns.addClass('redactor-button-disabled');\n\t\t\t\t},\n\t\t\t\tenableAll: function()\n\t\t\t\t{\n\t\t\t\t\tthis.button.toolbar().find('a.re-button').removeClass('redactor-button-disabled');\n\t\t\t\t},\n\t\t\t\tremove: function(key)\n\t\t\t\t{\n\t\t\t\t\tthis.button.get(key).remove();\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =caret\n\t\tcaret: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tset: function(node1, node2, end)\n\t\t\t\t{\n                    var cs = this.core.editor().scrollTop();\n                    this.core.editor().focus();\n                    this.core.editor().scrollTop(cs);\n\n\t\t\t\t\tend = (typeof end === 'undefined') ? 0 : 1;\n\n\t\t\t\t\tnode1 = node1[0] || node1;\n\t\t\t\t\tnode2 = node2[0] || node2;\n\n\t\t\t\t\tvar sel = this.selection.get();\n\t\t\t\t\tvar range = this.selection.range(sel);\n\n\t\t\t\t\ttry\n\t\t\t\t\t{\n\t\t\t\t\t\trange.setStart(node1, 0);\n\t\t\t\t\t\trange.setEnd(node2, end);\n\t\t\t\t\t}\n\t\t\t\t\tcatch (e) {}\n\n\t\t\t\t\tthis.selection.update(sel, range);\n\t\t\t\t},\n\t\t\t\tprepare: function(node)\n\t\t\t\t{\n\t\t\t\t\t// firefox focus\n\t\t\t\t\tif (this.detect.isFirefox() && typeof this.start !== 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.editor().focus();\n\t\t\t\t\t}\n\n\t\t\t\t\treturn node[0] || node;\n\t\t\t\t},\n\t\t\t\tstart: function(node)\n\t\t\t\t{\n\t\t\t\t\tvar sel, range;\n\t\t\t\t\tnode = this.caret.prepare(node);\n\n\t\t\t\t\tif (!node)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (node.tagName === 'BR')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn this.caret.before(node);\n\t\t\t\t\t}\n\n\t\t\t\t\tvar $first = $(node).children().first();\n\n\t\t\t\t\t// empty or inline tag\n\t\t\t\t\tvar inline = this.utils.isInlineTag(node.tagName);\n\t\t\t\t\tif (node.innerHTML === '' || inline)\n\t\t\t\t\t{\n                        this.caret.setStartEmptyOrInline(node, inline);\n\t\t\t\t\t}\n\t\t\t\t\t// empty inline inside\n                    else if ($first && $first.length !== 0 && this.utils.isInlineTag($first[0].tagName) && $first.text() === '')\n                    {\n                       this.caret.setStartEmptyOrInline($first[0], true);\n                    }\n                    // block tag\n\t\t\t\t\telse\n\t\t\t\t\t{\n                        sel = window.getSelection();\n                        sel.removeAllRanges();\n\n                        range = document.createRange();\n                        range.selectNodeContents(node);\n                        range.collapse(true);\n                        sel.addRange(range);\n\t\t\t\t\t}\n\n\n\t\t\t\t},\n\t\t\t\tsetStartEmptyOrInline: function(node, inline)\n\t\t\t\t{\n                    var sel = window.getSelection();\n\t\t\t\t    var range = document.createRange();\n\t\t\t\t\tvar textNode = document.createTextNode('\\u200B');\n\n\t\t\t\t\trange.setStart(node, 0);\n\t\t\t\t\trange.insertNode(textNode);\n\t\t\t\t\trange.setStartAfter(textNode);\n\t\t\t\t\trange.collapse(true);\n\n\t\t\t\t\tsel.removeAllRanges();\n\t\t\t\t\tsel.addRange(range);\n\n\t\t\t\t\t// remove invisible text node\n\t\t\t\t\tif (!inline)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.editor().on('keydown.redactor-remove-textnode', function()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$(textNode).remove();\n\t\t\t\t\t\t\t$(this).off('keydown.redactor-remove-textnode');\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tend: function(node)\n\t\t\t\t{\n\t\t\t\t\tvar sel, range;\n\t\t\t\t\tnode = this.caret.prepare(node);\n\n\t\t\t\t\tif (!node)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// empty node\n\t\t\t\t\tif (node.tagName !== 'BR' && node.innerHTML === '')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn this.caret.start(node);\n\t\t\t\t\t}\n\n\t\t\t\t\t// br\n\t\t\t\t\tif (node.tagName === 'BR')\n\t\t\t\t\t{\n\t\t\t\t\t\tvar space = document.createElement('span');\n\t\t\t\t\t\tspace.className = 'redactor-invisible-space';\n\t\t\t\t\t\tspace.innerHTML = '&#x200b;';\n\n\t\t\t\t\t\t$(node).after(space);\n\n\t\t\t\t\t\tsel = window.getSelection();\n\t\t\t\t\t\tsel.removeAllRanges();\n\n\t\t\t\t\t\trange = document.createRange();\n\n\t\t\t\t\t\trange.setStartBefore(space);\n\t\t\t\t\t\trange.setEndBefore(space);\n\t\t\t\t\t\tsel.addRange(range);\n\n\t\t\t\t\t\t$(space).replaceWith(function()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn $(this).contents();\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (node.lastChild && node.lastChild.nodeType === 1)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn this.caret.after(node.lastChild);\n\t\t\t\t\t}\n\n                    var sel = window.getSelection();\n                    if (sel.getRangeAt || sel.rangeCount)\n                    {\n                        try {\n                            var range = sel.getRangeAt(0);\n                            range.selectNodeContents(node);\n                            range.collapse(false);\n\n                            sel.removeAllRanges();\n                            sel.addRange(range);\n                        }\n                        catch(e) {}\n                    }\n\t\t\t\t},\n\t\t\t\tafter: function(node)\n\t\t\t\t{\n\t\t\t\t\tvar sel, range;\n\t\t\t\t\tnode = this.caret.prepare(node);\n\n\n\t\t\t\t\tif (!node)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (node.tagName === 'BR')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn this.caret.end(node);\n\t\t\t\t\t}\n\n\t\t\t\t\t// block tag\n\t\t\t\t\tif (this.utils.isBlockTag(node.tagName))\n\t\t\t\t\t{\n\t\t\t\t\t\tvar next = this.caret.next(node);\n\n\t\t\t\t\t\tif (typeof next === 'undefined')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.caret.end(node);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t// table\n\t\t\t\t\t\t\tif (next.tagName === 'TABLE')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tnext = $(next).find('th, td').first()[0];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t// list\n\t\t\t\t\t\t\telse if (next.tagName === 'UL' || next.tagName === 'OL')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tnext = $(next).find('li').first()[0];\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tthis.caret.start(next);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// inline tag\n\t\t\t\t\tvar textNode = document.createTextNode('\\u200B');\n\n\t\t\t\t\tsel = window.getSelection();\n\t\t\t\t\tsel.removeAllRanges();\n\n\t\t\t\t\trange = document.createRange();\n\t\t\t\t\trange.setStartAfter(node);\n\t\t\t\t\trange.insertNode(textNode);\n\t\t\t\t\trange.setStartAfter(textNode);\n\t\t\t\t\trange.collapse(true);\n\n\t\t\t\t\tsel.addRange(range);\n\n\t\t\t\t},\n\t\t\t\tbefore: function(node)\n\t\t\t\t{\n\t\t\t\t\tvar sel, range;\n\t\t\t\t\tnode = this.caret.prepare(node);\n\n\n\t\t\t\t\tif (!node)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// block tag\n\t\t\t\t\tif (this.utils.isBlockTag(node.tagName))\n\t\t\t\t\t{\n\t\t\t\t\t\tvar prev = this.caret.prev(node);\n\n\t\t\t\t\t\tif (typeof prev === 'undefined')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.caret.start(node);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t// table\n\t\t\t\t\t\t\tif (prev.tagName === 'TABLE')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tprev = $(prev).find('th, td').last()[0];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t// list\n\t\t\t\t\t\t\telse if (prev.tagName === 'UL' || prev.tagName === 'OL')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tprev = $(prev).find('li').last()[0];\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tthis.caret.end(prev);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// inline tag\n\t\t\t\t\tsel = window.getSelection();\n\t\t\t\t\tsel.removeAllRanges();\n\n\t\t\t\t\trange = document.createRange();\n\n\t\t\t        range.setStartBefore(node);\n\t\t\t        range.collapse(true);\n\n\t\t\t        sel.addRange(range);\n\t\t\t\t},\n\t\t\t\tnext: function(node)\n\t\t\t\t{\n\t\t\t\t\tvar $next = $(node).next();\n\t\t\t\t\tif ($next.hasClass('redactor-script-tag, redactor-selection-marker'))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn $next.next()[0];\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\treturn $next[0];\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tprev: function(node)\n\t\t\t\t{\n\t\t\t\t\tvar $prev = $(node).prev();\n\t\t\t\t\tif ($prev.hasClass('redactor-script-tag, redactor-selection-marker'))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn $prev.prev()[0];\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\treturn $prev[0];\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\t// #backward\n\t\t\t\toffset: function(node)\n\t\t\t\t{\n\t\t\t\t\treturn this.offset.get(node);\n\t\t\t\t}\n\n\t\t\t};\n\t\t},\n\n\t\t// =clean\n\t\tclean: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tonSet: function(html)\n\t\t\t\t{\n\t\t\t\t\thtml = this.clean.savePreCode(html);\n\t\t\t\t\thtml = this.clean.saveFormTags(html);\n\n\t\t\t\t\t// convert script tag\n\t\t\t\t\tif (this.opts.script)\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = html.replace(/<script(.*?[^>]?)>([\\w\\W]*?)<\\/script>/gi, '<pre class=\"redactor-script-tag\" $1>$2</pre>');\n\t\t\t\t\t}\n\n\t\t\t\t\t// converting entity\n\t\t\t\t\thtml = html.replace(/\\$/g, '&#36;');\n\t\t\t\t\thtml = html.replace(/&amp;/g, '&');\n\n\t\t\t\t\t// replace special characters in links\n\t\t\t\t\thtml = html.replace(/<a href=\"(.*?[^>]?)®(.*?[^>]?)\">/gi, '<a href=\"$1&reg$2\">');\n\n\t\t\t\t\t// save markers\n\t\t\t\t\thtml = html.replace(/<span id=\"selection-marker-1\"(.*?[^>]?)>​<\\/span>/gi, '###marker1###');\n\t\t\t\t\thtml = html.replace(/<span id=\"selection-marker-2\"(.*?[^>]?)>​<\\/span>/gi, '###marker2###');\n\n\t\t\t\t\t// replace tags\n\t\t\t\t\tvar self = this;\n\t\t\t\t\tvar $div = $(\"<div/>\").html($.parseHTML(html, document, true));\n\n\t\t\t\t\tvar replacement = this.opts.replaceTags;\n\t\t\t\t\tif (replacement)\n\t\t\t\t\t{\n                        var keys = Object.keys(this.opts.replaceTags);\n    \t\t\t\t\t$div.find(keys.join(',')).each(function(i,s)\n    \t\t\t\t\t{\n    \t\t\t\t\t\tself.utils.replaceToTag(s, replacement[s.tagName.toLowerCase()]);\n    \t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\t// add span marker\n\t\t\t\t\t$div.find('span, a').attr('data-redactor-span', true);\n\n\t\t\t\t\t// add style cache\n\t\t\t\t\t$div.find(this.opts.inlineTags.join(',')).each(function()\n\t\t\t\t\t{\n    \t\t\t\t\t// add style cache\n    \t\t\t\t\tvar $el = $(this);\n\n    \t\t\t\t\tif ($el.attr('style'))\n    \t\t\t\t\t{\n        \t\t\t\t\t$el.attr('data-redactor-style-cache', $el.attr('style'));\n    \t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\thtml = $div.html();\n\n\t\t\t\t\t// remove tags\n\t\t\t\t\tvar tags = ['font', 'html', 'head', 'link', 'body', 'meta', 'applet'];\n\t\t\t\t\tif (!this.opts.script)\n\t\t\t\t\t{\n\t\t\t\t\t\ttags.push('script');\n\t\t\t\t\t}\n\n\t\t\t\t\thtml = this.clean.stripTags(html, tags);\n\n\t\t\t\t\t// remove html comments\n\t\t\t\t\tif (this.opts.removeComments)\n\t\t\t\t\t{\n\t\t\t\t\t    html = html.replace(/<!--[\\s\\S]*?-->/gi, '');\n\t\t\t\t\t}\n\n\t\t\t\t\t// paragraphize\n\t\t\t\t\thtml = this.paragraphize.load(html);\n\n\t\t\t\t\t// restore markers\n\t\t\t\t\thtml = html.replace('###marker1###', '<span id=\"selection-marker-1\" class=\"redactor-selection-marker\">​</span>');\n\t\t\t\t\thtml = html.replace('###marker2###', '<span id=\"selection-marker-2\" class=\"redactor-selection-marker\">​</span>');\n\n\t\t\t\t\t// empty\n\t\t\t\t\tif (html.search(/^(||\\s||<br\\s?\\/?>||&nbsp;)$/i) !== -1)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn this.opts.emptyHtml;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tonGet: function(html)\n\t\t\t\t{\n\t\t\t\t\treturn this.clean.onSync(html);\n\t\t\t\t},\n\t\t\t\tonSync: function(html)\n\t\t\t\t{\n\t\t\t\t\t// remove invisible spaces\n\t\t\t\t\thtml = html.replace(/\\u200B/g, '');\n\t\t\t\t\thtml = html.replace(/&#x200b;/gi, '');\n\t\t\t\t\t//html = html.replace(/&nbsp;&nbsp;/gi, '&nbsp;');\n\n\t\t\t\t\tif (html.search(/^<p>(||\\s||<br\\s?\\/?>||&nbsp;)<\\/p>$/i) !== -1)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn '';\n\t\t\t\t\t}\n\n\t\t\t\t\t// remove image resize\n\t\t\t\t\thtml = html.replace(/<span(.*?)id=\"redactor-image-box\"(.*?[^>])>([\\w\\W]*?)<img(.*?)><\\/span>/gi, '$3<img$4>');\n\t\t\t\t\thtml = html.replace(/<span(.*?)id=\"redactor-image-resizer\"(.*?[^>])>(.*?)<\\/span>/gi, '');\n\t\t\t\t\thtml = html.replace(/<span(.*?)id=\"redactor-image-editter\"(.*?[^>])>(.*?)<\\/span>/gi, '');\n\t\t\t\t\thtml = html.replace(/<img(.*?)style=\"(.*?)opacity: 0\\.5;(.*?)\"(.*?)>/gi, '<img$1style=\"$2$3\"$4>');\n\n\t\t\t\t\tvar $div = $(\"<div/>\").html($.parseHTML(html, document, true));\n\n\t\t\t\t\t// remove empty atributes\n\t\t\t\t\t$div.find('*[style=\"\"]').removeAttr('style');\n\t\t\t\t\t$div.find('*[class=\"\"]').removeAttr('class');\n\t\t\t\t\t$div.find('*[rel=\"\"]').removeAttr('rel');\n\t\t\t\t\t$div.find('*[data-image=\"\"]').removeAttr('data-image');\n\t\t\t\t\t$div.find('*[alt=\"\"]').removeAttr('alt');\n\t\t\t\t\t$div.find('*[title=\"\"]').removeAttr('title');\n\t\t\t\t\t$div.find('*[data-redactor-style-cache]').removeAttr('data-redactor-style-cache');\n\n\t\t\t\t\t// remove markers\n\t\t\t\t\t$div.find('.redactor-invisible-space, .redactor-unlink').each(function()\n\t\t\t\t\t{\n\t\t\t\t\t\t$(this).contents().unwrap();\n\t\t\t\t\t});\n\n\t\t\t\t\t// remove span without attributes & span marker\n\t\t\t\t    $div.find('span, a').removeAttr('data-redactor-span data-redactor-style-cache').each(function()\n\t\t\t\t\t{\n    \t\t\t\t\tif (this.attributes.length === 0)\n    \t\t\t\t\t{\n\t\t\t\t\t\t    $(this).contents().unwrap();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\t// remove rel attribute from img\n\t\t\t\t\t$div.find('img').removeAttr('rel');\n\n\t\t\t\t\t$div.find('.redactor-selection-marker, #redactor-insert-marker').remove();\n\n\t\t\t\t\thtml = $div.html();\n\n\t\t\t\t\t// reconvert script tag\n\t\t\t\t\tif (this.opts.script)\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = html.replace(/<pre class=\"redactor-script-tag\"(.*?[^>]?)>([\\w\\W]*?)<\\/pre>/gi, '<script$1>$2</script>');\n\t\t\t\t\t}\n\n\t\t\t\t\t// restore form tag\n\t\t\t\t\thtml = this.clean.restoreFormTags(html);\n\n\t\t\t\t\t// remove br in|of li/header tags\n\t\t\t\t\thtml = html.replace(new RegExp('<br\\\\s?/?></h', 'gi'), '</h');\n\t\t\t\t\thtml = html.replace(new RegExp('<br\\\\s?/?></li>', 'gi'), '</li>');\n\t\t\t\t\thtml = html.replace(new RegExp('</li><br\\\\s?/?>', 'gi'), '</li>');\n\n\t\t\t\t\t// pre class\n\t\t\t\t\thtml = html.replace(/<pre>/gi, \"<pre>\\n\");\n\t\t\t\t\tif (this.opts.preClass)\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = html.replace(/<pre>/gi, '<pre class=\"' + this.opts.preClass + '\">');\n\t\t\t\t\t}\n\n\t\t\t\t\t// link nofollow\n\t\t\t\t\tif (this.opts.linkNofollow)\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = html.replace(/<a(.*?)rel=\"nofollow\"(.*?[^>])>/gi, '<a$1$2>');\n\t\t\t\t\t\thtml = html.replace(/<a(.*?[^>])>/gi, '<a$1 rel=\"nofollow\">');\n\t\t\t\t\t}\n\n\t\t\t\t\t// replace special characters\n\t\t\t\t\tvar chars = {\n\t\t\t\t\t\t'\\u2122': '&trade;',\n\t\t\t\t\t\t'\\u00a9': '&copy;',\n\t\t\t\t\t\t'\\u2026': '&hellip;',\n\t\t\t\t\t\t'\\u2014': '&mdash;',\n\t\t\t\t\t\t'\\u2010': '&dash;'\n\t\t\t\t\t};\n\n\t\t\t\t\t$.each(chars, function(i,s)\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = html.replace(new RegExp(i, 'g'), s);\n\t\t\t\t\t});\n\n\t\t\t\t\thtml = html.replace(/&amp;/g, '&');\n\n\t\t\t\t\t// remove empty paragpraphs\n\t\t\t\t\t//html = html.replace(/<p><\\/p>/gi, \"\");\n\n\t\t\t\t\t// remove new lines\n                    html = html.replace(/\\n{2,}/g, \"\\n\");\n\n                    // remove all newlines\n                    if (this.opts.removeNewlines)\n                    {\n                        html = html.replace(/\\r?\\n/g, \"\");\n                    }\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tonPaste: function(html, data, insert)\n\t\t\t\t{\n\t\t\t\t\t// if paste event\n\t\t\t\t\tif (insert !== true)\n\t\t\t\t\t{\n    \t\t\t\t\t// remove google docs markers\n                        html = html.replace(/<b\\sid=\"internal-source-marker(.*?)\">([\\w\\W]*?)<\\/b>/gi, \"$2\");\n    \t\t\t\t\thtml = html.replace(/<b(.*?)id=\"docs-internal-guid(.*?)\">([\\w\\W]*?)<\\/b>/gi, \"$3\");\n\n                        // google docs styles\n                        html = html.replace(/<span[^>]*(font-style: italic; font-weight: bold|font-weight: bold; font-style: italic)[^>]*>([\\w\\W]*?)<\\/span>/gi, '<b><i>$2</i></b>');\n                        html = html.replace(/<span[^>]*(font-style: italic; font-weight: 700|font-weight: 700; font-style: italic)[^>]*>([\\w\\W]*?)<\\/span>/gi, '<b><i>$2</i></b>');\n                        html = html.replace(/<span[^>]*font-style: italic[^>]*>([\\w\\W]*?)<\\/span>/gi, '<i>$1</i>');\n                        html = html.replace(/<span[^>]*font-weight: bold[^>]*>([\\w\\W]*?)<\\/span>/gi, '<b>$1</b>');\n                        html = html.replace(/<span[^>]*font-weight: 700[^>]*>([\\w\\W]*?)<\\/span>/gi, '<b>$1</b>');\n\n                        // op tag\n                        html = html.replace(/<o:p[^>]*>/gi, '');\n                        html = html.replace(/<\\/o:p>/gi, '');\n\n\t\t\t\t\t\tvar msword = this.clean.isHtmlMsWord(html);\n\t\t\t\t\t\tif (msword)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\thtml = this.clean.cleanMsWord(html);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\thtml = $.trim(html);\n\n\t\t\t\t\tif (data.pre)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.opts.preSpaces)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\thtml = html.replace(/\\t/g, new Array(this.opts.preSpaces + 1).join(' '));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\n\t\t\t\t\t\thtml = this.clean.replaceBrToNl(html);\n\t\t\t\t\t\thtml = this.clean.removeTagsInsidePre(html);\n\t\t\t\t\t}\n\n\t\t\t\t\t// if paste event\n\t\t\t\t\tif (insert !== true)\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = this.clean.removeEmptyInlineTags(html);\n\n\t\t\t\t\t\tif (data.encode === false)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\thtml = html.replace(/&/g, '&amp;');\n\t\t\t\t\t\t\thtml = this.clean.convertTags(html, data);\n\t\t\t\t\t\t\thtml = this.clean.getPlainText(html);\n\t\t\t\t\t\t\thtml = this.clean.reconvertTags(html, data);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif (data.text)\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = this.clean.replaceNbspToSpaces(html);\n\t\t\t\t\t\thtml = this.clean.getPlainText(html);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (data.lists)\n\t\t\t\t\t{\n    \t\t\t\t\thtml = html.replace(\"\\n\", '<br>');\n    \t\t\t\t}\n\n\t\t\t\t\tif (data.encode)\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = this.clean.encodeHtml(html);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (data.paragraphize)\n\t\t\t\t\t{\n    \t\t\t\t\t// ff bugfix\n                        html = html.replace(/ \\n/g, ' ');\n                        html = html.replace(/\\n /g, ' ');\n\n\t\t\t\t\t\thtml = this.paragraphize.load(html);\n\n\t\t\t\t\t\t// remove empty p\n\t\t\t\t\t\thtml = html.replace(/<p><\\/p>/g, '');\n\t\t\t\t\t}\n\n\t\t\t\t\t// remove paragraphs form lists (google docs bug)\n\t\t\t\t\thtml = html.replace(/<li><p>/g, '<li>');\n\t\t\t\t\thtml = html.replace(/<\\/p><\\/li>/g, '</li>');\n\n\t\t\t\t\treturn html;\n\n\t\t\t\t},\n\t\t\t\tgetCurrentType: function(html, insert)\n\t\t\t\t{\n\t\t\t\t\tvar blocks = this.selection.blocks();\n\n\t\t\t\t\tvar data = {\n\t\t\t\t\t\ttext: false,\n\t\t\t\t\t\tencode: false,\n\t\t\t\t\t\tparagraphize: true,\n\t\t\t\t\t\tline: this.clean.isHtmlLine(html),\n\t\t\t\t\t\tblocks: this.clean.isHtmlBlocked(html),\n\t\t\t\t\t\tpre: false,\n\t\t\t\t\t\tlists: false,\n\t\t\t\t\t\tblock: true,\n\t\t\t\t\t\tinline: true,\n\t\t\t\t\t\tlinks: true,\n\t\t\t\t\t\timages: true\n\t\t\t\t\t};\n\n\t\t\t\t\tif (blocks.length === 1 && this.utils.isCurrentOrParent(['h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'a', 'figcaption']))\n\t\t\t\t\t{\n\t\t\t\t\t\tdata.text = true;\n\t\t\t\t\t\tdata.paragraphize = false;\n\t\t\t\t\t\tdata.inline = false;\n\t\t\t\t\t\tdata.images = false;\n\t\t\t\t\t\tdata.links = false;\n\t\t\t\t\t\tdata.line = true;\n\t\t\t\t\t}\n\t\t\t\t\telse if (this.opts.type === 'inline' || this.opts.enterKey === false)\n\t\t\t\t\t{\n\t\t\t\t\t\tdata.paragraphize = false;\n\t\t\t\t\t\tdata.block = false;\n\t\t\t\t\t\tdata.line = true;\n\t\t\t\t\t}\n\t\t\t\t\telse if (blocks.length === 1 && this.utils.isCurrentOrParent(['li']))\n\t\t\t\t\t{\n\t\t\t\t\t\tdata.lists = true;\n\t\t\t\t\t\tdata.block = false;\n\t\t\t\t\t\tdata.paragraphize = false;\n\t\t\t\t\t\tdata.images = false;\n\t\t\t\t\t}\n\t\t\t\t\telse if (blocks.length === 1 && this.utils.isCurrentOrParent(['th', 'td', 'blockquote']))\n\t\t\t\t\t{\n\t\t\t\t\t\tdata.block = false;\n\t\t\t\t\t\tdata.paragraphize = false;\n\n\t\t\t\t\t}\n\t\t\t\t\telse if (this.opts.type === 'pre' || (blocks.length === 1 && this.utils.isCurrentOrParent('pre')))\n\t\t\t\t\t{\n\t\t\t\t\t\tdata.inline = false;\n\t\t\t\t\t\tdata.block = false;\n\t\t\t\t\t\tdata.encode = true;\n\t\t\t\t\t\tdata.pre = true;\n\t\t\t\t\t\tdata.paragraphize = false;\n\t\t\t\t\t\tdata.images = false;\n\t\t\t\t\t\tdata.links = false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (data.line === true)\n\t\t\t\t\t{\n\t\t\t\t\t\tdata.paragraphize = false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (insert === true)\n\t\t\t\t\t{\n\t\t\t\t\t\tdata.text = false;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn data;\n\n\t\t\t\t},\n\t\t\t\tisHtmlBlocked: function(html)\n\t\t\t\t{\n\t\t\t\t\tvar match1 = html.match(new RegExp('</(' + this.opts.blockTags.join('|' ).toUpperCase() + ')>', 'gi'));\n\t\t\t\t\tvar match2 = html.match(new RegExp('<hr(.*?[^>])>', 'gi'));\n\n\t\t\t\t\treturn (match1 === null && match2 === null) ? false : true;\n\t\t\t\t},\n\t\t\t\tisHtmlLine: function(html)\n\t\t\t\t{\n\t\t\t\t\tif (this.clean.isHtmlBlocked(html))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar matchBR = html.match(/<br\\s?\\/?>/gi);\n\t\t\t\t\tvar matchNL = html.match(/\\n/gi);\n\n\t\t\t\t\treturn (!matchBR && !matchNL) ? true : false;\n\t\t\t\t},\n\t\t\t\tisHtmlMsWord: function(html)\n\t\t\t\t{\n\t\t\t\t\treturn html.match(/class=\"?Mso|style=\"[^\"]*\\bmso-|style='[^'']*\\bmso-|w:WordDocument/i);\n\t\t\t\t},\n\t\t\t\tremoveEmptyInlineTags: function(html)\n\t\t\t\t{\n\t\t\t\t\tvar tags = this.opts.inlineTags;\n    \t\t\t\tvar $div = $(\"<div/>\").html($.parseHTML(html, document, true));\n                    var self = this;\n\n\t\t\t\t\tvar $spans = $div.find('span');\n\t\t\t\t\tvar $tags = $div.find(tags.join(','));\n\n\t\t\t\t\t$tags.removeAttr('style');\n\n\t\t\t\t\t$tags.each(function()\n\t\t\t\t\t{\n    \t\t\t\t\tvar tagHtml = $(this).html();\n    \t\t\t\t\tif (this.attributes.length === 0 && self.utils.isEmpty(tagHtml))\n    \t\t\t\t\t{\n        \t\t\t\t\t$(this).replaceWith(function()\n        \t\t\t\t\t{\n        \t\t\t\t\t\treturn $(this).contents();\n        \t\t\t\t\t});\n    \t\t\t\t\t}\n\t\t\t\t\t});\n\n                    $spans.each(function()\n\t\t\t\t\t{\n    \t\t\t\t\tvar tagHtml = $(this).html();\n    \t\t\t\t\tif (this.attributes.length === 0)\n    \t\t\t\t\t{\n        \t\t\t\t\t$(this).replaceWith(function()\n        \t\t\t\t\t{\n        \t\t\t\t\t\treturn $(this).contents();\n        \t\t\t\t\t});\n    \t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\thtml = $div.html();\n\n\t\t\t\t\t// convert php tags\n\t\t\t\t\thtml = html.replace('<!--?php', '<?php');\n\t\t\t\t\thtml = html.replace('<!--?', '<?');\n\t\t\t\t\thtml = html.replace('?-->', '?>');\n\n\t\t\t\t\t$div.remove();\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tcleanMsWord: function(html)\n\t\t\t\t{\n    \t\t\t\thtml = html.replace(/<!--[\\s\\S]*?-->/g, \"\");\n    \t\t\t\thtml = html.replace(/<o:p>[\\s\\S]*?<\\/o:p>/gi, '');\n\t\t\t\t\thtml = html.replace(/\\n/g, \" \");\n\t\t\t\t\thtml = html.replace(/<br\\s?\\/?>|<\\/p>|<\\/div>|<\\/li>|<\\/td>/gi, '\\n\\n');\n\n\t\t\t\t\t// lists\n\t\t\t\t\tvar $div = $(\"<div/>\").html(html);\n\n\t\t\t\t\tvar lastList = false;\n\t\t\t\t\tvar lastLevel = 1;\n\t\t\t\t\tvar listsIds = [];\n\n\t\t\t\t\t$div.find(\"p[style]\").each(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tvar matches = $(this).attr('style').match(/mso\\-list\\:l([0-9]+)\\slevel([0-9]+)/);\n\n\t\t\t\t\t\tif (matches)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar currentList = parseInt(matches[1]);\n\t\t\t\t\t\t\tvar currentLevel = parseInt(matches[2]);\n\t\t\t\t\t\t\tvar listType = $(this).html().match(/^[\\w]+\\./) ? \"ol\" : \"ul\";\n\n\t\t\t\t\t\t\tvar $li = $(\"<li/>\").html($(this).html());\n\n\t\t\t\t\t\t\t$li.html($li.html().replace(/^([\\w\\.]+)</, '<'));\n\t\t\t\t\t\t\t$li.find(\"span:first\").remove();\n\n\t\t\t\t\t\t\tif (currentLevel == 1 && $.inArray(currentList, listsIds) == -1)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tvar $list = $(\"<\" + listType + \"/>\").attr({\"data-level\": currentLevel, \"data-list\": currentList}).html($li);\n\t\t\t\t\t\t\t\t$(this).replaceWith($list);\n\n\t\t\t\t\t\t\t\tlastList = currentList;\n\t\t\t\t\t\t\t\tlistsIds.push(currentList);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (currentLevel > lastLevel)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tvar $prevList = $div.find('[data-level=\"' + lastLevel + '\"][data-list=\"' + lastList + '\"]');\n\t\t\t\t\t\t\t\t\tvar $lastList = $prevList;\n\n\t\t\t\t\t\t\t\t\tfor(var i = lastLevel; i < currentLevel; i++)\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t$list = $(\"<\" + listType + \"/>\");\n\t\t\t\t\t\t\t\t\t\t$list.appendTo($lastList.find(\"li\").last());\n\n\t\t\t\t\t\t\t\t\t\t$lastList = $list;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t$lastList.attr({\"data-level\": currentLevel, \"data-list\": currentList}).html($li);\n\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tvar $prevList = $div.find('[data-level=\"' + currentLevel + '\"][data-list=\"' + currentList + '\"]').last();\n\n\t\t\t\t\t\t\t\t\t$prevList.append($li);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tlastLevel = currentLevel;\n\t\t\t\t\t\t\t\tlastList = currentList;\n\n\t\t\t\t\t\t\t\t$(this).remove();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\t$div.find('[data-level][data-list]').removeAttr('data-level data-list');\n\t\t\t\t\thtml = $div.html();\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\treplaceNbspToSpaces: function(html)\n\t\t\t\t{\n\t\t\t\t\treturn html.replace('&nbsp;', ' ');\n\t\t\t\t},\n\t\t\t\treplaceBrToNl: function(html)\n\t\t\t\t{\n\t\t\t\t\treturn html.replace(/<br\\s?\\/?>/gi, '\\n');\n\t\t\t\t},\n\t\t\t\treplaceNlToBr: function(html)\n\t\t\t\t{\n\t\t\t\t\treturn html.replace(/\\n/g, '<br />');\n\t\t\t\t},\n\t\t\t\tconvertTags: function(html, data)\n\t\t\t\t{\n                    var $div = $('<div>').html(html);\n\n                    // remove iframe\n\t\t\t\t\t$div.find('iframe').remove();\n\n\t\t\t\t\t// link target & attrs\n\t\t\t\t\tvar $links = $div.find('a');\n\t\t\t\t\t$links.removeAttr('style');\n\t\t\t\t\tif (this.opts.pasteLinkTarget !== false)\n\t\t\t\t\t{\n    \t\t\t\t\t$links.attr('target', this.opts.pasteLinkTarget);\n\t\t\t\t\t}\n\n                    // links\n                    if (data.links && this.opts.pasteLinks)\n                    {\n                    \t$div.find('a').each(function(i, link)\n                    \t{\n                    \t\tif (link.href)\n                    \t\t{\n                    \t\t\tvar tmp = '#####[a href=\"' + link.href + '\"';\n                    \t\t\tvar attr;\n                    \t\t\tfor (var j = 0, length = link.attributes.length; j < length; j++)\n                    \t\t\t{\n                    \t\t\t\tattr = link.attributes.item(j);\n                    \t\t\t\tif (attr.name !== 'href')\n                    \t\t\t\t{\n                    \t\t\t\t\ttmp += ' ' + attr.name + '=\"' + attr.value + '\"';\n                    \t\t\t\t}\n                    \t\t\t}\n\n                    \t\t\tlink.outerHTML = tmp + ']#####' + link.innerHTML + '#####[/a]#####';\n                    \t\t}\n                    \t});\n                    }\n\n                    html = $div.html();\n\n                    // images\n\t\t\t\t\tif (data.images && this.opts.pasteImages)\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = html.replace(/<img(.*?)src=\"(.*?)\"(.*?[^>])>/gi, '#####[img$1src=\"$2\"$3]#####');\n\t\t\t\t\t}\n\n\t\t\t\t\t// plain text\n\t\t\t\t\tif (this.opts.pastePlainText)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn html;\n\t\t\t\t\t}\n\n\t\t\t\t\t// all tags\n\t\t\t\t\tvar blockTags = (data.lists) ? ['ul', 'ol', 'li'] : this.opts.pasteBlockTags;\n\n\t\t\t\t\tvar tags;\n\t\t\t\t\tif (data.block || data.lists)\n\t\t\t\t\t{\n\t\t\t\t\t\ttags = (data.inline) ? blockTags.concat(this.opts.pasteInlineTags) : blockTags;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\ttags = (data.inline) ? this.opts.pasteInlineTags : [];\n\t\t\t\t\t}\n\n\t\t\t\t\tvar len = tags.length;\n\t\t\t\t\tfor (var i = 0; i < len; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = html.replace(new RegExp('<\\/' + tags[i] + '>', 'gi'), '###/' + tags[i] + '###');\n\n\t\t\t\t\t\tif (tags[i] === 'td' || tags[i] === 'th')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\thtml = html.replace(new RegExp('<' + tags[i] + '(.*?[^>])((colspan|rowspan)=\"(.*?[^>])\")?(.*?[^>])>', 'gi'), '###' + tags[i] + ' $2###');\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (this.utils.isInlineTag(tags[i]))\n\t\t\t\t\t\t{\n    \t\t\t\t\t\thtml = html.replace(new RegExp('<' + tags[i] + '([^>]*)class=\"([^>]*)\"[^>]*>', 'gi'), '###' + tags[i] + ' class=\"$2\"###');\n                            html = html.replace(new RegExp('<' + tags[i] + '([^>]*)data-redactor-style-cache=\"([^>]*)\"[^>]*>', 'gi'), '###' + tags[i] + ' cache=\"$2\"###');\n                            html = html.replace(new RegExp('<' + tags[i] + '[^>]*>', 'gi'), '###' + tags[i] + '###');\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\thtml = html.replace(new RegExp('<' + tags[i] + '[^>]*>', 'gi'), '###' + tags[i] + '###');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn html;\n\n\t\t\t\t},\n\t\t\t\treconvertTags: function(html, data)\n\t\t\t\t{\n\t\t\t\t\t// links & images\n\t\t\t\t\tif ((data.links && this.opts.pasteLinks) || (data.images && this.opts.pasteImages))\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = html.replace(new RegExp('#####\\\\[', 'gi'), '<');\n\t\t\t\t\t\thtml = html.replace(new RegExp('\\\\]#####', 'gi'), '>');\n                    }\n\n\t\t\t\t\t// plain text\n\t\t\t\t\tif (this.opts.pastePlainText)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn html;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar blockTags = (data.lists) ? ['ul', 'ol', 'li'] : this.opts.pasteBlockTags;\n\n\t\t\t\t\tvar tags;\n\t\t\t\t\tif (data.block || data.lists)\n\t\t\t\t\t{\n\t\t\t\t\t\ttags = (data.inline) ? blockTags.concat(this.opts.pasteInlineTags) : blockTags;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\ttags = (data.inline) ? this.opts.pasteInlineTags : [];\n\t\t\t\t\t}\n\n\t\t\t\t\tvar len = tags.length;\n\t\t\t\t\tfor (var i = 0; i < len; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = html.replace(new RegExp('###\\/' + tags[i] + '###', 'gi'), '</' + tags[i] + '>');\n                    }\n\n                    for (var i = 0; i < len; i++)\n\t\t\t\t\t{\n    \t\t\t\t\thtml = html.replace(new RegExp('###' + tags[i] + '###', 'gi'), '<' + tags[i] + '>');\n    \t\t\t\t}\n\n\t\t\t\t\tfor (var i = 0; i < len; i++)\n\t\t\t\t\t{\n                        if (tags[i] === 'td' || tags[i] === 'th')\n                        {\n\t\t\t\t\t\t    html = html.replace(new RegExp('###' + tags[i] + '\\s?(.*?[^#])###', 'gi'), '<' + tags[i] + '$1>');\n                        }\n                        else if (this.utils.isInlineTag(tags[i]))\n                        {\n\n                            var spanMarker = (tags[i] === 'span') ? ' data-redactor-span=\"true\"' : '';\n\n                            html = html.replace(new RegExp('###' + tags[i] + ' cache=\"(.*?[^#])\"###', 'gi'), '<' + tags[i] + ' style=\"$1\"' + spanMarker + ' data-redactor-style-cache=\"$1\">');\n                            html = html.replace(new RegExp('###' + tags[i] + '\\s?(.*?[^#])###', 'gi'), '<' + tags[i] + '$1>');\n                        }\n                    }\n\n\t\t\t\t\treturn html;\n\n\t\t\t\t},\n\t\t\t\tcleanPre: function(block)\n\t\t\t\t{\n\t\t\t\t\tblock = (typeof block === 'undefined') ? $(this.selection.block()).closest('pre', this.core.editor()[0]) : block;\n\n\t\t\t\t\t$(block).find('br').replaceWith(function()\n\t\t\t\t\t{\n\t\t\t\t\t\treturn document.createTextNode('\\n');\n\t\t\t\t\t});\n\n\t\t\t\t\t$(block).find('p').replaceWith(function()\n\t\t\t\t\t{\n\t\t\t\t\t\treturn $(this).contents();\n\t\t\t\t\t});\n\n\t\t\t\t},\n\t\t\t\tremoveTagsInsidePre: function(html)\n\t\t\t\t{\n\t\t\t\t\tvar $div = $('<div />').append(html);\n\t\t\t\t\t$div.find('pre').replaceWith(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tvar str = $(this).html();\n\t\t\t\t\t\tstr = str.replace(/<br\\s?\\/?>|<\\/p>|<\\/div>|<\\/li>|<\\/td>/gi, '\\n');\n\t\t\t\t\t\tstr = str.replace(/(<([^>]+)>)/gi, '');\n\n\t\t\t\t\t\treturn $('<pre />').append(str);\n\t\t\t\t\t});\n\n\t\t\t\t\thtml = $div.html();\n\t\t\t\t\t$div.remove();\n\n\t\t\t\t\treturn html;\n\n\t\t\t\t},\n\t\t\t\tgetPlainText: function(html)\n\t\t\t\t{\n\t\t\t\t\thtml = html.replace(/<!--[\\s\\S]*?-->/gi, '');\n\t\t\t\t\thtml = html.replace(/<style[\\s\\S]*?style>/gi, '');\n                    html = html.replace(/<p><\\/p>/g, '');\n\t\t\t\t\thtml = html.replace(/<\\/div>|<\\/li>|<\\/td>/gi, '\\n');\n\t\t\t\t\thtml = html.replace(/<\\/p>/gi, '\\n\\n');\n\t\t\t\t\thtml = html.replace(/<\\/H[1-6]>/gi, '\\n\\n');\n\n\t\t\t\t\tvar tmp = document.createElement('div');\n\t\t\t\t\ttmp.innerHTML = html;\n\t\t\t\t\thtml = tmp.textContent || tmp.innerText;\n\n\t\t\t\t\treturn $.trim(html);\n\t\t\t\t},\n\t\t\t\tsavePreCode: function(html)\n\t\t\t\t{\n\t\t\t\t\thtml = this.clean.savePreFormatting(html);\n\t\t\t\t\thtml = this.clean.saveCodeFormatting(html);\n\t\t\t\t\thtml = this.clean.restoreSelectionMarkers(html);\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tsavePreFormatting: function(html)\n\t\t\t\t{\n\t\t\t\t\tvar pre = html.match(/<pre(.*?)>([\\w\\W]*?)<\\/pre>/gi);\n\t\t\t\t\tif (pre === null)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn html;\n\t\t\t\t\t}\n\n\t\t\t\t\t$.each(pre, $.proxy(function(i,s)\n\t\t\t\t\t{\n    \t\t\t\t\tvar arr = [];\n    \t\t\t\t\tvar codeTag = false;\n    \t\t\t\t\tvar contents, attr1, attr2;\n\n    \t\t\t\t\tif (s.match(/<pre(.*?)>(([\\n\\r\\s]+)?)<code(.*?)>/i))\n    \t\t\t\t\t{\n        \t\t\t\t\tarr = s.match(/<pre(.*?)>(([\\n\\r\\s]+)?)<code(.*?)>([\\w\\W]*?)<\\/code>(([\\n\\r\\s]+)?)<\\/pre>/i);\n        \t\t\t\t\tcodeTag = true;\n\n                            contents = arr[5];\n                            attr1 = arr[1];\n                            attr2 = arr[4];\n    \t\t\t\t\t}\n                        else\n\t\t\t\t\t\t{\n    \t\t\t\t\t\tarr = s.match(/<pre(.*?)>([\\w\\W]*?)<\\/pre>/i);\n\n                            contents = arr[2];\n                            attr1 = arr[1];\n                        }\n\n\t\t\t\t\t\tcontents = contents.replace(/<br\\s?\\/?>/g, '\\n');\n\t\t\t\t\t\tcontents = contents.replace(/&nbsp;/g, ' ');\n\n\t\t\t\t\t\tif (this.opts.preSpaces)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcontents = contents.replace(/\\t/g, new Array(this.opts.preSpaces + 1).join(' '));\n\t\t\t\t\t\t}\n\n                        contents = this.clean.encodeEntities(contents);\n\n\t\t\t\t\t\t// $ fix\n\t\t\t\t\t\tcontents = contents.replace(/\\$/g, '&#36;');\n\n                        if (codeTag)\n                        {\n                            html = html.replace(s, '<pre' + attr1 + '><code' + attr2 + '>' + contents + '</code></pre>');\n                        }\n                        else\n                        {\n                            html = html.replace(s, '<pre' + attr1 + '>' + contents + '</pre>');\n                        }\n\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tsaveCodeFormatting: function(html)\n\t\t\t\t{\n\t\t\t\t\tvar code = html.match(/<code(.*?)>([\\w\\W]*?)<\\/code>/gi);\n\t\t\t\t\tif (code === null)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn html;\n\t\t\t\t\t}\n\n\t\t\t\t\t$.each(code, $.proxy(function(i,s)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar arr = s.match(/<code(.*?)>([\\w\\W]*?)<\\/code>/i);\n\n\t\t\t\t\t\tarr[2] = arr[2].replace(/&nbsp;/g, ' ');\n\t\t\t\t\t\tarr[2] = this.clean.encodeEntities(arr[2]);\n\t\t\t\t\t\tarr[2] = arr[2].replace(/\\$/g, '&#36;');\n\n\t\t\t\t\t\thtml = html.replace(s, '<code' + arr[1] + '>' + arr[2] + '</code>');\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\trestoreSelectionMarkers: function(html)\n\t\t\t\t{\n\t\t\t\t\thtml = html.replace(/&lt;span id=&quot;selection-marker-([0-9])&quot; class=&quot;redactor-selection-marker&quot;&gt;​&lt;\\/span&gt;/g, '<span id=\"selection-marker-$1\" class=\"redactor-selection-marker\">​</span>');\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tsaveFormTags: function(html)\n\t\t\t\t{\n\t\t\t\t\treturn html.replace(/<form(.*?)>([\\w\\W]*?)<\\/form>/gi, '<section$1 rel=\"redactor-form-tag\">$2</section>');\n\t\t\t\t},\n\t\t\t\trestoreFormTags: function(html)\n\t\t\t\t{\n\t\t\t\t\treturn html.replace(/<section(.*?) rel=\"redactor-form-tag\"(.*?)>([\\w\\W]*?)<\\/section>/gi, '<form$1$2>$3</form>');\n\t\t\t\t},\n\t\t\t\tencodeHtml: function(html)\n\t\t\t\t{\n\t\t\t\t\thtml = html.replace(/”/g, '\"');\n\t\t\t\t\thtml = html.replace(/“/g, '\"');\n\t\t\t\t\thtml = html.replace(/‘/g, '\\'');\n\t\t\t\t\thtml = html.replace(/’/g, '\\'');\n\t\t\t\t\thtml = this.clean.encodeEntities(html);\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tencodeEntities: function(str)\n\t\t\t\t{\n\t\t\t\t\tstr = String(str).replace(/&amp;/g, '&').replace(/&lt;/g, '<').replace(/&gt;/g, '>').replace(/&quot;/g, '\"');\n\t\t\t\t\tstr = str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;');\n\n\t\t\t\t\treturn str;\n\t\t\t\t},\n\t\t\t\tstripTags: function(input, denied)\n\t\t\t\t{\n\t\t\t\t\tif (typeof denied === 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn input.replace(/(<([^>]+)>)/gi, '');\n\t\t\t\t\t}\n\n\t\t\t\t    var tags = /<\\/?([a-z][a-z0-9]*)\\b[^>]*>/gi;\n\n\t\t\t\t    return input.replace(tags, function ($0, $1)\n\t\t\t\t    {\n\t\t\t\t        return denied.indexOf($1.toLowerCase()) === -1 ? $0 : '';\n\t\t\t\t    });\n\t\t\t\t},\n\t\t\t\tremoveMarkers: function(html)\n\t\t\t\t{\n\t\t\t\t\treturn html.replace(/<span(.*?[^>]?)class=\"redactor-selection-marker\"(.*?[^>]?)>([\\w\\W]*?)<\\/span>/gi, '');\n\t\t\t\t},\n\t\t\t\tremoveSpaces: function(html)\n\t\t\t\t{\n\t\t\t\t\thtml = $.trim(html);\n\t\t\t\t\thtml = html.replace(/\\n/g, '');\n\t\t\t\t\thtml = html.replace(/[\\t]*/g, '');\n\t\t\t\t\thtml = html.replace(/\\n\\s*\\n/g, \"\\n\");\n\t\t\t\t\thtml = html.replace(/^[\\s\\n]*/g, ' ');\n\t\t\t\t\thtml = html.replace(/[\\s\\n]*$/g, ' ');\n\t\t\t\t\thtml = html.replace( />\\s{2,}</g, '> <'); // between inline tags can be only one space\n\t\t\t\t\thtml = html.replace(/\\n\\n/g, \"\\n\");\n\t\t\t\t\thtml = html.replace(/\\u200B/g, '');\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tremoveSpacesHard: function(html)\n\t\t\t\t{\n\t\t\t\t\thtml = $.trim(html);\n\t\t\t\t\thtml = html.replace(/\\n/g, '');\n\t\t\t\t\thtml = html.replace(/[\\t]*/g, '');\n\t\t\t\t\thtml = html.replace(/\\n\\s*\\n/g, \"\\n\");\n\t\t\t\t\thtml = html.replace(/^[\\s\\n]*/g, '');\n\t\t\t\t\thtml = html.replace(/[\\s\\n]*$/g, '');\n\t\t\t\t\thtml = html.replace( />\\s{2,}</g, '><');\n\t\t\t\t\thtml = html.replace(/\\n\\n/g, \"\\n\");\n\t\t\t\t\thtml = html.replace(/\\u200B/g, '');\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tnormalizeCurrentHeading: function()\n\t\t\t\t{\n\t\t\t\t\tvar heading = this.selection.block();\n\t\t\t\t\tif (this.utils.isCurrentOrParentHeader() && heading)\n\t\t\t\t\t{\n\t\t\t\t\t\theading.normalize();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =code\n\t\tcode: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tsyncFire: true,\n\t\t\t\thtml: false,\n\t\t\t\tstart: function(html)\n\t\t\t\t{\n\t\t\t\t\thtml = $.trim(html);\n\t\t\t\t\thtml = html.replace(/^(<span id=\"selection-marker-1\" class=\"redactor-selection-marker\">​<\\/span>)/, '');\n\n\t\t\t\t\t// clean\n\t\t\t\t\tif (this.opts.type === 'textarea')\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = this.clean.onSet(html);\n\t\t\t\t\t}\n\t\t\t\t\telse if (this.opts.type === 'div' && html === '')\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = this.opts.emptyHtml;\n\t\t\t\t\t}\n\n\t\t\t\t\thtml = html.replace(/<p><span id=\"selection-marker-1\" class=\"redactor-selection-marker\">​<\\/span><\\/p>/, '');\n\n\t\t\t\t\tthis.events.stopDetectChanges();\n\t\t\t\t\tthis.core.editor().html(html);\n\t\t\t\t\tthis.observe.load();\n\t\t\t\t\tthis.events.startDetectChanges();\n\t\t\t\t},\n\t\t\t\tset: function(html, options)\n\t\t\t\t{\n\t\t\t\t\thtml = $.trim(html);\n\n                    options = options || {};\n\n                    // start\n                    if (options.start)\n                    {\n                        this.start = options.start;\n                    }\n\n\t\t\t\t\t// clean\n\t\t\t\t\tif (this.opts.type === 'textarea')\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = this.clean.onSet(html);\n\t\t\t\t\t}\n\t\t\t\t\telse if (this.opts.type === 'div' && html === '')\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = this.opts.emptyHtml;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.core.editor().html(html);\n\n\t\t\t\t\tif (this.opts.type === 'textarea')\n\t\t\t\t\t{\n    \t\t\t\t\tthis.code.sync();\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.placeholder.enable();\n\t\t\t\t},\n\t\t\t\tget: function()\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.type === 'textarea')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn this.core.textarea().val();\n                    }\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tvar html = this.core.editor().html();\n\n\t\t\t\t\t\t// clean\n\t\t\t\t\t\thtml = this.clean.onGet(html);\n\n\t\t\t\t\t\treturn html;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tsync: function()\n\t\t\t\t{\n\t\t\t\t\tif (!this.code.syncFire)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar html = this.core.editor().html();\n\t\t\t\t\tvar htmlCleaned = this.code.cleaned(html);\n\n\t\t\t\t\t// is there a need to synchronize\n\t\t\t\t\tif (this.code.isSync(htmlCleaned))\n\t\t\t\t\t{\n\t\t\t\t\t\t// do not sync\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// save code\n\t\t\t\t\tthis.code.html = htmlCleaned;\n\n\t\t\t\t\tif (this.opts.type !== 'textarea')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.callback('sync', html);\n\t\t\t\t\t\tthis.core.callback('change', html);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.opts.type === 'textarea')\n\t\t\t\t\t{\n\t\t\t\t\t\tsetTimeout($.proxy(function()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.code.startSync(html);\n\n\t\t\t\t\t\t}, this), 10);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tstartSync: function(html)\n\t\t\t\t{\n\t\t\t\t\t// before clean callback\n\t\t\t\t\thtml = this.core.callback('syncBefore', html);\n\n\t\t\t\t\t// clean\n\t\t\t\t\thtml = this.clean.onSync(html);\n\n\t\t\t\t\t// set code\n\t\t\t\t\tthis.core.textarea().val(html);\n\n\t\t\t\t\t// after sync callback\n\t\t\t\t\tthis.core.callback('sync', html);\n\n\t\t\t\t\t// change callback\n\t\t\t\t\tif (this.start === false)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.callback('change', html);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.start = false;\n\t\t\t\t},\n\t\t\t\tisSync: function(htmlCleaned)\n\t\t\t\t{\n\t\t\t\t\tvar html = (this.code.html !== false) ? this.code.html : false;\n\n\t\t\t\t\treturn (html !== false && html === htmlCleaned);\n\t\t\t\t},\n\t\t\t\tcleaned: function(html)\n\t\t\t\t{\n\t\t\t\t\thtml = html.replace(/\\u200B/g, '');\n\t\t\t\t\treturn this.clean.removeMarkers(html);\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =core\n\t\tcore: function()\n\t\t{\n\t\t\treturn {\n\n\t\t\t\tid: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.$editor.attr('id');\n\t\t\t\t},\n\t\t\t\telement: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.$element;\n\t\t\t\t},\n\t\t\t\teditor: function()\n\t\t\t\t{\n\t\t\t\t\treturn (typeof this.$editor === 'undefined') ? $() : this.$editor;\n\t\t\t\t},\n\t\t\t\ttextarea: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.$textarea;\n\t\t\t\t},\n\t\t\t\tbox: function()\n\t\t\t\t{\n\t\t\t\t\treturn (this.opts.type === 'textarea') ? this.$box : this.$element;\n\t\t\t\t},\n\t\t\t\ttoolbar: function()\n\t\t\t\t{\n\t\t\t\t\treturn (this.$toolbar) ? this.$toolbar : false;\n\t\t\t\t},\n\t\t\t\tair: function()\n\t\t\t\t{\n\t\t\t\t\treturn (this.$air) ? this.$air : false;\n\t\t\t\t},\n\t\t\t\tobject: function()\n\t\t\t\t{\n\t\t\t\t\treturn $.extend({}, this);\n\t\t\t\t},\n\t\t\t\tstructure: function()\n\t\t\t\t{\n\t\t\t\t\tthis.core.editor().toggleClass('redactor-structure');\n\t\t\t\t},\n\t\t\t\taddEvent: function(name)\n\t\t\t\t{\n\t\t\t\t\tthis.core.event = name;\n\t\t\t\t},\n\t\t\t\tgetEvent: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.core.event;\n\t\t\t\t},\n\t\t\t\tcallback: function(type, e, data)\n\t\t\t\t{\n\t\t\t\t\tvar eventNamespace = 'redactor';\n\t\t\t\t\tvar returnValue = false;\n\t\t\t\t\tvar events = $._data(this.core.element()[0], 'events');\n\n\t\t\t\t\t// on callback\n\t\t\t\t\tif (typeof events !== 'undefined' && typeof events[type] !== 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\tvar len = events[type].length;\n\t\t\t\t\t\tfor (var i = 0; i < len; i++)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar namespace = events[type][i].namespace;\n\t\t\t\t\t\t\tif (namespace === 'callback.' + eventNamespace)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tvar handler = events[type][i].handler;\n\t\t\t\t\t\t\t\tvar args = (typeof data === 'undefined') ? [e] : [e, data];\n\t\t\t\t\t\t\t\treturnValue = (typeof args === 'undefined') ? handler.call(this, e) : handler.call(this, e, args);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (returnValue)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn returnValue;\n\t\t\t\t\t}\n\n\t\t\t\t\t// no callback\n\t\t\t\t\tif (typeof this.opts.callbacks[type] === 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn (typeof data === 'undefined') ? e : data;\n\t\t\t\t\t}\n\n\t\t\t\t\t// callback\n\t\t\t\t\tvar callback = this.opts.callbacks[type];\n\n\t\t\t\t\tif ($.isFunction(callback))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn (typeof data === 'undefined') ? callback.call(this, e) : callback.call(this, e, data);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\treturn (typeof data === 'undefined') ? e : data;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tdestroy: function()\n\t\t\t\t{\n\t\t\t\t\tthis.opts.destroyed = true;\n\n\t\t\t\t\tthis.core.callback('destroy');\n\n\t\t\t\t\t// placeholder\n\t\t\t\t\tthis.placeholder.destroy();\n\n\t\t\t\t\t// progress\n\t\t\t\t\tthis.progress.destroy();\n\n\t\t\t\t\t// help label\n\t\t\t\t\t$('#redactor-voice-' + this.uuid).remove();\n\n\t\t\t\t\tthis.core.editor().removeClass('redactor-in redactor-styles redactor-structure redactor-layer-img-edit');\n\n\t\t\t\t\t// caret service\n\t\t\t\t\tthis.core.editor().off('keydown.redactor-remove-textnode');\n\n\t\t\t\t\t// observer\n\t\t\t\t\tthis.core.editor().off('.redactor-observe.' + this.uuid);\n\n\t\t\t\t\t// off events and remove data\n\t\t\t\t\tthis.$element.off('.redactor').removeData('redactor');\n\t\t\t\t\tthis.core.editor().off('.redactor');\n\n\t\t\t\t\t$(document).off('.redactor-dropdown');\n\t\t\t\t\t$(document).off('.redactor-air.' + this.uuid);\n\t\t\t\t\t$(document).off('mousedown.redactor-blur.' + this.uuid);\n\t\t\t\t\t$(document).off('mousedown.redactor.' + this.uuid);\n\t\t\t\t\t$(document).off('touchstart.redactor.' + this.uuid + ' click.redactor.' + this.uuid);\n\t\t\t\t\t$(window).off('.redactor-toolbar.' + this.uuid);\n\t\t\t\t\t$(window).off('touchmove.redactor.' + this.uuid);\n\t\t\t\t\t$(\"body\").off('scroll.redactor.' + this.uuid);\n\n\t\t\t\t\t$(this.opts.toolbarFixedTarget).off('scroll.redactor.' + this.uuid);\n\n\t\t\t\t\t// plugins events\n\t\t\t\t\tvar self = this;\n\t\t\t\t\tif (this.opts.plugins !== false)\n\t\t\t\t\t{\n\t\t\t\t\t\t$.each(this.opts.plugins, function(i,s)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$(window).off('.redactor-plugin-' + s);\n\t\t\t\t\t\t\t$(document).off('.redactor-plugin-' + s);\n\t\t\t\t\t\t\t$(\"body\").off('.redactor-plugin-' + s);\n\t\t\t\t\t\t\tself.core.editor().off('.redactor-plugin-' + s);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\t// click to edit\n\t\t\t\t\tthis.$element.off('click.redactor-click-to-edit');\n\t\t\t\t\tthis.$element.removeClass('redactor-click-to-edit');\n\n\t\t\t\t\t// common\n\t\t\t\t\tthis.core.editor().removeClass('redactor-layer');\n\t\t\t\t\tthis.core.editor().removeAttr('contenteditable');\n\n\t\t\t\t\tvar html = this.code.get();\n\n\t\t\t\t\tif (this.opts.toolbar && this.$toolbar)\n\t\t\t\t\t{\n\t\t\t\t\t\t// dropdowns off\n\t\t\t\t\t\tthis.$toolbar.find('a').each(function()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar $el = $(this);\n\t\t\t\t\t\t\tif ($el.data('dropdown'))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$el.data('dropdown').remove();\n\t\t\t\t\t\t\t\t$el.data('dropdown', {});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.opts.type === 'textarea')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$box.after(this.$element);\n\t\t\t\t\t\tthis.$box.remove();\n\t\t\t\t\t\tthis.$element.val(html).show();\n\t\t\t\t\t}\n\n\t\t\t\t\t// air\n\t\t\t\t\tif (this.opts.air)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$air.remove();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.opts.toolbar && this.$toolbar)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$toolbar.remove();\n\t\t\t\t\t}\n\n\t\t\t\t\t// modal\n\t\t\t\t\tif (this.$modalBox)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$modalBox.remove();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.$modalOverlay)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$modalOverlay.remove();\n\t\t\t\t\t}\n\n\t\t\t\t\t// hide link's tooltip\n\t\t\t\t\t$('.redactor-link-tooltip').remove();\n\n\t\t\t\t\t// autosave\n\t\t\t\t\tclearInterval(this.autosaveTimeout);\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =detect\n\t\tdetect: function()\n\t\t{\n\t\t\treturn {\n\n\t\t\t\t// public\n\t\t\t\tisWebkit: function()\n\t\t\t\t{\n\t\t\t\t\treturn /webkit/.test(this.opts.userAgent);\n\t\t\t\t},\n\t\t\t\tisFirefox: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.opts.userAgent.indexOf('firefox') > -1;\n\t\t\t\t},\n\t\t\t\tisIe: function(v)\n\t\t\t\t{\n                    if (document.documentMode || /Edge/.test(navigator.userAgent))\n                    {\n                        return 'edge';\n                    }\n\n\t\t\t\t\tvar ie;\n\t\t\t\t\tie = RegExp('msie' + (!isNaN(v)?('\\\\s'+v):''), 'i').test(navigator.userAgent);\n\n\t\t\t\t\tif (!ie)\n\t\t\t\t\t{\n\t\t\t\t\t\tie = !!navigator.userAgent.match(/Trident.*rv[ :]*11\\./);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn ie;\n\t\t\t\t},\n\t\t\t\tisMobile: function()\n\t\t\t\t{\n\t\t\t\t\treturn /(iPhone|iPod|BlackBerry|Android)/.test(navigator.userAgent);\n\t\t\t\t},\n\t\t\t\tisDesktop: function()\n\t\t\t\t{\n\t\t\t\t\treturn !/(iPhone|iPod|iPad|BlackBerry|Android)/.test(navigator.userAgent);\n\t\t\t\t},\n\t\t\t\tisIpad: function()\n\t\t\t\t{\n\t\t\t\t\treturn /iPad/.test(navigator.userAgent);\n\t\t\t\t}\n\n\t\t\t};\n\t\t},\n\n\t\t// =dropdown\n\t\tdropdown: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tactive: false,\n\t\t\t\tbutton: false,\n\t\t\t\tkey: false,\n\t\t\t\tposition: [],\n\t\t\t\tgetDropdown: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.dropdown.active;\n\t\t\t\t},\n\t\t\t\tbuild: function(name, $dropdown, dropdownObject)\n\t\t\t\t{\n\t\t\t\t\tdropdownObject = this.dropdown.buildFormatting(name, dropdownObject);\n\n\t\t\t\t\t$.each(dropdownObject, $.proxy(function(btnName, btnObject)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar $item = this.dropdown.buildItem(btnName, btnObject);\n\n\t\t\t\t\t\tthis.observe.addDropdown($item, btnName, btnObject);\n\t\t\t\t\t\t$dropdown.attr('rel', name).append($item);\n\n\t\t\t\t\t}, this));\n\t\t\t\t},\n\t\t\t\tbuildFormatting: function(name, dropdownObject)\n\t\t\t\t{\n\t\t\t\t\tif (name !== 'format' || this.opts.formattingAdd === false)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn dropdownObject;\n\t\t\t\t\t}\n\n\t\t\t\t\t$.each(this.opts.formattingAdd, $.proxy(function(i,s)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar type = (this.utils.isBlockTag(s.args[0])) ? 'block' : 'inline';\n\n\t\t\t\t\t\tdropdownObject[i] = {\n\t\t\t\t\t\t\tfunc: (type === 'block') ? 'block.format' : 'inline.format',\n\t\t\t\t\t\t\targs: s.args,\n\t\t\t\t\t\t\ttitle: s.title\n\t\t\t\t\t\t};\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t\treturn dropdownObject;\n\t\t\t\t},\n\t\t\t\tbuildItem: function(btnName, btnObject)\n\t\t\t\t{\n\t\t\t\t\tvar $itemContainer = $('<li />');\n\t\t\t\t\tif (typeof btnObject.classname !== 'undefined')\n\t\t\t\t\t{\n    \t\t\t\t\t$itemContainer.addClass(btnObject.classname);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (btnName.search(/^divider/i) !== -1)\n\t\t\t\t\t{\n    \t\t\t\t\t$itemContainer.addClass('redactor-dropdown-divider');\n\n    \t\t\t\t\treturn $itemContainer;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar $item = $('<a href=\"#\" class=\"redactor-dropdown-' + btnName + '\" role=\"button\" />');\n\t\t\t\t\tvar $itemSpan = $('<span />').html(btnObject.title);\n\n\t\t\t\t\t$item.append($itemSpan);\n\t\t\t\t\t$item.on('mousedown', $.proxy(function(e)\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\tthis.dropdown.buildClick(e, btnName, btnObject);\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t\t$itemContainer.append($item);\n\n\t\t\t\t\treturn $itemContainer;\n\n\t\t\t\t},\n\t\t\t\tbuildClick: function(e, btnName, btnObject)\n\t\t\t\t{\n\t\t\t\t\tif ($(e.target).hasClass('redactor-dropdown-link-inactive'))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar command = this.dropdown.buildCommand(btnObject);\n\n\t\t\t\t\tif (typeof btnObject.args !== 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.button.toggle(e, btnName, command.type, command.callback, btnObject.args);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.button.toggle(e, btnName, command.type, command.callback);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tbuildCommand: function(btnObject)\n\t\t\t\t{\n\t\t\t\t\tvar command = {};\n\t\t\t\t\tcommand.type = 'func';\n\t\t\t\t\tcommand.callback = btnObject.func;\n\n\t\t\t\t\tif (btnObject.command)\n\t\t\t\t\t{\n\t\t\t\t\t\tcommand.type = 'command';\n\t\t\t\t\t\tcommand.callback = btnObject.command;\n\t\t\t\t\t}\n\t\t\t\t\telse if (btnObject.dropdown)\n\t\t\t\t\t{\n\t\t\t\t\t\tcommand.type = 'dropdown';\n\t\t\t\t\t\tcommand.callback = btnObject.dropdown;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn command;\n\t\t\t\t},\n\t\t\t\tshow: function(e, key)\n\t\t\t\t{\n\t\t\t\t\tif (this.detect.isDesktop())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.editor().focus();\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.dropdown.hideAll(false, key);\n\n\t\t\t\t\tthis.dropdown.key = key;\n\t\t\t\t\tthis.dropdown.button = this.button.get(this.dropdown.key);\n\n\t\t\t\t\tif (this.dropdown.button.hasClass('dropact'))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.dropdown.hide();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// re append\n\t\t\t\t\tthis.dropdown.active = this.dropdown.button.data('dropdown').appendTo(document.body);\n\n\t\t\t\t\t// callback\n\t\t\t\t\tthis.core.callback('dropdownShow', { dropdown: this.dropdown.active, key: this.dropdown.key, button: this.dropdown.button });\n\n\t\t\t\t\t// set button\n\t\t\t\t\tthis.button.setActive(this.dropdown.key);\n\t\t\t\t\tthis.dropdown.button.addClass('dropact');\n\n\t\t\t\t\t// position\n\t\t\t\t\tthis.dropdown.getButtonPosition();\n\n\t\t\t\t\t// show\n\t\t\t\t\tif (this.button.toolbar().hasClass('toolbar-fixed-box') && this.detect.isDesktop())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.dropdown.showIsFixedToolbar();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.dropdown.showIsUnFixedToolbar();\n\t\t\t\t\t}\n\n\t\t\t\t\t// disable scroll whan dropdown scroll\n\t\t\t\t\tif (this.detect.isDesktop() && !this.detect.isFirefox())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.dropdown.active.on('mouseover.redactor-dropdown', $.proxy(this.utils.disableBodyScroll, this));\n\t\t\t\t\t\tthis.dropdown.active.on('mouseout.redactor-dropdown mousedown.redactor-dropdown', $.proxy(this.utils.enableBodyScroll, this));\n\t\t\t\t\t}\n\n\t\t\t\t\te.stopPropagation();\n\n\t\t\t\t},\n\t\t\t\tshowIsFixedToolbar: function()\n\t\t\t\t{\n\t\t\t\t\tvar top = this.dropdown.button.position().top + this.dropdown.button.innerHeight() + this.opts.toolbarFixedTopOffset;\n\n\t\t\t\t\tvar position = 'fixed';\n\t\t\t\t\tif (this.opts.toolbarFixedTarget !== document)\n\t\t\t\t\t{\n\t\t\t\t\t\ttop = (this.dropdown.button.innerHeight() + this.$toolbar.offset().top) + this.opts.toolbarFixedTopOffset;\n\t\t\t\t\t\tposition = 'absolute';\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.dropdown.active.css({\n\n\t\t\t\t\t\tposition: position,\n\t\t\t\t\t\tleft: this.dropdown.position.left + 'px',\n\t\t\t\t\t\ttop: top + 'px'\n\n\t\t\t\t\t}).show();\n\n\t\t\t\t\t// animate\n\t\t\t\t\tthis.dropdown.active.redactorAnimation('slideDown', { duration: 0.2 }, $.proxy(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.dropdown.enableCallback();\n\t\t\t\t\t\tthis.dropdown.enableEvents();\n\n\t\t\t\t\t}, this));\n\t\t\t\t},\n\t\t\t\tshowIsUnFixedToolbar: function()\n\t\t\t\t{\n\t\t\t\t\tthis.dropdown.active.css({\n\n\t\t\t\t\t\tposition: 'absolute',\n\t\t\t\t\t\tleft: this.dropdown.position.left + 'px',\n\t\t\t\t\t\ttop: (this.dropdown.button.innerHeight() + this.dropdown.position.top) + 'px'\n\n\t\t\t\t\t}).show();\n\n\t\t\t\t\t// animate\n\t\t\t\t\tthis.dropdown.active.redactorAnimation(((this.opts.animation) ? 'slideDown' : 'show'), { duration: 0.2 }, $.proxy(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.dropdown.enableCallback();\n\t\t\t\t\t\tthis.dropdown.enableEvents();\n\n\t\t\t\t\t}, this));\n\t\t\t\t},\n\t\t\t\tenableEvents: function()\n\t\t\t\t{\n\t\t\t\t\t$(document).on('mousedown.redactor-dropdown', $.proxy(this.dropdown.hideAll, this));\n\t\t\t\t\tthis.core.editor().on('touchstart.redactor-dropdown', $.proxy(this.dropdown.hideAll, this));\n\t\t\t\t\t$(document).on('keyup.redactor-dropdown', $.proxy(this.dropdown.closeHandler, this));\n\t\t\t\t},\n\t\t\t\tenableCallback: function()\n\t\t\t\t{\n\t\t\t\t\tthis.core.callback('dropdownShown', { dropdown: this.dropdown.active, key: this.dropdown.key, button: this.dropdown.button });\n\t\t\t\t},\n\t\t\t\tgetButtonPosition: function()\n\t\t\t\t{\n\t\t\t\t\tthis.dropdown.position = this.dropdown.button.offset();\n\n\t\t\t\t\t// fix right placement\n\t\t\t\t\tvar dropdownWidth = this.dropdown.active.width();\n\t\t\t\t\tif ((this.dropdown.position.left + dropdownWidth) > $(document).width())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.dropdown.position.left = Math.max(0, this.dropdown.position.left - dropdownWidth + parseInt(this.dropdown.button.innerWidth()));\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\tcloseHandler: function(e)\n\t\t\t\t{\n\t\t\t\t\tif (e.which !== this.keyCode.ESC)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.dropdown.hideAll(e);\n\t\t\t\t\tthis.core.editor().focus();\n\t\t\t\t},\n\t\t\t\thideAll: function(e, key)\n\t\t\t\t{\n\t\t\t\t\tif (this.detect.isDesktop())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.utils.enableBodyScroll();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (e !== false && $(e.target).closest('.redactor-dropdown').length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar $buttons = (typeof key === 'undefined') ? this.button.toolbar().find('a.dropact') : this.button.toolbar().find('a.dropact').not('.re-' + key);\n\t\t\t\t\tvar $elements = (typeof key === 'undefined') ? $('.redactor-dropdown-' + this.uuid) : $('.redactor-dropdown-' + this.uuid).not('.redactor-dropdown-box-' + key);\n\n\t\t\t\t\tif ($elements.length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\t$(document).off('.redactor-dropdown');\n\t\t\t\t\t\tthis.core.editor().off('.redactor-dropdown');\n\n\t\t\t\t\t\t$.each($elements, $.proxy(function(i,s)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar $el = $(s);\n\n\t\t\t\t\t\t\tthis.core.callback('dropdownHide', $el);\n\n\t\t\t\t\t\t\t$el.hide();\n\t\t\t\t\t\t\t$el.off('mouseover mouseout').off('.redactor-dropdown');\n\n\t\t\t\t\t\t}, this));\n\n\t\t\t\t\t\t$buttons .removeClass('redactor-act dropact');\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\thide: function ()\n\t\t\t\t{\n\t\t\t\t\tif (this.dropdown.active === false)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.detect.isDesktop())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.utils.enableBodyScroll();\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.dropdown.active.redactorAnimation(((this.opts.animation) ? 'slideUp' : 'hide'), { duration: 0.2 }, $.proxy(function()\n\t\t\t\t\t{\n\t\t\t\t\t\t$(document).off('.redactor-dropdown');\n\t\t\t\t\t\tthis.core.editor().off('.redactor-dropdown');\n\n\t\t\t\t\t\tthis.dropdown.hideOut();\n\n\n\t\t\t\t\t}, this));\n\t\t\t\t},\n\t\t\t\thideOut: function()\n\t\t\t\t{\n\t\t\t\t\tthis.core.callback('dropdownHide', this.dropdown.active);\n\n\t\t\t\t\tthis.dropdown.button.removeClass('redactor-act dropact');\n\t\t\t\t\tthis.dropdown.active.off('mouseover mouseout').off('.redactor-dropdown');\n\t\t\t\t\tthis.dropdown.button = false;\n\t\t\t\t\tthis.dropdown.key = false;\n\t\t\t\t\tthis.dropdown.active = false;\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =events\n\t\tevents: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tfocused: false,\n\t\t\t\tblured: true,\n\t\t\t\tdropImage: false,\n\t\t\t\tstopChanges: false,\n\t\t\t\tstopDetectChanges: function()\n\t\t\t\t{\n\t\t\t\t\tthis.events.stopChanges = true;\n\t\t\t\t},\n\t\t\t\tstartDetectChanges: function()\n\t\t\t\t{\n\t\t\t\t\tvar self = this;\n\t\t\t\t\tsetTimeout(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tself.events.stopChanges = false;\n\t\t\t\t\t}, 1);\n\t\t\t\t},\n\t\t\t\tdragover: function(e)\n\t\t\t\t{\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\te.stopPropagation();\n\n\t\t\t\t\tif (e.target.tagName === 'IMG')\n\t\t\t\t\t{\n\t\t\t\t\t\t$(e.target).addClass('redactor-image-dragover');\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\tdragleave: function(e)\n\t\t\t\t{\n\t\t\t\t\t// remove image dragover\n\t\t\t\t\tthis.core.editor().find('img').removeClass('redactor-image-dragover');\n\t\t\t\t},\n\t\t\t\tdrop: function(e)\n\t\t\t\t{\n\t\t\t\t\te = e.originalEvent || e;\n\n\t\t\t\t\t// remove image dragover\n\t\t\t\t\tthis.core.editor().find('img').removeClass('redactor-image-dragover');\n\n\t\t\t\t\tif (this.opts.type === 'inline' || this.opts.type === 'pre')\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (window.FormData === undefined || !e.dataTransfer)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (e.dataTransfer.files.length === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn this.events.onDrop(e);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.events.onDropUpload(e);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.core.callback('drop', e);\n\n\t\t\t\t},\n\t\t\t\tclick: function(e)\n\t\t\t\t{\n\t\t\t\t\tvar event = this.core.getEvent();\n\t\t\t\t\tvar type = (event === 'click' || event === 'arrow') ? false : 'click';\n\n                    this.core.addEvent(type);\n\t\t\t\t\tthis.utils.disableSelectAll();\n\t\t\t\t\tthis.core.callback('click', e);\n\t\t\t\t},\n\t\t\t\tfocus: function(e)\n\t\t\t\t{\n\t\t\t\t\tif (this.rtePaste)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.events.isCallback('focus'))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.callback('focus', e);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.events.focused = true;\n\t\t\t\t\tthis.events.blured = false;\n\n\t\t\t\t\t// tab\n\t\t\t\t\tif (this.selection.current() === false)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar sel = this.selection.get();\n\t\t\t\t\t\tvar range = this.selection.range(sel);\n\n\t\t\t\t\t\trange.setStart(this.core.editor()[0], 0);\n\t\t\t\t\t\trange.setEnd(this.core.editor()[0], 0);\n\t\t\t\t\t\tthis.selection.update(sel, range);\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\tblur: function(e)\n\t\t\t\t{\n\t\t\t\t\tif (this.start || this.rtePaste)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ($(e.target).closest('#' + this.core.id() + ', .redactor-toolbar, .redactor-dropdown, #redactor-modal-box').length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!this.events.blured && this.events.isCallback('blur'))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.callback('blur', e);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.events.focused = false;\n\t\t\t\t\tthis.events.blured = true;\n\t\t\t\t},\n\t\t\t\ttouchImageEditing: function()\n\t\t\t\t{\n\t\t\t\t\tvar scrollTimer = -1;\n\t\t\t\t\tthis.events.imageEditing = false;\n\t\t\t\t\t$(window).on('touchmove.redactor.' + this.uuid, $.proxy(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.events.imageEditing = true;\n\t\t\t\t\t\tif (scrollTimer !== -1)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tclearTimeout(scrollTimer);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tscrollTimer = setTimeout($.proxy(function()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.events.imageEditing = false;\n\n\t\t\t\t\t\t}, this), 500);\n\n\t\t\t\t\t}, this));\n\t\t\t\t},\n\t\t\t\tinit: function()\n\t\t\t\t{\n\t\t\t\t\tthis.core.editor().on('dragover.redactor dragenter.redactor', $.proxy(this.events.dragover, this));\n\t\t\t\t\tthis.core.editor().on('dragleave.redactor', $.proxy(this.events.dragleave, this));\n\t\t\t\t\tthis.core.editor().on('drop.redactor', $.proxy(this.events.drop, this));\n\t\t\t\t\tthis.core.editor().on('click.redactor', $.proxy(this.events.click, this));\n\t\t\t\t\tthis.core.editor().on('paste.redactor', $.proxy(this.paste.init, this));\n\t\t\t\t\tthis.core.editor().on('keydown.redactor', $.proxy(this.keydown.init, this));\n\t\t\t\t\tthis.core.editor().on('keyup.redactor', $.proxy(this.keyup.init, this));\n\t\t\t\t\tthis.core.editor().on('focus.redactor', $.proxy(this.events.focus, this));\n\n\t\t\t\t\t$(document).on('mousedown.redactor-blur.' + this.uuid, $.proxy(this.events.blur, this));\n\n\t\t\t\t\tthis.events.touchImageEditing();\n\n\t\t\t\t\tthis.events.createObserver();\n\t\t\t\t\tthis.events.setupObserver();\n\n\t\t\t\t},\n\t\t\t\tcreateObserver: function()\n\t\t\t\t{\n\t\t\t\t\tvar self = this;\n\t\t\t\t\tthis.events.observer = new MutationObserver(function(mutations)\n\t\t\t\t\t{\n\t\t\t\t\t\tmutations.forEach($.proxy(self.events.iterateObserver, self));\n\t\t\t\t\t});\n\n\t\t\t\t},\n\t\t\t\titerateObserver: function(mutation)\n\t\t\t\t{\n\n\t\t\t\t\tvar stop = false;\n\n\t\t\t\t\t// target\n\t\t\t\t\tif (((this.opts.type === 'textarea' || this.opts.type === 'div')\n\t\t\t\t\t    && (!this.detect.isFirefox() && mutation.target === this.core.editor()[0]))\n\t\t\t\t\t    || (mutation.attributeName === 'class' && mutation.target === this.core.editor()[0])\n\t\t\t\t\t    || (mutation.attributeName == 'data-vivaldi-spatnav-clickable')\n                    )\n\t\t\t\t\t{\n\t\t\t\t\t\tstop = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!stop)\n\t\t\t\t\t{\n    \t\t\t\t\tthis.observe.load();\n\t\t\t\t\t\tthis.events.changeHandler();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tsetupObserver: function()\n\t\t\t\t{\n\t\t\t\t\tthis.events.observer.observe(this.core.editor()[0], {\n\t\t\t\t\t\t attributes: true,\n\t\t\t\t\t\t subtree: true,\n\t\t\t\t\t\t childList: true,\n\t\t\t\t\t\t characterData: true,\n\t\t\t\t\t\t characterDataOldValue: true\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tchangeHandler: function()\n\t\t\t\t{\n\t\t\t\t\tif (this.events.stopChanges)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.code.sync();\n\n\t\t\t\t\t// autosave\n\t\t\t\t\tif (this.autosave.is())\n\t\t\t\t\t{\n\n\t\t\t\t\t\tclearTimeout(this.autosaveTimeout);\n\t\t\t\t\t\tthis.autosaveTimeout = setTimeout($.proxy(this.autosave.send, this), 300);\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\tonDropUpload: function(e)\n\t\t\t\t{\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\te.stopPropagation();\n\n\t\t\t\t\tif ((!this.opts.dragImageUpload && !this.opts.dragFileUpload) || (this.opts.imageUpload === null && this.opts.fileUpload === null))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (e.target.tagName === 'IMG')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.events.dropImage = e.target;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar files = e.dataTransfer.files;\n                    var len = files.length;\n\t\t\t\t\tfor (var i = 0; i < len; i++)\n\t\t\t\t\t{\n    \t\t\t\t\tthis.upload.directUpload(files[i], e);\n    \t\t\t\t}\n\t\t\t\t},\n\t\t\t\tonDrop: function(e)\n\t\t\t\t{\n\t\t\t\t\tthis.core.callback('drop', e);\n\t\t\t\t},\n\t\t\t\tisCallback: function(name)\n\t\t\t\t{\n\t\t\t\t\treturn (typeof this.opts.callbacks[name] !== 'undefined' && $.isFunction(this.opts.callbacks[name]));\n\t\t\t\t},\n\n\t\t\t\t// #backward\n\t\t\t\tstopDetect: function()\n\t\t\t\t{\n\t\t\t\t\tthis.events.stopDetectChanges();\n\t\t\t\t},\n\t\t\t\tstartDetect: function()\n\t\t\t\t{\n\t\t\t\t\tthis.events.startDetectChanges();\n\t\t\t\t}\n\n\t\t\t};\n\t\t},\n\n\t\t// =file\n\t\tfile: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tis: function()\n\t\t\t\t{\n\t\t\t\t\treturn !(!this.opts.fileUpload || !this.opts.fileUpload && !this.opts.s3);\n\t\t\t\t},\n\t\t\t\tshow: function()\n\t\t\t\t{\n\t\t\t\t\t// build modal\n\t\t\t\t\tthis.modal.load('file', this.lang.get('file'), 700);\n\n\t\t\t\t\t// build upload\n\t\t\t\t\tthis.upload.init('#redactor-modal-file-upload', this.opts.fileUpload, this.file.insert);\n\n\t\t\t\t\t// set selected text\n\t\t\t\t\t$('#redactor-filename').val(this.selection.get().toString());\n\n\t\t\t\t\t// show\n\t\t\t\t\tthis.modal.show();\n\t\t\t\t},\n\t\t\t\tinsert: function(json, direct, e)\n\t\t\t\t{\n\t\t\t\t\t// error callback\n\t\t\t\t\tif (typeof json.error !== 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.modal.close();\n\t\t\t\t\t\tthis.core.callback('fileUploadError', json);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.file.release(e, direct);\n\n\t\t\t\t\t// prepare\n\t\t\t\t\tthis.buffer.set();\n\t\t\t\t\tthis.air.collapsed();\n\n\t\t\t\t\t// get\n\t\t\t\t\tvar text = this.file.text(json);\n\t\t\t\t\tvar $link = $('<a />').attr('href', json.url).text(text);\n\t\t\t\t\tvar id = (typeof json.id === 'undefined') ? '' : json.id;\n\t\t\t\t\tvar type = (typeof json.s3 === 'undefined') ? 'file' : 's3';\n\n\t\t\t\t\t// set id\n\t\t\t\t\t$link.attr('data-' + type, id);\n\n\t\t\t\t\t// insert\n\t\t\t\t\t$link = $(this.insert.node($link));\n\n\t\t\t\t\t// focus\n\t\t\t\t\tthis.caret.after($link);\n\n\t\t\t\t\t// callback\n\t\t\t\t\tthis.storage.add({ type: type, node: $link[0], url: json.url, id: id });\n\n\t\t\t\t\tif (direct !== null)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.callback('fileUpload', $link, json);\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\trelease: function(e, direct)\n\t\t\t\t{\n\t\t\t\t\tif (direct)\n\t\t\t\t\t{\n\t\t\t\t\t\t// drag and drop upload\n\t\t\t\t\t\tthis.marker.remove();\n\t\t\t\t\t\tthis.insert.nodeToPoint(e, this.marker.get());\n\t\t\t\t\t\tthis.selection.restore();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\t// upload from modal\n\t\t\t\t\t\tthis.modal.close();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\ttext: function(json)\n\t\t\t\t{\n\t\t\t\t\tvar text = $('#redactor-filename').val();\n\n\t\t\t\t\treturn (typeof text === 'undefined' || text === '') ? json.name : text;\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =focus\n\t\tfocus: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tstart: function()\n\t\t\t\t{\n\t\t\t\t\tthis.core.editor().focus();\n\n\t\t\t\t\tif (this.opts.type === 'inline')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar $first = this.focus.first();\n\t\t\t\t\tif ($first !== false)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.caret.start($first);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tend: function()\n\t\t\t\t{\n\t\t\t\t\tthis.core.editor().focus();\n\n\t\t\t\t\tvar last = (this.opts.inline) ? this.core.editor() : this.focus.last();\n\t\t\t\t\tif (last.length === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// get inline last node\n\t\t\t\t\tvar lastNode = this.focus.lastChild(last);\n\t\t\t\t\tif (!this.detect.isWebkit() && lastNode !== false)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.caret.end(lastNode);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tvar sel = this.selection.get();\n\t\t\t\t\t\tvar range = this.selection.range(sel);\n\n\t\t\t\t\t\tif (range !== null)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\trange.selectNodeContents(last[0]);\n\t\t\t\t\t\t\trange.collapse(false);\n\n\t\t\t\t\t\t\tthis.selection.update(sel, range);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.caret.end(last);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\tfirst: function()\n\t\t\t\t{\n\t\t\t\t\tvar $first = this.core.editor().children().first();\n\t\t\t\t\tif ($first.length === 0 && ($first[0].length === 0 || $first[0].tagName === 'BR' || $first[0].tagName === 'HR' || $first[0].nodeType === 3))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ($first[0].tagName === 'UL' || $first[0].tagName === 'OL')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn $first.find('li').first();\n\t\t\t\t\t}\n\n\t\t\t\t\treturn $first;\n\n\t\t\t\t},\n\t\t\t\tlast: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.core.editor().children().last();\n\t\t\t\t},\n\t\t\t\tlastChild: function(last)\n\t\t\t\t{\n\t\t\t\t\tvar lastNode = last[0].lastChild;\n\n\t\t\t\t\treturn (lastNode !== null && this.utils.isInlineTag(lastNode.tagName)) ? lastNode : false;\n\t\t\t\t},\n\t\t\t\tis: function()\n\t\t\t\t{\n\t\t\t\t\treturn (this.core.editor()[0] === document.activeElement);\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =image\n\t\timage: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tis: function()\n\t\t\t\t{\n\t\t\t\t\treturn !(!this.opts.imageUpload || !this.opts.imageUpload && !this.opts.s3);\n\t\t\t\t},\n\t\t\t\tshow: function()\n\t\t\t\t{\n\t\t\t\t\t// build modal\n\t\t\t\t\tthis.modal.load('image', this.lang.get('image'), 700);\n\n\t\t\t\t\t// build upload\n\t\t\t\t\tthis.upload.init('#redactor-modal-image-droparea', this.opts.imageUpload, this.image.insert);\n\t\t\t\t\tthis.modal.show();\n\n\t\t\t\t},\n\t\t\t\tinsert: function(json, direct, e)\n\t\t\t\t{\n\t\t\t\t\tvar $img;\n\n\t\t\t\t\t// error callback\n\t\t\t\t\tif (typeof json.error !== 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.modal.close();\n\t\t\t\t\t\tthis.events.dropImage = false;\n\t\t\t\t\t\tthis.core.callback('imageUploadError', json, e);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// change image\n\t\t\t\t\tif (this.events.dropImage !== false)\n\t\t\t\t\t{\n\t\t\t\t\t\t$img = $(this.events.dropImage);\n\n\t\t\t\t\t\tthis.core.callback('imageDelete', $img[0].src, $img);\n\n\t\t\t\t\t\t$img.attr('src', json.url);\n\n\t\t\t\t\t\tthis.events.dropImage = false;\n\t\t\t\t\t\tthis.core.callback('imageUpload', $img, json);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.placeholder.hide();\n\t\t\t\t\tvar $figure = $('<' + this.opts.imageTag + '>');\n\n\t\t\t\t\t$img = $('<img>');\n\t\t\t\t\t$img.attr('src', json.url);\n\n\t\t\t\t\t// set id\n\t\t\t\t\tvar id = (typeof json.id === 'undefined') ? '' : json.id;\n\t\t\t\t\tvar type = (typeof json.s3 === 'undefined') ? 'image' : 's3';\n\t\t\t\t\t$img.attr('data-' + type, id);\n\n\t\t\t\t\t$figure.append($img);\n\n\t\t\t\t\tvar pre = this.utils.isTag(this.selection.current(), 'pre');\n\n\t\t\t\t\tif (direct)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.air.collapsed();\n\t\t\t\t\t\tthis.marker.remove();\n\n\t\t\t\t\t\tvar node = this.insert.nodeToPoint(e, this.marker.get());\n\t\t\t\t\t\tvar $next = $(node).next();\n\n\t\t\t\t\t\tthis.selection.restore();\n\n\t\t\t\t\t\t// buffer\n\t\t\t\t\t\tthis.buffer.set();\n\n\t\t\t\t\t\t// insert\n\t\t\t\t\t\tif (typeof $next !== 'undefined' && $next.length !== 0 && $next[0].tagName === 'IMG')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t// delete callback\n\t\t\t\t\t\t\tthis.core.callback('imageDelete', $next[0].src, $next);\n\n\t\t\t\t\t\t\t// replace\n\t\t\t\t\t\t\t$next.closest('figure, p', this.core.editor()[0]).replaceWith($figure);\n\t\t\t\t\t\t\tthis.caret.after($figure);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (pre)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$(pre).after($figure);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.insert.node($figure);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tthis.caret.after($figure);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.modal.close();\n\n\t\t\t\t\t\t// buffer\n\t\t\t\t\t\tthis.buffer.set();\n\n\t\t\t\t\t\t// insert\n\t\t\t\t\t\tthis.air.collapsed();\n\n\t\t\t\t\t\tif (pre)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$(pre).after($figure);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.insert.node($figure);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.caret.after($figure);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.events.dropImage = false;\n\t\t\t\t\tthis.storage.add({ type: type, node: $img[0], url: json.url, id: id });\n\n\t\t\t\t\tvar nextNode = $img[0].nextSibling;\n\t\t\t\t\tvar $nextFigure = $figure.next();\n\t\t\t\t\tvar isNextEmpty = $(nextNode).text().replace(/\\u200B/g, '');\n\t\t\t\t\tvar isNextFigureEmpty = $nextFigure.text().replace(/\\u200B/g, '');\n\n\t\t\t\t\tif (isNextEmpty === '')\n\t\t\t\t\t{\n    \t\t\t\t\t$(nextNode).remove();\n\t\t\t\t\t}\n\n\t\t\t\t\tif ($nextFigure.length === 1 && $nextFigure[0].tagName === 'FIGURE' && isNextFigureEmpty === '')\n\t\t\t\t\t{\n    \t\t\t\t\t$nextFigure.remove();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (direct !== null)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.callback('imageUpload', $img, json);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n    \t\t\t\t\tthis.core.callback('imageInserted', $img, json);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tsetEditable: function($image)\n\t\t\t\t{\n\t\t\t\t\t$image.on('dragstart', function(e)\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t});\n\n                    if (this.opts.imageResizable)\n                    {\n    \t\t\t\t\tvar handler = $.proxy(function(e)\n    \t\t\t\t\t{\n    \t\t\t\t\t\tthis.observe.image = $image;\n    \t\t\t\t\t\tthis.image.resizer = this.image.loadEditableControls($image);\n\n    \t\t\t\t\t\t$(document).on('mousedown.redactor-image-resize-hide.' + this.uuid, $.proxy(this.image.hideResize, this));\n\n    \t\t\t\t\t\tif (this.image.resizer)\n    \t\t\t\t\t\t{\n                                this.image.resizer.on('mousedown.redactor touchstart.redactor', $.proxy(function(e)\n        \t\t\t\t\t\t{\n        \t\t\t\t\t\t\tthis.image.setResizable(e, $image);\n        \t\t\t\t\t\t}, this));\n    \t\t\t\t\t\t}\n\n    \t\t\t\t\t}, this);\n\n    \t\t\t\t\t$image.off('mousedown.redactor').on('mousedown.redactor', $.proxy(this.image.hideResize, this));\n    \t\t\t\t\t$image.off('click.redactor touchstart.redactor').on('click.redactor touchstart.redactor', handler);\n                    }\n                    else\n                    {\n    \t\t\t\t\t$image.off('click.redactor touchstart.redactor').on('click.redactor touchstart.redactor', $.proxy(function(e)\n    \t\t\t\t\t{\n    \t\t\t\t\t\tsetTimeout($.proxy(function()\n    \t\t\t\t\t\t{\n    \t\t\t\t\t\t\tthis.image.showEdit($image);\n\n    \t\t\t\t\t\t}, this), 200);\n\n    \t\t\t\t\t}, this));\n                    }\n\n\t\t\t\t},\n\t\t\t\tsetResizable: function(e, $image)\n\t\t\t\t{\n\t\t\t\t\te.preventDefault();\n\n\t\t\t\t    this.image.resizeHandle = {\n\t\t\t\t        x : e.pageX,\n\t\t\t\t        y : e.pageY,\n\t\t\t\t        el : $image,\n\t\t\t\t        ratio: $image.width() / $image.height(),\n\t\t\t\t        h: $image.height()\n\t\t\t\t    };\n\n\t\t\t\t    e = e.originalEvent || e;\n\n\t\t\t\t    if (e.targetTouches)\n\t\t\t\t    {\n\t\t\t\t         this.image.resizeHandle.x = e.targetTouches[0].pageX;\n\t\t\t\t         this.image.resizeHandle.y = e.targetTouches[0].pageY;\n\t\t\t\t    }\n\n\t\t\t\t\tthis.image.startResize();\n\t\t\t\t},\n\t\t\t\tstartResize: function()\n\t\t\t\t{\n\t\t\t\t\t$(document).on('mousemove.redactor-image-resize touchmove.redactor-image-resize', $.proxy(this.image.moveResize, this));\n\t\t\t\t\t$(document).on('mouseup.redactor-image-resize touchend.redactor-image-resize', $.proxy(this.image.stopResize, this));\n\t\t\t\t},\n\t\t\t\tmoveResize: function(e)\n\t\t\t\t{\n\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\te = e.originalEvent || e;\n\n\t\t\t\t\tvar height = this.image.resizeHandle.h;\n\n\t\t            if (e.targetTouches) height += (e.targetTouches[0].pageY -  this.image.resizeHandle.y);\n\t\t            else height += (e.pageY -  this.image.resizeHandle.y);\n\n\t\t\t\t\tvar width = Math.round(height * this.image.resizeHandle.ratio);\n\n\t\t\t\t\tif (height < 50 || width < 100) return;\n\t\t\t\t\tif (this.core.editor().width() <= width) return;\n\n\t\t\t\t\tthis.image.resizeHandle.el.attr({width: width, height: height});\n\t\t            this.image.resizeHandle.el.width(width);\n\t\t            this.image.resizeHandle.el.height(height);\n\n\t\t            this.code.sync();\n\t\t\t\t},\n\t\t\t\tstopResize: function()\n\t\t\t\t{\n\t\t\t\t\tthis.handle = false;\n\t\t\t\t\t$(document).off('.redactor-image-resize');\n\n\t\t\t\t\tthis.image.hideResize();\n\t\t\t\t},\n                hideResize: function(e)\n\t\t\t\t{\n\t\t\t\t\tif (e && $(e.target).closest('#redactor-image-box', this.$editor[0]).length !== 0) return;\n\t\t\t\t\tif (e && e.target.tagName == 'IMG')\n\t\t\t\t\t{\n\t\t\t\t\t\tvar $image = $(e.target);\n\t\t\t\t\t}\n\n\t\t\t\t\tvar imageBox = this.$editor.find('#redactor-image-box');\n\t\t\t\t\tif (imageBox.length === 0) return;\n\n\t\t\t\t\t$('#redactor-image-editter').remove();\n\t\t\t\t\t$('#redactor-image-resizer').remove();\n\n\t\t\t\t\timageBox.find('img').css({\n\t\t\t\t\t\tmarginTop: imageBox[0].style.marginTop,\n\t\t\t\t\t\tmarginBottom: imageBox[0].style.marginBottom,\n\t\t\t\t\t\tmarginLeft: imageBox[0].style.marginLeft,\n\t\t\t\t\t\tmarginRight: imageBox[0].style.marginRight\n\t\t\t\t\t});\n\n\t\t\t\t\timageBox.css('margin', '');\n\t\t\t\t\timageBox.find('img').css('opacity', '');\n\t\t\t\t\timageBox.replaceWith(function()\n\t\t\t\t\t{\n\t\t\t\t\t\treturn $(this).contents();\n\t\t\t\t\t});\n\n\t\t\t\t\t$(document).off('mousedown.redactor-image-resize-hide.' + this.uuid);\n\n\t\t\t\t\tif (typeof this.image.resizeHandle !== 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.image.resizeHandle.el.attr('rel', this.image.resizeHandle.el.attr('style'));\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tloadResizableControls: function($image, imageBox)\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.imageResizable && !this.detect.isMobile())\n\t\t\t\t\t{\n\t\t\t\t\t\tvar imageResizer = $('<span id=\"redactor-image-resizer\" data-redactor=\"verified\"></span>');\n\n\t\t\t\t\t\tif (!this.detect.isDesktop())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\timageResizer.css({ width: '15px', height: '15px' });\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\timageResizer.attr('contenteditable', false);\n\t\t\t\t\t\timageBox.append(imageResizer);\n\t\t\t\t\t\timageBox.append($image);\n\n\t\t\t\t\t\treturn imageResizer;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\timageBox.append($image);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tloadEditableControls: function($image)\n\t\t\t\t{\n    \t\t\t\tif ($('#redactor-image-box').length !== 0)\n    \t\t\t\t{\n        \t\t\t\treturn;\n    \t\t\t\t}\n\n\t\t\t\t\tvar imageBox = $('<span id=\"redactor-image-box\" data-redactor=\"verified\">');\n\t\t\t\t\timageBox.css('float', $image.css('float')).attr('contenteditable', false);\n\n\t\t\t\t\tif ($image[0].style.margin != 'auto')\n\t\t\t\t\t{\n\t\t\t\t\t\timageBox.css({\n\t\t\t\t\t\t\tmarginTop: $image[0].style.marginTop,\n\t\t\t\t\t\t\tmarginBottom: $image[0].style.marginBottom,\n\t\t\t\t\t\t\tmarginLeft: $image[0].style.marginLeft,\n\t\t\t\t\t\t\tmarginRight: $image[0].style.marginRight\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t$image.css('margin', '');\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\timageBox.css({ 'display': 'block', 'margin': 'auto' });\n\t\t\t\t\t}\n\n\t\t\t\t\t$image.css('opacity', '.5').after(imageBox);\n\n\n\t\t\t\t\tif (this.opts.imageEditable)\n\t\t\t\t\t{\n\t\t\t\t\t\t// editter\n\t\t\t\t\t\tthis.image.editter = $('<span id=\"redactor-image-editter\" data-redactor=\"verified\">' + this.lang.get('edit') + '</span>');\n\t\t\t\t\t\tthis.image.editter.attr('contenteditable', false);\n\t\t\t\t\t\tthis.image.editter.on('click', $.proxy(function()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.image.showEdit($image);\n\t\t\t\t\t\t}, this));\n\n\t\t\t\t\t\timageBox.append(this.image.editter);\n\n\t\t\t\t\t\t// position correction\n\t\t\t\t\t\tvar editerWidth = this.image.editter.innerWidth();\n\t\t\t\t\t\tthis.image.editter.css('margin-left', '-' + editerWidth/2 + 'px');\n\t\t\t\t\t}\n\n\t\t\t\t\treturn this.image.loadResizableControls($image, imageBox);\n\n\t\t\t\t},\n\t\t\t\tshowEdit: function($image)\n\t\t\t\t{\n\t\t\t\t\tif (this.events.imageEditing)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.observe.image = $image;\n\n\t\t\t\t\tvar $link = $image.closest('a', this.$editor[0]);\n    \t\t\t\tvar $figure = $image.closest('figure', this.$editor[0]);\n    \t\t\t\tvar $container = ($figure.length !== 0) ? $figure : $image;\n\n\t\t\t\t\tthis.modal.load('image-edit', this.lang.get('edit'), 705);\n\n\t\t\t\t\tthis.image.buttonDelete = this.modal.getDeleteButton().text(this.lang.get('delete'));\n\t\t\t\t\tthis.image.buttonSave = this.modal.getActionButton().text(this.lang.get('save'));\n\n\t\t\t\t\tthis.image.buttonDelete.on('click', $.proxy(this.image.remove, this));\n\t\t\t\t\tthis.image.buttonSave.on('click', $.proxy(this.image.update, this));\n\n\t\t\t\t\tif (this.opts.imageCaption === false)\n\t\t\t\t\t{\n\t\t\t\t\t\t$('#redactor-image-caption').val('').hide().prev().hide();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tvar $parent = $image.closest(this.opts.imageTag, this.$editor[0]);\n\t\t\t\t\t\tvar $ficaption = $parent.find('figcaption');\n\t\t\t\t\t\tif ($ficaption !== 0)\n\t\t\t\t\t\t{\n\n\t\t\t\t\t\t\t$('#redactor-image-caption').val($ficaption.text()).show();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!this.opts.imagePosition)\n\t\t\t\t\t{\n    \t\t\t\t\t$('.redactor-image-position-option').hide();\n    \t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n    \t\t\t\t\tvar isCentered = ($figure.length !== 0) ? ($container.css('text-align') === 'center') : ($container.css('display') == 'block' && $container.css('float') == 'none');\n\t\t\t\t\t\tvar floatValue = (isCentered) ? 'center' : $container.css('float');\n\t\t\t\t\t\t$('#redactor-image-align').val(floatValue);\n\t\t\t\t\t}\n\n\t\t\t\t\t$('#redactor-image-preview').html($('<img src=\"' + $image.attr('src') + '\" style=\"max-width: 100%;\">'));\n\t\t\t\t\t$('#redactor-image-title').val($image.attr('alt'));\n\n\t\t\t\t\tif ($link.length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\t$('#redactor-image-link').val($link.attr('href'));\n\t\t\t\t\t\tif ($link.attr('target') === '_blank')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$('#redactor-image-link-blank').prop('checked', true);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// hide link's tooltip\n\t\t\t\t\t$('.redactor-link-tooltip').remove();\n\n\t\t\t\t\tthis.modal.show();\n\n\t\t\t\t\t// focus\n\t\t\t\t\tif (this.detect.isDesktop())\n\t\t\t\t\t{\n\t\t\t\t\t\t$('#redactor-image-title').focus();\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\tupdate: function()\n\t\t\t\t{\n\t\t\t\t\tvar $image = this.observe.image;\n\t\t\t\t\tvar $link = $image.closest('a', this.core.editor()[0]);\n\n\t\t\t\t\tvar title = $('#redactor-image-title').val().replace(/(<([^>]+)>)/ig,\"\");\n\t\t\t\t\t$image.attr('alt', title).attr('title', title);\n\n                    this.image.setFloating($image);\n\n\t\t\t\t\t// as link\n\t\t\t\t\tvar link = $.trim($('#redactor-image-link').val()).replace(/(<([^>]+)>)/ig,\"\");\n\t\t\t\t\tif (link !== '')\n\t\t\t\t\t{\n\t\t\t\t\t\t// test url (add protocol)\n\t\t\t\t\t\tvar pattern = '((xn--)?[a-z0-9]+(-[a-z0-9]+)*\\\\.)+[a-z]{2,}';\n\t\t\t\t\t\tvar re = new RegExp('^(http|ftp|https)://' + pattern, 'i');\n\t\t\t\t\t\tvar re2 = new RegExp('^' + pattern, 'i');\n\n\t\t\t\t\t\tif (link.search(re) === -1 && link.search(re2) === 0 && this.opts.linkProtocol)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlink = this.opts.linkProtocol + '://' + link;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar target = ($('#redactor-image-link-blank').prop('checked')) ? true : false;\n\n\t\t\t\t\t\tif ($link.length === 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar a = $('<a href=\"' + link + '\" id=\"redactor-img-tmp\">' + this.utils.getOuterHtml($image) + '</a>');\n\t\t\t\t\t\t\tif (target)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ta.attr('target', '_blank');\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t$image = $image.replaceWith(a);\n\t\t\t\t\t\t\t$link = this.core.editor().find('#redactor-img-tmp');\n\t\t\t\t\t\t\t$link.removeAttr('id');\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$link.attr('href', link);\n\t\t\t\t\t\t\tif (target)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$link.attr('target', '_blank');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$link.removeAttr('target');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if ($link.length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\t$link.replaceWith(this.utils.getOuterHtml($image));\n\t\t\t\t\t}\n\n                    this.image.addCaption($image, $link);\n\t\t\t\t\tthis.modal.close();\n\n\t\t\t\t\t// buffer\n\t\t\t\t\tthis.buffer.set();\n\n\t\t\t\t},\n\t\t\t\tsetFloating: function($image)\n\t\t\t\t{\n    \t\t\t\tvar $figure = $image.closest('figure', this.$editor[0]);\n    \t\t\t\tvar $container = ($figure.length !== 0) ? $figure : $image;\n\t\t\t\t\tvar floating = $('#redactor-image-align').val();\n\n\t\t\t\t\tvar imageFloat = '';\n\t\t\t\t\tvar imageDisplay = '';\n\t\t\t\t\tvar imageMargin = '';\n\t\t\t\t\tvar textAlign = '';\n\n\t\t\t\t\tswitch (floating)\n\t\t\t\t\t{\n\t\t\t\t\t\tcase 'left':\n\t\t\t\t\t\t\timageFloat = 'left';\n\t\t\t\t\t\t\timageMargin = '0 ' + this.opts.imageFloatMargin + ' ' + this.opts.imageFloatMargin + ' 0';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'right':\n\t\t\t\t\t\t\timageFloat = 'right';\n\t\t\t\t\t\t\timageMargin = '0 0 ' + this.opts.imageFloatMargin + ' ' + this.opts.imageFloatMargin;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'center':\n\n                            if ($figure.length !== 0)\n                            {\n                                textAlign = 'center';\n                            }\n                            else\n                            {\n\t    \t\t\t\t\t\timageDisplay = 'block';\n    \t\t\t\t\t\t\timageMargin = 'auto';\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\t$container.css({ 'float': imageFloat, 'display': imageDisplay, 'margin': imageMargin, 'text-align': textAlign });\n\t\t\t\t\t$container.attr('rel', $image.attr('style'));\n\t\t\t\t},\n\t\t\t\taddCaption: function($image, $link)\n\t\t\t\t{\n                    var caption = $('#redactor-image-caption').val();\n\n                    var $target = ($link.length !== 0) ? $link : $image;\n\t\t\t\t\tvar $figcaption = $target.next();\n\n\t\t\t\t\tif ($figcaption.length === 0 || $figcaption[0].tagName !== 'FIGCAPTION')\n\t\t\t\t\t{\n\t\t\t\t\t\t$figcaption = false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (caption !== '')\n\t\t\t\t\t{\n\t\t\t\t\t\tif ($figcaption === false)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$figcaption = $('<figcaption />').text(caption);\n\t\t\t\t\t\t\t$target.after($figcaption);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$figcaption.text(caption);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if ($figcaption !== false)\n\t\t\t\t\t{\n\t\t\t\t\t\t$figcaption.remove();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tremove: function(e, $image, index)\n\t\t\t\t{\n\t\t\t\t\t$image = (typeof $image === 'undefined') ? $(this.observe.image) : $image;\n\n\t\t\t\t\t// delete from modal\n\t\t\t\t\tif (typeof e !== 'boolean')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buffer.set();\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.events.stopDetectChanges();\n\n\t\t\t\t\tvar $link = $image.closest('a', this.core.editor()[0]);\n\t\t\t\t\tvar $figure = $image.closest(this.opts.imageTag, this.core.editor()[0]);\n\t\t\t\t\tvar $parent = $image.parent();\n\n\t\t\t\t\t// callback\n                    var imageDeleteStop = this.core.callback('imageDelete', e, $image[0]);\n\t\t\t\t\tif (imageDeleteStop === false)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (e) e.preventDefault();\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ($('#redactor-image-box').length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\t$parent = $('#redactor-image-box').parent();\n\t\t\t\t\t}\n\n\t\t\t\t\tvar $next, $prev;\n\t\t\t\t\tif ($figure.length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\t$prev = $figure.prev();\n\t\t\t\t\t\t$next = $figure.next();\n\t\t\t\t\t\t$figure.remove();\n\t\t\t\t\t}\n\t\t\t\t\telse if ($link.length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\t$parent = $link.parent();\n\t\t\t\t\t\t$link.remove();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\t$image.remove();\n\t\t\t\t\t}\n\n\t\t\t\t\t$('#redactor-image-box').remove();\n\n\t\t\t\t\tif (e !== false)\n\t\t\t\t\t{\n\t\t\t\t\t\tif ($next && $next.length !== 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.caret.start($next);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if ($prev && $prev.length !== 0)\n\t\t\t\t\t\t{\n                            this.caret.end($prev);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (typeof e !== 'boolean')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.modal.close();\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.utils.restoreScroll();\n\t\t\t\t\tthis.observe.image = false;\n\t\t\t\t\tthis.events.startDetectChanges();\n\t\t\t\t\tthis.placeholder.enable();\n\t\t\t\t\tthis.code.sync();\n\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =indent\n\t\tindent: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tincrease: function()\n\t\t\t\t{\n\t\t\t\t\tif (!this.list.get())\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar $current = $(this.selection.current()).closest('li');\n\t\t\t\t\tvar $list = $current.closest('ul, ol', this.core.editor()[0]);\n\n\t\t\t\t\tvar $li = $current.closest('li');\n\t\t\t\t\tvar $prev = $li.prev();\n\t\t\t\t\tif ($prev.length === 0 || $prev[0].tagName !== 'LI')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.buffer.set();\n\n\n\t\t\t\t\tif (this.utils.isCollapsed())\n\t\t\t\t\t{\n\t\t\t\t\t\tvar listTag = $list[0].tagName;\n\t\t\t\t\t\tvar $newList = $('<' + listTag + ' />');\n\n\t\t\t\t\t\tthis.selection.save();\n\n                        var $ol = $prev.find('ol').first();\n                        if ($ol.length === 1)\n                        {\n                            $ol.append($current);\n                        }\n                        else\n                        {\n                            var listTag = $list[0].tagName;\n                            var $newList = $('<' + listTag + ' />');\n                            $newList.append($current);\n                            $prev.append($newList);\n                        }\n\n\t\t\t\t\t\tthis.selection.restore();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tdocument.execCommand('indent');\n\n\t\t\t\t\t\t// normalize\n\t\t\t\t\t\tthis.selection.save();\n\t\t\t\t\t\tthis.indent.removeEmpty();\n\t\t\t\t\t\tthis.indent.normalize();\n\t\t\t\t\t\tthis.selection.restore();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tdecrease: function()\n\t\t\t\t{\n\t\t\t\t\tif (!this.list.get())\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar $current = $(this.selection.current()).closest('li');\n\t\t\t\t\tvar $list = $current.closest('ul, ol', this.core.editor()[0]);\n\n\t\t\t\t\tthis.buffer.set();\n\n\t\t\t\t\tdocument.execCommand('outdent');\n\n\t\t\t\t\tvar $item = $(this.selection.current()).closest('li', this.core.editor()[0]);\n\n\t\t\t\t\tif (this.utils.isCollapsed())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.indent.repositionItem($item);\n\t\t\t\t\t}\n\n\t\t\t\t\tif ($item.length === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tdocument.execCommand('formatblock', false, 'p');\n\t\t\t\t\t\t$item = $(this.selection.current());\n\t\t\t\t\t\tvar $next = $item.next();\n\t\t\t\t\t\tif ($next.length !== 0 && $next[0].tagName === 'BR')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$next.remove();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// normalize\n\t\t\t\t\tthis.selection.save();\n\t\t\t\t\tthis.indent.removeEmpty();\n\t\t\t\t\tthis.indent.normalize();\n\t\t\t\t\tthis.selection.restore();\n\n\t\t\t\t},\n\t\t\t\trepositionItem: function($item)\n\t\t\t\t{\n    \t\t\t\tvar $next = $item.next();\n    \t\t\t\tif ($next.length !== 0 && ($next[0].tagName !== 'UL' || $next[0].tagName !== 'OL'))\n    \t\t\t\t{\n        \t\t\t\t$item.append($next);\n    \t\t\t\t}\n\n\t\t\t\t\tvar $prev = $item.prev();\n\t\t\t\t\tif ($prev.length !== 0 && $prev[0].tagName !== 'LI')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.selection.save();\n\t\t\t\t\t\tvar $li = $item.parents('li', this.core.editor()[0]);\n\t\t\t\t\t\t$li.after($item);\n\t\t\t\t\t\tthis.selection.restore();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tnormalize: function()\n\t\t\t\t{\n\t\t\t\t\tthis.core.editor().find('li').each($.proxy(function(i,s)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar $el = $(s);\n\n\t\t\t\t\t\t// remove style\n                        var filter = '';\n                        if (this.opts.keepStyleAttr.length !== 0)\n                        {\n                            filter = ',' + this.opts.keepStyleAttr.join(',');\n                        }\n\n\t\t\t\t\t\t$el.find(this.opts.inlineTags.join(',')).not('img' + filter).removeAttr('style');\n\n\t\t\t\t\t\tvar $parent = $el.parent();\n\t\t\t\t\t\tif ($parent.length !== 0 && $parent[0].tagName === 'LI')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$parent.after($el);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar $next = $el.next();\n\t\t\t\t\t\tif ($next.length !== 0 && ($next[0].tagName === 'UL' || $next[0].tagName === 'OL'))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$el.append($next);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t},\n\t\t\t\tremoveEmpty: function($list)\n\t\t\t\t{\n\t\t\t\t\tvar $lists = this.core.editor().find('ul, ol');\n\t\t\t\t\tvar $items = this.core.editor().find('li');\n\n\t\t\t\t\t$items.each($.proxy(function(i, s)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.indent.removeItemEmpty(s);\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t\t$lists.each($.proxy(function(i, s)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.indent.removeItemEmpty(s);\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t\t$items.each($.proxy(function(i, s)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.indent.removeItemEmpty(s);\n\n\t\t\t\t\t}, this));\n\t\t\t\t},\n\t\t\t\tremoveItemEmpty: function(s)\n\t\t\t\t{\n\t\t\t\t\tvar html = s.innerHTML.replace(/[\\t\\s\\n]/g, '');\n\t\t\t\t\thtml = html.replace(/<span><\\/span>/g, '');\n\n\t\t\t\t\tif (html === '')\n\t\t\t\t\t{\n\t\t\t\t\t\t$(s).remove();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =inline\n\t\tinline: function()\n\t\t{\n\t\t\treturn {\n                format: function(tag, attr, value, type)\n\t\t\t\t{\n    \t\t\t\t// Stop formatting pre/code\n\t\t\t\t\tif (this.utils.isCurrentOrParent(['PRE', 'CODE'])) return;\n\n\t\t\t\t\t// Get params\n\t\t\t\t\tvar params = this.inline.getParams(attr, value, type);\n\n                    // Arrange tag\n                    tag = this.inline.arrangeTag(tag);\n\n                    this.placeholder.hide();\n\t\t\t\t\tthis.buffer.set();\n\n\t\t\t\t\t(this.utils.isCollapsed()) ? this.inline.formatCollapsed(tag, params) : this.inline.formatUncollapsed(tag, params);\n\t\t\t\t},\n\t\t\t\tformatCollapsed: function(tag, params)\n\t\t\t\t{\n    \t\t\t\tvar newInline;\n    \t\t\t\tvar inline = this.selection.inline();\n\n    \t\t\t\tif (inline)\n\t\t\t\t\t{\n                        var currentTag = inline.tagName.toLowerCase();\n                        if (currentTag === tag)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t// empty = remove\n\t\t\t\t\t\t\tif (this.utils.isEmpty(inline.innerHTML))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.caret.after(inline);\n\t\t\t\t\t\t\t\t$(inline).remove();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t// not empty = break\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tvar $first = this.inline.insertBreakpoint(inline, currentTag);\n\t\t\t\t\t\t\t\tthis.caret.after($first);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n                        else if ($(inline).closest(tag).length === 0)\n                        {\n\t\t\t\t\t\t\tnewInline = this.inline.insertInline(tag);\n\t\t\t\t\t\t\tnewInline = this.inline.setParams(newInline, params);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n    \t\t\t\t\t\tvar $first = this.inline.insertBreakpoint(inline, currentTag);\n                            this.caret.after($first);\n\t\t\t\t\t\t}\n    \t\t\t\t}\n    \t\t\t\telse\n    \t\t\t\t{\n                        newInline = this.inline.insertInline(tag);\n                        newInline = this.inline.setParams(newInline, params);\n    \t\t\t\t}\n\t\t\t\t},\n\t\t\t\tformatUncollapsed: function(tag, params)\n\t\t\t\t{\n    \t\t\t\tthis.selection.save();\n\n                    var nodes = this.inline.getClearedNodes();\n                    this.inline.setNodesStriked(nodes, tag, params);\n\n                    this.selection.restore();\n\n                    document.execCommand('strikethrough');\n\n                    this.selection.saveInstant();\n\n                    var self = this;\n                    this.core.editor().find('strike').each(function()\n    \t\t\t\t{\n                        var $el = self.utils.replaceToTag(this, tag);\n        \t\t\t\tself.inline.setParams($el[0], params);\n\n        \t\t\t\tvar $inside = $el.find(tag);\n        \t\t\t\tvar $parent = $el.parent();\n        \t\t\t\tvar $parentAround = $parent.parent();\n\n                        // revert formatting (safari bug)\n                        if ($parentAround.length !== 0 && $parentAround[0].tagName.toLowerCase() === tag && $parentAround.html() == $parent[0].outerHTML)\n                        {\n                            $el.replaceWith(function() { return $(this).contents(); });\n                            $parentAround.replaceWith(function() { return $(this).contents(); });\n\n                            return;\n                        }\n\n        \t\t\t\t// remove inside\n        \t\t\t\tif ($inside.length !== 0) self.inline.cleanInsideOrParent($inside, params);\n\n                        // same parent\n                        if ($parent.html() == $el[0].outerHTML) self.inline.cleanInsideOrParent($parent, params);\n\n                        // bugfix: remove empty inline tags after selection\n                        if (self.detect.isFirefox())\n                        {\n                            self.core.editor().find(tag + ':empty').remove();\n                        }\n    \t\t\t\t});\n\n    \t\t\t\tthis.selection.restoreInstant();\n\t\t\t\t},\n\t\t\t\tcleanInsideOrParent: function($el, params)\n\t\t\t\t{\n                    if (params)\n                    {\n                        for (var key in params.data)\n                        {\n        \t\t\t\t    this.inline.removeSpecificAttr($el, key, params.data[key]);\n        \t\t\t\t}\n    \t\t\t\t}\n\t\t\t\t},\n    \t\t\tgetClearedNodes: function()\n    \t\t\t{\n                    var nodes = this.selection.nodes();\n        \t\t\tvar newNodes = [];\n        \t\t\tvar len = nodes.length;\n                    var started = 0;\n\n                    // find array slice\n                    for (var i = 0; i < len; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\tif ($(nodes[i]).hasClass('redactor-selection-marker'))\n\t\t\t\t\t\t{\n    \t\t\t\t\t\tstarted = i + 2;\n    \t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n                    // find selected inline & text nodes\n                    for (var i = 0; i < len; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (i >= started && !this.utils.isBlockTag(nodes[i].tagName))\n\t\t\t\t\t\t{\n                            newNodes.push(nodes[i]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn newNodes;\n    \t\t\t},\n                isConvertableAttr: function(node, name, value)\n                {\n                    var nodeAttrValue = $(node).attr(name);\n                    if (nodeAttrValue)\n                    {\n                        if (name === 'style')\n                        {\n                            value = $.trim(value).replace(/;$/, '')\n\n                            var rules = value.split(';');\n                            var count = 0;\n                            for (var i = 0; i < rules.length; i++)\n                            {\n                                var arr = rules[i].split(':');\n                                var ruleName = $.trim(arr[0]);\n                                var ruleValue = $.trim(arr[1]);\n\n                                if (ruleName.search(/color/) !== -1)\n                                {\n                                    var val = $(node).css(ruleName);\n                                    if (val && (val === ruleValue || this.utils.rgb2hex(val) === ruleValue))\n                                    {\n                                        count++;\n                                    }\n                                }\n                                else if ($(node).css(ruleName) === ruleValue)\n                                {\n                                    count++;\n                                }\n                            }\n\n                            if (count === rules.length)\n                            {\n                                return 1;\n                            }\n                        }\n                        else if (nodeAttrValue === value)\n                        {\n                            return 1;\n                        }\n                    }\n\n                    return 0;\n\n                },\n    \t\t\tisConvertable: function(node, nodeTag, tag, params)\n    \t\t\t{\n                    if (nodeTag === tag)\n                    {\n                        if (params)\n                        {\n                            var count = 0;\n                            for (var key in params.data)\n                            {\n                                count += this.inline.isConvertableAttr(node, key, params.data[key]);\n                            }\n\n                            if (count === Object.keys(params.data).length)\n                            {\n                                return true;\n                            }\n                        }\n                        else\n                        {\n                            return true;\n                        }\n                    }\n\n                    return false;\n    \t\t\t},\n    \t\t\tsetNodesStriked: function(nodes, tag, params)\n    \t\t\t{\n                    for (var i = 0; i < nodes.length; i++)\n\t\t\t\t\t{\n                        var nodeTag = (nodes[i].tagName) ? nodes[i].tagName.toLowerCase() : undefined;\n\n                        var parent = nodes[i].parentNode;\n                        var parentTag = (parent && parent.tagName) ? parent.tagName.toLowerCase() : undefined;\n\n                        var convertable = this.inline.isConvertable(parent, parentTag, tag, params);\n                        if (convertable)\n                        {\n                            var $el = $(parent).replaceWith(function()\n                            {\n                                return $('<strike>').append($(this).contents());\n                            });\n\n                            $el.attr('data-redactor-inline-converted');\n                        }\n\n                        var convertable = this.inline.isConvertable(nodes[i], nodeTag, tag, params);\n                        if (convertable)\n                        {\n                            var $el = $(nodes[i]).replaceWith(function()\n                            {\n                                return $('<strike>').append($(this).contents());\n                            });\n                        }\n    \t\t\t\t}\n    \t\t\t},\n                insertBreakpoint: function(inline, currentTag)\n\t\t\t\t{\n\t\t\t\t\tvar breakpoint = document.createElement('span');\n\t\t\t\t\tbreakpoint.id = 'redactor-inline-breakpoint';\n\t\t\t\t\tbreakpoint = this.insert.node(breakpoint);\n\n\t\t\t\t\tvar end = this.utils.isEndOfElement(inline);\n\t\t\t\t\tvar code = this.utils.getOuterHtml(inline);\n\t\t\t\t\tvar endTag = (end) ? '' : '<' + currentTag + '>';\n\n                    code = code.replace(/<span id=\"redactor-inline-breakpoint\"><\\/span>/i, \"</\" + currentTag + \">\" + endTag);\n\n\t\t\t\t\tvar $code = $(code);\n\t\t\t\t\t$(inline).replaceWith($code);\n\n\t\t\t\t\tif (endTag !== '')\n\t\t\t\t\t{\n    \t\t\t\t\tthis.utils.cloneAttributes(inline, $code.last());\n\t\t\t\t\t}\n\n\t\t\t\t\treturn $code.first();\n\t\t\t\t},\n                insertInline: function(tag)\n\t\t\t\t{\n\t\t\t\t\tvar node = document.createElement(tag);\n\n\t\t\t\t\tthis.insert.node(node);\n\t\t\t\t\tthis.caret.start(node);\n\n\t\t\t\t\treturn node;\n\t\t\t\t},\n\t\t\t\tarrangeTag: function(tag)\n\t\t\t\t{\n                    var tags = ['b', 'bold', 'i', 'italic', 'underline', 'strikethrough', 'deleted', 'superscript', 'subscript'];\n\t\t\t\t\tvar replaced = ['strong', 'strong', 'em', 'em', 'u', 'del', 'del', 'sup', 'sub'];\n\n    \t\t\t\ttag = tag.toLowerCase();\n\n\t\t\t\t\tfor (var i = 0; i < tags.length; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (tag === tags[i])\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttag = replaced[i];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn tag;\n\t\t\t\t},\n\t\t\t\tgetStyleParams: function(params)\n\t\t\t\t{\n                    var result = {};\n    \t\t\t\tvar rules = params.trim().replace(/;$/, '').split(';');\n    \t\t\t\tfor (var i = 0; i < rules.length; i++)\n    \t\t\t\t{\n        \t\t\t\tvar rule = rules[i].split(':');\n        \t\t\t\tif (rule)\n        \t\t\t\t{\n                            result[rule[0].trim()] = rule[1].trim();\n                        }\n    \t\t\t\t}\n\n    \t\t\t\treturn result;\n\t\t\t\t},\n\t\t\t\tgetParams: function(attr, value, type)\n\t\t\t\t{\n \t\t\t\t    var data = false;\n    \t\t\t\tvar func = 'toggle';\n    \t\t\t\tif (typeof attr === 'object')\n    \t\t\t\t{\n        \t\t\t\tdata = attr;\n        \t\t\t\tfunc = (value !== undefined) ? value : func;\n    \t\t\t\t}\n    \t\t\t\telse if (attr !== undefined && value !== undefined)\n    \t\t\t\t{\n        \t\t\t\tdata = {};\n        \t\t\t\tdata[attr] = value;\n        \t\t\t\tfunc = (type !== undefined) ? type : func;\n    \t\t\t\t}\n\n    \t\t\t\treturn (data) ? { 'func': func, 'data': data } : false;\n\t\t\t\t},\n\t\t\t\tsetParams: function(node, params)\n\t\t\t\t{\n                    if (params)\n                    {\n                        for (var key in params.data)\n                        {\n                            var $node = $(node);\n                            if (key === 'style')\n                            {\n                                node = this.inline[params.func + 'Style'](params.data[key], node);\n                                $node.attr('data-redactor-style-cache', $node.attr('style'));\n                            }\n                            else if (key === 'class')\n                            {\n                                node = this.inline[params.func + 'Class'](params.data[key], node);\n                            }\n                            // attr\n                            else\n                            {\n                                node = (params.func === 'remove') ? this.inline[params.func + 'Attr'](key, node) : this.inline[params.func + 'Attr'](key, params.data[key], node);\n                            }\n\n                            if (key === 'style' && node.tagName === 'SPAN')\n                            {\n                                $node.attr('data-redactor-span', true);\n                            }\n                        }\n                    }\n\n                    return node;\n\t\t\t\t},\n\n                // Each\n                eachInline: function(node, callback)\n                {\n                    var lastNode;\n                    var nodes = (node === undefined) ? this.selection.inlines() : [node];\n    \t\t\t\tif (nodes)\n    \t\t\t\t{\n        \t\t\t\tfor (var i = 0; i < nodes.length; i++)\n        \t\t\t\t{\n            \t\t\t\tlastNode = callback(nodes[i])[0];\n        \t\t\t\t}\n    \t\t\t\t}\n\n    \t\t\t\treturn lastNode;\n                },\n\n                // Class\n                replaceClass: function(value, node)\n\t\t\t\t{\n    \t\t\t\treturn this.inline.eachInline(node, function(el)\n    \t\t\t\t{\n                        return $(el).removeAttr('class').addClass(value);\n    \t\t\t\t});\n\t\t\t\t},\n\t\t\t\ttoggleClass: function(value, node)\n\t\t\t\t{\n    \t\t\t\treturn this.inline.eachInline(node, function(el)\n    \t\t\t\t{\n                        return $(el).toggleClass(value);\n    \t\t\t\t});\n\t\t\t\t},\n\t\t\t\taddClass: function(value, node)\n\t\t\t\t{\n    \t\t\t\treturn this.inline.eachInline(node, function(el)\n    \t\t\t\t{\n                        return $(el).addClass(value);\n    \t\t\t\t});\n\t\t\t\t},\n\t\t\t\tremoveClass: function(value, node)\n\t\t\t\t{\n    \t\t\t\treturn this.inline.eachInline(node, function(el)\n    \t\t\t\t{\n                        return $(el).removeClass(value);\n    \t\t\t\t});\n\t\t\t\t},\n\t\t\t\tremoveAllClass: function(node)\n\t\t\t\t{\n    \t\t\t\treturn this.inline.eachInline(node, function(el)\n    \t\t\t\t{\n                        return $(el).removeAttr('class');\n    \t\t\t\t});\n\t\t\t\t},\n\n\t\t\t\t// Attr\n\t\t\t\treplaceAttr: function(name, value, node)\n\t\t\t\t{\n    \t\t\t\treturn this.inline.eachInline(node, function(el)\n    \t\t\t\t{\n                        return $(el).removeAttr(name).attr(name. value);\n    \t\t\t\t});\n\t\t\t\t},\n\t\t\t\ttoggleAttr: function(name, value, node)\n\t\t\t\t{\n    \t\t\t\treturn this.inline.eachInline(node, function(el)\n    \t\t\t\t{\n        \t\t\t\tvar attr = $(el).attr(name);\n\n        \t\t\t\treturn (attr) ? $(el).removeAttr(name) : $(el).attr(name. value);\n    \t\t\t\t});\n\t\t\t\t},\n\t\t\t\taddAttr: function(name, value, node)\n\t\t\t\t{\n    \t\t\t\treturn this.inline.eachInline(node, function(el)\n    \t\t\t\t{\n                        return $(el).attr(name, value);\n    \t\t\t\t});\n\t\t\t\t},\n\t\t\t\tremoveAttr: function(name, node)\n\t\t\t\t{\n    \t\t\t\treturn this.inline.eachInline(node, function(el)\n    \t\t\t\t{\n        \t\t\t\tvar $el = $(el);\n\n                        $el.removeAttr(name);\n                        if (name === 'style')\n                        {\n        \t\t\t\t    $el.removeAttr('data-redactor-style-cache');\n        \t\t\t\t}\n\n                        return $el;\n    \t\t\t\t});\n\t\t\t\t},\n\t\t\t\tremoveAllAttr: function(node)\n\t\t\t\t{\n    \t\t\t\treturn this.inline.eachInline(node, function(el)\n    \t\t\t\t{\n        \t\t\t\tvar $el = $(el);\n                        var len = el.attributes.length;\n\t\t\t\t\t\tfor (var z = 0; z < len; z++)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$el.removeAttr(el.attributes[z].name);\n\t\t\t\t\t\t}\n\n                        return $el;\n    \t\t\t\t});\n\t\t\t\t},\n\t\t\t\tremoveSpecificAttr: function(node, key, value)\n\t\t\t\t{\n    \t\t\t\tvar $el = $(node);\n    \t\t\t\tif (key === 'style')\n    \t\t\t\t{\n        \t\t\t\tvar arr = value.split(':');\n        \t\t\t\tvar name = arr[0].trim();\n                        $el.css(name, '');\n\n                        if (this.utils.removeEmptyAttr(node, 'style'))\n                        {\n                            $el.removeAttr('data-redactor-style-cache');\n                        }\n    \t\t\t\t}\n    \t\t\t\telse\n    \t\t\t\t{\n        \t\t\t\t$el.removeAttr(key)[0];\n    \t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\t// Style\n\t\t\t\thasParentStyle: function($el)\n\t\t\t\t{\n                    var $parent = $el.parent();\n\n                    return ($parent.length === 1 && $parent[0].tagName === $el[0].tagName && $parent.html() === $el[0].outerHTML) ? $parent : false;\n\t\t\t\t},\n\t\t\t\taddParentStyle: function($el)\n\t\t\t\t{\n                    var $parent = this.inline.hasParentStyle($el);\n                    if ($parent)\n                    {\n                        var style = this.inline.getStyleParams($el.attr('style'));\n                        $parent.css(style);\n                        $parent.attr('data-redactor-style-cache', $parent.attr('style'));\n\n                        $el.replaceWith(function()\n                        {\n                            return $(this).contents();\n                        });\n                    }\n                    else\n                    {\n                        $el.attr('data-redactor-style-cache', $el.attr('style'));\n                    }\n\n                    return $el;\n\t\t\t\t},\n\t\t\t\treplaceStyle: function(params, node)\n\t\t\t\t{\n    \t\t\t\tparams = this.inline.getStyleParams(params);\n\n                    var self = this;\n    \t\t\t\treturn this.inline.eachInline(node, function(el)\n    \t\t\t\t{\n        \t\t\t\tvar $el = $(el);\n                        $el.removeAttr('style').css(params);\n\n                        var style = $el.attr('style');\n                        if (style) $el.attr('style', style.replace(/\"/g, '\\''));\n\n                        $el = self.inline.addParentStyle($el);\n\n                        return $el;\n    \t\t\t\t});\n\t\t\t\t},\n\t\t\t\ttoggleStyle: function(params, node)\n\t\t\t\t{\n    \t\t\t\tparams = this.inline.getStyleParams(params);\n\n                    var self = this;\n    \t\t\t\treturn this.inline.eachInline(node, function(el)\n    \t\t\t\t{\n        \t\t\t\tvar $el = $(el);\n\n                        for (var key in params)\n                        {\n                            var newVal = params[key];\n                            var oldVal = $el.css(key);\n\n                            oldVal = (self.utils.isRgb(oldVal)) ? self.utils.rgb2hex(oldVal) : oldVal.replace(/\"/g, '');\n                            newVal = (self.utils.isRgb(newVal)) ? self.utils.rgb2hex(newVal) : newVal.replace(/\"/g, '');\n\n                            if (oldVal === newVal)\n                            {\n                                $el.css(key, '');\n                            }\n                            else\n                            {\n                                $el.css(key, newVal);\n                            }\n                        }\n\n                        var style = $el.attr('style');\n                        if (style) $el.attr('style', style.replace(/\"/g, '\\''));\n\n                        if (!self.utils.removeEmptyAttr(el, 'style'))\n                        {\n                            $el = self.inline.addParentStyle($el);\n                        }\n                        else\n                        {\n                            $el.removeAttr('data-redactor-style-cache');\n                        }\n\n\n                        return $el;\n    \t\t\t\t});\n\t\t\t\t},\n\t\t\t\taddStyle: function(params, node)\n\t\t\t\t{\n                    params = this.inline.getStyleParams(params);\n\n                    var self = this;\n    \t\t\t\treturn this.inline.eachInline(node, function(el)\n    \t\t\t\t{\n                        var $el = $(el);\n\n                        $el.css(params);\n\n                        var style = $el.attr('style');\n                        if (style) $el.attr('style', style.replace(/\"/g, '\\''));\n\n                        $el = self.inline.addParentStyle($el);\n\n                        return $el;\n    \t\t\t\t});\n\t\t\t\t},\n\t\t\t\tremoveStyle: function(params, node)\n\t\t\t\t{\n    \t\t\t\tparams = this.inline.getStyleParams(params);\n\n                    var self = this;\n    \t\t\t\treturn this.inline.eachInline(node, function(el)\n    \t\t\t\t{\n        \t\t\t\tvar $el = $(el);\n\n                        for (var key in params)\n                        {\n                            $el.css(key, '');\n                        }\n\n                        if (self.utils.removeEmptyAttr(el, 'style'))\n                        {\n                            $el.removeAttr('data-redactor-style-cache');\n                        }\n                        else\n                        {\n                            $el.attr('data-redactor-style-cache', $el.attr('style'));\n                        }\n\n                        return $el;\n    \t\t\t\t});\n\t\t\t\t},\n\t\t\t\tremoveAllStyle: function(node)\n\t\t\t\t{\n    \t\t\t\treturn this.inline.eachInline(node, function(el)\n    \t\t\t\t{\n                        return $(el).removeAttr('style').removeAttr('data-redactor-style-cache');\n    \t\t\t\t});\n\t\t\t\t},\n                removeStyleRule: function(name)\n\t\t\t\t{\n\t\t\t\t\tvar parent = this.selection.parent();\n\t\t\t\t\tvar nodes = this.selection.inlines();\n\n                    this.buffer.set();\n\n\t\t\t\t\tif (parent && parent.tagName === 'SPAN')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.inline.removeStyleRuleAttr($(parent), name);\n\t\t\t\t\t}\n\n                    for (var i = 0; i < nodes.length; i++)\n\t\t\t\t\t{\n    \t\t\t\t\tvar el = nodes[i];\n\t\t\t\t\t\tvar $el = $(el);\n\t\t\t\t\t\tif ($.inArray(el.tagName.toLowerCase(), this.opts.inlineTags) != -1 && !$el.hasClass('redactor-selection-marker'))\n\t\t\t\t\t\t{\n                            this.inline.removeStyleRuleAttr($el, name);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\tremoveStyleRuleAttr: function($el, name)\n\t\t\t\t{\n                    $el.css(name, '');\n\t\t\t\t\tif (this.utils.removeEmptyAttr($el, 'style'))\n\t\t\t\t\t{\n\t\t\t\t\t\t$el.removeAttr('data-redactor-style-cache');\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n    \t\t\t\t\t$el.attr('data-redactor-style-cache', $el.attr('style'));\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\t// Update\n\t\t\t\tupdate: function(tag, attr, value, type)\n\t\t\t\t{\n                    tag = this.inline.arrangeTag(tag);\n\n\t\t\t\t\tvar params = this.inline.getParams(attr, value, type);\n\t\t\t\t\tvar nodes = this.selection.inlines();\n\t\t\t\t\tvar result = [];\n\n                    if (nodes)\n                    {\n                        for (var i = 0; i < nodes.length; i++)\n                        {\n                            var el = nodes[i];\n                            if (tag === '*' || el.tagName.toLowerCase() === tag)\n                            {\n    \t\t\t\t\t\t    result.push(this.inline.setParams(el, params));\n    \t\t\t\t\t\t}\n                        }\n                    }\n\n                    return result;\n\t\t\t\t},\n\n                // All\n\t\t\t\tremoveFormat: function()\n\t\t\t\t{\n    \t\t\t\tthis.selection.save();\n\n    \t\t\t\tvar nodes = this.inline.getClearedNodes();\n    \t\t\t\tfor (var i = 0; i < nodes.length; i++)\n    \t\t\t\t{\n        \t\t\t\tif (nodes[i].nodeType === 1)\n        \t\t\t\t{\n            \t\t\t\t$(nodes[i]).replaceWith(function()\n                            {\n                                return $(this).contents();\n                            });\n        \t\t\t\t}\n    \t\t\t\t}\n\n    \t\t\t\tthis.selection.restore();\n\t\t\t\t}\n\n\t\t\t};\n\t\t},\n\n\t\t// =insert\n\t\tinsert: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tset: function(html)\n\t\t\t\t{\n\t\t\t\t\tthis.placeholder.hide();\n\n\t\t\t\t\tthis.code.set(html);\n\t\t\t\t\tthis.focus.end();\n\n\t\t\t\t\tthis.placeholder.enable();\n\t\t\t\t},\n\t\t\t\thtml: function(html, data)\n\t\t\t\t{\n\t\t\t\t\tthis.placeholder.hide();\n\t\t\t\t\tthis.core.editor().focus();\n\n\t\t\t\t\tvar block = this.selection.block();\n\t\t\t\t\tvar inline = this.selection.inline();\n\n\t\t\t\t\t// clean\n\t\t\t\t\tif (typeof data === 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\tdata = this.clean.getCurrentType(html, true);\n\t\t\t\t\t\thtml = this.clean.onPaste(html, data, true);\n\t\t\t\t\t}\n\n\t\t\t\t\thtml = $.parseHTML(html);\n\n                    // end node\n                    var endNode = $(html).last();\n\n\t\t\t\t\t// delete selected content\n\t\t\t\t\tvar sel = this.selection.get();\n\t\t\t\t\tvar range = this.selection.range(sel);\n\t\t\t\t\trange.deleteContents();\n\n\t\t\t\t\tthis.selection.update(sel, range);\n\n\t\t\t\t\t// insert list in list\n\t\t\t\t\tif (data.lists)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar $list = $(html);\n\t\t\t\t\t\tif ($list.length !== 0 && ($list[0].tagName === 'UL' || $list[0].tagName === 'OL'))\n\t\t\t\t\t\t{\n\n\t\t\t\t\t\t\tthis.insert.appendLists(block, $list);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (data.blocks && block)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.utils.isSelectAll())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.core.editor().html(html);\n\t\t\t\t\t\t\tthis.focus.end();\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar breaked = this.utils.breakBlockTag();\n\t\t\t\t\t\t\tif (breaked === false)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.insert.placeHtml(html);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n    \t\t\t\t\t\t\tvar $last = $(html).children().last();\n\t\t\t\t\t\t\t\t$last.append(this.marker.get());\n\n\t\t\t\t\t\t\t\tif (breaked.type === 'start')\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tbreaked.$block.before(html);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tbreaked.$block.after(html);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tthis.selection.restore();\n\t\t\t\t\t\t\t\tthis.core.editor().find('p').each(function()\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tif ($.trim(this.innerHTML) === '')\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t$(this).remove();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tif (inline)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t// remove same tag inside\n\t\t\t\t\t\t\tvar $div = $(\"<div/>\").html(html);\n\t\t\t\t\t\t\t$div.find(inline.tagName.toLowerCase()).each(function()\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$(this).contents().unwrap();\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\thtml = $div.html();\n\t\t\t\t\t\t\thtml = $.parseHTML(html);\n\n\t\t\t\t\t\t\tendNode = $(html).last();\n\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (this.utils.isSelectAll())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar $node = $(this.opts.emptyHtml);\n\t\t\t\t\t\t\tthis.core.editor().html('').append($node);\n\t\t\t\t\t\t\t$node.html(html);\n\t\t\t\t\t\t\tthis.caret.end($node);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.insert.placeHtml(html);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.utils.disableSelectAll();\n\n\t\t\t\t\tif (data.pre) this.clean.cleanPre();\n\n                    this.caret.end(endNode);\n                    this.linkify.format();\n\t\t\t\t},\n\t\t\t\ttext: function(text)\n\t\t\t\t{\n\t\t\t\t\ttext = text.toString();\n\t\t\t\t\ttext = $.trim(text);\n\n\t\t\t\t\tvar tmp = document.createElement('div');\n\t\t\t\t\ttmp.innerHTML = text;\n\t\t\t\t\ttext = tmp.textContent || tmp.innerText;\n\n\t\t\t\t\tif (typeof text === 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.placeholder.hide();\n\t\t\t\t\tthis.core.editor().focus();\n\n\t\t\t\t\t// blocks\n\t\t\t\t\tvar blocks = this.selection.blocks();\n\n\t\t\t\t\t// nl to spaces\n\t\t\t\t\ttext = text.replace(/\\n/g, ' ');\n\n\t\t\t\t\t// select all\n\t\t\t\t\tif (this.utils.isSelectAll())\n\t\t\t\t\t{\n\t\t\t\t\t\tvar $node = $(this.opts.emptyHtml);\n\t\t\t\t\t\tthis.core.editor().html('').append($node);\n\t\t\t\t\t\t$node.html(text);\n\t\t\t\t\t\tthis.caret.end($node);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\t// insert\n\t\t\t\t\t\tvar sel = this.selection.get();\n\t\t\t\t\t\tvar node = document.createTextNode(text);\n\n\t\t\t\t\t\tif (sel.getRangeAt && sel.rangeCount)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar range = sel.getRangeAt(0);\n\t\t\t\t\t\t\trange.deleteContents();\n\t\t\t\t\t\t\trange.insertNode(node);\n\t\t\t\t\t\t\trange.setStartAfter(node);\n\t\t\t\t\t\t\trange.collapse(true);\n\n\t\t\t\t\t\t\tthis.selection.update(sel, range);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// wrap node if selected two or more block tags\n\t\t\t\t\t\tif (blocks.length > 1)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$(node).wrap('<p>');\n\t\t\t\t\t\t\tthis.caret.after(node);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.utils.disableSelectAll();\n\t\t\t\t\tthis.linkify.format();\n\t\t\t\t\tthis.clean.normalizeCurrentHeading();\n\n\t\t\t\t},\n\t\t\t\traw: function(html)\n\t\t\t\t{\n\t\t\t\t\tthis.placeholder.hide();\n\t\t\t\t\tthis.core.editor().focus();\n\n\t\t\t\t\tvar sel = this.selection.get();\n\n\t\t\t\t\tvar range = this.selection.range(sel);\n\t\t\t\t\trange.deleteContents();\n\n\t\t            var el = document.createElement(\"div\");\n\t\t            el.innerHTML = html;\n\n\t\t            var frag = document.createDocumentFragment(), node, lastNode;\n\t\t            while ((node = el.firstChild))\n\t\t            {\n\t\t                lastNode = frag.appendChild(node);\n\t\t            }\n\n\t\t            range.insertNode(frag);\n\n\t\t\t\t\tif (lastNode)\n\t\t\t\t\t{\n\t\t\t\t\t\trange = range.cloneRange();\n\t\t\t\t\t\trange.setStartAfter(lastNode);\n\t\t\t\t\t\trange.collapse(true);\n\t\t\t\t\t\tsel.removeAllRanges();\n\t\t\t\t\t\tsel.addRange(range);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tnode: function(node, deleteContent)\n\t\t\t\t{\n\t\t\t\t\tthis.placeholder.hide();\n\n\t\t\t\t\tif (typeof this.start !== 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.editor().focus();\n\t\t\t\t\t}\n\n\t\t\t\t\tnode = node[0] || node;\n\n\t\t\t\t\tvar block = this.selection.block();\n\t\t\t\t\tvar gap = this.utils.isBlockTag(node.tagName);\n\t\t\t\t\tvar result = true;\n\n\t\t\t\t\tif (this.utils.isSelectAll())\n\t\t\t\t\t{\n\t\t\t\t\t\tif (gap)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.core.editor().html(node);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.core.editor().html($('<p>').html(node));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.code.sync();\n\t\t\t\t\t}\n\t\t\t\t\telse if (gap && block)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar breaked = this.utils.breakBlockTag();\n\t\t\t\t\t\tif (breaked === false)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.insert.placeNode(node, deleteContent);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (breaked.type === 'start')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tbreaked.$block.before(node);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tbreaked.$block.after(node);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tthis.core.editor().find('p:empty').remove();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tresult = this.insert.placeNode(node, deleteContent);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.utils.disableSelectAll();\n\n\t\t\t\t\tif (result)\n\t\t\t\t\t{\n\t\t\t\t\t    this.caret.end(node);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn node;\n\n\t\t\t\t},\n\t\t\t\tappendLists: function(block, $list)\n\t\t\t\t{\n\t\t\t\t\tvar $block = $(block);\n\t\t\t\t\tvar last;\n\t\t\t\t\tvar isEmpty = this.utils.isEmpty(block.innerHTML);\n\n\t\t\t\t\tif (isEmpty || this.utils.isEndOfElement(block))\n\t\t\t\t\t{\n\t\t\t\t\t\tlast = $block;\n\t\t\t\t\t\t$list.find('li').each(function()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlast.after(this);\n\t\t\t\t\t\t\tlast = $(this);\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tif (isEmpty)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$block.remove();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (this.utils.isStartOfElement(block))\n\t\t\t\t\t{\n\t\t\t\t\t\t$list.find('li').each(function()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$block.before(this);\n\t\t\t\t\t\t\tlast = $(this);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t        var endOfNode = this.selection.extractEndOfNode(block);\n\n\t\t\t\t        $block.after($('<li>').append(endOfNode));\n\t\t\t\t        $block.append($list);\n\t\t\t\t\t\tlast = $list;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.marker.remove();\n\n\t\t\t\t\tif (last)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.caret.end(last);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.linkify.format();\n\t\t\t\t},\n\t\t\t\tplaceHtml: function(html)\n\t\t\t\t{\n\t\t\t\t\tvar marker = document.createElement('span');\n\t\t\t\t\tmarker.id = 'redactor-insert-marker';\n\t\t\t\t\tmarker = this.insert.node(marker);\n\n\t\t\t\t\t$(marker).before(html);\n\t\t\t\t\tthis.selection.restore();\n\t\t\t\t\tthis.caret.after(marker);\n\t\t\t\t\t$(marker).remove();\n\t\t\t\t},\n\t\t\t\tplaceNode: function(node, deleteContent)\n\t\t\t\t{\n\t\t\t\t\tvar sel = this.selection.get();\n\t\t\t\t\tvar range = this.selection.range(sel);\n\t\t\t\t\tif (range == null)\n\t\t\t\t\t{\n    \t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (deleteContent !== false)\n\t\t\t\t\t{\n\t\t\t\t\t\trange.deleteContents();\n\t\t\t\t\t}\n\n\t\t\t\t\trange.insertNode(node);\n\t\t\t\t\trange.collapse(false);\n\n\t\t\t\t\tthis.selection.update(sel, range);\n\t\t\t\t},\n\t\t\t\tnodeToPoint: function(e, node)\n\t\t\t\t{\n\t\t\t\t\tthis.placeholder.hide();\n\n\t\t\t\t\tnode = node[0] || node;\n\n\t\t\t\t\tif (this.utils.isEmpty())\n\t\t\t\t\t{\n\t\t\t\t\t\tnode = (this.utils.isBlock(node)) ? node : $('<p />').append(node);\n\n\t\t\t\t\t\tthis.core.editor().html(node);\n\n\t\t\t\t\t\treturn node;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar range;\n\t\t\t\t\tvar x = e.clientX, y = e.clientY;\n\t\t\t\t\tif (document.caretPositionFromPoint)\n\t\t\t\t\t{\n\t\t\t\t\t    var pos = document.caretPositionFromPoint(x, y);\n\t\t\t\t\t    var sel = document.getSelection();\n\t\t\t\t\t    range = sel.getRangeAt(0);\n\t\t\t\t\t    range.setStart(pos.offsetNode, pos.offset);\n\t\t\t\t\t    range.collapse(true);\n\t\t\t\t\t    range.insertNode(node);\n\t\t\t\t\t}\n\t\t\t\t\telse if (document.caretRangeFromPoint)\n\t\t\t\t\t{\n\t\t\t\t\t    range = document.caretRangeFromPoint(x, y);\n\t\t\t\t\t    range.insertNode(node);\n\t\t\t\t\t}\n\t\t\t\t\telse if (typeof document.body.createTextRange !== \"undefined\")\n\t\t\t\t\t{\n\t\t\t\t        range = document.body.createTextRange();\n\t\t\t\t        range.moveToPoint(x, y);\n\t\t\t\t        var endRange = range.duplicate();\n\t\t\t\t        endRange.moveToPoint(x, y);\n\t\t\t\t        range.setEndPoint(\"EndToEnd\", endRange);\n\t\t\t\t        range.select();\n\t\t\t\t\t}\n\n\t\t\t\t\treturn node;\n\n\t\t\t\t},\n\n\t\t\t\t// #backward\n\t\t\t\tnodeToCaretPositionFromPoint: function(e, node)\n\t\t\t\t{\n\t\t\t\t\tthis.insert.nodeToPoint(e, node);\n\t\t\t\t},\n\t\t\t\tmarker: function()\n\t\t\t\t{\n\t\t\t\t\tthis.marker.insert();\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =keydown\n\t\tkeydown: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tinit: function(e)\n\t\t\t\t{\n\t\t\t\t\tif (this.rtePaste)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar key = e.which;\n\t\t\t\t\tvar arrow = (key >= 37 && key <= 40);\n\n\t\t\t\t\tthis.keydown.ctrl = e.ctrlKey || e.metaKey;\n\t\t\t\t\tthis.keydown.parent = this.selection.parent();\n\t\t\t\t\tthis.keydown.current = this.selection.current();\n\t\t\t\t\tthis.keydown.block = this.selection.block();\n\n\t\t\t        // detect tags\n\t\t\t\t\tthis.keydown.pre = this.utils.isTag(this.keydown.current, 'pre');\n\t\t\t\t\tthis.keydown.blockquote = this.utils.isTag(this.keydown.current, 'blockquote');\n\t\t\t\t\tthis.keydown.figcaption = this.utils.isTag(this.keydown.current, 'figcaption');\n\t\t\t\t\tthis.keydown.figure = this.utils.isTag(this.keydown.current, 'figure');\n\n\t\t\t\t\t// callback\n\t\t\t\t\tvar keydownStop = this.core.callback('keydown', e);\n\t\t\t\t\tif (keydownStop === false)\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\t// shortcuts setup\n\t\t\t\t\tthis.shortcuts.init(e, key);\n\n\t\t\t\t\t// buffer\n\t\t\t\t\tthis.keydown.checkEvents(arrow, key);\n                    this.keydown.setupBuffer(e, key);\n\n\t\t\t\t\tif (this.utils.isSelectAll() && ( key === this.keyCode.ENTER || key === this.keyCode.BACKSPACE || key === this.keyCode.DELETE))\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\tthis.code.set(this.opts.emptyHtml);\n                        this.events.changeHandler();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.keydown.addArrowsEvent(arrow);\n\t\t\t\t\tthis.keydown.setupSelectAll(e, key);\n\n\t\t\t\t\t// turn off enter key\n\t\t\t\t\tif (!this.opts.enterKey && key === this.keyCode.ENTER)\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\t// remove selected\n\t\t\t\t\t\tvar sel = this.selection.get();\n\t\t\t\t\t\tvar range = this.selection.range(sel);\n\n\t\t\t\t\t\tif (!range.collapsed)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\trange.deleteContents();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// down\n\t\t\t\t\tif (this.opts.enterKey && key === this.keyCode.DOWN)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.keydown.onArrowDown();\n\t\t\t\t\t}\n\n\t\t\t\t\t// up\n\t\t\t\t\tif (this.opts.enterKey && key === this.keyCode.UP)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.keydown.onArrowUp();\n\t\t\t\t\t}\n\n\n\t\t\t\t\t// replace to p before / after the table or into body\n\t\t\t\t\tif ((this.opts.type === 'textarea' || this.opts.type === 'div') && this.keydown.current && this.keydown.current.nodeType === 3 && $(this.keydown.parent).hasClass('redactor-in'))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.keydown.wrapToParagraph();\n\t\t\t\t\t}\n\n\t\t\t\t\t// on Shift+Space or Ctrl+Space\n\t\t\t\t\tif (!this.keyup.lastShiftKey && key === this.keyCode.SPACE && (e.ctrlKey || e.shiftKey))\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\treturn this.keydown.onShiftSpace();\n\t\t\t\t\t}\n\n\t\t\t\t\t// on Shift+Enter or Ctrl+Enter\n\t\t\t\t\tif (key === this.keyCode.ENTER && (e.ctrlKey || e.shiftKey))\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\treturn this.keydown.onShiftEnter(e);\n\t\t\t\t\t}\n\n\t\t\t\t\t// on enter\n\t\t\t\t\tif (key === this.keyCode.ENTER && !e.shiftKey && !e.ctrlKey && !e.metaKey)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn this.keydown.onEnter(e);\n\t\t\t\t\t}\n\n\t\t\t\t\t// tab or cmd + [\n\t\t\t\t\tif (key === this.keyCode.TAB || e.metaKey && key === 221 || e.metaKey && key === 219)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn this.keydown.onTab(e, key);\n\t\t\t\t\t}\n\n                    // firefox bugfix\n\t\t\t\t\tif (this.detect.isFirefox() && key === this.keyCode.BACKSPACE && this.keydown.block && this.keydown.block.tagName === 'P' && this.utils.isStartOfElement(this.keydown.block))\n\t\t\t\t\t{\n    \t\t\t\t\tvar $prev = $(this.keydown.block).prev();\n    \t\t\t\t\tif ($prev.length !== 0)\n    \t\t\t\t\t{\n        \t\t\t\t\te.preventDefault();\n\n        \t\t\t\t\t$prev.append(this.marker.get());\n        \t\t\t\t\t$prev.append($(this.keydown.block).html());\n        \t\t\t\t\t$(this.keydown.block).remove();\n\n                            this.selection.restore();\n\n        \t\t\t\t\treturn;\n    \t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// backspace & delete\n\t\t\t\t\tif (key === this.keyCode.BACKSPACE || key === this.keyCode.DELETE)\n\t\t\t\t\t{\n    \t\t\t\t\tif (this.observe.image && typeof this.observe.image !== 'undefined' && $('#redactor-image-box').length !== 0)\n    \t\t\t\t\t{\n        \t\t\t\t\te.preventDefault();\n\n        \t\t\t\t\tvar $prev = this.observe.image.closest('figure, p').prev()\n        \t\t\t\t\tthis.image.remove(false);\n                            this.observe.image = false;\n\n        \t\t\t\t\tif ($prev && $prev.length !== 0)\n        \t\t\t\t\t{\n            \t\t\t\t\tthis.caret.end($prev);\n        \t\t\t\t\t}\n        \t\t\t\t\telse\n        \t\t\t\t\t{\n            \t\t\t\t\tthis.core.editor().focus();\n        \t\t\t\t\t}\n\n        \t\t\t\t\treturn;\n    \t\t\t\t\t}\n\n\t\t\t\t\t\tthis.keydown.onBackspaceAndDeleteBefore();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (key === this.keyCode.DELETE)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar $next = $(this.keydown.block).next();\n\n\t\t\t\t\t\t// delete figure\n\t\t\t\t\t\tif (this.utils.isEndOfElement(this.keydown.block) && $next.length !== 0 && $next[0].tagName === 'FIGURE')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$next.remove();\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// append list (safari bug)\n\t\t\t\t\t\tvar tagLi = (this.keydown.block && this.keydown.block.tagName === 'LI') ? this.keydown.block : false;\n\t\t\t\t\t\tif (tagLi)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar $list = $(this.keydown.block).parents('ul, ol').last();\n\t\t\t\t\t\t\tvar $nextList = $list.next();\n\n\t\t\t\t\t\t\tif (this.utils.isRedactorParent($list) && this.utils.isEndOfElement($list) && $nextList.length !== 0\n\t\t\t\t\t\t\t\t&& ($nextList[0].tagName === 'UL' || $nextList[0].tagName === 'OL'))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\t\t\t$list.append($nextList.contents());\n\t\t\t\t\t\t\t\t$nextList.remove();\n\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// append pre\n\t\t\t\t\t\tif (this.utils.isEndOfElement(this.keydown.block) && $next.length !== 0 && $next[0].tagName === 'PRE')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$(this.keydown.block).append($next.text());\n\t\t\t\t\t\t\t$next.remove();\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t\t// image delete\n\t\t\t\t\tif (key === this.keyCode.DELETE && $('#redactor-image-box').length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.image.remove();\n\t\t\t\t\t}\n\n\t\t\t\t\t// backspace\n\t\t\t\t\tif (key === this.keyCode.BACKSPACE)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.detect.isFirefox())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.line.removeOnBackspace(e);\n\t\t\t\t\t\t}\n\n                        // combine list after and before if paragraph is empty\n                        if (this.list.combineAfterAndBefore(this.keydown.block))\n                        {\n                            e.preventDefault();\n                            return;\n                        }\n\n\t\t\t\t\t\t// backspace as outdent\n\t\t\t\t\t\tvar block = this.selection.block();\n\t\t\t\t\t\tif (block && block.tagName === 'LI' && this.utils.isCollapsed() && this.utils.isStartOfElement())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.indent.decrease();\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.keydown.removeInvisibleSpace();\n\t\t\t\t\t\tthis.keydown.removeEmptyListInTable(e);\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif (key === this.keyCode.BACKSPACE || key === this.keyCode.DELETE)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.keydown.onBackspaceAndDeleteAfter(e);\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\tonShiftSpace: function()\n\t\t\t\t{\n\t\t\t\t\tthis.buffer.set();\n\t\t\t\t\tthis.insert.raw('&nbsp;');\n\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\t\t\t\tonShiftEnter: function(e)\n\t\t\t\t{\n\t\t\t\t\tthis.buffer.set();\n\n\t\t\t\t\treturn (this.keydown.pre) ? this.keydown.insertNewLine(e) : this.insert.raw('<br>');\n\t\t\t\t},\n\t\t\t\tonBackspaceAndDeleteBefore: function()\n\t\t\t\t{\n\t\t\t\t\tthis.utils.saveScroll();\n\t\t\t\t},\n\t\t\t\tonBackspaceAndDeleteAfter: function(e)\n\t\t\t\t{\n\t\t\t\t\t// remove style tag\n\t\t\t\t\tsetTimeout($.proxy(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.code.syncFire = false;\n\t\t\t\t\t\tthis.keydown.removeEmptyLists();\n\n                        var filter = '';\n                        if (this.opts.keepStyleAttr.length !== 0)\n                        {\n                            filter = ',' + this.opts.keepStyleAttr.join(',');\n                        }\n\n\t\t\t\t\t\tvar $styleTags = this.core.editor().find('*[style]');\n\t\t\t\t\t\t$styleTags.not('img, figure, iframe, #redactor-image-box, #redactor-image-editter, [data-redactor-style-cache], [data-redactor-span]' + filter).removeAttr('style');\n\n\t\t\t\t\t\tthis.keydown.formatEmpty(e);\n\t\t\t\t\t\tthis.code.syncFire = true;\n\n\t\t\t\t\t}, this), 1);\n\t\t\t\t},\n\t\t\t\tonEnter: function(e)\n\t\t\t\t{\n\t\t\t\t\tvar stop = this.core.callback('enter', e);\n\t\t\t\t\tif (stop === false)\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\t// blockquote exit\n\t\t\t\t\tif (this.keydown.blockquote && this.keydown.exitFromBlockquote(e) === true)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\t// pre\n\t\t\t\t\tif (this.keydown.pre)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn this.keydown.insertNewLine(e);\n\t\t\t\t\t}\n\t\t\t\t\t// blockquote & figcaption\n\t\t\t\t\telse if (this.keydown.blockquote || this.keydown.figcaption)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn this.keydown.insertBreakLine(e);\n\t\t\t\t\t}\n\t\t\t\t\t// figure\n\t\t\t\t\telse if (this.keydown.figure)\n\t\t\t\t\t{\n\t\t\t\t\t\tsetTimeout($.proxy(function()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.keydown.replaceToParagraph('FIGURE');\n\n\t\t\t\t\t\t}, this), 1);\n\t\t\t\t\t}\n\t\t\t\t\t// paragraphs\n\t\t\t\t\telse if (this.keydown.block)\n\t\t\t\t\t{\n\t\t\t\t\t\tsetTimeout($.proxy(function()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.keydown.replaceToParagraph('DIV');\n\n\t\t\t\t\t\t}, this), 1);\n\n\t\t\t\t\t\t// empty list exit\n\t\t\t\t\t\tif (this.keydown.block.tagName === 'LI')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar current = this.selection.current();\n\t\t\t\t\t\t\tvar $parent = $(current).closest('li', this.$editor[0]);\n\t\t\t\t\t\t\tvar $list = $parent.parents('ul,ol', this.$editor[0]).last();\n\n\t\t\t\t\t\t\tif ($parent.length !== 0 && this.utils.isEmpty($parent.html()) && $list.next().length === 0 && this.utils.isEmpty($list.find(\"li\").last().html()))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$list.find(\"li\").last().remove();\n\n\t\t\t\t\t\t\t\tvar node = $(this.opts.emptyHtml);\n\t\t\t\t\t\t\t\t$list.after(node);\n\t\t\t\t\t\t\t\tthis.caret.start(node);\n\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\t\t\t\t\t// outside\n\t\t\t\t\telse if (!this.keydown.block)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn this.keydown.insertParagraph(e);\n\t\t\t\t\t}\n\n                    // firefox enter into inline element\n\t\t\t\t\tif (this.detect.isFirefox() && this.utils.isInline(this.keydown.parent))\n\t\t\t\t\t{\n                        this.keydown.insertBreakLine(e);\n                        return;\n                    }\n\n\t\t\t\t\t// remove inline tags in new-empty paragraph\n                    if (!this.opts.keepInlineOnEnter)\n                    {\n    \t\t\t\t\tsetTimeout($.proxy(function()\n    \t\t\t\t\t{\n    \t\t\t\t\t\tvar inline = this.selection.inline();\n    \t\t\t\t\t\tif (inline && this.utils.isEmpty(inline.innerHTML))\n    \t\t\t\t\t\t{\n    \t\t\t\t\t\t\tvar parent = this.selection.block();\n    \t\t\t\t\t\t\t$(inline).remove();\n    \t\t\t\t\t\t\t//this.caret.start(parent);\n\n                                var range = document.createRange();\n                                range.setStart(parent, 0);\n\n                                var textNode = document.createTextNode('\\u200B');\n\n                                range.insertNode(textNode);\n                                range.setStartAfter(textNode);\n                                range.collapse(true);\n\n                                var sel = window.getSelection();\n                \t\t\t\tsel.removeAllRanges();\n                \t\t\t\tsel.addRange(range);\n    \t\t\t\t\t\t}\n\n\n    \t\t\t\t\t}, this), 1);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tcheckEvents: function(arrow, key)\n\t\t\t\t{\n\t\t\t\t\tif (!arrow && (this.core.getEvent() === 'click' || this.core.getEvent() === 'arrow'))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.addEvent(false);\n\n\t\t\t\t\t\tif (this.keydown.checkKeyEvents(key))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.buffer.set();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tcheckKeyEvents: function(key)\n\t\t\t\t{\n\t\t\t\t\tvar k = this.keyCode;\n\t\t\t\t\tvar keys = [k.BACKSPACE, k.DELETE, k.ENTER, k.ESC, k.TAB, k.CTRL, k.META, k.ALT, k.SHIFT];\n\n\t\t\t\t\treturn ($.inArray(key, keys) === -1) ? true : false;\n\n\t\t\t\t},\n\t\t\t\taddArrowsEvent: function(arrow)\n\t\t\t\t{\n\t\t\t\t\tif (!arrow)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ((this.core.getEvent() === 'click' || this.core.getEvent() === 'arrow'))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.addEvent(false);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t    this.core.addEvent('arrow');\n\t\t\t\t},\n\t\t\t\tsetupBuffer: function(e, key)\n\t\t\t\t{\n\t\t\t\t\tif (this.keydown.ctrl && key === 90 && !e.shiftKey && !e.altKey && this.sBuffer.length) // z key\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tthis.buffer.undo();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t// redo\n\t\t\t\t\telse if (this.keydown.ctrl && key === 90 && e.shiftKey && !e.altKey && this.sRebuffer.length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tthis.buffer.redo();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\telse if (!this.keydown.ctrl)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (key === this.keyCode.SPACE || key === this.keyCode.BACKSPACE || key === this.keyCode.DELETE || (key === this.keyCode.ENTER && !e.ctrlKey && !e.shiftKey))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.buffer.set();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\texitFromBlockquote: function(e)\n\t\t\t\t{\n\t\t\t\t\tif (!this.utils.isEndOfElement(this.keydown.blockquote))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar tmp = this.clean.removeSpacesHard($(this.keydown.blockquote).html());\n\t\t\t\t\tif (tmp.search(/(<br\\s?\\/?>){1}$/i) !== -1)\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\tvar $last = $(this.keydown.blockquote).children().last();\n\n\t\t\t\t\t\t$last.filter('br').remove();\n\t\t\t\t\t\t$(this.keydown.blockquote).children().last().filter('span').remove();\n\n\t\t\t\t\t\tvar node = $(this.opts.emptyHtml);\n\t\t\t\t\t\t$(this.keydown.blockquote).after(node);\n\t\t\t\t\t\tthis.caret.start(node);\n\n\t\t\t\t\t\treturn true;\n\n\t\t\t\t\t}\n\n\t\t\t\t\treturn;\n\t\t\t\t},\n\t\t\t\tonArrowDown: function()\n\t\t\t\t{\n\t\t\t\t\tvar tags = [this.keydown.blockquote, this.keydown.pre, this.keydown.figcaption];\n\n\t\t\t\t\tfor (var i = 0; i < tags.length; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (tags[i])\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.keydown.insertAfterLastElement(tags[i]);\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tonArrowUp: function()\n\t\t\t\t{\n\t\t\t\t\tvar tags = [this.keydown.blockquote, this.keydown.pre, this.keydown.figcaption];\n\n\t\t\t\t\tfor (var i = 0; i < tags.length; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (tags[i])\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.keydown.insertBeforeFirstElement(tags[i]);\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tinsertAfterLastElement: function(element)\n\t\t\t\t{\n\t\t\t\t\tif (!this.utils.isEndOfElement(element))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar last = this.core.editor().contents().last();\n\t\t\t\t\tvar $next = (element.tagName === 'FIGCAPTION') ? $(this.keydown.block).parent().next() : $(this.keydown.block).next();\n\n\t\t\t\t\tif ($next.length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\telse if (last.length === 0 && last[0] !== element)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.caret.start(last);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tvar node = $(this.opts.emptyHtml);\n\n\t\t\t\t\t\tif (element.tagName === 'FIGCAPTION')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t    $(element).parent().after(node);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n    \t\t\t\t\t\t$(element).after(node);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.caret.start(node);\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\tinsertBeforeFirstElement: function(element)\n\t\t\t\t{\n\t\t\t\t\tif (!this.utils.isStartOfElement())\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.core.editor().contents().length > 1 && this.core.editor().contents().first()[0] !== element)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar node = $(this.opts.emptyHtml);\n\t\t\t\t\t$(element).before(node);\n\t\t\t\t\tthis.caret.start(node);\n\n\t\t\t\t},\n\t\t\t\tonTab: function(e, key)\n\t\t\t\t{\n\t\t\t\t\tif (!this.opts.tabKey)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar isList = (this.keydown.block && this.keydown.block.tagName === 'LI')\n\t\t\t\t\tif (this.utils.isEmpty(this.code.get()) || (!isList && !this.keydown.pre && this.opts.tabAsSpaces === false))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tthis.buffer.set();\n\n                    var isListStart = (isList && this.utils.isStartOfElement(this.keydown.block));\n\t\t\t\t\tvar node;\n\n\t\t\t\t\tif (this.keydown.pre && !e.shiftKey)\n\t\t\t\t\t{\n\t\t\t\t\t\tnode = (this.opts.preSpaces) ? document.createTextNode(Array(this.opts.preSpaces + 1).join('\\u00a0')) : document.createTextNode('\\t');\n\t\t\t\t\t\tthis.insert.node(node);\n\t\t\t\t\t}\n\t\t\t\t\telse if (this.opts.tabAsSpaces !== false && !isListStart)\n\t\t\t\t\t{\n\t\t\t\t\t\tnode = document.createTextNode(Array(this.opts.tabAsSpaces + 1).join('\\u00a0'));\n\t\t\t\t\t\tthis.insert.node(node);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tif (e.metaKey && key === 219)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.indent.decrease();\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (e.metaKey && key === 221)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.indent.increase();\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (!e.shiftKey)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.indent.increase();\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.indent.decrease();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\t\t\t\tsetupSelectAll: function(e, key)\n\t\t\t\t{\n\t\t\t\t\tif (this.keydown.ctrl && key === 65)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.utils.enableSelectAll();\n\t\t\t\t\t}\n\t\t\t\t\telse if (key !== this.keyCode.LEFT_WIN && !this.keydown.ctrl)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.utils.disableSelectAll();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tinsertNewLine: function(e)\n\t\t\t\t{\n\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\tvar node = document.createTextNode('\\n');\n\n\t\t\t\t\tvar sel = this.selection.get();\n\t\t\t\t\tvar range = this.selection.range(sel);\n\n\t\t\t\t\trange.deleteContents();\n\t\t\t\t\trange.insertNode(node);\n\n\t\t\t\t\tthis.caret.after(node);\n\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\t\t\t\tinsertParagraph: function(e)\n\t\t\t\t{\n\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\tvar p = document.createElement('p');\n\t\t\t\t\t//p.innerHTML = this.opts.invisibleSpace;\n\t\t\t\t\tp.innerHTML = '<br>';\n\n\t\t\t\t\tvar sel = this.selection.get();\n\t\t\t\t\tvar range = this.selection.range(sel);\n\n\t\t\t\t\trange.deleteContents();\n\t\t\t\t\trange.insertNode(p);\n\n\t\t\t\t\tthis.caret.start(p);\n\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\t\t\t\tinsertBreakLine: function(e)\n\t\t\t\t{\n\t\t\t\t\treturn this.keydown.insertBreakLineProcessing(e);\n\t\t\t\t},\n\t\t\t\tinsertDblBreakLine: function(e)\n\t\t\t\t{\n\t\t\t\t\treturn this.keydown.insertBreakLineProcessing(e, true);\n\t\t\t\t},\n\t\t\t\tinsertBreakLineProcessing: function(e, dbl)\n\t\t\t\t{\n\t\t\t\t\te.stopPropagation();\n\n\t\t\t\t\tvar br1 = document.createElement('br');\n\t\t\t\t\tthis.insert.node(br1);\n\n\t\t\t\t\tif (dbl === true)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar br2 = document.createElement('br');\n\t\t\t\t\t\tthis.insert.node(br2);\n\t\t\t\t\t\tthis.caret.after(br2);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n    \t\t\t\t\tthis.caret.after(br1);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\n\t\t\t\t},\n\t\t\t\twrapToParagraph: function()\n\t\t\t\t{\n\t\t\t\t\tvar $current = $(this.keydown.current);\n\t\t\t\t\tvar\tnode = $('<p>').append($current.clone());\n\t\t\t\t\t$current.replaceWith(node);\n\n\t\t\t\t\tvar next = $(node).next();\n\t\t\t\t\tif (typeof(next[0]) !== 'undefined' && next[0].tagName === 'BR')\n\t\t\t\t\t{\n\t\t\t\t\t\tnext.remove();\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.caret.end(node);\n\n\t\t\t\t},\n\t\t\t\treplaceToParagraph: function(tag)\n\t\t\t\t{\n\t\t\t\t\tvar blockElem = this.selection.block();\n\t\t\t\t\tvar $prev = $(blockElem).prev();\n\n\t\t\t\t\tvar blockHtml = blockElem.innerHTML.replace(/<br\\s?\\/?>/gi, '');\n\t\t\t\t\tif (blockElem.tagName === tag && this.utils.isEmpty(blockHtml) && !$(blockElem).hasClass('redactor-in'))\n\t\t\t\t\t{\n\t\t\t\t\t\tvar p = document.createElement('p');\n\t\t\t\t\t\t$(blockElem).replaceWith(p);\n\n                        this.keydown.setCaretToParagraph(p);\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\telse if (blockElem.tagName === 'P')\n\t\t\t\t\t{\n\t\t\t\t\t\t$(blockElem).removeAttr('class').removeAttr('style');\n\n\t\t\t\t\t\t// fix #227\n\t\t\t\t\t\tif (this.detect.isIe() && this.utils.isEmpty(blockHtml) && this.utils.isInline(this.keydown.parent))\n                        {\n                            $(blockElem).on('input', $.proxy(function()\n                            {\n                                var parent = this.selection.parent();\n                                if (this.utils.isInline(parent))\n                                {\n                                    var html = $(parent).html();\n                                    $(blockElem).html(html);\n                                    this.caret.end(blockElem);\n                                }\n\n                                $(blockElem).off('keyup');\n\n                            }, this));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\telse if ($prev.hasClass(this.opts.videoContainerClass))\n\t\t\t\t\t{\n    \t\t\t\t\t$prev.removeAttr('class');\n\n    \t\t\t\t\tvar p = document.createElement('p');\n\t\t\t\t\t\t$prev.replaceWith(p);\n\n\t\t\t\t\t\tthis.keydown.setCaretToParagraph(p);\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tsetCaretToParagraph: function(p)\n\t\t\t\t{\n                    var range = document.createRange();\n                    range.setStart(p, 0);\n\n                    var textNode = document.createTextNode('\\u200B');\n\n                    range.insertNode(textNode);\n                    range.setStartAfter(textNode);\n                    range.collapse(true);\n\n                    var sel = window.getSelection();\n    \t\t\t\tsel.removeAllRanges();\n    \t\t\t\tsel.addRange(range);\n\t\t\t\t},\n\t\t\t\tremoveInvisibleSpace: function()\n\t\t\t\t{\n\t\t\t\t\tvar $current = $(this.keydown.current);\n\t\t\t\t\tif ($current.text().search(/^\\u200B$/g) === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\t$current.remove();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tremoveEmptyListInTable: function(e)\n\t\t\t\t{\n\t\t\t\t\tvar $current = $(this.keydown.current);\n\t\t\t\t\tvar $parent = $(this.keydown.parent);\n\t\t\t\t\tvar td = $current.closest('td', this.$editor[0]);\n\n\t\t\t\t\tif (td.length !== 0 && $current.closest('li', this.$editor[0]) && $parent.children('li').length === 1)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!this.utils.isEmpty($current.text()))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\t$current.remove();\n\t\t\t\t\t\t$parent.remove();\n\n\t\t\t\t\t\tthis.caret.start(td);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tremoveEmptyLists: function()\n\t\t\t\t{\n\t\t\t\t\tvar removeIt = function()\n\t\t\t\t\t{\n\t\t\t\t\t\tvar html = $.trim(this.innerHTML).replace(/\\/t\\/n/g, '');\n\t\t\t\t\t\tif (html === '')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$(this).remove();\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\t\tthis.core.editor().find('li').each(removeIt);\n\t\t\t\t\tthis.core.editor().find('ul, ol').each(removeIt);\n\t\t\t\t},\n\t\t\t\tformatEmpty: function(e)\n\t\t\t\t{\n\t\t\t\t\tvar html = $.trim(this.core.editor().html());\n\n\t\t\t\t\tif (!this.utils.isEmpty(html))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\tif (this.opts.type === 'inline' || this.opts.type === 'pre')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.editor().html(this.marker.html());\n\t\t\t\t\t\tthis.selection.restore();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.editor().html(this.opts.emptyHtml);\n\t\t\t\t\t\tthis.focus.start();\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =keyup\n\t\tkeyup: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tinit: function(e)\n\t\t\t\t{\n\t\t\t\t\tif (this.rtePaste)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar key = e.which;\n\t\t\t\t\tthis.keyup.block = this.selection.block();\n\t\t\t\t\tthis.keyup.current = this.selection.current();\n\t\t\t\t\tthis.keyup.parent = this.selection.parent();\n\t\t\t\t\tthis.keyup.lastShiftKey = e.shiftKey;\n\n\n\t\t\t\t\t// callback\n\t\t\t\t\tvar stop = this.core.callback('keyup', e);\n\t\t\t\t\tif (stop === false)\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n                    // replace a prev figure to paragraph if caret is before image\n                    if (key === this.keyCode.ENTER)\n                    {\n                        if (this.keyup.block && this.keyup.block.tagName === 'FIGURE')\n                        {\n                            var $prev = $(this.keyup.block).prev();\n                            if ($prev.length !== 0 && $prev[0].tagName === 'FIGURE')\n                            {\n                                var $newTag = this.utils.replaceToTag($prev, 'p');\n                                this.caret.start($newTag);\n                                return;\n                            }\n                        }\n                    }\n\n\t\t\t\t\t// replace figure to paragraph\n\t\t\t\t\tif (key === this.keyCode.BACKSPACE || key === this.keyCode.DELETE)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.utils.isSelectAll())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.focus.start();\n                            this.toolbar.setUnfixed();\n\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// if caret before figure - delete image\n\t\t\t\t\t\tif (this.keyup.block && this.keydown.block && this.keyup.block.tagName === 'FIGURE' && this.utils.isStartOfElement(this.keydown.block))\n\t\t\t\t\t\t{\n    \t\t\t\t\t\te.preventDefault();\n\n                            this.selection.save();\n                            $(this.keyup.block).find('figcaption').remove();\n    \t\t\t\t\t\t$(this.keyup.block).find('img').first().remove();\n    \t\t\t\t\t\tthis.utils.replaceToTag(this.keyup.block, 'p');\n\n    \t\t\t\t\t\tvar $marker = this.marker.find();\n    \t\t\t\t\t\t$('html, body').animate({ scrollTop: $marker.position().top + 20 }, 500);\n\n    \t\t\t\t\t\tthis.selection.restore();\n    \t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\n\t\t\t\t\t\t// if paragraph does contain only image replace to figure\n\t\t\t\t\t\tif (this.keyup.block && this.keyup.block.tagName === 'P')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar isContainImage = $(this.keyup.block).find('img').length;\n\t\t\t\t\t\t\tvar text = $(this.keyup.block).text().replace(/\\u200B/g, '');\n\t\t\t\t\t\t\tif (text === '' && isContainImage !== 0)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.utils.replaceToTag(this.keyup.block, 'figure');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// if figure does not contain image - replace to paragraph\n\t\t\t\t\t\tif (this.keyup.block && this.keyup.block.tagName === 'FIGURE' && $(this.keyup.block).find('img').length === 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.selection.save();\n\t\t\t\t\t\t\tthis.utils.replaceToTag(this.keyup.block, 'p');\n\t\t\t\t\t\t\tthis.selection.restore();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// linkify\n\t\t\t\t\tif (this.linkify.isKey(key))\n\t\t\t\t\t{\n    \t\t\t\t\tthis.selection.save();\n\t\t\t\t\t\tthis.linkify.format();\n    \t\t\t\t\tthis.selection.restore();\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t};\n\t\t},\n\n\t\t// =lang\n\t\tlang: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tload: function()\n\t\t\t\t{\n\t\t\t\t\tthis.opts.curLang = this.opts.langs[this.opts.lang];\n\t\t\t\t},\n\t\t\t\tget: function(name)\n\t\t\t\t{\n\t\t\t\t\treturn (typeof this.opts.curLang[name] !== 'undefined') ? this.opts.curLang[name] : '';\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =line\n\t\tline: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tinsert: function()\n\t\t\t\t{\n\t\t\t\t\tthis.buffer.set();\n\n\t\t\t\t\t// insert\n\t\t\t\t\tthis.insert.html(this.line.getLineHtml());\n\n\t\t\t\t\t// find\n\t\t\t\t\tvar $hr = this.core.editor().find('#redactor-hr-tmp-id');\n\t\t\t\t\t$hr.removeAttr('id');\n\n\t\t\t\t\tthis.core.callback('insertedLine', $hr);\n\n\t\t\t\t\treturn $hr;\n\t\t\t\t},\n\t\t\t\tgetLineHtml: function()\n\t\t\t\t{\n\t\t\t\t\tvar html = '<hr id=\"redactor-hr-tmp-id\" />';\n\t\t\t\t\tif (!this.detect.isFirefox() && this.utils.isEmpty())\n\t\t\t\t\t{\n\t\t\t\t\t\thtml += '<p>' + this.opts.emptyHtml + '</p>';\n\t\t\t\t\t}\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\t// ff only\n\t\t\t\tremoveOnBackspace: function(e)\n\t\t\t\t{\n\t\t\t\t\tif (!this.utils.isCollapsed())\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar $block = $(this.selection.block());\n\t\t\t\t\tif ($block.length === 0 || !this.utils.isStartOfElement($block))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// if hr is previous element\n\t\t\t\t\tvar $prev = $block.prev();\n\t\t\t\t\tif ($prev && $prev.length !== 0 && $prev[0].tagName === 'HR')\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t$prev.remove();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =link\n\t\tlink: function()\n\t\t{\n\t\t\treturn {\n\n\t\t\t\t// public\n\t\t\t\tget: function()\n\t\t\t\t{\n\t\t\t\t\treturn $(this.selection.inlines('a'));\n\t\t\t\t},\n\t\t\t\tis: function()\n\t\t\t\t{\n\t\t\t\t\tvar nodes = this.selection.nodes() ;\n\t\t\t\t\tvar $link = $(this.selection.current()).closest('a', this.core.editor()[0]);\n\n\t\t\t\t\treturn ($link.length === 0 || nodes.length > 1) ? false : $link;\n\t\t\t\t},\n\t\t\t\tunlink: function(e)\n\t\t\t\t{\n\t\t\t\t\t// if call from clickable element\n\t\t\t\t\tif (typeof e !== 'undefined' && e.preventDefault)\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t}\n\n\t\t\t\t\t// buffer\n\t\t\t\t\tthis.buffer.set();\n\n\t\t\t\t\tvar links = this.selection.inlines('a');\n\t\t\t\t\tif (links.length === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar $links = this.link.replaceLinksToText(links);\n\n\t\t\t\t\tthis.observe.closeAllTooltip();\n\t\t\t\t\tthis.core.callback('deletedLink', $links);\n\n\t\t\t\t},\n\t\t\t\tinsert: function(link, cleaned)\n\t\t\t\t{\n\t\t\t\t\tvar $el = this.link.is();\n\n\t\t\t\t\tif (cleaned !== true)\n\t\t\t\t\t{\n\t\t\t\t\t\tlink = this.link.buildLinkFromObject($el, link);\n\t\t\t\t\t\tif (link === false)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// buffer\n\t\t\t\t\tthis.buffer.set();\n\n\t\t\t\t\t// callback\n\t\t\t\t\tlink = this.core.callback('beforeInsertingLink', link);\n\n\t\t\t\t\tif ($el === false)\n\t\t\t\t\t{\n\t\t\t\t\t\t// insert\n\t\t\t\t\t\t$el = $('<a />');\n\t\t\t\t\t\t$el = this.link.update($el, link);\n\t\t\t\t\t\t$el = $(this.insert.node($el));\n\n\t\t\t\t\t\tvar $parent = $el.parent();\n\t\t\t\t\t\tif (this.utils.isRedactorParent($parent) === false)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$el.wrap('<p>');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// remove unlink wrapper\n\t\t\t\t\t\tif ($parent.hasClass('redactor-unlink'))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$parent.replaceWith(function(){\n\t\t\t\t\t\t\t\treturn $(this).contents();\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.caret.after($el);\n\t\t\t\t\t\tthis.core.callback('insertedLink', $el);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\t// update\n\t\t\t\t\t\t$el = this.link.update($el, link);\n\t\t\t\t\t\tthis.caret.after($el);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn $el;\n\n\t\t\t\t},\n\t\t\t\tupdate: function($el, link)\n\t\t\t\t{\n\t\t\t\t\t$el.text(link.text);\n\t\t\t\t\t$el.attr('href', link.url);\n\n\t\t\t\t\tthis.link.target($el, link.target);\n\n\t\t\t\t\treturn $el;\n\n\t\t\t\t},\n\t\t\t\ttarget: function($el, target)\n\t\t\t\t{\n\t\t\t\t\treturn (target) ? $el.attr('target', '_blank') : $el.removeAttr('target');\n\t\t\t\t},\n\t\t\t\tshow: function(e)\n\t\t\t\t{\n\t\t\t\t\t// if call from clickable element\n\t\t\t\t\tif (typeof e !== 'undefined' && e.preventDefault)\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t}\n\n\t\t\t\t\t// close tooltip\n\t\t\t\t\tthis.observe.closeAllTooltip();\n\n\t\t\t\t\t// is link\n\t\t\t\t\tvar $el = this.link.is();\n\n\t\t\t\t\t// build modal\n\t\t\t\t\tthis.link.buildModal($el);\n\n\t\t\t\t\t// build link\n\t\t\t\t\tvar link = this.link.buildLinkFromElement($el);\n\n\t\t\t\t\t// if link cut & paste inside editor browser added self host to a link\n\t\t\t\t\tlink.url = this.link.removeSelfHostFromUrl(link.url);\n\n                    // new tab target\n\t\t\t\t\tif (this.opts.linkNewTab && !$el)\n\t\t\t\t\t{\n    \t\t\t\t\tlink.target = true;\n\t\t\t\t\t}\n\n\t\t\t\t\t// set modal values\n\t\t\t\t\tthis.link.setModalValues(link);\n\n\t\t\t\t\t// show modal\n\t\t\t\t\tthis.modal.show();\n\n\t\t\t\t\t// focus\n\t\t\t\t\tif (this.detect.isDesktop())\n\t\t\t\t\t{\n\t\t\t\t\t\t$('#redactor-link-url').focus();\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\t// private\n\t\t\t\tsetModalValues: function(link)\n\t\t\t\t{\n\t\t\t\t\t$('#redactor-link-blank').prop('checked', link.target);\n\t\t\t\t\t$('#redactor-link-url').val(link.url);\n\t\t\t\t\t$('#redactor-link-url-text').val(link.text);\n\t\t\t\t},\n\t\t\t\tbuildModal: function($el)\n\t\t\t\t{\n\t\t\t\t\tthis.modal.load('link', this.lang.get(($el === false) ? 'link-insert' : 'link-edit'), 600);\n\n\t\t\t\t\t// button insert\n\t\t\t\t\tvar $btn = this.modal.getActionButton();\n\t\t\t\t\t$btn.text(this.lang.get(($el === false) ? 'insert' : 'save')).on('click', $.proxy(this.link.callback, this));\n\n\t\t\t\t},\n\t\t\t\tcallback: function()\n\t\t\t\t{\n\t\t\t\t\t// build link\n\t\t\t\t\tvar link = this.link.buildLinkFromModal();\n\t\t\t\t\tif (link === false)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\t// close\n\t\t\t\t\tthis.modal.close();\n\n\t\t\t\t\t// insert or update\n\t\t\t\t\tthis.link.insert(link, true);\n\t\t\t\t},\n\t\t\t\tcleanUrl: function(url)\n\t\t\t\t{\n\t\t\t\t\treturn (typeof url === 'undefined') ? '' : $.trim(url.replace(/[^\\W\\w\\D\\d+&\\'@#/%?=~_|!:,.;\\(\\)]/gi, ''));\n\t\t\t\t},\n\t\t\t\tcleanText: function(text)\n\t\t\t\t{\n\t\t\t\t\treturn (typeof text === 'undefined') ? '' : $.trim(text.replace(/(<([^>]+)>)/gi, ''));\n\t\t\t\t},\n\t\t\t\tgetText: function(link)\n\t\t\t\t{\n\t\t\t\t\treturn (link.text === '' && link.url !== '') ? this.link.truncateUrl(link.url.replace(/<|>/g, '')) : link.text;\n\t\t\t\t},\n\t\t\t\tisUrl: function(url)\n\t\t\t\t{\n    \t\t\t\tvar reUrl = new RegExp('^((https?|ftp):\\\\/\\\\/)?(([a-z\\\\d]([a-z\\\\d-]*[a-z\\\\d])*)\\\\.?)+[a-z]{2,}(\\\\:\\\\d+)?(\\\\/[-a-z\\\\d%_.~+]*)*(\\\\?[;&a-z\\\\d%_.~+=-]*)?(\\\\#[-a-z\\\\d_]*)?$','i');\n\n    \t\t\t\treturn (reUrl.test(url)) ? url : false;\n\t\t\t\t},\n\t\t\t\tisMailto: function(url)\n\t\t\t\t{\n\t\t\t\t\treturn (url.search('@') !== -1 && /(http|ftp|https):\\/\\//i.test(url) === false);\n\t\t\t\t},\n\t\t\t\tisEmpty: function(link)\n\t\t\t\t{\n\t\t\t\t\treturn (link.url === '' || (link.text === '' && link.url === ''));\n\t\t\t\t},\n\t\t\t\ttruncateUrl: function(url)\n\t\t\t\t{\n\t\t\t\t\treturn (url.length > this.opts.linkSize) ? url.substring(0, this.opts.linkSize) + '...' : url;\n\t\t\t\t},\n\t\t\t\tparse: function(link)\n\t\t\t\t{\n\t\t\t\t\t// mailto\n\t\t\t\t\tif (this.link.isMailto(link.url))\n\t\t\t\t\t{\n\t\t\t\t\t\tlink.url = 'mailto:' + link.url.replace('mailto:', '');\n\t\t\t\t\t}\n\t\t\t\t\t// url\n\t\t\t\t\telse if (link.url.search('#') !== 0)\n\t\t\t\t\t{\n    \t\t\t\t\tif (this.opts.linkValidation)\n    \t\t\t\t\t{\n        \t\t\t\t\tlink.url = (this.link.isUrl(link.url)) ? 'http://' + link.url.replace(/(ftp|https?):\\/\\//gi, '') : link.url;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// empty url or text or isn't url\n\t\t\t\t\treturn (this.link.isEmpty(link) || link.url === false) ? false : link;\n\n\t\t\t\t},\n\t\t\t\tbuildLinkFromModal: function()\n\t\t\t\t{\n\t\t\t\t\tvar link = {};\n\n\t\t\t\t\t// url\n\t\t\t\t\tlink.url = this.link.cleanUrl($('#redactor-link-url').val());\n\n\t\t\t\t\t// text\n\t\t\t\t\tlink.text = this.link.cleanText($('#redactor-link-url-text').val());\n\t\t\t\t\tlink.text = this.link.getText(link);\n\n\t\t\t\t\t// target\n\t\t\t\t\tlink.target = ($('#redactor-link-blank').prop('checked')) ? true : false;\n\n\t\t\t\t\t// parse\n\t\t\t\t\treturn this.link.parse(link);\n\n\t\t\t\t},\n\t\t\t\tbuildLinkFromObject: function($el, link)\n\t\t\t\t{\n\t\t\t\t\t// url\n\t\t\t\t\tlink.url = this.link.cleanUrl(link.url);\n\n\t\t\t\t\t// text\n\t\t\t\t\tlink.text = (typeof link.text === 'undefined' && this.selection.is()) ? this.selection.text() : this.link.cleanText(link.text);\n\t\t\t\t\tlink.text = this.link.getText(link);\n\n\t\t\t\t\t// target\n\t\t\t\t\tlink.target = ($el === false) ? link.target : this.link.buildTarget($el);\n\n\t\t\t\t\t// parse\n\t\t\t\t\treturn this.link.parse(link);\n\n\t\t\t\t},\n\t\t\t\tbuildLinkFromElement: function($el)\n\t\t\t\t{\n\t\t\t\t\tvar link = {\n\t\t\t\t\t\turl: '',\n\t\t\t\t\t\ttext: (this.selection.is()) ? this.selection.text() : '',\n\t\t\t\t\t\ttarget: false\n\t\t\t\t\t};\n\n\t\t\t\t\tif ($el !== false)\n\t\t\t\t\t{\n\t\t\t\t\t\tlink.url = $el.attr('href');\n\t\t\t\t\t\tlink.text = $el.text();\n\t\t\t\t\t\tlink.target = this.link.buildTarget($el);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn link;\n\t\t\t\t},\n\t\t\t\tbuildTarget: function($el)\n\t\t\t\t{\n\t\t\t\t\treturn (typeof $el.attr('target') !== 'undefined' && $el.attr('target') === '_blank') ? true : false;\n\t\t\t\t},\n\t\t\t\tremoveSelfHostFromUrl: function(url)\n\t\t\t\t{\n\t\t\t\t\tvar href = self.location.href.replace('#', '').replace(/\\/$/i, '');\n\t\t\t\t\treturn url.replace(/^\\/\\#/, '#').replace(href, '').replace('mailto:', '');\n\t\t\t\t},\n\t\t\t\treplaceLinksToText: function(links)\n\t\t\t\t{\n\t\t\t\t\tvar $first;\n\t\t\t\t\tvar $links = $.each(links, function(i,s)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar $el = $(s);\n\t\t\t\t\t\tvar $unlinked = $('<span class=\"redactor-unlink\" />').append($el.contents());\n\t\t\t\t\t\t$el.replaceWith($unlinked);\n\n\t\t\t\t\t\tif (i === 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$first = $unlinked;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn $el;\n\t\t\t\t\t});\n\n\t\t\t\t\t// set caret after unlinked node\n\t\t\t\t\tif (links.length === 1 && this.selection.isCollapsed())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.caret.after($first);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn $links;\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =linkify\n\t\tlinkify: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tisKey: function(key)\n\t\t\t\t{\n\t\t\t\t\treturn key === this.keyCode.ENTER || key === this.keyCode.SPACE;\n\t\t\t\t},\n\t\t\t\tisLink: function(node)\n\t\t\t\t{\n\t\t\t\t\treturn (node.nodeValue.match(this.opts.regexps.linkyoutube) || node.nodeValue.match(this.opts.regexps.linkvimeo) || node.nodeValue.match(this.opts.regexps.linkimage) || node.nodeValue.match(this.opts.regexps.url));\n\t\t\t\t},\n\t\t\t\tisFiltered: function(i, node)\n\t\t\t\t{\n\t\t\t\t\treturn node.nodeType === 3 && $.trim(node.nodeValue) !== \"\" && !$(node).parent().is(\"pre\") && (this.linkify.isLink(node));\n\t\t\t\t},\n\t\t\t\thandler: function(i, node)\n\t\t\t\t{\n\t\t\t\t\tvar $el = $(node);\n\t\t\t\t\tvar text = $el.text();\n\t\t\t\t\tvar html = text;\n\n\t\t\t\t\tif (html.match(this.opts.regexps.linkyoutube) || html.match(this.opts.regexps.linkvimeo))\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = this.linkify.convertVideoLinks(html);\n\t\t\t\t\t}\n\t\t\t\t\telse if (html.match(this.opts.regexps.linkimage))\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = this.linkify.convertImages(html);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = this.linkify.convertLinks(html);\n\t\t\t\t\t}\n\n\t\t\t\t\t$el.before(text.replace(text, html)).remove();\n\t\t\t\t},\n\t\t\t\tformat: function()\n\t\t\t\t{\n\t\t\t\t\tif (!this.opts.linkify || this.utils.isCurrentOrParent('pre'))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.core.editor().find(\":not(iframe,img,a,pre,code,.redactor-unlink)\").addBack().contents().filter($.proxy(this.linkify.isFiltered, this)).each($.proxy(this.linkify.handler, this));\n\n\t\t\t\t\t// collect\n\t\t\t\t\tvar $el;\n\t\t\t\t\tvar $objects = this.core.editor().find('.redactor-linkify-object').each($.proxy(function(i,s)\n\t\t\t\t\t{\n\t\t\t\t\t\t$el = $(s);\n\t\t\t\t\t\t$el.removeClass('redactor-linkify-object');\n\t\t\t\t\t\tif ($el.attr('class') === '')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$el.removeAttr('class');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (s.tagName === 'A')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.core.callback('insertedLink', $el);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn $el;\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t\t// callback\n\t\t\t\t\tsetTimeout($.proxy(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.code.sync();\n\t\t\t\t\t\tthis.core.callback('linkify', $objects);\n\n\t\t\t\t\t}, this), 100);\n\n\t\t\t\t},\n\t\t\t\tconvertVideoLinks: function(html)\n\t\t\t\t{\n\t\t\t\t\tvar iframeStart = '<div class=\"' + this.opts.videoContainerClass + ' redactor-linkify-object\"><iframe class=\"redactor-linkify-object\" width=\"500\" height=\"281\" src=\"';\n\t\t\t\t\tvar iframeEnd = '\" frameborder=\"0\" allowfullscreen></iframe></div>';\n\n\t\t\t\t\tif (html.match(this.opts.regexps.linkyoutube))\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = html.replace(this.opts.regexps.linkyoutube, iframeStart + '//www.youtube.com/embed/$1' + iframeEnd);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (html.match(this.opts.regexps.linkvimeo))\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = html.replace(this.opts.regexps.linkvimeo, iframeStart + '//player.vimeo.com/video/$2' + iframeEnd);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tconvertImages: function(html)\n\t\t\t\t{\n\t\t\t\t\tvar matches = html.match(this.opts.regexps.linkimage);\n\t\t\t\t\tif (!matches)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn html;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn html.replace(html, '<img src=\"' + matches + '\"  class=\"redactor-linkify-object\" />');\n\t\t\t\t},\n\t\t\t\tconvertLinks: function(html)\n\t\t\t\t{\n\t\t\t\t\tvar matches = html.match(this.opts.regexps.url);\n\t\t\t\t\tif (!matches)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn html;\n\t\t\t\t\t}\n\n\t\t\t\t\tmatches = $.grep(matches, function(v, k) { return $.inArray(v, matches) === k; });\n\n\t\t\t\t\tvar length = matches.length;\n\n\t\t\t\t\tfor (var i = 0; i < length; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar href = matches[i], text = href;\n\t\t\t\t\t\tvar linkProtocol = (href.match(/(https?|ftp):\\/\\//i) !== null) ? '' : 'http://';\n\n\t\t\t\t\t\tif (text.length > this.opts.linkSize)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttext = text.substring(0, this.opts.linkSize) + '...';\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (text.search('%') === -1)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttext = decodeURIComponent(text);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar regexB = \"\\\\b\";\n\n\t\t\t\t\t\tif ($.inArray(href.slice(-1), [\"/\", \"&\", \"=\"]) !== -1)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tregexB = \"\";\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// escaping url\n\t\t\t\t\t\tvar regexp = new RegExp('(' + href.replace(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g, \"\\\\$&\") + regexB + ')', 'g');\n\n\t\t\t\t\t\t// target\n\t\t\t\t\t\tvar target = '';\n\t\t\t\t\t\tif (this.opts.pasteLinkTarget !== false)\n                        {\n    \t\t\t\t\t    target = ' target=\"' + this.opts.pasteLinkTarget + '\"';\n                        }\n\n\t\t\t\t\t\thtml = html.replace(regexp, '<a href=\"' + linkProtocol + $.trim(href) + '\"' + target + ' class=\"redactor-linkify-object\">' + $.trim(text) + '</a>');\n\t\t\t\t\t}\n\n\t\t\t\t\treturn html;\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =list\n\t\tlist: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\ttoggle: function(type)\n\t\t\t\t{\n\t\t\t\t\tif (this.utils.inBlocks(['table', 'td', 'th', 'tr']))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n    \t\t\t\ttype = (type === 'orderedlist') ? 'ol' : type;\n    \t\t\t\ttype = (type === 'unorderedlist') ? 'ul' : type;\n\n    \t\t\t\ttype = type.toLowerCase();\n\n                    this.buffer.set();\n                    this.selection.save();\n\n                    var nodes = this.list._getBlocks();\n                    var block = this.selection.block();\n                    var $list = $(block).parents('ul, ol').last();\n                    if (nodes.length === 0 && $list.length !== 0)\n                    {\n                        nodes = [$list.get(0)];\n                    }\n\n                    nodes = (this.list._isUnformat(type, nodes)) ? this.list._unformat(type, nodes) : this.list._format(type, nodes);\n\n                    this.selection.restore();\n\n                    return nodes;\n\t\t\t\t},\n\t\t\t\tget: function()\n\t\t\t\t{\n\t\t\t\t\tvar current = this.selection.current();\n\t\t\t\t\tvar $list = $(current).closest('ul, ol', this.core.editor()[0]);\n\n\t\t\t\t\treturn ($list.length === 0) ? false : $list;\n\t\t\t\t},\n                combineAfterAndBefore: function(block)\n\t\t\t\t{\n    \t\t\t\tvar $prev = $(block).prev();\n    \t\t\t\tvar $next = $(block).next();\n                    var isEmptyBlock = (block && block.tagName === 'P' && (block.innerHTML === '<br>' || block.innerHTML === ''));\n                    var isBlockWrapped = ($prev.closest('ol, ul', this.core.editor()[0]).length === 1 && $next.closest('ol, ul', this.core.editor()[0]).length === 1);\n\n                    if (isEmptyBlock && isBlockWrapped)\n                    {\n                        $prev.children('li').last().append(this.marker.get());\n                        $prev.append($next.contents());\n                        this.selection.restore();\n\n                        return true;\n                    }\n\n                    return false;\n\n\t\t\t\t},\n    \t\t\t_getBlocks: function()\n    \t\t\t{\n        \t\t\tvar finalBlocks = [];\n        \t\t\tvar blocks = this.selection.blocks();\n        \t\t\tfor (var i = 0; i < blocks.length; i++)\n        \t\t\t{\n            \t\t\tvar $el = $(blocks[i]);\n            \t\t\tvar isFirst = ($el.parent().hasClass('redactor-in'));\n\n            \t\t\tif (isFirst) finalBlocks.push(blocks[i]);\n        \t\t\t}\n\n        \t\t\treturn finalBlocks;\n    \t\t\t},\n                _isUnformat: function(type, nodes)\n                {\n                    var countLists = 0;\n                    for (var i = 0; i < nodes.length; i++)\n                    {\n                        if (nodes[i].nodeType !== 3)\n                        {\n                            var tag = nodes[i].tagName.toLowerCase();\n                            if (tag === type || tag === 'figure')\n                            {\n                                countLists++;\n                            }\n                        }\n                    }\n\n                    return (countLists === nodes.length);\n                },\n                _uniteBlocks: function(nodes, tags)\n                {\n                    var z = 0;\n                    var blocks = { 0: [] };\n                    var lastcell = false;\n                    for (var i = 0; i < nodes.length; i++)\n                    {\n                        var $node = $(nodes[i]);\n                        var $cell = $node.closest('th, td');\n\n                        if ($cell.length !== 0)\n                        {\n                            if ($cell.get(0) !== lastcell)\n                            {\n                                // create block\n                                z++;\n                                blocks[z] = [];\n                            }\n\n                            if (this.list._isUniteBlock(nodes[i], tags))\n                            {\n                                blocks[z].push(nodes[i]);\n                            }\n                        }\n                        else\n                        {\n                            if (this.list._isUniteBlock(nodes[i], tags))\n                            {\n                                blocks[z].push(nodes[i]);\n                            }\n                            else\n                            {\n                                // create block\n                                z++;\n                                blocks[z] = [];\n                            }\n                        }\n\n                        lastcell = $cell.get();\n                    }\n\n                    return blocks;\n                },\n                _isUniteBlock: function(node, tags)\n                {\n                    return (node.nodeType === 3 || tags.indexOf(node.tagName.toLowerCase()) !== -1);\n                },\n                _createList: function(type, blocks, key)\n                {\n                    var last = blocks[blocks.length-1];\n                    var $last = $(last);\n                    var $list = $('<' + type + '>');\n                    $last.after($list);\n\n                    return $list;\n                },\n                _createListItem: function(item)\n                {\n                    var $item = $('<li>');\n                    if (item.nodeType === 3)\n                    {\n                        $item.append(item);\n                    }\n                    else\n                    {\n                        var $el = $(item);\n                        $item.append($el.contents());\n                        $el.remove();\n                    }\n\n                    return $item;\n                },\n                _format: function(type, nodes)\n                {\n                    var tags = ['p', 'div', 'blockquote', 'pre', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'ul', 'ol'];\n                    var blocks = this.list._uniteBlocks(nodes, tags);\n                    var lists = [];\n\n                    for (var key in blocks)\n                    {\n                        var items = blocks[key];\n                        var $list = this.list._createList(type, blocks[key]);\n\n                        for (var i = 0; i < items.length; i++)\n                        {\n                            var $item;\n\n                            // lists\n                            if (items[i].nodeType !== 3 && (items[i].tagName === 'UL' || items[i].tagName === 'OL'))\n                            {\n                                $item = $(items[i]).contents();\n                                $list.append($item);\n                            }\n                            // other blocks or texts\n                            else\n                            {\n                                $item = this.list._createListItem(items[i]);\n                                //this.utils.normalizeTextNodes($item);\n                                $list.append($item);\n                            }\n                        }\n\n                        lists.push($list.get(0));\n                    }\n\n                    return lists;\n                },\n                _unformat: function(type, nodes)\n                {\n\n                    if (nodes.length === 1)\n                    {\n                        // one list\n                        var $list = $(nodes[0]);\n                        var $items = $list.find('li');\n\n                        var selectedItems = this.selection.blocks(['li']);\n                        var block = this.selection.block();\n                        var $li = $(block).closest('li');\n                        if (selectedItems.length === 0 && $li.length !== 0)\n                        {\n                            selectedItems = [$li.get(0)];\n                        }\n\n                        // 1) entire\n                        if (selectedItems.length === $items.length)\n                        {\n                            return this.list._unformatEntire(nodes[0]);\n                        }\n\n                        var pos = this.list._getItemsPosition($items, selectedItems);\n\n                        // 2) top\n                        if (pos === 'Top')\n                        {\n                            return this.list._unformatAtSide('before', selectedItems, $list);\n                        }\n\n                        // 3) bottom\n                        else if (pos === 'Bottom')\n                        {\n                            selectedItems.reverse();\n                            return this.list._unformatAtSide('after', selectedItems, $list);\n                        }\n\n                        // 4) middle\n                        else if (pos === 'Middle')\n                        {\n                            var $last = $(selectedItems[selectedItems.length-1]);\n\n                            var ci = false;\n\n                            var $parent = false;\n                            var $secondList = $('<' + $list.get(0).tagName.toLowerCase() + '>');\n                            $items.each(function(i, node)\n                            {\n                                if (ci)\n                                {\n                                    var $node = $(node);\n                                    var $childList = ($node.children('ul, ol').length !== 0);\n\n                                    if ($node.closest('.redactor-split-item').length === 0 && ($parent === false || $node.closest($parent).length === 0))\n                                    {\n                                        $node.addClass('redactor-split-item');\n                                    }\n\n                                    $parent = $node;\n\n                                }\n\n                                if (node === $last.get(0))\n                                {\n                                    ci = true;\n                                }\n                            });\n\n                            $items.filter('.redactor-split-item').each(function(i, node)\n                            {\n                                var $node = $(node);\n                                $node.removeClass('redactor-split-item');\n                                $secondList.append(node);\n                            });\n\n                            $list.after($secondList);\n\n                            selectedItems.reverse();\n                            for (var i = 0; i < selectedItems.length; i++)\n                            {\n                                var $item = $(selectedItems[i]);\n                                var $container = this.list._createUnformatContainer($item);\n\n                                $list.after($container);\n                                $container.find('ul, ol').remove();\n                                $item.remove();\n                            }\n\n\n                            return;\n                        }\n\n                    }\n                    else\n                    {\n                        // unformat all\n                        for (var i = 0; i < nodes.length; i++)\n                        {\n                            if (nodes[i].nodeType !== 3 && nodes[i].tagName.toLowerCase() === type)\n                            {\n                                this.list._unformatEntire(nodes[i]);\n                            }\n                        }\n                    }\n                },\n                _unformatEntire: function(list)\n                {\n                    var $list = $(list);\n                    var $items = $list.find('li');\n                    $items.each(function(i, node)\n                    {\n                        var $item = $(node);\n                        var $container = this.list._createUnformatContainer($item);\n\n                        $item.remove();\n                        $list.before($container);\n\n                    }.bind(this));\n\n                    $list.remove();\n                },\n                _unformatAtSide: function(type, selectedItems, $list)\n                {\n                    for (var i = 0; i < selectedItems.length; i++)\n                    {\n                        var $item = $(selectedItems[i]);\n                        var $container = this.list._createUnformatContainer($item);\n\n                        $list[type]($container);\n\n                        var $innerLists = $container.find('ul, ol').first();\n                        $item.append($innerLists);\n\n                        $innerLists.each(function(i, node)\n                        {\n                            var $node = $(node);\n                            var $parent = $node.closest('li');\n\n                            if ($parent.get(0) === selectedItems[i])\n                            {\n                                $node.unwrap();\n                                $parent.addClass('r-unwrapped');\n                            }\n\n                        });\n\n                        if (this.utils.isEmpty($item.html())) $item.remove();\n                    }\n\n                    // clear empty\n                    $list.find('.r-unwrapped').each(function(node)\n                    {\n                        var $node = $(node);\n                        if ($node.html().trim() === '') $node.remove();\n                        else $node.removeClass('r-unwrapped');\n                    });\n                },\n                _getItemsPosition: function($items, selectedItems)\n                {\n                    var pos = 'Middle';\n\n                    var sFirst = selectedItems[0];\n                    var sLast = selectedItems[selectedItems.length-1];\n\n                    var first = $items.first().get(0);\n                    var last = $items.last().get(0);\n\n                    if (first === sFirst && last !== sLast)\n                    {\n                        pos = 'Top';\n                    }\n                    else if (first !== sFirst && last === sLast)\n                    {\n                        pos = 'Bottom';\n                    }\n\n                    return pos;\n                },\n                _createUnformatContainer: function($item)\n                {\n                    var $container = $('<p>');\n                    $container.append($item.contents());\n\n                    return $container;\n                }\n\t\t\t};\n\t\t},\n\n\t\t// =marker\n\t\tmarker: function()\n\t\t{\n\t\t\treturn {\n\n\t\t\t\t// public\n\t\t\t\tget: function(num)\n\t\t\t\t{\n\t\t\t\t\tnum = (typeof num === 'undefined') ? 1 : num;\n\n\t\t\t\t\tvar marker = document.createElement('span');\n\n\t\t\t\t\tmarker.id = 'selection-marker-' + num;\n\t\t\t\t\tmarker.className = 'redactor-selection-marker';\n\t\t\t\t\tmarker.innerHTML = this.opts.invisibleSpace;\n\n\t\t\t\t\treturn marker;\n\t\t\t\t},\n\t\t\t\thtml: function(num)\n\t\t\t\t{\n\t\t\t\t\treturn this.utils.getOuterHtml(this.marker.get(num));\n\t\t\t\t},\n\t\t\t\tfind: function(num)\n\t\t\t\t{\n\t\t\t\t\tnum = (typeof num === 'undefined') ? 1 : num;\n\n\t\t\t\t\treturn this.core.editor().find('span#selection-marker-' + num);\n\t\t\t\t},\n\t\t\t\tinsert: function()\n\t\t\t\t{\n\t\t\t\t\tvar sel = this.selection.get();\n\t\t\t\t\tvar range = this.selection.range(sel);\n\n\t\t\t\t\tthis.marker.insertNode(range, this.marker.get(1), true);\n\t\t\t\t\tif (range && range.collapsed === false)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.marker.insertNode(range, this.marker.get(2), false);\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\tremove: function()\n\t\t\t\t{\n\t\t\t\t\tthis.core.editor().find('.redactor-selection-marker').each(this.marker.iterateRemove);\n\t\t\t\t},\n\n\t\t\t\t// private\n\t\t\t\tinsertNode: function(range, node, collapse)\n\t\t\t\t{\n\t\t\t\t\tvar parent = this.selection.parent();\n\t\t\t\t\tif (range === null || $(parent).closest('.redactor-in').length === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\trange = range.cloneRange();\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\trange.collapse(collapse);\n\t\t\t\t\t\trange.insertNode(node);\n\t\t\t\t\t}\n\t\t\t\t\tcatch (e)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.focus.start();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\titerateRemove: function(i, el)\n\t\t\t\t{\n\t\t\t\t\tvar $el = $(el);\n\t\t\t\t\tvar text = $el.text().replace(/\\u200B/g, '');\n\t\t\t\t\tvar parent = $el.parent()[0];\n\n                    if (text === '') $el.remove();\n                    else $el.replaceWith(function() { return $(this).contents(); });\n\n                    // if (parent && parent.normalize) parent.normalize();\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =modal\n\t\tmodal: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tcallbacks: {},\n\t\t\t\ttemplates: function()\n\t\t\t\t{\n\t\t\t\t\tthis.opts.modal = {\n\t\t\t\t\t\t'image-edit': String()\n\t\t\t\t\t\t+ '<div class=\"redactor-modal-tab redactor-group\" data-title=\"General\">'\n\t\t\t\t\t\t\t+ '<div id=\"redactor-image-preview\" class=\"redactor-modal-tab-side\">'\n\t\t\t\t\t\t\t+ '</div>'\n\t\t\t\t\t\t\t+ '<div class=\"redactor-modal-tab-area\">'\n\t\t\t\t\t\t\t\t+ '<section>'\n\t\t\t\t\t\t\t\t\t+ '<label>' + this.lang.get('title') + '</label>'\n\t\t\t\t\t\t\t\t\t+ '<input type=\"text\" id=\"redactor-image-title\" />'\n\t\t\t\t\t\t\t\t+ '</section>'\n\t\t\t\t\t\t\t\t+ '<section>'\n\t\t\t\t\t\t\t\t\t+ '<label>' + this.lang.get('caption') + '</label>'\n\t\t\t\t\t\t\t\t\t+ '<input type=\"text\" id=\"redactor-image-caption\" aria-label=\"' + this.lang.get('caption') + '\" />'\n\t\t\t\t\t\t\t\t+ '</section>'\n\t\t\t\t\t\t\t\t+ '<section>'\n\t\t\t\t\t\t\t\t\t+ '<label>' + this.lang.get('link') + '</label>'\n\t\t\t\t\t\t\t\t\t+ '<input type=\"text\" id=\"redactor-image-link\" aria-label=\"' + this.lang.get('link') + '\" />'\n\t\t\t\t\t\t\t\t+ '</section>'\n\t\t\t\t\t\t\t\t+ '<section>'\n        \t\t\t\t\t\t\t+ '<label class=\"redactor-image-position-option\">' + this.lang.get('image-position') + '</label>'\n        \t\t\t\t\t\t\t+ '<select class=\"redactor-image-position-option\" id=\"redactor-image-align\" aria-label=\"' + this.lang.get('image-position') + '\">'\n        \t\t\t\t\t\t\t\t+ '<option value=\"none\">' + this.lang.get('none') + '</option>'\n        \t\t\t\t\t\t\t\t+ '<option value=\"left\">' + this.lang.get('left') + '</option>'\n        \t\t\t\t\t\t\t\t+ '<option value=\"center\">' + this.lang.get('center') + '</option>'\n        \t\t\t\t\t\t\t\t+ '<option value=\"right\">' + this.lang.get('right') + '</option>'\n        \t\t\t\t\t\t\t+ '</select>'\n\t\t\t\t\t\t\t\t+ '</section>'\n\t\t\t\t\t\t\t\t+ '<section>'\n\t\t\t\t\t\t\t\t\t+ '<label class=\"checkbox\"><input type=\"checkbox\" id=\"redactor-image-link-blank\" aria-label=\"' + this.lang.get('link-in-new-tab') + '\"> ' + this.lang.get('link-in-new-tab') + '</label>'\n\t\t\t\t\t\t\t\t+ '</section>'\n\t\t\t\t\t\t\t\t+ '<section>'\n\t\t\t\t\t\t\t\t\t+ '<button id=\"redactor-modal-button-action\">' + this.lang.get('insert') + '</button>'\n\t\t\t\t\t\t\t\t\t+ '<button id=\"redactor-modal-button-cancel\">' + this.lang.get('cancel') + '</button>'\n\t\t\t\t\t\t\t\t\t+ '<button id=\"redactor-modal-button-delete\" class=\"redactor-modal-button-offset\">' + this.lang.get('delete') + '</button>'\n\t\t\t\t\t\t\t\t+ '</section>'\n\t\t\t\t\t\t\t+ '</div>'\n\t\t\t\t\t\t+ '</div>',\n\n\t\t\t\t\t\t'image': String()\n\t\t\t\t\t\t+ '<div class=\"redactor-modal-tab\" data-title=\"Upload\">'\n\t\t\t\t\t\t\t+ '<section>'\n\t\t\t\t\t\t\t\t+ '<div id=\"redactor-modal-image-droparea\"></div>'\n\t \t\t\t\t\t\t+ '</section>'\n \t\t\t\t\t\t+ '</div>',\n\n\t\t\t\t\t\t'file': String()\n\t\t\t\t\t\t+ '<div class=\"redactor-modal-tab\" data-title=\"Upload\">'\n\t\t\t\t\t\t\t+ '<section>'\n\t\t\t\t\t\t\t\t+ '<label>' + this.lang.get('filename') + ' <span class=\"desc\">(' + this.lang.get('optional') + ')</span></label>'\n\t\t\t\t\t\t\t\t+ '<input type=\"text\" id=\"redactor-filename\" aria-label=\"' + this.lang.get('filename') + '\" /><br><br>'\n\t\t\t\t\t\t\t+ '</section>'\n\t\t\t\t\t\t\t+ '<section>'\n\t\t\t\t\t\t\t\t+ '<div id=\"redactor-modal-file-upload\"></div>'\n\t\t\t\t\t\t\t+ '</section>'\n\t\t\t\t\t\t+ '</div>',\n\n\t\t\t\t\t\t'link': String()\n\t\t\t\t\t\t+ '<div class=\"redactor-modal-tab\" data-title=\"General\">'\n\t\t\t\t\t\t\t+ '<section>'\n\t\t\t\t\t\t\t\t+ '<label>URL</label>'\n\t\t\t\t\t\t\t\t+ '<input type=\"url\" id=\"redactor-link-url\" aria-label=\"URL\" />'\n\t\t\t\t\t\t\t+ '</section>'\n\t\t\t\t\t\t\t+ '<section>'\n\t\t\t\t\t\t\t\t+ '<label>' + this.lang.get('text') + '</label>'\n\t\t\t\t\t\t\t\t+ '<input type=\"text\" id=\"redactor-link-url-text\" aria-label=\"' + this.lang.get('text') + '\" />'\n\t\t\t\t\t\t\t+ '</section>'\n\t\t\t\t\t\t\t+ '<section>'\n\t\t\t\t\t\t\t\t+ '<label class=\"checkbox\"><input type=\"checkbox\" id=\"redactor-link-blank\"> ' + this.lang.get('link-in-new-tab') + '</label>'\n\t\t\t\t\t\t\t+ '</section>'\n\t\t\t\t\t\t\t+ '<section>'\n\t\t\t\t\t\t\t\t+ '<button id=\"redactor-modal-button-action\">' + this.lang.get('insert') + '</button>'\n\t\t\t\t\t\t\t\t+ '<button id=\"redactor-modal-button-cancel\">' + this.lang.get('cancel') + '</button>'\n\t\t\t\t\t\t\t+ '</section>'\n\t\t\t\t\t\t+ '</div>'\n\t\t\t\t\t};\n\n\t\t\t\t\t$.extend(this.opts, this.opts.modal);\n\n\t\t\t\t},\n\t\t\t\taddCallback: function(name, callback)\n\t\t\t\t{\n\t\t\t\t\tthis.modal.callbacks[name] = callback;\n\t\t\t\t},\n\t\t\t\taddTemplate: function(name, template)\n\t\t\t\t{\n\t\t\t\t\tthis.opts.modal[name] = template;\n\t\t\t\t},\n\t\t\t\tgetTemplate: function(name)\n\t\t\t\t{\n\t\t\t\t\treturn this.opts.modal[name];\n\t\t\t\t},\n\t\t\t\tgetModal: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.$modalBody;\n\t\t\t\t},\n\t\t\t\tgetActionButton: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.$modalBody.find('#redactor-modal-button-action');\n\t\t\t\t},\n\t\t\t\tgetCancelButton: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.$modalBody.find('#redactor-modal-button-cancel');\n\t\t\t\t},\n\t\t\t\tgetDeleteButton: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.$modalBody.find('#redactor-modal-button-delete');\n\t\t\t\t},\n\t\t\t\tload: function(templateName, title, width)\n\t\t\t\t{\n\t\t\t\t\tif (typeof this.$modalBox !== 'undefined' && this.$modalBox.hasClass('open'))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.modal.templateName = templateName;\n\t\t\t\t\tthis.modal.width = width;\n\n\t\t\t\t\tthis.modal.build();\n\t\t\t\t\tthis.modal.enableEvents();\n\t\t\t\t\tthis.modal.setTitle(title);\n\t\t\t\t\tthis.modal.setDraggable();\n\t\t\t\t\tthis.modal.setContent();\n\n\t\t\t\t\t// callbacks\n\t\t\t\t\tif (typeof this.modal.callbacks[templateName] !== 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.modal.callbacks[templateName].call(this);\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\tshow: function()\n\t\t\t\t{\n\n\t\t\t\t\tif (!this.detect.isDesktop())\n\t\t\t\t\t{\n\t\t\t\t\t\tdocument.activeElement.blur();\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.selection.save();\n\t\t\t\t\tthis.modal.buildTabber();\n\n\t\t\t\t\tif (this.detect.isMobile())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.modal.width = '96%';\n\t\t\t\t\t}\n\n\t\t\t\t\t// resize\n\t\t\t\t\tsetTimeout($.proxy(this.modal.buildWidth, this), 0);\n\t\t\t\t\t$(window).on('resize.redactor-modal', $.proxy(this.modal.buildWidth, this));\n\n\n\t\t\t\t\tthis.$modalOverlay.redactorAnimation('fadeIn', {\n\t\t\t\t\t\tduration: 0.25\n\t\t\t\t\t});\n\n\t\t\t\t\t/* BEGIN HACK */\n\t\t\t\t\t// make sure that the modal is at the end of the DOM\n\t\t\t\t\tthis.$modalBox.appendTo(document.body);\n\t\t\t\t\t/* END HACK */\n\n\t\t\t\t\tthis.$modalBox.addClass('open').show();\n\t\t\t\t\tthis.$modal.redactorAnimation('fadeIn', {\n\t\t\t\t\t\t\ttiming: 'cubic-bezier(0.175, 0.885, 0.320, 1.105)'\n\t\t\t\t\t\t},\n\t\t\t\t\t\t$.proxy(function()\n\t\t\t\t\t\t{\n\n\t\t\t\t\t\t\tthis.utils.saveScroll();\n\t\t\t\t\t\t\tthis.utils.disableBodyScroll();\n\n\t\t\t\t\t\t\t// modal shown callback\n\t\t\t\t\t\t\tthis.core.callback('modalOpened', this.modal.templateName, this.$modal);\n\n\t\t\t\t\t\t\t// fix bootstrap modal focus\n\t\t\t\t\t\t\t$(document).off('focusin.modal');\n\n\t\t\t\t\t\t\t// enter\n\t\t\t\t\t\t\tvar $elements = this.$modal.find('input[type=text],input[type=url],input[type=email]');\n\t\t\t\t\t\t\t$elements.on('keydown.redactor-modal', $.proxy(this.modal.setEnter, this));\n\n\t\t\t\t\t\t}, this)\n\t\t\t\t\t);\n\n\t\t\t\t},\n\t\t\t\tbuildWidth: function()\n\t\t\t\t{\n\t\t\t\t\tvar windowHeight = $(window).height();\n\t\t\t\t\tvar windowWidth = $(window).width();\n\n\t\t\t\t\tvar number = (typeof this.modal.width === 'number');\n\n\t\t\t\t\tif (!number && this.modal.width.match(/%$/))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$modal.css({ 'width': this.modal.width, 'margin-bottom': '16px' });\n\t\t\t\t\t}\n\t\t\t\t\telse if (parseInt(this.modal.width) > windowWidth)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$modal.css({ 'width': '96%', 'margin-bottom': '2%' });\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tif (number)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.modal.width += 'px';\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.$modal.css({ 'width': this.modal.width, 'margin-bottom': '16px' });\n\t\t\t\t\t}\n\n\t\t\t\t\t// margin top\n\t\t\t\t\tvar height = this.$modal.outerHeight();\n\t\t\t\t\tvar top = (windowHeight/2 - height/2) + 'px';\n\n\t\t\t\t\tif (this.detect.isMobile())\n\t\t\t\t\t{\n\t\t\t\t\t\ttop = '2%';\n\t\t\t\t\t}\n\t\t\t\t\telse if (height > windowHeight)\n\t\t\t\t\t{\n\t\t\t\t\t\ttop = '16px';\n\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.$modal.css('margin-top', top);\n\t\t\t\t},\n\t\t\t\tbuildTabber: function()\n\t\t\t\t{\n\t\t\t\t\tthis.modal.tabs = this.$modal.find('.redactor-modal-tab');\n\n\t\t\t\t\tif (this.modal.tabs.length < 2)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.modal.$tabsBox = $('<div id=\"redactor-modal-tabber\" />');\n\t\t\t\t\t$.each(this.modal.tabs, $.proxy(function(i,s)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar a = $('<a href=\"#\" rel=\"' + i + '\" />').text($(s).attr('data-title'));\n\n\t\t\t\t\t\ta.on('click', $.proxy(this.modal.showTab, this));\n\n\t\t\t\t\t\tif (i === 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ta.addClass('active');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.modal.$tabsBox.append(a);\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t\tthis.$modalBody.prepend(this.modal.$tabsBox);\n\n\t\t\t\t},\n\t\t\t\tshowTab: function(e)\n\t\t\t\t{\n\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\tvar $el = $(e.target);\n\t\t\t\t\tvar index = $el.attr('rel');\n\n\t\t\t\t\tthis.modal.tabs.hide();\n\t\t\t\t\tthis.modal.tabs.eq(index).show();\n\n\t\t\t\t\t$('#redactor-modal-tabber').find('a').removeClass('active');\n\t\t\t\t\t$el.addClass('active');\n\n\t\t\t\t\treturn false;\n\n\t\t\t\t},\n\t\t\t\tsetTitle: function(title)\n\t\t\t\t{\n\t\t\t\t\tthis.$modalHeader.html(title);\n\t\t\t\t},\n\t\t\t\tsetContent: function()\n\t\t\t\t{\n\t\t\t\t\tthis.$modalBody.html(this.modal.getTemplate(this.modal.templateName));\n\n\t\t\t\t\tthis.modal.getCancelButton().on('mousedown', $.proxy(this.modal.close, this));\n\t\t\t\t},\n\t\t\t\tsetDraggable: function()\n\t\t\t\t{\n\t\t\t\t\tif (typeof $.fn.draggable === 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.$modal.draggable({ handle: this.$modalHeader });\n\t\t\t\t\tthis.$modalHeader.css('cursor', 'move');\n\t\t\t\t},\n\t\t\t\tsetEnter: function(e)\n\t\t\t\t{\n\t\t\t\t\tif (e.which !== 13)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tthis.modal.getActionButton().click();\n\t\t\t\t},\n\t\t\t\tbuild: function()\n\t\t\t\t{\n\t\t\t\t\tthis.modal.buildOverlay();\n\n\t\t\t\t\tthis.$modalBox = $('<div id=\"redactor-modal-box\"/>').hide();\n\t\t\t\t\tthis.$modal = $('<div id=\"redactor-modal\" role=\"dialog\" />');\n\t\t\t\t\tthis.$modalHeader = $('<div id=\"redactor-modal-header\" />');\n\t\t\t\t\tthis.$modalClose = $('<button type=\"button\" id=\"redactor-modal-close\" aria-label=\"' + this.lang.get('close') + '\" />').html('&times;');\n\t\t\t\t\tthis.$modalBody = $('<div id=\"redactor-modal-body\" />');\n\n\t\t\t\t\tthis.$modal.append(this.$modalHeader);\n\t\t\t\t\tthis.$modal.append(this.$modalBody);\n\t\t\t\t\tthis.$modal.append(this.$modalClose);\n\t\t\t\t\tthis.$modalBox.append(this.$modal);\n\t\t\t\t\tthis.$modalBox.appendTo(document.body);\n\n\t\t\t\t},\n\t\t\t\tbuildOverlay: function()\n\t\t\t\t{\n\t\t\t\t\tthis.$modalOverlay = $('<div id=\"redactor-modal-overlay\">').hide();\n\t\t\t\t\t$('body').prepend(this.$modalOverlay);\n\t\t\t\t},\n\t\t\t\tenableEvents: function()\n\t\t\t\t{\n\t\t\t\t\tthis.$modalClose.on('mousedown.redactor-modal', $.proxy(this.modal.close, this));\n\t\t\t\t\t$(document).on('keyup.redactor-modal', $.proxy(this.modal.closeHandler, this));\n\t\t\t\t\tthis.core.editor().on('keyup.redactor-modal', $.proxy(this.modal.closeHandler, this));\n\t\t\t\t\tthis.$modalBox.on('click.redactor-modal', $.proxy(this.modal.close, this));\n\t\t\t\t},\n\t\t\t\tdisableEvents: function()\n\t\t\t\t{\n\t\t\t\t\tthis.$modalClose.off('mousedown.redactor-modal');\n\t\t\t\t\t$(document).off('keyup.redactor-modal');\n\t\t\t\t\tthis.core.editor().off('keyup.redactor-modal');\n\t\t\t\t\tthis.$modalBox.off('click§.redactor-modal');\n\t\t\t\t\t$(window).off('resize.redactor-modal');\n\t\t\t\t},\n\t\t\t\tcloseHandler: function(e)\n\t\t\t\t{\n\t\t\t\t\tif (e.which !== this.keyCode.ESC)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.modal.close(false);\n\t\t\t\t},\n\t\t\t\tclose: function(e)\n\t\t\t\t{\n\t\t\t\t\tif (e)\n\t\t\t\t\t{\n\t\t\t\t\t\tif ($(e.target).attr('id') !== 'redactor-modal-button-cancel' && e.target !== this.$modalClose[0] && e.target !== this.$modalBox[0])\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!this.$modalBox)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// restore selection\n\t\t\t\t\tthis.selection.restore();\n\n\t\t\t\t\tthis.modal.disableEvents();\n\t\t\t\t\tthis.utils.enableBodyScroll();\n\t\t\t\t\tthis.utils.restoreScroll();\n\n\t\t\t\t\tthis.$modalOverlay.redactorAnimation('fadeOut', { duration: 0.4 }, $.proxy(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$modalOverlay.remove();\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t\tthis.$modal.redactorAnimation('fadeOut', {\n\n\t\t\t\t\t\tduration: 0.3,\n\t\t\t\t\t\ttiming: 'cubic-bezier(0.175, 0.885, 0.320, 1.175)'\n\n\t\t\t\t\t}, $.proxy(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tif (typeof this.$modalBox !== 'undefined')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.$modalBox.remove();\n\t\t\t\t\t\t\tthis.$modalBox = undefined;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.core.callback('modalClosed', this.modal.templateName);\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =observe\n\t\tobserve: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tload: function()\n\t\t\t\t{\n\t\t\t\t\tif (typeof this.opts.destroyed !== 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.observe.links();\n\t\t\t\t\tthis.observe.images();\n\n\t\t\t\t},\n\t\t\t\tisCurrent: function($el, $current)\n\t\t\t\t{\n\t\t\t\t\tif (typeof $current === 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\t$current = $(this.selection.current());\n\t\t\t\t\t}\n\n\t\t\t\t\treturn $current.is($el) || $current.parents($el).length > 0;\n\t\t\t\t},\n\t\t\t\ttoolbar: function()\n\t\t\t\t{\n    \t\t\t\tthis.observe.buttons();\n\t    \t\t\tthis.observe.dropdowns();\n\t\t\t\t},\n\t\t\t\tbuttons: function(e, btnName)\n\t\t\t\t{\n\t\t\t\t\tvar current = this.selection.current();\n\t\t\t\t\tvar parent = this.selection.parent();\n\n\t\t\t\t\tif (e !== false) this.button.setInactiveAll();\n\t\t\t\t\telse             this.button.setInactiveAll(btnName);\n\n\n\t\t\t\t\tif (e === false && btnName !== 'html')\n\t\t\t\t\t{\n\t\t\t\t\t\tif ($.inArray(btnName, this.opts.activeButtons) !== -1) this.button.toggleActive(btnName);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!this.utils.isRedactorParent(current))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// disable line\n\t\t\t\t\tif (this.core.editor().css('display') !== 'none')\n\t\t\t\t\t{\n\t    \t\t\t\tif (this.utils.isCurrentOrParentHeader() || this.utils.isCurrentOrParent(['table', 'pre', 'blockquote', 'li'])) this.button.disable('horizontalrule');\n    \t\t\t\t\telse this.button.enable('horizontalrule');\n\t\t\t\t\t}\n\n\t\t\t\t\t$.each(this.opts.activeButtonsStates, $.proxy(function(key, value)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar parentEl = $(parent).closest(key, this.$editor[0]);\n\t\t\t\t\t\tvar currentEl = $(current).closest(key, this.$editor[0]);\n\n\t\t\t\t\t\tif (parentEl.length !== 0 && !this.utils.isRedactorParent(parentEl))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!this.utils.isRedactorParent(currentEl))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (parentEl.length !== 0 || currentEl.closest(key, this.$editor[0]).length !== 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.button.setActive(value);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t},\n\t\t\t\tdropdowns: function()\n\t\t\t\t{\n    \t\t\t\tvar finded = $('<div />').html(this.selection.html()).find('a').length;\n\t\t\t\t\tvar $current = $(this.selection.current());\n\t\t\t\t\tvar isRedactor = this.utils.isRedactorParent($current);\n\n\t\t\t\t\t$.each(this.opts.observe.dropdowns, $.proxy(function(key, value)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar observe = value.observe,\n\t\t\t\t\t\t\telement = observe.element,\n\t\t\t\t\t\t\t$item   = value.item,\n\t\t\t\t\t\t\tinValues = typeof observe['in'] !== 'undefined' ? observe['in'] : false,\n\t\t\t\t\t\t\toutValues = typeof observe.out !== 'undefined' ? observe.out : false;\n\n\t\t\t\t\t\tif (($current.closest(element).length > 0 && isRedactor) || (element === 'a' && finded !== 0))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.observe.setDropdownProperties($item, inValues, outValues);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.observe.setDropdownProperties($item, outValues, inValues);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}, this));\n\t\t\t\t},\n\t\t\t\tsetDropdownProperties: function($item, addProperties, deleteProperties)\n\t\t\t\t{\n\t\t\t\t\tif (deleteProperties && typeof deleteProperties.attr !== 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.observe.setDropdownAttr($item, deleteProperties.attr, true);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (typeof addProperties.attr !== 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.observe.setDropdownAttr($item, addProperties.attr);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (typeof addProperties.title !== 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\t$item.find('span').text(addProperties.title);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tsetDropdownAttr: function($item, properties, isDelete)\n\t\t\t\t{\n\t\t\t\t\t$.each(properties, function(key, value)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (key === 'class')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (!isDelete)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$item.addClass(value);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$item.removeClass(value);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (!isDelete)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$item.attr(key, value);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$item.removeAttr(key);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\taddDropdown: function($item, btnName, btnObject)\n\t\t\t\t{\n\t\t\t\t\tif (typeof btnObject.observe === \"undefined\")\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tbtnObject.item = $item;\n\n\t\t\t\t\tthis.opts.observe.dropdowns.push(btnObject);\n\t\t\t\t},\n\t\t\t\timages: function()\n\t\t\t\t{\n                    if (this.opts.imageEditable)\n                    {\n                        this.core.editor().addClass('redactor-layer-img-edit');\n    \t\t\t\t\tthis.core.editor().find('img').each($.proxy(function(i, img)\n    \t\t\t\t\t{\n    \t\t\t\t\t\tvar $img = $(img);\n\n    \t\t\t\t\t\t// IE fix (when we clicked on an image and then press backspace IE does goes to image's url)\n    \t\t\t\t\t\t$img.closest('a', this.$editor[0]).on('click', function(e) { e.preventDefault(); });\n\n    \t\t\t\t\t\tthis.image.setEditable($img);\n\n\n    \t\t\t\t\t}, this));\n                    }\n\t\t\t\t},\n\t\t\t\tlinks: function()\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.linkTooltip)\n\t\t\t\t\t{\n    \t\t\t\t\tthis.core.editor().find('a').each($.proxy(function(i, s)\n    \t\t\t\t\t{\n        \t\t\t\t\tvar $link = $(s);\n        \t\t\t\t\tif ($link.data('cached') !== true)\n        \t\t\t\t\t{\n            \t\t\t\t\t$link.data('cached', true);\n            \t\t\t\t\t$link.on('touchstart.redactor.' + this.uuid + ' click.redactor.' + this.uuid, $.proxy(this.observe.showTooltip, this));\n        \t\t\t\t\t}\n\n    \t\t\t\t\t}, this));\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tgetTooltipPosition: function($link)\n\t\t\t\t{\n\t\t\t\t\treturn $link.offset();\n\t\t\t\t},\n\t\t\t\tshowTooltip: function(e)\n\t\t\t\t{\n\t\t\t\t\tvar $el = $(e.target);\n\n\t\t\t\t\tif ($el[0].tagName === 'IMG')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ($el[0].tagName !== 'A')\n\t\t\t\t\t{\n\t\t\t\t\t\t$el = $el.closest('a', this.$editor[0]);\n\t\t\t\t\t}\n\n\t\t\t\t\tif ($el[0].tagName !== 'A')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar $link = $el;\n\n\t\t\t\t\tvar pos = this.observe.getTooltipPosition($link);\n\t\t\t\t\tvar tooltip = $('<span class=\"redactor-link-tooltip\"></span>');\n\n\t\t\t\t\tvar href = $link.attr('href');\n\t\t\t\t\tif (href === undefined)\n\t\t\t\t\t{\n\t\t\t\t\t\thref = '';\n\t\t\t\t\t}\n\n\t\t\t\t\tif (href.length > 24)\n\t\t\t\t\t{\n\t\t\t\t\t\thref = href.substring(0, 24) + '...';\n\t\t\t\t\t}\n\n\t\t\t\t\tvar aLink = $('<a href=\"' + $link.attr('href') + '\" target=\"_blank\" />').html(href).addClass('redactor-link-tooltip-action');\n\t\t\t\t\tvar aEdit = $('<a href=\"#\" />').html(this.lang.get('edit')).on('click', $.proxy(this.link.show, this)).addClass('redactor-link-tooltip-action');\n\t\t\t\t\tvar aUnlink = $('<a href=\"#\" />').html(this.lang.get('unlink')).on('click', $.proxy(this.link.unlink, this)).addClass('redactor-link-tooltip-action');\n\n\t\t\t\t\ttooltip.append(aLink).append(' | ').append(aEdit).append(' | ').append(aUnlink);\n\n\t\t\t\t\tvar lineHeight = parseInt($link.css('line-height'), 10);\n                    var lineClicked = Math.ceil((e.pageY - pos.top)/lineHeight);\n                    var top = pos.top + lineClicked * lineHeight;\n\n\t\t\t\t\ttooltip.css({\n\t\t\t\t\t\ttop: top + 'px',\n\t\t\t\t\t\tleft: pos.left + 'px'\n\t\t\t\t\t});\n\n\t\t\t\t\t$('.redactor-link-tooltip').remove();\n\t\t\t\t\t$('body').append(tooltip);\n\n\t\t\t\t\tthis.core.editor().on('touchstart.redactor.' + this.uuid + ' click.redactor.' + this.uuid, $.proxy(this.observe.closeTooltip, this));\n\t\t\t\t\t$(document).on('touchstart.redactor.' + this.uuid + ' click.redactor.' + this.uuid, $.proxy(this.observe.closeTooltip, this));\n\t\t\t\t},\n\t\t\t\tcloseAllTooltip: function()\n\t\t\t\t{\n\t\t\t\t\t$('.redactor-link-tooltip').remove();\n\t\t\t\t},\n\t\t\t\tcloseTooltip: function(e)\n\t\t\t\t{\n\t\t\t\t\te = e.originalEvent || e;\n\n\t\t\t\t\tvar target = e.target;\n\t\t\t\t\tvar $parent = $(target).closest('a', this.$editor[0]);\n\t\t\t\t\tif ($parent.length !== 0 && $parent[0].tagName === 'A' && target.tagName !== 'A')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\telse if ((target.tagName === 'A' && this.utils.isRedactorParent(target)) || $(target).hasClass('redactor-link-tooltip-action'))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.observe.closeAllTooltip();\n\n\t\t\t\t\tthis.core.editor().off('touchstart.redactor.' + this.uuid + ' click.redactor.' + this.uuid, $.proxy(this.observe.closeTooltip, this));\n\t\t\t\t\t$(document).off('touchstart.redactor.' + this.uuid + ' click.redactor.' + this.uuid, $.proxy(this.observe.closeTooltip, this));\n\t\t\t\t}\n\n\t\t\t};\n\t\t},\n\n\t\t// =offset\n\t\toffset: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tget: function(node)\n\t\t\t\t{\n\t\t\t\t\tvar cloned = this.offset.clone(node);\n\t\t\t\t\tif (cloned === false)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn 0;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar div = document.createElement('div');\n\t\t\t\t\tdiv.appendChild(cloned.cloneContents());\n\t\t\t\t\tdiv.innerHTML = div.innerHTML.replace(/<img(.*?[^>])>$/gi, 'i');\n\n\t\t\t        var text = $.trim($(div).text()).replace(/[\\t\\n\\r\\n]/g, '').replace(/\\u200B/g, '');\n\n\t\t\t\t\treturn text.length;\n\n\t\t\t\t},\n\t\t\t\tclone: function(node)\n\t\t\t\t{\n\t\t\t\t\tvar sel = this.selection.get();\n\t\t\t\t\tvar range = this.selection.range(sel);\n\n\t\t\t\t\tif (range === null && typeof node === 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tnode = (typeof node === 'undefined') ? this.$editor : node;\n\t\t\t\t\tif (node === false)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tnode = node[0] || node;\n\n\t\t\t\t\tvar cloned = range.cloneRange();\n\t\t\t\t\tcloned.selectNodeContents(node);\n\t\t\t\t\tcloned.setEnd(range.endContainer, range.endOffset);\n\n\t\t\t\t\treturn cloned;\n\t\t\t\t},\n\t\t\t\tset: function(start, end)\n\t\t\t\t{\n\t\t\t\t\tend = (typeof end === 'undefined') ? start : end;\n\n\t\t\t\t\tif (!this.focus.is())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.focus.start();\n\t\t\t\t\t}\n\n\t\t\t\t\tvar sel = this.selection.get();\n\t\t\t\t\tvar range = this.selection.range(sel);\n\t\t\t\t\tvar node, offset = 0;\n\t\t\t\t\tvar walker = document.createTreeWalker(this.$editor[0], NodeFilter.SHOW_TEXT, null, null);\n\n\t\t\t\t\twhile ((node = walker.nextNode()) !== null)\n\t\t\t\t\t{\n\t\t\t\t\t\toffset += node.nodeValue.length;\n\t\t\t\t\t\tif (offset > start)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\trange.setStart(node, node.nodeValue.length + start - offset);\n\t\t\t\t\t\t\tstart = Infinity;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (offset >= end)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\trange.setEnd(node, node.nodeValue.length + end - offset);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\trange.collapse(false);\n\t\t\t\t\tthis.selection.update(sel, range);\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =paragraphize\n\t\tparagraphize: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tload: function(html)\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.paragraphize === false || this.opts.type === 'inline' || this.opts.type === 'pre')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn html;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (html === '' || html === '<p></p>')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn this.opts.emptyHtml;\n\t\t\t\t\t}\n\n\t\t\t\t\thtml = html + \"\\n\";\n\n\t\t\t\t\tthis.paragraphize.safes = [];\n\t\t\t\t\tthis.paragraphize.z = 0;\n\n\t\t\t\t\t// before\n\t\t\t\t\thtml = html.replace(/(<br\\s?\\/?>){1,}\\n?<\\/blockquote>/gi, '</blockquote>');\n\t\t\t\t\thtml = html.replace(/<\\/pre>/gi, \"</pre>\\n\\n\");\n\t\t\t\t\thtml = html.replace(/<p>\\s<br><\\/p>/gi, '<p></p>');\n\n\t\t\t\t\thtml = this.paragraphize.getSafes(html);\n\n\t\t\t\t\thtml = html.replace('<br>', \"\\n\");\n\t\t\t\t\thtml = this.paragraphize.convert(html);\n\n\t\t\t\t\thtml = this.paragraphize.clear(html);\n\t\t\t\t\thtml = this.paragraphize.restoreSafes(html);\n\n\t\t\t\t\t// after\n\t\t\t\t\thtml = html.replace(new RegExp('<br\\\\s?/?>\\n?<(' + this.opts.paragraphizeBlocks.join('|') + ')(.*?[^>])>', 'gi'), '<p><br /></p>\\n<$1$2>');\n\n\t\t\t\t\treturn $.trim(html);\n\t\t\t\t},\n\t\t\t\tgetSafes: function(html)\n\t\t\t\t{\n\t\t\t\t\tvar $div = $('<div />').append(html);\n\n\t\t\t\t\t// remove paragraphs in blockquotes\n\t\t\t\t\t$div.find('blockquote p').replaceWith(function()\n\t\t\t\t\t{\n\t\t\t\t\t\treturn $(this).append('<br />').contents();\n\t\t\t\t\t});\n\n                    $div.find(this.opts.paragraphizeBlocks.join(', ')).each($.proxy(function(i,s)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.paragraphize.z++;\n\t\t\t\t\t\tthis.paragraphize.safes[this.paragraphize.z] = s.outerHTML;\n\n\t\t\t\t\t\treturn $(s).replaceWith(\"\\n#####replace\" + this.paragraphize.z + \"#####\\n\\n\");\n\n\n\t\t\t\t\t}, this));\n\n                    // deal with redactor selection markers\n                    $div.find('span.redactor-selection-marker').each($.proxy(function(i,s)\n                    {\n                        this.paragraphize.z++;\n                        this.paragraphize.safes[this.paragraphize.z] = s.outerHTML;\n\n                        return $(s).replaceWith(\"\\n#####replace\" + this.paragraphize.z + \"#####\\n\\n\");\n                    }, this));\n\n\t\t\t\t\treturn $div.html();\n\t\t\t\t},\n\t\t\t\trestoreSafes: function(html)\n\t\t\t\t{\n\t\t\t\t\t$.each(this.paragraphize.safes, function(i,s)\n\t\t\t\t\t{\n\t\t\t\t\t\ts = (typeof s !== 'undefined') ? s.replace(/\\$/g, '&#36;') : s;\n\t\t\t\t\t\thtml = html.replace('#####replace' + i + '#####', s);\n\n\t\t\t\t\t});\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tconvert: function(html)\n\t\t\t\t{\n\t\t\t\t\thtml = html.replace(/\\r\\n/g, \"xparagraphmarkerz\");\n\t\t\t\t\thtml = html.replace(/\\n/g, \"xparagraphmarkerz\");\n\t\t\t\t\thtml = html.replace(/\\r/g, \"xparagraphmarkerz\");\n\n\t\t\t\t\tvar re1 = /\\s+/g;\n\t\t\t\t\thtml = html.replace(re1, \" \");\n\t\t\t\t\thtml = $.trim(html);\n\n\t\t\t\t\tvar re2 = /xparagraphmarkerzxparagraphmarkerz/gi;\n\t\t\t\t\thtml = html.replace(re2, \"</p><p>\");\n\n\t\t\t\t\tvar re3 = /xparagraphmarkerz/gi;\n\t\t\t\t\thtml = html.replace(re3, \"<br>\");\n\n\t\t\t\t\thtml = '<p>' + html + '</p>';\n\n\t\t\t\t\thtml = html.replace(\"<p></p>\", \"\");\n\t\t\t\t\thtml = html.replace(\"\\r\\n\\r\\n\", \"\");\n\t\t\t\t\thtml = html.replace(/<\\/p><p>/g, \"</p>\\r\\n\\r\\n<p>\");\n\t\t\t\t\thtml = html.replace(new RegExp(\"<br\\\\s?/?></p>\", \"g\"), \"</p>\");\n\t\t\t\t\thtml = html.replace(new RegExp(\"<p><br\\\\s?/?>\", \"g\"), \"<p>\");\n\t\t\t\t\thtml = html.replace(new RegExp(\"<p><br\\\\s?/?>\", \"g\"), \"<p>\");\n\t\t\t\t\thtml = html.replace(new RegExp(\"<br\\\\s?/?></p>\", \"g\"), \"</p>\");\n\t\t\t\t\thtml = html.replace(/<p>&nbsp;<\\/p>/gi, \"\");\n\t\t\t\t\thtml = html.replace(/<p>\\s?<br>&nbsp;<\\/p>/gi, '');\n\t\t\t\t\thtml = html.replace(/<p>\\s?<br>/gi, '<p>');\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tclear: function(html)\n\t\t\t\t{\n\n\t\t\t\t\thtml = html.replace(/<p>(.*?)#####replace(.*?)#####\\s?<\\/p>/gi, '<p>$1</p>#####replace$2#####');\n\t\t\t\t\thtml = html.replace(/(<br\\s?\\/?>){2,}<\\/p>/gi, '</p>');\n\n\t\t\t\t\thtml = html.replace(new RegExp('</blockquote></p>', 'gi'), '</blockquote>');\n\t\t\t\t\thtml = html.replace(new RegExp('<p></blockquote>', 'gi'), '</blockquote>');\n\t\t\t\t\thtml = html.replace(new RegExp('<p><blockquote>', 'gi'), '<blockquote>');\n\t\t\t\t\thtml = html.replace(new RegExp('<blockquote></p>', 'gi'), '<blockquote>');\n\n\t\t\t\t\thtml = html.replace(new RegExp('<p><p ', 'gi'), '<p ');\n\t\t\t\t\thtml = html.replace(new RegExp('<p><p>', 'gi'), '<p>');\n\t\t\t\t\thtml = html.replace(new RegExp('</p></p>', 'gi'), '</p>');\n\t\t\t\t\thtml = html.replace(new RegExp('<p>\\\\s?</p>', 'gi'), '');\n\t\t\t\t\thtml = html.replace(new RegExp(\"\\n</p>\", 'gi'), '</p>');\n\t\t\t\t\thtml = html.replace(new RegExp('<p>\\t?\\t?\\n?<p>', 'gi'), '<p>');\n\t\t\t\t\thtml = html.replace(new RegExp('<p>\\t*</p>', 'gi'), '');\n\n\t\t\t\t\treturn html;\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =paste\n\t\tpaste: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tinit: function(e)\n\t\t\t\t{\n\t\t\t\t\tthis.rtePaste = true;\n\t\t\t\t\tvar pre = (this.opts.type === 'pre' || this.utils.isCurrentOrParent('pre')) ? true : false;\n\n\t\t\t\t\t// clipboard event\n\t\t\t\t\tif (this.detect.isDesktop())\n\t\t\t\t\t{\n\n    \t\t\t\t\tif (!this.paste.pre && this.opts.clipboardImageUpload && this.opts.imageUpload && this.paste.detectClipboardUpload(e))\n    \t\t\t\t\t{\n    \t\t\t\t\t\tif (this.detect.isIe())\n    \t\t\t\t\t\t{\n    \t\t\t\t\t\t\tsetTimeout($.proxy(this.paste.clipboardUpload, this), 100);\n    \t\t\t\t\t\t}\n\n    \t\t\t\t\t\treturn;\n    \t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.utils.saveScroll();\n\t\t\t\t\tthis.selection.save();\n\t\t\t\t\tthis.paste.createPasteBox(pre);\n\n\t\t\t\t\t$(window).on('scroll.redactor-freeze', $.proxy(function()\n\t\t\t\t\t{\n\t\t\t\t\t\t$(window).scrollTop(this.saveBodyScroll);\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t\tsetTimeout($.proxy(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tvar html = this.paste.getPasteBoxCode(pre);\n\n\t\t\t\t\t\t// buffer\n\t\t\t\t\t\tthis.buffer.set();\n\t\t\t\t\t\tthis.selection.restore();\n\n\t\t\t\t\t\tthis.utils.restoreScroll();\n\n\t\t\t\t\t\t// paste info\n\t\t\t\t\t\tvar data = this.clean.getCurrentType(html);\n\n\t\t\t\t\t\t// clean\n\t\t\t\t\t\thtml = this.clean.onPaste(html, data);\n\n\t\t\t\t\t\t// callback\n\t\t\t\t\t\tvar returned = this.core.callback('paste', html);\n\t\t\t\t\t\thtml = (typeof returned === 'undefined') ? html : returned;\n\n\t\t\t\t\t\tthis.paste.insert(html, data);\n\t\t\t\t\t\tthis.rtePaste = false;\n\n\t\t\t\t\t\t// clean pre breaklines\n\t\t\t\t\t\tif (pre)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.clean.cleanPre();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t$(window).off('scroll.redactor-freeze');\n\n\t\t\t\t\t}, this), 1);\n\n\t\t\t\t},\n\t\t\t\tgetPasteBoxCode: function(pre)\n\t\t\t\t{\n\t\t\t\t\tvar html = (pre) ? this.$pasteBox.val() : this.$pasteBox.html();\n\t\t\t\t\tthis.$pasteBox.remove();\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tcreatePasteBox: function(pre)\n\t\t\t\t{\n\t\t\t\t\tvar css = { position: 'fixed', width: '1px', top: 0, left: '-9999px' };\n\n\t\t\t\t\tthis.$pasteBox = (pre) ? $('<textarea>').css(css) : $('<div>').attr('contenteditable', 'true').css(css);\n\t\t\t\t\tthis.paste.appendPasteBox();\n\t\t\t\t\tthis.$pasteBox.focus();\n\t\t\t\t},\n\t\t\t\tappendPasteBox: function()\n\t\t\t\t{\n\t\t\t\t\tif (this.detect.isIe())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.box().append(this.$pasteBox);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\t// bootstrap modal\n\t\t\t\t\t\tvar $visibleModals = $('.modal-body:visible');\n\t\t\t\t\t\tif ($visibleModals.length > 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$visibleModals.append(this.$pasteBox);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$('body').prepend(this.$pasteBox);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tdetectClipboardUpload: function(e)\n\t\t\t\t{\n\t\t\t\t\te = e.originalEvent || e;\n\n\t\t\t\t\tvar clipboard = e.clipboardData;\n\t\t\t\t\tif (this.detect.isIe() || this.detect.isFirefox())\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\t// prevent safari fake url\n\t\t\t\t\tvar types = clipboard.types;\n\t\t\t\t\tif (types.indexOf('public.tiff') !== -1)\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!clipboard.items || !clipboard.items.length)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar file = clipboard.items[0].getAsFile();\n\t\t\t\t\tif (file === null)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar reader = new FileReader();\n\t\t\t\t\treader.readAsDataURL(file);\n\t\t\t\t\treader.onload = $.proxy(this.paste.insertFromClipboard, this);\n\n\t\t\t\t\treturn true;\n\t\t\t\t},\n\t\t\t\tclipboardUpload: function()\n\t\t\t\t{\n\t\t\t\t\tvar imgs = this.$editor.find('img');\n\t\t\t\t\t$.each(imgs, $.proxy(function(i,s)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (s.src.search(/^data\\:image/i) === -1)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar formData = !!window.FormData ? new FormData() : null;\n\t\t\t\t\t\tif (!window.FormData)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.upload.direct = true;\n\t\t\t\t\t\tthis.upload.type = 'image';\n\t\t\t\t\t\tthis.upload.url = this.opts.imageUpload;\n\t\t\t\t\t\tthis.upload.callback = $.proxy(function(data)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (this.detect.isIe())\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$(s).wrap($('<figure />'));\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tvar $parent = $(s).parent();\n\t\t\t\t\t\t\t\tthis.utils.replaceToTag($parent, 'figure');\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\ts.src = data.url;\n\t\t\t\t\t\t\tthis.core.callback('imageUpload', $(s), data);\n\n\t\t\t\t\t\t}, this);\n\n\t\t\t\t\t\tvar blob = this.utils.dataURItoBlob(s.src);\n\n\t\t\t\t\t\tformData.append('clipboard', 1);\n\t\t\t\t\t\tformData.append(this.opts.imageUploadParam, blob);\n\n\t\t\t\t\t\tthis.progress.show();\n\t\t\t\t\t\tthis.upload.send(formData, false);\n\t\t\t\t\t\tthis.code.sync();\n\t\t\t\t\t\tthis.rtePaste = false;\n\n\t\t\t\t\t}, this));\n\t\t\t\t},\n\t\t\t\tinsertFromClipboard: function(e)\n\t\t\t\t{\n\t\t\t\t\tvar formData = !!window.FormData ? new FormData() : null;\n\t\t\t\t\tif (!window.FormData)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.upload.direct = true;\n\t\t\t\t\tthis.upload.type = 'image';\n\t\t\t\t\tthis.upload.url = this.opts.imageUpload;\n\t\t\t\t\tthis.upload.callback = this.image.insert;\n\n\t\t\t\t\tvar blob = this.utils.dataURItoBlob(e.target.result);\n\n\t\t\t\t\tformData.append('clipboard', 1);\n\t\t\t\t\tformData.append(this.opts.imageUploadParam, blob);\n\n\t\t\t\t\tthis.progress.show();\n\t\t\t\t\tthis.upload.send(formData, e);\n\t\t\t\t\tthis.rtePaste = false;\n\t\t\t\t},\n\t\t\t\tinsert: function(html, data)\n\t\t\t\t{\n\t\t\t\t\tif (data.pre)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.insert.raw(html);\n\t\t\t\t\t}\n\t\t\t\t\telse if (data.text)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.insert.text(html);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.insert.html(html, data);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Firefox Clipboard Observe\n\t\t\t\t\tif (this.detect.isFirefox() && this.opts.imageUpload && this.opts.clipboardImageUpload)\n\t\t\t\t\t{\n\t\t\t\t\t\tsetTimeout($.proxy(this.paste.clipboardUpload, this), 100);\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =placeholder\n\t\tplaceholder: function()\n\t\t{\n\t\t\treturn {\n\n\t\t\t\t// public\n\t\t\t\tenable: function()\n\t\t\t\t{\n\t\t\t\t\tsetTimeout($.proxy(function()\n\t\t\t\t\t{\n\t\t\t\t\t\treturn (this.placeholder.isEditorEmpty()) ? this.placeholder.show() : this.placeholder.hide();\n\n\t\t\t\t\t}, this), 5);\n\t\t\t\t},\n\t\t\t\tshow: function()\n\t\t\t\t{\n\t\t\t\t\tthis.core.editor().addClass('redactor-placeholder');\n\t\t\t\t},\n\t\t\t\tupdate: function(text)\n\t\t\t\t{\n\t\t\t\t\tthis.opts.placeholder = text;\n\t\t\t\t\tthis.core.editor().attr('placeholder', text);\n\t\t\t\t},\n\t\t\t\thide: function()\n\t\t\t\t{\n\t\t\t\t\tthis.core.editor().removeClass('redactor-placeholder');\n\t\t\t\t},\n\t\t\t\tis: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.core.editor().hasClass('redactor-placeholder');\n\t\t\t\t},\n\n\n\t\t\t\t// private\n\t\t\t\tinit: function()\n\t\t\t\t{\n\t\t\t\t\tif (!this.placeholder.enabled())\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!this.utils.isEditorRelative())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.utils.setEditorRelative();\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.placeholder.build();\n\t\t\t\t\tthis.placeholder.buildPosition();\n\t\t\t\t\tthis.placeholder.enable();\n\t\t\t\t\tthis.placeholder.enableEvents();\n\n\t\t\t\t},\n\t\t\t\tenabled: function()\n\t\t\t\t{\n\t\t\t\t\treturn (this.opts.placeholder) ? this.core.element().attr('placeholder', this.opts.placeholder) : this.placeholder.isAttr();\n\t\t\t\t},\n\t\t\t\tenableEvents: function()\n\t\t\t\t{\n\t\t\t\t\tthis.core.editor().on('keydown.redactor-placeholder.' + this.uuid, $.proxy(this.placeholder.enable, this));\n\t\t\t\t},\n\t\t\t\tdisableEvents: function()\n\t\t\t\t{\n\t\t\t\t\tthis.core.editor().off('.redactor-placeholder.' + this.uuid);\n\t\t\t\t},\n\t\t\t\tbuild: function()\n\t\t\t\t{\n\t\t\t\t\tthis.core.editor().attr('placeholder', this.core.element().attr('placeholder'));\n\t\t\t\t},\n\t\t\t\tbuildPosition: function()\n\t\t\t\t{\n\t\t\t\t\tvar $style = $('<style />');\n\t\t\t\t\t$style.addClass('redactor-placeholder-style-tag');\n\t\t\t\t\t$style.html('#' + this.core.id() + '.redactor-placeholder::after ' + this.placeholder.getPosition());\n\n\t\t\t\t\t$('head').append($style);\n\t\t\t\t},\n\t\t\t\tgetPosition: function()\n\t\t\t\t{\n\t\t\t\t\treturn '{ top: ' + this.core.editor().css('padding-top') + '; left: ' + this.core.editor().css('padding-left') + '; }';\n\t\t\t\t},\n\t\t\t\tisEditorEmpty: function()\n\t\t\t\t{\n\t\t\t\t\tvar html = $.trim(this.core.editor().html()).replace(/[\\t\\n]/g, '');\n\t\t\t\t\tvar states = ['', '<p>​</p>', '<p>​<br></p>', this.opts.emptyHtmlRendered];\n\n\t\t\t\t\treturn ($.inArray(html, states) !== -1);\n\t\t\t\t},\n\t\t\t\tisAttr: function()\n\t\t\t\t{\n\t\t\t\t\treturn (typeof this.core.element().attr('placeholder') !== 'undefined' && this.core.element().attr('placeholder') !== '');\n\t\t\t\t},\n\t\t\t\tdestroy: function()\n\t\t\t\t{\n\t\t\t\t\tthis.core.editor().removeAttr('placeholder');\n\n\t\t\t\t\tthis.placeholder.hide();\n\t\t\t\t\tthis.placeholder.disableEvents();\n\n\t\t\t\t\t$('.redactor-placeholder-style-tag').remove();\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =progress\n\t\tprogress: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\t$box: null,\n\t\t\t\t$bar: null,\n\t\t\t\ttarget: document.body,  // or id selector\n\n\t\t\t\t// public\n\t\t\t\tshow: function()\n\t\t\t\t{\n\t\t\t\t\tif (!this.progress.is())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.progress.build();\n\t\t\t\t\t\tthis.progress.$box.redactorAnimation('fadeIn');\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.progress.$box.show();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\thide: function()\n\t\t\t\t{\n\t\t\t\t\tif (this.progress.is())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.progress.$box.redactorAnimation('fadeOut', { duration: 0.35 }, $.proxy(this.progress.destroy, this));\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tupdate: function(value)\n\t\t\t\t{\n\t\t\t\t\tthis.progress.show();\n\t\t\t\t\tthis.progress.$bar.css('width', value + '%');\n\t\t\t\t},\n\t\t\t\tis: function()\n\t\t\t\t{\n\t\t\t\t\treturn (this.progress.$box === null) ? false : true;\n\t\t\t\t},\n\n\t\t\t\t// private\n\t\t\t\tbuild: function()\n\t\t\t\t{\n\t\t\t\t\tthis.progress.$bar = $('<span />');\n\t\t\t\t\tthis.progress.$box = $('<div id=\"redactor-progress\" />');\n\n\t\t\t\t\tthis.progress.$box.append(this.progress.$bar);\n\t\t\t\t\t$(this.progress.target).append(this.progress.$box);\n\t\t\t\t},\n\t\t\t\tdestroy: function()\n\t\t\t\t{\n\t\t\t\t\tif (this.progress.is())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.progress.$box.remove();\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.progress.$box = null;\n\t\t\t\t\tthis.progress.$bar = null;\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =selection\n\t\tselection: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tget: function()\n\t\t\t\t{\n\t\t\t\t\tif (window.getSelection)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn window.getSelection();\n\t\t\t\t\t}\n\t\t\t\t\telse if (document.selection && document.selection.type !== \"Control\")\n\t\t\t\t\t{\n\t\t\t\t\t\treturn document.selection;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn null;\n\t\t\t\t},\n\t\t\t\trange: function(sel)\n\t\t\t\t{\n\t\t\t\t\tif (typeof sel === 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\tsel = this.selection.get();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (sel.getRangeAt && sel.rangeCount)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn sel.getRangeAt(0);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn null;\n\t\t\t\t},\n\t\t\t\tis: function()\n\t\t\t\t{\n\t\t\t\t\treturn (this.selection.isCollapsed()) ? false : true;\n\t\t\t\t},\n\t\t\t\tisRedactor: function()\n\t\t\t\t{\n\t\t\t\t\tvar range = this.selection.range();\n\n\t\t\t\t\tif (range !== null)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar el = range.startContainer.parentNode;\n\n\t\t\t\t\t\tif ($(el).hasClass('redactor-in') || $(el).parents('.redactor-in').length !== 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\t\t\t\tisCollapsed: function()\n\t\t\t\t{\n\t\t\t\t\tvar sel = this.selection.get();\n\n\t\t\t\t\treturn (sel === null) ? false : sel.isCollapsed;\n\t\t\t\t},\n\t\t\t\tupdate: function(sel, range)\n\t\t\t\t{\n\t\t\t\t\tif (range === null)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tsel.removeAllRanges();\n\t\t\t\t\tsel.addRange(range);\n\t\t\t\t},\n\t\t\t\tcurrent: function()\n\t\t\t\t{\n\t\t\t\t\tvar sel = this.selection.get();\n\n\t\t\t\t\treturn (sel === null) ? false : sel.anchorNode;\n\t\t\t\t},\n\t\t\t\tparent: function()\n\t\t\t\t{\n\t\t\t\t\tvar current = this.selection.current();\n\n\t\t\t\t\treturn (current === null) ? false : current.parentNode;\n\t\t\t\t},\n\t\t\t\tblock: function(node)\n\t\t\t\t{\n\t\t\t\t\tnode = node || this.selection.current();\n\n\t\t\t\t\twhile (node)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.utils.isBlockTag(node.tagName))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn ($(node).hasClass('redactor-in')) ? false : node;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tnode = node.parentNode;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\t\t\t\tinline: function(node)\n\t\t\t\t{\n\t\t\t\t\tnode = node || this.selection.current();\n\n\t\t\t\t\twhile (node)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.utils.isInlineTag(node.tagName))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn ($(node).hasClass('redactor-in')) ? false : node;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tnode = node.parentNode;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\t\t\t\telement: function(node)\n\t\t\t\t{\n\t\t\t\t\tif (!node)\n\t\t\t\t\t{\n\t\t\t\t\t\tnode = this.selection.current();\n\t\t\t\t\t}\n\n\t\t\t\t\twhile (node)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (node.nodeType === 1)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif ($(node).hasClass('redactor-in'))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn node;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tnode = node.parentNode;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\t\t\t\tprev: function()\n\t\t\t\t{\n\t\t\t\t\tvar current = this.selection.current();\n\n\t\t\t\t\treturn (current === null) ? false : this.selection.current().previousSibling;\n\t\t\t\t},\n\t\t\t\tnext: function()\n\t\t\t\t{\n\t\t\t\t\tvar current = this.selection.current();\n\n\t\t\t\t\treturn (current === null) ? false : this.selection.current().nextSibling;\n\t\t\t\t},\n\t\t\t\tblocks: function(tag)\n\t\t\t\t{\n\t\t\t\t\tvar blocks = [];\n\t\t\t\t\tvar nodes = this.selection.nodes(tag);\n\n\t\t\t\t\t$.each(nodes, $.proxy(function(i,node)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.utils.isBlock(node))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tblocks.push(node);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t\tvar block = this.selection.block();\n\t\t\t\t\tif (blocks.length === 0 && block === false)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn [];\n\t\t\t\t\t}\n\t\t\t\t\telse if (blocks.length === 0 && block !== false)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn [block];\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\treturn blocks;\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\tinlines: function(tag)\n\t\t\t\t{\n\t\t\t\t\tvar inlines = [];\n\t\t\t\t\tvar nodes = this.selection.nodes(tag);\n\n\t\t\t\t\t$.each(nodes, $.proxy(function(i,node)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.utils.isInline(node))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tinlines.push(node);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t\tvar inline = this.selection.inline();\n\t\t\t\t\tif (inlines.length === 0 && inline === false)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn [];\n\t\t\t\t\t}\n\t\t\t\t\telse if (inlines.length === 0 && inline !== false)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn [inline];\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\treturn inlines;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tnodes: function(tag)\n\t\t\t\t{\n                    var filter = (typeof tag === 'undefined') ? [] : (($.isArray(tag)) ? tag : [tag]);\n\n\t\t\t\t\tvar sel = this.selection.get();\n\t\t\t\t\tvar range = this.selection.range(sel);\n                    var nodes = [];\n                    var resultNodes = [];\n\n\t\t\t\t\tif (this.utils.isCollapsed())\n\t\t\t\t\t{\n\t\t\t\t\t\tnodes = [this.selection.current()];\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tvar node = range.startContainer;\n\t\t\t\t\t\tvar endNode = range.endContainer;\n\n\t\t\t\t\t\t// single node\n\t\t\t\t\t\tif (node === endNode)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn [node];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// iterate\n\t\t\t\t\t\twhile (node && node !== endNode)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tnodes.push(node = this.selection.nextNode(node));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// partially selected nodes\n\t\t\t\t\t\tnode = range.startContainer;\n\t\t\t\t\t\twhile (node && node !== range.commonAncestorContainer)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tnodes.unshift(node);\n\t\t\t\t\t\t\tnode = node.parentNode;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// remove service nodes\n\t\t\t\t\t$.each(nodes, function(i,s)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (s)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar tagName = (s.nodeType !== 1) ? false : s.tagName.toLowerCase();\n\n\t\t\t\t\t\t\tif ($(s).hasClass('redactor-script-tag') || $(s).hasClass('redactor-selection-marker'))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse if (tagName && filter.length !== 0 && $.inArray(tagName, filter) === -1)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tresultNodes.push(s);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\treturn (resultNodes.length === 0) ? [] : resultNodes;\n\t\t\t\t},\n\t\t\t\tnextNode: function(node)\n\t\t\t\t{\n\t\t\t\t\tif (node.hasChildNodes())\n\t\t\t\t\t{\n\t\t\t\t\t\treturn node.firstChild;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\twhile (node && !node.nextSibling)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tnode = node.parentNode;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!node)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn node.nextSibling;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tsave: function()\n\t\t\t\t{\n \t\t\t\t\tthis.marker.insert();\n\t\t\t\t\tthis.savedSel = this.core.editor().html();\n\t\t\t\t},\n\t\t\t\trestore: function(removeMarkers)\n\t\t\t\t{\n                    var node1 = this.marker.find(1);\n\t\t\t\t\tvar node2 = this.marker.find(2);\n\n\t\t\t\t\tif (this.detect.isFirefox())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.editor().focus();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (node1.length !== 0 && node2.length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.caret.set(node1, node2);\n\t\t\t\t\t}\n\t\t\t\t\telse if (node1.length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.caret.start(node1);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.editor().focus();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (removeMarkers !== false)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.marker.remove();\n\t\t\t\t\t\tthis.savedSel = false;\n\t\t\t\t\t}\n\t\t\t\t},\n                saveInstant: function()\n                {\n                    var el = this.core.editor()[0];\n                    var doc = el.ownerDocument, win = doc.defaultView;\n                    var sel = win.getSelection();\n\n                    if (!sel.getRangeAt || !sel.rangeCount)\n                    {\n                        return;\n                    }\n\n                    var range = sel.getRangeAt(0);\n                    var selectionRange = range.cloneRange();\n\n                    selectionRange.selectNodeContents(el);\n                    selectionRange.setEnd(range.startContainer, range.startOffset);\n\n                    var start = selectionRange.toString().length;\n\n                    this.saved = {\n                        start: start,\n                        end: start + range.toString().length,\n                        node: range.startContainer\n                    };\n\n                    return this.saved;\n                },\n                restoreInstant: function(saved)\n                {\n                    if (typeof saved === 'undefined' && !this.saved)\n                    {\n                        return;\n                    }\n\n                    this.saved = (typeof saved !== 'undefined') ? saved : this.saved;\n\n                    var $node = this.core.editor().find(this.saved.node);\n                    if ($node.length !== 0 && $node.text().trim().replace(/\\u200B/g, '').length === 0)\n                    {\n                       try {\n                            var range = document.createRange();\n                            range.setStart($node[0], 0);\n\n                            var sel = window.getSelection();\n                            sel.removeAllRanges();\n                            sel.addRange(range);\n                        }\n                        catch(e) {}\n\n                        return;\n                    }\n\n                    var el = this.core.editor()[0];\n                    var doc = el.ownerDocument, win = doc.defaultView;\n                    var charIndex = 0, range = doc.createRange();\n\n                    range.setStart(el, 0);\n                    range.collapse(true);\n\n                    var nodeStack = [el], node, foundStart = false, stop = false;\n                    while (!stop && (node = nodeStack.pop()))\n                    {\n                        if (node.nodeType == 3)\n                        {\n                            var nextCharIndex = charIndex + node.length;\n                            if (!foundStart && this.saved.start >= charIndex && this.saved.start <= nextCharIndex)\n                            {\n                                range.setStart(node, this.saved.start - charIndex);\n                                foundStart = true;\n                            }\n\n                            if (foundStart && this.saved.end >= charIndex && this.saved.end <= nextCharIndex)\n                            {\n                                range.setEnd(node, this.saved.end - charIndex);\n                                stop = true;\n                            }\n                            charIndex = nextCharIndex;\n                        }\n                        else\n                        {\n                            var i = node.childNodes.length;\n                            while (i--)\n                            {\n                                nodeStack.push(node.childNodes[i]);\n                            }\n                        }\n                    }\n\n                    var sel = win.getSelection();\n                    sel.removeAllRanges();\n                    sel.addRange(range);\n                },\n\t\t\t\tnode: function(node)\n\t\t\t\t{\n\t\t\t\t\t$(node).prepend(this.marker.get(1));\n\t\t\t\t\t$(node).append(this.marker.get(2));\n\n\t\t\t\t\tthis.selection.restore();\n\t\t\t\t},\n\t\t\t\tall: function()\n\t\t\t\t{\n\t\t\t\t\tthis.core.editor().focus();\n\n\t\t\t\t\tvar sel = this.selection.get();\n\t\t\t\t\tvar range = this.selection.range(sel);\n\n\t\t\t\t\trange.selectNodeContents(this.core.editor()[0]);\n\n\t\t\t\t\tthis.selection.update(sel, range);\n\t\t\t\t},\n\t\t\t\tremove: function()\n\t\t\t\t{\n\t\t\t\t\tthis.selection.get().removeAllRanges();\n\t\t\t\t},\n\t\t\t\treplace: function(html)\n\t\t\t\t{\n\t\t\t\t\tthis.insert.html(html);\n\t\t\t\t},\n\t\t\t\ttext: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.selection.get().toString();\n\t\t\t\t},\n\t\t\t\thtml: function()\n\t\t\t\t{\n\t\t\t\t\tvar html = '';\n\t\t\t\t\tvar sel = this.selection.get();\n\n\t\t\t\t\tif (sel.rangeCount)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar container = document.createElement('div');\n\t\t\t\t\t\tvar len = sel.rangeCount;\n\t\t\t\t\t\tfor (var i = 0; i < len; ++i)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcontainer.appendChild(sel.getRangeAt(i).cloneContents());\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\thtml = this.clean.onGet(container.innerHTML);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\textractEndOfNode: function(node)\n\t\t\t\t{\n\t\t\t\t\tvar sel = this.selection.get();\n\t\t\t\t\tvar range = this.selection.range(sel);\n\n\t\t\t        var clonedRange = range.cloneRange();\n\t\t\t        clonedRange.selectNodeContents(node);\n\t\t\t        clonedRange.setStart(range.endContainer, range.endOffset);\n\n\t\t\t        return clonedRange.extractContents();\n\t\t\t\t},\n\n\t\t\t\t// #backward\n\t\t\t\tremoveMarkers: function()\n\t\t\t\t{\n\t\t\t\t\tthis.marker.remove();\n\t\t\t\t},\n\t\t\t\tmarker: function(num)\n\t\t\t\t{\n\t\t\t\t\treturn this.marker.get(num);\n\t\t\t\t},\n\t\t\t\tmarkerHtml: function(num)\n\t\t\t\t{\n\t\t\t\t\treturn this.marker.html(num);\n\t\t\t\t}\n\n\t\t\t};\n\t\t},\n\n\t\t// =shortcuts\n\t\tshortcuts: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\t// based on https://github.com/jeresig/jquery.hotkeys\n\t\t\t\thotkeysSpecialKeys: {\n\t\t\t\t\t8: \"backspace\", 9: \"tab\", 10: \"return\", 13: \"return\", 16: \"shift\", 17: \"ctrl\", 18: \"alt\", 19: \"pause\",\n\t\t\t\t\t20: \"capslock\", 27: \"esc\", 32: \"space\", 33: \"pageup\", 34: \"pagedown\", 35: \"end\", 36: \"home\",\n\t\t\t\t\t37: \"left\", 38: \"up\", 39: \"right\", 40: \"down\", 45: \"insert\", 46: \"del\", 59: \";\", 61: \"=\",\n\t\t\t\t\t96: \"0\", 97: \"1\", 98: \"2\", 99: \"3\", 100: \"4\", 101: \"5\", 102: \"6\", 103: \"7\",\n\t\t\t\t\t104: \"8\", 105: \"9\", 106: \"*\", 107: \"+\", 109: \"-\", 110: \".\", 111 : \"/\",\n\t\t\t\t\t112: \"f1\", 113: \"f2\", 114: \"f3\", 115: \"f4\", 116: \"f5\", 117: \"f6\", 118: \"f7\", 119: \"f8\",\n\t\t\t\t\t120: \"f9\", 121: \"f10\", 122: \"f11\", 123: \"f12\", 144: \"numlock\", 145: \"scroll\", 173: \"-\", 186: \";\", 187: \"=\",\n\t\t\t\t\t188: \",\", 189: \"-\", 190: \".\", 191: \"/\", 192: \"`\", 219: \"[\", 220: \"\\\\\", 221: \"]\", 222: \"'\"\n\t\t\t\t},\n\t\t\t\thotkeysShiftNums: {\n\t\t\t\t\t\"`\": \"~\", \"1\": \"!\", \"2\": \"@\", \"3\": \"#\", \"4\": \"$\", \"5\": \"%\", \"6\": \"^\", \"7\": \"&\",\n\t\t\t\t\t\"8\": \"*\", \"9\": \"(\", \"0\": \")\", \"-\": \"_\", \"=\": \"+\", \";\": \": \", \"'\": \"\\\"\", \",\": \"<\",\n\t\t\t\t\t\".\": \">\",  \"/\": \"?\",  \"\\\\\": \"|\"\n\t\t\t\t},\n\t\t\t\tinit: function(e, key)\n\t\t\t\t{\n\t\t\t\t\t// disable browser's hot keys for bold and italic if shortcuts off\n\t\t\t\t\tif (this.opts.shortcuts === false)\n\t\t\t\t\t{\n\t\t\t\t\t\tif ((e.ctrlKey || e.metaKey) && (key === 66 || key === 73))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\t// build\n\t\t\t\t\t\t$.each(this.opts.shortcuts, $.proxy(function(str, command)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.shortcuts.build(e, str, command);\n\n\t\t\t\t\t\t}, this));\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tbuild: function(e, str, command)\n\t\t\t\t{\n\t\t\t\t\tvar handler = $.proxy(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.shortcuts.buildHandler(command);\n\n\t\t\t\t\t}, this);\n\n\t\t\t\t\tvar keys = str.split(',');\n\t\t\t\t\tvar len = keys.length;\n\t\t\t\t\tfor (var i = 0; i < len; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (typeof keys[i] === 'string')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.shortcuts.handler(e, $.trim(keys[i]), handler);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\tbuildHandler: function(command)\n\t\t\t\t{\n\t\t\t\t\tvar func;\n\t\t\t\t\tif (command.func.search(/\\./) !== '-1')\n\t\t\t\t\t{\n\t\t\t\t\t\tfunc = command.func.split('.');\n\t\t\t\t\t\tif (typeof this[func[0]] !== 'undefined')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis[func[0]][func[1]].apply(this, command.params);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis[command.func].apply(this, command.params);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\thandler: function(e, keys, origHandler)\n\t\t\t\t{\n\t\t\t\t\tkeys = keys.toLowerCase().split(\" \");\n\n\t\t\t\t\tvar special = this.shortcuts.hotkeysSpecialKeys[e.keyCode];\n\t\t\t\t\tvar character = String.fromCharCode(e.which).toLowerCase();\n\t\t\t\t\tvar modif = \"\", possible = {};\n\n\t\t\t\t\t$.each([ \"alt\", \"ctrl\", \"meta\", \"shift\"], function(index, specialKey)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (e[specialKey + 'Key'] && special !== specialKey)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tmodif += specialKey + '+';\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\n\t\t\t\t\tif (special)\n\t\t\t\t\t{\n\t\t\t\t\t\tpossible[modif + special] = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (character)\n\t\t\t\t\t{\n\t\t\t\t\t\tpossible[modif + character] = true;\n\t\t\t\t\t\tpossible[modif + this.shortcuts.hotkeysShiftNums[character]] = true;\n\n\t\t\t\t\t\t// \"$\" can be triggered as \"Shift+4\" or \"Shift+$\" or just \"$\"\n\t\t\t\t\t\tif (modif === \"shift+\")\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tpossible[this.shortcuts.hotkeysShiftNums[character]] = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tvar len = keys.length;\n\t\t\t\t\tfor (var i = 0; i < len; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (possible[keys[i]])\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\treturn origHandler.apply(this, arguments);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =storage\n\t\tstorage: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tdata: [],\n\t\t\t\tadd: function(data)\n\t\t\t\t{\n\t\t\t\t\t// type, node, url, id\n\t\t\t\t\tdata.status = true;\n\t\t\t\t\tdata.url = decodeURI(data.url);\n\n\t\t\t\t\tthis.storage.data[data.url] = data;\n\t\t\t\t},\n\t\t\t\tstatus: function(url, status)\n\t\t\t\t{\n\t\t\t\t\tthis.storage.data[decodeURI(url)].status = status;\n\t\t\t\t},\n\t\t\t\tobserve: function()\n\t\t\t\t{\n\t\t\t\t\tvar _this = this;\n\n\t\t\t\t\tvar $images = this.core.editor().find('[data-image]');\n\t\t\t\t\t$images.each(function(i, s)\n\t\t\t\t\t{\n\t\t\t\t\t\t_this.storage.add({ type: 'image', node: s, url: s.src, id: $(s).attr('data-image') });\n\t\t\t\t\t});\n\n\t\t\t\t\tvar $files = this.core.editor().find('[data-file]');\n\t\t\t\t\t$files.each(function(i, s)\n\t\t\t\t\t{\n\t\t\t\t\t\t_this.storage.add({ type: 'file', node: s, url: s.href, id: $(s).attr('data-file') });\n\t\t\t\t\t});\n\n\t\t\t\t\tvar $s3 = this.core.editor().find('[data-s3]');\n\t\t\t\t\t$s3.each(function(i, s)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar url = (s.tagName === 'IMG') ? s.src : s.href;\n\t\t\t\t\t\t_this.storage.add({ type: 's3', node: s, url: url, id: $(s).attr('data-s3') });\n\t\t\t\t\t});\n\n\t\t\t\t},\n\t\t\t\tchanges: function()\n\t\t\t\t{\n\t\t\t\t\tfor (var key in this.storage.data)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar data = this.storage.data[key];\n\t\t\t\t\t\tvar attr = (data.node.tagName === 'IMG') ? 'src' : 'href';\n\t\t\t\t\t\tvar $el = this.core.editor().find('[data-' + data.type + '][' + attr + '=\"' + data.url + '\"]');\n\n\t\t\t\t\t\tif ($el.length === 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.storage.status(data.url, false);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.storage.status(data.url, true);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\n\t\t\t\t\treturn this.storage.data;\n\t\t\t\t}\n\n\t\t\t};\n\t\t},\n\n\t\t// =toolbar\n\t\ttoolbar: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tbuild: function()\n\t\t\t\t{\n\t\t\t\t\tthis.button.hideButtons();\n\t\t\t\t\tthis.button.hideButtonsOnMobile();\n\n                    this.$toolbarBox = $('<div />').addClass('redactor-toolbar-box');\n\t\t\t\t\tthis.$toolbar = this.toolbar.createContainer();\n\t\t\t\t\tthis.$toolbarBox.append(this.$toolbar);\n\n\t\t\t\t\tthis.toolbar.append();\n\t\t\t\t\tthis.button.$toolbar = this.$toolbar;\n\t\t\t\t\tthis.button.setFormatting();\n\t\t\t\t\tthis.button.load(this.$toolbar);\n\n\t\t\t\t\tthis.toolbar.setOverflow();\n\t\t\t\t\tthis.toolbar.setFixed();\n\n\t\t\t\t},\n\t\t\t\tcreateContainer: function()\n\t\t\t\t{\n\t\t\t\t\treturn $('<ul>').addClass('redactor-toolbar').attr({ 'id': 'redactor-toolbar-' + this.uuid, 'role': 'toolbar' });\n\t\t\t\t},\n\t\t\t\tappend: function()\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.toolbarExternal)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$toolbar.addClass('redactor-toolbar-external');\n\t\t\t\t\t\t$(this.opts.toolbarExternal).html(this.$toolbarBox);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.opts.type === 'textarea')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.$box.prepend(this.$toolbarBox);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.$element.before(this.$toolbarBox);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tsetOverflow: function()\n\t\t\t\t{\n    \t\t\t\tif (this.opts.toolbarOverflow)\n\t\t\t\t\t{\n    \t\t\t\t\tthis.$toolbar.addClass('redactor-toolbar-overflow');\n    \t\t\t\t}\n\t\t\t\t},\n\t\t\t\tsetFixed: function()\n\t\t\t\t{\n\t\t\t\t\tif (!this.opts.toolbarFixed || this.opts.toolbarExternal)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.opts.toolbarFixedTarget !== document)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar $el = $(this.opts.toolbarFixedTarget);\n\t\t\t\t\t\tthis.toolbar.toolbarOffsetTop = ($el.length === 0) ? 0 : this.core.box().offset().top - $el.offset().top;\n\t\t\t\t\t}\n\n\t\t\t\t\t// bootstrap modal fix\n\t\t\t\t\tvar late = (this.core.box().closest('.modal-body').length !== 0) ? 1000 : 0;\n\n\t\t\t\t\tsetTimeout($.proxy(function()\n\t\t\t\t\t{\n    \t\t\t\t\tvar self = this;\n\t\t\t\t\t\tthis.toolbar.observeScroll(false);\n\t\t\t\t\t\tif (this.detect.isDesktop())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$(this.opts.toolbarFixedTarget).on('scroll.redactor.' + this.uuid, function()\n\t\t\t\t\t\t\t{\n                                if (self.core.editor().height() < 100 || self.placeholder.isEditorEmpty())\n            \t\t\t\t\t{\n                \t\t\t\t\treturn;\n            \t\t\t\t\t}\n\n    \t\t\t\t\t\t\tself.toolbar.observeScroll();\n                            });\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$(this.opts.toolbarFixedTarget).on('scroll.redactor.' + this.uuid, function()\n\t\t\t\t\t\t\t{\n                                if (self.core.editor().height() < 100 || self.placeholder.isEditorEmpty())\n            \t\t\t\t\t{\n                \t\t\t\t\treturn;\n            \t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tself.core.toolbar().hide();\n\t\t\t\t\t\t\t\tclearTimeout($.data(this, \"scrollCheck\"));\n\t\t\t\t\t\t\t\t$.data(this, \"scrollCheck\", setTimeout(function()\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tself.core.toolbar().show();\n\t\t\t\t\t\t\t\t\tself.toolbar.observeScroll();\n\t\t\t\t\t\t\t\t}, 250) );\n\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}, this), late);\n\n\t\t\t\t},\n\t\t\t\tsetUnfixed: function()\n\t\t\t\t{\n    \t\t\t\tthis.toolbar.observeScrollDisable();\n\t\t\t\t},\n\t\t\t\tgetBoxTop: function()\n\t\t\t\t{\n\t\t\t\t\treturn (this.opts.toolbarFixedTarget === document) ? this.core.box().offset().top : this.toolbar.toolbarOffsetTop;\n\t\t\t\t},\n\t\t\t\tobserveScroll: function(start)\n\t\t\t\t{\n\t\t\t\t\t// tolerance 0 if redactor in the hidden layer\n\t\t\t\t\tvar tolerance = 0;\n\n\t\t\t\t\tif (start !== false)\n\t\t\t\t\t{\n\t\t\t\t\t\ttolerance = (this.opts.toolbarFixedTarget === document) ? 20 : 0;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar scrollTop = $(this.opts.toolbarFixedTarget).scrollTop();\n\t\t\t\t\tvar boxTop = this.toolbar.getBoxTop();\n\n                    if (scrollTop === boxTop)\n                    {\n                        return;\n                    }\n\n\t\t\t\t\tif ((scrollTop + this.opts.toolbarFixedTopOffset + tolerance) > boxTop)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.toolbar.observeScrollEnable(scrollTop, boxTop);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.toolbar.observeScrollDisable();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tobserveScrollResize: function()\n\t\t\t\t{\n\t\t\t\t\tthis.$toolbar.css({\n\n\t\t\t\t\t\twidth: this.core.box().innerWidth(),\n\t\t\t\t\t\tleft: this.core.box().offset().left\n\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tobserveScrollEnable: function(scrollTop, boxTop)\n\t\t\t\t{\n\t\t\t\t\tif (typeof this.fullscreen !== 'undefined' && this.fullscreen.isOpened === false)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.toolbar.observeScrollDisable();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar end = boxTop + this.core.box().outerHeight() - 32;\n\t\t\t\t\tvar width = this.core.box().innerWidth();\n\n\t\t\t\t\tvar position = (this.detect.isDesktop()) ? 'fixed' : 'absolute';\n\t\t\t\t\tvar top = (this.detect.isDesktop()) ? this.opts.toolbarFixedTopOffset : ($(this.opts.toolbarFixedTarget).scrollTop() - boxTop + this.opts.toolbarFixedTopOffset);\n\t\t\t\t\tvar left = (this.detect.isDesktop()) ? this.core.box().offset().left : 0;\n\n\n\t\t\t\t\tif (this.opts.toolbarFixedTarget !== document)\n\t\t\t\t\t{\n\t\t\t\t\t\t position = 'absolute';\n\t\t\t\t\t\t top = this.opts.toolbarFixedTopOffset + $(this.opts.toolbarFixedTarget).scrollTop() - boxTop;\n\t\t\t\t\t\t left = 0;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.$toolbar.addClass('toolbar-fixed-box');\n\n\t\t\t\t\tthis.$toolbar.css({\n\t\t\t\t\t\tposition: position,\n\t\t\t\t\t\twidth: width,\n\t\t\t\t\t\ttop: top,\n\t\t\t\t\t\tleft: left\n\t\t\t\t\t});\n\n\n\t\t\t\t\tif (scrollTop > end)\n\t\t\t\t\t{\n\t\t\t\t\t\t$('.redactor-dropdown-' + this.uuid + ':visible').hide();\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.toolbar.setDropdownsFixed();\n\n\t\t\t\t\tthis.$toolbar.css('visibility', (scrollTop < end) ? 'visible' : 'hidden');\n\t\t\t\t\t$(window).on('resize.redactor-toolbar.' + this.uuid, $.proxy(this.toolbar.observeScrollResize, this));\n\t\t\t\t},\n\t\t\t\tobserveScrollDisable: function()\n\t\t\t\t{\n\t\t\t\t\tthis.$toolbar.css({\n\t\t\t\t\t\tposition: 'relative',\n\t\t\t\t\t\twidth: 'auto',\n\t\t\t\t\t\ttop: 0,\n\t\t\t\t\t\tleft: 0,\n\t\t\t\t\t\tvisibility: 'visible'\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.toolbar.unsetDropdownsFixed();\n\t\t\t\t\tthis.$toolbar.removeClass('toolbar-fixed-box');\n\t\t\t\t\t$(window).off('resize.redactor-toolbar.' + this.uuid);\n\t\t\t\t},\n\t\t\t\tsetDropdownsFixed: function()\n\t\t\t\t{\n\t\t\t\t\tvar position = (this.opts.toolbarFixedTarget === document && this.detect.isDesktop()) ? 'fixed' : 'absolute';\n\t\t\t\t\tthis.toolbar.setDropdownPosition(position);\n\t\t\t\t},\n\t\t\t\tunsetDropdownsFixed: function()\n\t\t\t\t{\n\t\t\t\t\tthis.toolbar.setDropdownPosition('absolute');\n\t\t\t\t},\n\t\t\t\tsetDropdownPosition: function(position)\n\t\t\t\t{\n\t\t\t\t\tvar self = this;\n\t\t\t\t\t$('.redactor-dropdown-' + this.uuid).each(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tvar $el = $(this);\n\t\t\t\t\t\tvar $button = self.button.get($el.attr('rel'));\n\t\t\t\t\t\tvar top = (position === 'fixed') ? self.opts.toolbarFixedTopOffset : $button.offset().top;\n\n\t\t\t\t\t\t$el.css({ position: position, top: ($button.innerHeight() + top) + 'px' });\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =upload\n\t\tupload: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tinit: function(id, url, callback)\n\t\t\t\t{\n\t\t\t\t\tthis.upload.direct = false;\n\t\t\t\t\tthis.upload.callback = callback;\n\t\t\t\t\tthis.upload.url = url;\n\t\t\t\t\tthis.upload.$el = $(id);\n\t\t\t\t\tthis.upload.$droparea = $('<div id=\"redactor-droparea\" />');\n\n\t\t\t\t\tthis.upload.$placeholdler = $('<div id=\"redactor-droparea-placeholder\" />').text(this.lang.get('upload-label'));\n\t\t\t\t\tthis.upload.$input = $('<input type=\"file\" name=\"file\" multiple />');\n\n\t\t\t\t\tthis.upload.$placeholdler.append(this.upload.$input);\n\t\t\t\t\tthis.upload.$droparea.append(this.upload.$placeholdler);\n\t\t\t\t\tthis.upload.$el.append(this.upload.$droparea);\n\n\t\t\t\t\tthis.upload.$droparea.off('redactor.upload');\n\t\t\t\t\tthis.upload.$input.off('redactor.upload');\n\n\t\t\t\t\tthis.upload.$droparea.on('dragover.redactor.upload', $.proxy(this.upload.onDrag, this));\n\t\t\t\t\tthis.upload.$droparea.on('dragleave.redactor.upload', $.proxy(this.upload.onDragLeave, this));\n\n\t\t\t\t\t// change\n\t\t\t\t\tthis.upload.$input.on('change.redactor.upload', $.proxy(function(e)\n\t\t\t\t\t{\n                        e = e.originalEvent || e;\n                        var len = this.upload.$input[0].files.length;\n\n                        for (var i = 0; i < len; i++)\n                        {\n                            var index = (len - 1) - i;\n                            this.upload.traverseFile(this.upload.$input[0].files[index], e);\n                        }\n\t\t\t\t\t}, this));\n\n\t\t\t\t\t// drop\n\t\t\t\t\tthis.upload.$droparea.on('drop.redactor.upload', $.proxy(function(e)\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\tthis.upload.$droparea.removeClass('drag-hover').addClass('drag-drop');\n\t\t\t\t\t\tthis.upload.onDrop(e);\n\n\t\t\t\t\t}, this));\n\t\t\t\t},\n\t\t\t\tdirectUpload: function(file, e)\n\t\t\t\t{\n\t\t\t\t\tthis.upload.direct = true;\n\t\t\t\t\tthis.upload.traverseFile(file, e);\n\t\t\t\t},\n\t\t\t\tonDrop: function(e)\n\t\t\t\t{\n\t\t\t\t\te = e.originalEvent || e;\n\t\t\t\t\tvar files = e.dataTransfer.files;\n\n\t\t\t\t\tif (this.opts.multipleImageUpload)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar len = files.length;\n\t\t\t\t\t\tfor (var i = 0; i < len; i++)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.upload.traverseFile(files[i], e);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.upload.traverseFile(files[0], e);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\ttraverseFile: function(file, e)\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.s3)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.upload.setConfig(file);\n\t\t\t\t\t\tthis.uploads3.send(file, e);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar formData = !!window.FormData ? new FormData() : null;\n\t\t\t\t\tif (window.FormData)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.upload.setConfig(file);\n\n\t\t\t\t\t\tvar name = (this.upload.type === 'image') ? this.opts.imageUploadParam : this.opts.fileUploadParam;\n\t\t\t\t\t\tformData.append(name, file);\n\t\t\t\t\t}\n\n\t\t\t\t\tvar stop = this.core.callback('uploadStart', e, formData);\n\t\t\t\t\tif (stop !== false)\n\t\t\t\t\t{\n    \t\t\t\t\tthis.progress.show();\n\t\t\t\t    \tthis.upload.send(formData, e);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tsetConfig: function(file)\n\t\t\t\t{\n\t\t\t\t\tthis.upload.getType(file);\n\n\t\t\t\t\tif (this.upload.direct)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.upload.url = (this.upload.type === 'image') ? this.opts.imageUpload : this.opts.fileUpload;\n\t\t\t\t\t\tthis.upload.callback = (this.upload.type === 'image') ? this.image.insert : this.file.insert;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tgetType: function(file)\n\t\t\t\t{\n\t\t\t\t\tthis.upload.type = (this.opts.imageTypes.indexOf(file.type) === -1) ? 'file' : 'image';\n\n\t\t\t\t\tif (this.opts.imageUpload === null && this.opts.fileUpload !== null)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.upload.type = 'file';\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tgetHiddenFields: function(obj, fd)\n\t\t\t\t{\n\t\t\t\t\tif (obj === false || typeof obj !== 'object')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn fd;\n\t\t\t\t\t}\n\n\t\t\t\t\t$.each(obj, $.proxy(function(k, v)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (v !== null && v.toString().indexOf('#') === 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tv = $(v).val();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tfd.append(k, v);\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t\treturn fd;\n\n\t\t\t\t},\n\t\t\t\tsend: function(formData, e)\n\t\t\t\t{\n\t\t\t\t\t// append hidden fields\n\t\t\t\t\tif (this.upload.type === 'image')\n\t\t\t\t\t{\n\t\t\t\t\t\tformData = this.utils.appendFields(this.opts.imageUploadFields, formData);\n\t\t\t\t\t\tformData = this.utils.appendForms(this.opts.imageUploadForms, formData);\n\t\t\t\t\t\tformData = this.upload.getHiddenFields(this.upload.imageFields, formData);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tformData = this.utils.appendFields(this.opts.fileUploadFields, formData);\n\t\t\t\t\t\tformData = this.utils.appendForms(this.opts.fileUploadForms, formData);\n\t\t\t\t\t\tformData = this.upload.getHiddenFields(this.upload.fileFields, formData);\n\t\t\t\t\t}\n\n\t\t\t\t\tvar xhr = new XMLHttpRequest();\n\t\t\t\t\txhr.open('POST', this.upload.url);\n\t\t\t\t\txhr.setRequestHeader(\"X-Requested-With\", \"XMLHttpRequest\");\n\n\t\t\t\t\t// complete\n\t\t\t\t\txhr.onreadystatechange = $.proxy(function()\n\t\t\t\t\t{\n\t\t\t\t\t    if (xhr.readyState === 4)\n\t\t\t\t\t    {\n\t\t\t\t\t        var data = xhr.responseText;\n\n\t\t\t\t\t\t\tdata = data.replace(/^\\[/, '');\n\t\t\t\t\t\t\tdata = data.replace(/\\]$/, '');\n\n\t\t\t\t\t\t\tvar json;\n\t\t\t\t\t\t\ttry\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tjson = (typeof data === 'string' ? JSON.parse(data) : data);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tcatch(err)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tjson = { error: true };\n\t\t\t\t\t\t\t}\n\n\n\t\t\t\t\t\t\tthis.progress.hide();\n\n\t\t\t\t\t\t\tif (!this.upload.direct)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.upload.$droparea.removeClass('drag-drop');\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tthis.upload.callback(json, this.upload.direct, e);\n\t\t\t\t\t    }\n\t\t\t\t\t}, this);\n\n                    // before send\n                    var stop = this.core.callback('uploadBeforeSend', xhr);\n                    if (stop !== false)\n                    {\n                        xhr.send(formData);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tonDrag: function(e)\n\t\t\t\t{\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tthis.upload.$droparea.addClass('drag-hover');\n\t\t\t\t},\n\t\t\t\tonDragLeave: function(e)\n\t\t\t\t{\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tthis.upload.$droparea.removeClass('drag-hover');\n\t\t\t\t},\n\t\t\t\tclearImageFields: function()\n\t\t\t\t{\n\t\t\t\t\tthis.upload.imageFields = {};\n\t\t\t\t},\n\t\t\t\taddImageFields: function(name, value)\n\t\t\t\t{\n\t\t\t\t\tthis.upload.imageFields[name] = value;\n\t\t\t\t},\n\t\t\t\tremoveImageFields: function(name)\n\t\t\t\t{\n\t\t\t\t\tdelete this.upload.imageFields[name];\n\t\t\t\t},\n\t\t\t\tclearFileFields: function()\n\t\t\t\t{\n\t\t\t\t\tthis.upload.fileFields = {};\n\t\t\t\t},\n\t\t\t\taddFileFields: function(name, value)\n\t\t\t\t{\n\t\t\t\t\tthis.upload.fileFields[name] = value;\n\t\t\t\t},\n\t\t\t\tremoveFileFields: function(name)\n\t\t\t\t{\n\t\t\t\t\tdelete this.upload.fileFields[name];\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =s3\n\t\tuploads3: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tsend: function(file, e)\n\t\t\t\t{\n\t\t\t\t\tthis.uploads3.executeOnSignedUrl(file, $.proxy(function(signedURL)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.uploads3.sendToS3(file, signedURL, e);\n\t\t\t\t\t}, this));\n\t\t\t\t},\n\t\t\t\texecuteOnSignedUrl: function(file, callback)\n\t\t\t\t{\n\t\t\t\t\tvar xhr = new XMLHttpRequest();\n\t\t\t\t\tvar mark = (this.opts.s3.search(/\\?/) === -1) ? '?' : '&';\n\n\t\t\t\t\txhr.open('GET', this.opts.s3 + mark + 'name=' + file.name + '&type=' + file.type, true);\n\n\t\t\t\t\t// hack to pass bytes through unprocessed.\n\t\t\t\t\tif (xhr.overrideMimeType)\n\t\t\t\t\t{\n\t\t\t\t\t\txhr.overrideMimeType('text/plain; charset=x-user-defined');\n\t\t\t\t\t}\n\n\t\t\t\t\tvar that = this;\n\t\t\t\t\txhr.onreadystatechange = function(e)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.readyState === 4 && this.status === 200)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthat.progress.show();\n\t\t\t\t\t\t\tcallback(decodeURIComponent(this.responseText));\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\t\txhr.send();\n\t\t\t\t},\n\t\t\t\tcreateCORSRequest: function(method, url)\n\t\t\t\t{\n\t\t\t\t\tvar xhr = new XMLHttpRequest();\n\t\t\t\t\tif (\"withCredentials\" in xhr)\n\t\t\t\t\t{\n\t\t\t\t\t\txhr.open(method, url, true);\n\t\t\t\t\t}\n\t\t\t\t\telse if (typeof XDomainRequest !== \"undefined\")\n\t\t\t\t\t{\n\t\t\t\t\t\txhr = new XDomainRequest();\n\t\t\t\t\t\txhr.open(method, url);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\txhr = null;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn xhr;\n\t\t\t\t},\n\n                sendToS3: function(file, url, e)\n                {\n                    var xhr = this.uploads3.createCORSRequest('PUT', url);\n                    if (!xhr)\n                    {\n                        return;\n                    }\n\n                    xhr.onload = $.proxy(function()\n                    {\n                        var json;\n                        this.progress.hide();\n\n                        if (xhr.status !== 200)\n                        {\n                            // error\n                            json = { error: true };\n                            this.upload.callback(json, this.upload.direct, xhr);\n\n                            return;\n                        }\n\n                        var s3file = url.split('?');\n                        if (!s3file[0])\n                        {\n                            // url parsing is fail\n                            return false;\n                        }\n\n\n                        if (!this.upload.direct)\n                        {\n                            this.upload.$droparea.removeClass('drag-drop');\n                        }\n\n                        json = { url: s3file[0], id: s3file[0], s3: true };\n                        if (this.upload.type === 'file')\n                        {\n                            var arr = s3file[0].split('/');\n                            json.name = arr[arr.length-1];\n                        }\n\n                        this.upload.callback(json, this.upload.direct, e);\n\n\n                    }, this);\n\n                    xhr.onerror = function() {};\n                    xhr.upload.onprogress = function(e) {};\n\n                    xhr.setRequestHeader('Content-Type', file.type);\n                    xhr.setRequestHeader('x-amz-acl', 'public-read');\n\n                    xhr.send(file);\n\n                }\n\t\t\t};\n\t\t},\n\n\t\t// =utils\n\t\tutils: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tisEmpty: function(html)\n\t\t\t\t{\n\t\t\t\t\thtml = (typeof html === 'undefined') ? this.core.editor().html() : html;\n\n\t\t\t\t\thtml = html.replace(/[\\u200B-\\u200D\\uFEFF]/g, '');\n\t\t\t\t\thtml = html.replace(/&nbsp;/gi, '');\n\t\t\t\t\thtml = html.replace(/<\\/?br\\s?\\/?>/g, '');\n\t\t\t\t\thtml = html.replace(/\\s/g, '');\n\t\t\t\t\thtml = html.replace(/^<p>[^\\W\\w\\D\\d]*?<\\/p>$/i, '');\n\t\t\t\t\thtml = html.replace(/<iframe(.*?[^>])>$/i, 'iframe');\n\t\t\t\t\thtml = html.replace(/<source(.*?[^>])>$/i, 'source');\n\n\t\t\t\t\t// remove empty tags\n\t\t\t\t\thtml = html.replace(/<[^\\/>][^>]*><\\/[^>]+>/gi, '');\n\t\t\t\t\thtml = html.replace(/<[^\\/>][^>]*><\\/[^>]+>/gi, '');\n\n\t\t\t\t\thtml = $.trim(html);\n\n\t\t\t\t\treturn html === '';\n\t\t\t\t},\n\t\t\t\tisElement: function(obj)\n\t\t\t\t{\n\t\t\t\t\ttry {\n\t\t\t\t\t\t// Using W3 DOM2 (works for FF, Opera and Chrome)\n\t\t\t\t\t\treturn obj instanceof HTMLElement;\n\t\t\t\t\t}\n\t\t\t\t\tcatch(e)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn (typeof obj === \"object\") && (obj.nodeType === 1) && (typeof obj.style === \"object\") && (typeof obj.ownerDocument === \"object\");\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tstrpos: function(haystack, needle, offset)\n\t\t\t\t{\n\t\t\t\t\tvar i = haystack.indexOf(needle, offset);\n\t\t\t\t\treturn i >= 0 ? i : false;\n\t\t\t\t},\n\t\t\t\tdataURItoBlob: function(dataURI)\n\t\t\t\t{\n\t\t\t\t\tvar byteString;\n\t\t\t\t\tif (dataURI.split(',')[0].indexOf('base64') >= 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tbyteString = atob(dataURI.split(',')[1]);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tbyteString = unescape(dataURI.split(',')[1]);\n\t\t\t\t\t}\n\n\t\t\t\t\tvar mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];\n\n\t\t\t\t\tvar ia = new Uint8Array(byteString.length);\n\t\t\t\t\tfor (var i = 0; i < byteString.length; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\tia[i] = byteString.charCodeAt(i);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn new Blob([ia], { type:mimeString });\n\t\t\t\t},\n\t\t\t\tgetOuterHtml: function(el)\n\t\t\t\t{\n\t\t\t\t\treturn $('<div>').append($(el).eq(0).clone()).html();\n\t\t\t\t},\n\t\t\t\tcloneAttributes: function(from, to)\n\t\t\t\t{\n\t\t\t\t\tfrom = from[0] || from;\n\t\t\t\t\tto = $(to);\n\n\t\t\t\t\tvar attrs = from.attributes;\n\t\t\t\t\tvar len = attrs.length;\n\t\t\t\t\twhile (len--)\n\t\t\t\t\t{\n\t\t\t\t\t    var attr = attrs[len];\n\t\t\t\t\t    to.attr(attr.name, attr.value);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn to;\n\t\t\t\t},\n\t\t\t\tbreakBlockTag: function()\n\t\t\t\t{\n\t\t\t\t\tvar block = this.selection.block();\n\t\t\t\t\tif (!block)\n\t\t\t\t\t{\n    \t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar isEmpty = this.utils.isEmpty(block.innerHTML);\n\n\t\t\t\t\tvar tag = block.tagName.toLowerCase();\n\t\t\t\t\tif (tag === 'pre' || tag === 'li' || tag === 'td' || tag === 'th')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!isEmpty && this.utils.isStartOfElement(block))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn { $block: $(block), $next: $(block).next(), type: 'start' };\n\t\t\t\t\t}\n\t\t\t\t\telse if (!isEmpty && this.utils.isEndOfElement(block))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn { $block: $(block), $next: $(block).next(), type: 'end' };\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tvar endOfNode = this.selection.extractEndOfNode(block);\n\t\t\t\t\t\tvar $nextPart = $('<' + tag + ' />').append(endOfNode);\n\n\t\t\t\t\t\t$nextPart = this.utils.cloneAttributes(block, $nextPart);\n\t\t\t\t\t\t$(block).after($nextPart);\n\n\t\t\t\t\t\treturn { $block: $(block), $next: $nextPart, type: 'break' };\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t// tag detection\n\t\t\t\tinBlocks: function(tags)\n\t\t\t\t{\n\t\t\t\t\ttags = ($.isArray(tags)) ? tags : [tags];\n\n\t\t\t\t\tvar blocks = this.selection.blocks();\n\t\t\t\t\tvar len = blocks.length;\n\t\t\t\t\tvar contains = false;\n\t\t\t\t\tfor (var i = 0; i < len; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (blocks[i] !== false)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar tag = blocks[i].tagName.toLowerCase();\n\n\t\t\t\t\t\t\tif ($.inArray(tag, tags) !== -1)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tcontains = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn contains;\n\n\t\t\t\t},\n\t\t\t\tinInlines: function(tags)\n\t\t\t\t{\n\t\t\t\t\ttags = ($.isArray(tags)) ? tags : [tags];\n\n\t\t\t\t\tvar inlines = this.selection.inlines();\n\t\t\t\t\tvar len = inlines.length;\n\t\t\t\t\tvar contains = false;\n\t\t\t\t\tfor (var i = 0; i < len; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar tag = inlines[i].tagName.toLowerCase();\n\n\t\t\t\t\t\tif ($.inArray(tag, tags) !== -1)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcontains = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn contains;\n\n\t\t\t\t},\n\t\t\t\tisTag: function(current, tag)\n\t\t\t\t{\n\t\t\t\t\tvar element = $(current).closest(tag, this.core.editor()[0]);\n\t\t\t\t\tif (element.length === 1)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn element[0];\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\t\t\t\tisBlock: function(block)\n\t\t\t\t{\n\t\t\t\t\tif (block === null)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tblock = block[0] || block;\n\n\t\t\t\t\treturn block && this.utils.isBlockTag(block.tagName);\n\t\t\t\t},\n\t\t\t\tisBlockTag: function(tag)\n\t\t\t\t{\n\t\t\t\t\treturn (typeof tag === 'undefined') ? false : this.reIsBlock.test(tag);\n\t\t\t\t},\n\t\t\t\tisInline: function(inline)\n\t\t\t\t{\n\t\t\t\t\tinline = inline[0] || inline;\n\n\t\t\t\t\treturn inline && this.utils.isInlineTag(inline.tagName);\n\t\t\t\t},\n\t\t\t\tisInlineTag: function(tag)\n\t\t\t\t{\n\t\t\t\t\treturn (typeof tag === 'undefined') ? false : this.reIsInline.test(tag);\n\t\t\t\t},\n\t\t\t\t// parents detection\n\t\t\t\tisRedactorParent: function(el)\n\t\t\t\t{\n\t\t\t\t\tif (!el)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ($(el).parents('.redactor-in').length === 0 || $(el).hasClass('redactor-in'))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn el;\n\t\t\t\t},\n\t\t\t\tisCurrentOrParentHeader: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.utils.isCurrentOrParent(['H1', 'H2', 'H3', 'H4', 'H5', 'H6']);\n\t\t\t\t},\n\t\t\t\tisCurrentOrParent: function(tagName)\n\t\t\t\t{\n\t\t\t\t\tvar parent = this.selection.parent();\n\t\t\t\t\tvar current = this.selection.current();\n\n\t\t\t\t\tif ($.isArray(tagName))\n\t\t\t\t\t{\n\t\t\t\t\t\tvar matched = 0;\n\t\t\t\t\t\t$.each(tagName, $.proxy(function(i, s)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (this.utils.isCurrentOrParentOne(current, parent, s))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tmatched++;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, this));\n\n\t\t\t\t\t\treturn (matched === 0) ? false : true;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\treturn this.utils.isCurrentOrParentOne(current, parent, tagName);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tisCurrentOrParentOne: function(current, parent, tagName)\n\t\t\t\t{\n\t\t\t\t\ttagName = tagName.toUpperCase();\n\n\t\t\t\t\treturn parent && parent.tagName === tagName ? parent : current && current.tagName === tagName ? current : false;\n\t\t\t\t},\n\t\t\t\tisEditorRelative: function()\n\t\t\t\t{\n\t\t\t\t\tvar position = this.core.editor().css('position');\n\t\t\t\t\tvar arr = ['absolute', 'fixed', 'relative'];\n\n\t\t\t\t\treturn ($.inArray(arr, position) !== -1);\n\t\t\t\t},\n\t\t\t\tsetEditorRelative: function()\n\t\t\t\t{\n\t\t\t\t\tthis.core.editor().addClass('redactor-relative');\n\t\t\t\t},\n\t\t\t\t// scroll\n\t\t\t\tgetScrollTarget: function()\n\t\t\t\t{\n    \t\t\t\tvar $scrollTarget = $(this.opts.scrollTarget);\n\n    \t\t\t\treturn ($scrollTarget.length !== 0) ? $scrollTarget : $(document);\n\t\t\t\t},\n\t\t\t\tfreezeScroll: function()\n\t\t\t\t{\n\t\t\t\t\tthis.freezeScrollTop = this.utils.getScrollTarget().scrollTop();\n\t\t\t\t\tthis.utils.getScrollTarget().scrollTop(this.freezeScrollTop);\n\t\t\t\t},\n\t\t\t\tunfreezeScroll: function()\n\t\t\t\t{\n\t\t\t\t\tif (typeof this.freezeScrollTop === 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.utils.getScrollTarget().scrollTop(this.freezeScrollTop);\n\t\t\t\t},\n\t\t\t\tsaveScroll: function()\n\t\t\t\t{\n\t\t\t\t\tthis.tmpScrollTop = this.utils.getScrollTarget().scrollTop();\n\t\t\t\t},\n\t\t\t\trestoreScroll: function()\n\t\t\t\t{\n\t\t\t\t\tif (typeof this.tmpScrollTop === 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.utils.getScrollTarget().scrollTop(this.tmpScrollTop);\n\t\t\t\t},\n\t\t\t\tisStartOfElement: function(element)\n\t\t\t\t{\n\t\t\t\t\tif (typeof element === 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\telement = this.selection.block();\n\t\t\t\t\t\tif (!element)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn (this.offset.get(element) === 0) ? true : false;\n\t\t\t\t},\n\t\t\t\tisEndOfElement: function(element)\n\t\t\t\t{\n\t\t\t\t\tif (typeof element === 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\telement = this.selection.block();\n\t\t\t\t\t\tif (!element)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tvar text = $.trim($(element).text()).replace(/[\\t\\n\\r\\n]/g, '').replace(/\\u200B/g, '');\n\t\t\t\t\tvar offset = this.offset.get(element);\n\n\t\t\t\t\treturn (offset === text.length) ? true : false;\n\t\t\t\t},\n\t\t\t\tremoveEmptyAttr: function(el, attr)\n\t\t\t\t{\n\t\t\t\t\tvar $el = $(el);\n\t\t\t\t\tif (typeof $el.attr(attr) === 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ($el.attr(attr) === '')\n\t\t\t\t\t{\n\t\t\t\t\t\t$el.removeAttr(attr);\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\t\t\t\treplaceToTag: function(node, tag)\n\t\t\t\t{\n\t\t\t\t\tvar replacement;\n\t\t\t\t\t$(node).replaceWith(function()\n\t\t\t\t\t{\n\t\t\t\t\t\treplacement = $('<' + tag + ' />').append($(this).contents());\n\n\t\t\t\t\t\tfor (var i = 0; i < this.attributes.length; i++)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treplacement.attr(this.attributes[i].name, this.attributes[i].value);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn replacement;\n\t\t\t\t\t});\n\n\t\t\t\t\treturn replacement;\n\t\t\t\t},\n\t\t\t\t// select all\n\t\t\t\tisSelectAll: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.selectAll;\n\t\t\t\t},\n\t\t\t\tenableSelectAll: function()\n\t\t\t\t{\n\t\t\t\t\tthis.selectAll = true;\n\t\t\t\t},\n\t\t\t\tdisableSelectAll: function()\n\t\t\t\t{\n\t\t\t\t\tthis.selectAll = false;\n\t\t\t\t},\n\t\t\t\tdisableBodyScroll: function()\n\t\t\t\t{\n\t\t\t\t\tvar $body = $('html');\n\t\t\t\t\tvar windowWidth = window.innerWidth;\n\t\t\t\t\tif (!windowWidth)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar documentElementRect = document.documentElement.getBoundingClientRect();\n\t\t\t\t\t\twindowWidth = documentElementRect.right - Math.abs(documentElementRect.left);\n\t\t\t\t\t}\n\n\t\t\t\t\tvar isOverflowing = document.body.clientWidth < windowWidth;\n\t\t\t\t\tvar scrollbarWidth = this.utils.measureScrollbar();\n\n\t\t\t\t\t$body.css('overflow', 'hidden');\n\t\t\t\t\tif (isOverflowing)\n\t\t\t\t\t{\n\t\t\t\t\t\t$body.css('padding-right', scrollbarWidth);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tmeasureScrollbar: function()\n\t\t\t\t{\n\t\t\t\t\tvar $body = $('body');\n\t\t\t\t\tvar scrollDiv = document.createElement('div');\n\t\t\t\t\tscrollDiv.className = 'redactor-scrollbar-measure';\n\n\t\t\t\t\t$body.append(scrollDiv);\n\t\t\t\t\tvar scrollbarWidth = scrollDiv.offsetWidth - scrollDiv.clientWidth;\n\t\t\t\t\t$body[0].removeChild(scrollDiv);\n\t\t\t\t\treturn scrollbarWidth;\n\t\t\t\t},\n\t\t\t\tenableBodyScroll: function()\n\t\t\t\t{\n\t\t\t\t\t$('html').css({ 'overflow': '', 'padding-right': '' });\n\t\t\t\t\t$('body').remove('redactor-scrollbar-measure');\n\t\t\t\t},\n\t\t\t\tappendFields: function(appendFields, data)\n\t\t\t\t{\n\t\t\t\t\tif (!appendFields)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn data;\n\t\t\t\t\t}\n\t\t\t\t\telse if (typeof appendFields === 'object')\n\t\t\t\t\t{\n    \t\t\t\t\t$.each(appendFields, function(k, v)\n    \t\t\t\t\t{\n    \t\t\t\t\t\tif (v !== null && v.toString().indexOf('#') === 0)\n    \t\t\t\t\t\t{\n        \t\t\t\t\t\tv = $(v).val();\n                            }\n\n    \t\t\t\t\t\tdata.append(k, v);\n\n    \t\t\t\t\t});\n\n    \t\t\t\t\treturn data;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar $fields = $(appendFields);\n\t\t\t\t\tif ($fields.length === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn data;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tvar str = '';\n\t\t\t\t\t\t$fields.each(function()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdata.append($(this).attr('name'), $(this).val());\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn data;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tappendForms: function(appendForms, data)\n\t\t\t\t{\n\t\t\t\t\tif (!appendForms)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn data;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar $forms = $(appendForms);\n\t\t\t\t\tif ($forms.length === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn data;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tvar formData = $forms.serializeArray();\n\n\t\t\t\t\t\t$.each(formData, function(z,f)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdata.append(f.name, f.value);\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn data;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tisRgb: function(str)\n\t\t\t\t{\n                    return (str.search(/^rgb/i) === 0);\n\t\t\t\t},\n\t\t\t\trgb2hex: function(rgb)\n\t\t\t\t{\n                    rgb = rgb.match(/^rgba?[\\s+]?\\([\\s+]?(\\d+)[\\s+]?,[\\s+]?(\\d+)[\\s+]?,[\\s+]?(\\d+)[\\s+]?/i);\n\n                    return (rgb && rgb.length === 4) ? \"#\" +\n                    (\"0\" + parseInt(rgb[1],10).toString(16)).slice(-2) +\n                    (\"0\" + parseInt(rgb[2],10).toString(16)).slice(-2) +\n                    (\"0\" + parseInt(rgb[3],10).toString(16)).slice(-2) : '';\n                },\n\n\t\t\t\t// #backward\n\t\t\t\tisCollapsed: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.selection.isCollapsed();\n\t\t\t\t},\n\t\t\t\tisMobile: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.detect.isMobile();\n\t\t\t\t},\n\t\t\t\tisDesktop: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.detect.isDesktop();\n\t\t\t\t},\n\t\t\t\tisPad: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.detect.isIpad();\n\t\t\t\t}\n\n\t\t\t};\n\t\t},\n\n\t\t// #backward\n\t\tbrowser: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\twebkit: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.detect.isWebkit();\n\t\t\t\t},\n\t\t\t\tff: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.detect.isFirefox();\n\t\t\t\t},\n\t\t\t\tie: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.detect.isIe();\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t};\n\n\t$(window).on('load.tools.redactor', function()\n\t{\n\t\t$('[data-tools=\"redactor\"]').redactor();\n\t});\n\n\t// constructor\n\tRedactor.prototype.init.prototype = Redactor.prototype;\n\n})(jQuery);\n\n(function($)\n{\n\t$.fn.redactorAnimation = function(animation, options, callback)\n\t{\n\t\treturn this.each(function()\n\t\t{\n\t\t\tnew redactorAnimation(this, animation, options, callback);\n\t\t});\n\t};\n\n\tfunction redactorAnimation(element, animation, options, callback)\n\t{\n\t\t// default\n\t\tvar opts = {\n\t\t\tduration: 0.5,\n\t\t\titerate: 1,\n\t\t\tdelay: 0,\n\t\t\tprefix: 'redactor-',\n\t\t\ttiming: 'linear'\n\t\t};\n\n\t\tthis.animation = animation;\n\t\tthis.slide = (this.animation === 'slideDown' || this.animation === 'slideUp');\n\t\tthis.$element = $(element);\n\t\tthis.prefixes = ['', '-moz-', '-o-animation-', '-webkit-'];\n\t\tthis.queue = [];\n\n\t\t// options or callback\n\t\tif (typeof options === 'function')\n\t\t{\n\t\t\tcallback = options;\n\t\t\tthis.opts = opts;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.opts = $.extend(opts, options);\n\t\t}\n\n\t\t// slide\n\t\tif (this.slide)\n\t\t{\n\t\t\tthis.$element.height(this.$element.height());\n\t\t}\n\n\t\t// init\n\t\tthis.init(callback);\n\n\t}\n\n\tredactorAnimation.prototype = {\n\n\t\tinit: function(callback)\n\t\t{\n\t\t\tthis.queue.push(this.animation);\n\n\t\t\tthis.clean();\n\n\t\t\tif (this.animation === 'show')\n\t\t\t{\n\t\t\t\tthis.opts.timing = 'linear';\n\t\t\t\tthis.$element.removeClass('hide').show();\n\n\t\t\t\tif (typeof callback === 'function')\n\t\t\t\t{\n\t\t\t\t\tcallback(this);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (this.animation === 'hide')\n\t\t\t{\n\t\t\t\tthis.opts.timing = 'linear';\n\t\t\t\tthis.$element.hide();\n\n\t\t\t\tif (typeof callback === 'function')\n\t\t\t\t{\n\t\t\t\t\tcallback(this);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.animate(callback);\n\t\t\t}\n\n\t\t},\n\t\tanimate: function(callback)\n\t\t{\n\t\t\tthis.$element.addClass('redactor-animated').css('display', '').removeClass('hide');\n\t\t\tthis.$element.addClass(this.opts.prefix + this.queue[0]);\n\n\t\t\tthis.set(this.opts.duration + 's', this.opts.delay + 's', this.opts.iterate, this.opts.timing);\n\n\t\t\tvar _callback = (this.queue.length > 1) ? null : callback;\n\t\t\tthis.complete('AnimationEnd', $.proxy(function()\n\t\t\t{\n\t\t\t\tif (this.$element.hasClass(this.opts.prefix + this.queue[0]))\n\t\t\t\t{\n\t\t\t\t\tthis.clean();\n\t\t\t\t\tthis.queue.shift();\n\n\t\t\t\t\tif (this.queue.length)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.animate(callback);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t}, this), _callback);\n\t\t},\n\t\tset: function(duration, delay, iterate, timing)\n\t\t{\n\t\t\tvar len = this.prefixes.length;\n\n\t\t\twhile (len--)\n\t\t\t{\n\t\t\t\tthis.$element.css(this.prefixes[len] + 'animation-duration', duration);\n\t\t\t\tthis.$element.css(this.prefixes[len] + 'animation-delay', delay);\n\t\t\t\tthis.$element.css(this.prefixes[len] + 'animation-iteration-count', iterate);\n\t\t\t\tthis.$element.css(this.prefixes[len] + 'animation-timing-function', timing);\n\t\t\t}\n\n\t\t},\n\t\tclean: function()\n\t\t{\n\t\t\tthis.$element.removeClass('redactor-animated');\n\t\t\tthis.$element.removeClass(this.opts.prefix + this.queue[0]);\n\n\t\t\tthis.set('', '', '', '');\n\n\t\t},\n\t\tcomplete: function(type, make, callback)\n\t\t{\n\t\t\tthis.$element.one(type.toLowerCase() + ' webkit' + type + ' o' + type + ' MS' + type, $.proxy(function()\n\t\t\t{\n\t\t\t\tif (typeof make === 'function')\n\t\t\t\t{\n\t\t\t\t\tmake();\n\t\t\t\t}\n\n\t\t\t\tif (typeof callback === 'function')\n\t\t\t\t{\n\t\t\t\t\tcallback(this);\n\t\t\t\t}\n\n\t\t\t\t// hide\n\t\t\t\tvar effects = ['fadeOut', 'slideUp', 'zoomOut', 'slideOutUp', 'slideOutRight', 'slideOutLeft'];\n\t\t\t\tif ($.inArray(this.animation, effects) !== -1)\n\t\t\t\t{\n\t\t\t\t\tthis.$element.css('display', 'none');\n\t\t\t\t}\n\n\t\t\t\t// slide\n\t\t\t\tif (this.slide)\n\t\t\t\t{\n\t\t\t\t\tthis.$element.css('height', '');\n\t\t\t\t}\n\n\t\t\t}, this));\n\n\t\t}\n\t};\n\n})(jQuery);\n"]}