!function(t){Craft.RedactorInput=Garnish.Base.extend({id:null,linkOptions:null,volumes:null,elementSiteId:null,redactorConfig:null,$textarea:null,redactor:null,linkOptionModals:null,init:function(e){if(this.id=e.id,this.linkOptions=e.linkOptions,this.volumes=e.volumes,this.transforms=e.transforms,this.elementSiteId=e.elementSiteId,this.redactorConfig=e.redactorConfig,this.linkOptionModals=[],this.redactorConfig.lang||(this.redactorConfig.lang=e.redactorLang),this.redactorConfig.direction||(this.redactorConfig.direction=e.direction||Craft.orientation),this.redactorConfig.imageUpload=!0,this.redactorConfig.fileUpload=!0,this.redactorConfig.dragImageUpload=!1,this.redactorConfig.dragFileUpload=!1,typeof this.redactorConfig.plugins!=typeof[]&&(this.redactorConfig.plugins=[]),this.redactorConfig.plugins.push("craftAssetImages"),this.redactorConfig.plugins.push("craftAssetFiles"),this.redactorConfig.plugins.push("craftEntryLinks"),this.redactorConfig.plugins.push("craftAssetImageEditor"),this.redactorConfig.buttons){var i;-1!==(i=t.inArray("formatting",this.redactorConfig.buttons))&&this.redactorConfig.buttons.splice(i,1,"format");for(var r,o=["unorderedlist","orderedlist","undent","indent"],n=0;n<o.length;n++)-1!==(i=t.inArray(o[n],this.redactorConfig.buttons))&&(this.redactorConfig.buttons.splice(i,1),(void 0===r||i<r)&&(r=i));void 0!==r&&this.redactorConfig.buttons.splice(r,0,"lists")}this.redactorConfig.callbacks={started:Craft.RedactorInput.handleRedactorInit,focus:this.onEditorFocus.bind(this),blur:this.onEditorBlur.bind(this),contextbar:this.showContextBar.bind(this)},this.initRedactor()},initRedactor:function(){var e="#"+this.id;if(this.$textarea=t(e),void 0===this.redactorConfig.toolbarFixed||this.redactorConfig.toolbarFixed){var i=this.$textarea.closest("#content-container, .lp-editor");i.length&&(this.redactorConfig.toolbarFixedTarget=i)}Craft.RedactorInput.currentInstance=this,this.$textarea.redactor(this.redactorConfig),this.redactor=$R(e);var r=this.redactor.toolbar.getButtonsKeys();r.includes("image")&&(this.redactor.plugin.craftAssetImages.overrideButton("image"),this.redactor.plugin.craftAssetImages.setTransforms(this.transforms),this.redactor.plugin.craftAssetImages.setVolumes(this.volumes),this.redactor.plugin.craftAssetImages.setElementSiteId(this.elementSiteId)),r.includes("file")&&(this.redactor.plugin.craftAssetFiles.overrideButton("file"),this.redactor.plugin.craftAssetFiles.setVolumes(this.volumes),this.redactor.plugin.craftAssetFiles.setElementSiteId(this.elementSiteId)),r.includes("link")&&(this.redactor.plugin.craftEntryLinks.setElementSiteId(this.elementSiteId),this.linkOptions.length&&this.redactor.plugin.craftEntryLinks.setLinkOptions(this.linkOptions)),delete Craft.RedactorInput.currentInstance},onInitRedactor:function(t){this.redactor=t,this.redactor.container.getElement().addClass("focusable-input"),this.leaveFullscreetOnSaveShortcut(),this.redactor.opts.toolbarFixed&&!Craft.RedactorInput.scrollPageOnReady&&(Garnish.$doc.ready(function(){Garnish.$doc.trigger("scroll")}),Craft.RedactorInput.scrollPageOnReady=!0)},onEditorFocus:function(){this.redactor.container.getElement().addClass("focus"),this.redactor.container.getElement().trigger("focus")},onEditorBlur:function(){this.redactor.container.getElement().removeClass("focus"),this.redactor.container.getElement().trigger("blur")},leaveFullscreetOnSaveShortcut:function(){void 0!==this.redactor.plugin.fullscreen&&"function"==typeof this.redactor.plugin.fullscreen.close&&Craft.cp.on("beforeSaveShortcut",t.proxy(function(){this.redactor.plugin.fullscreen.isOpen&&this.redactor.plugin.fullscreen.close()},this))},replaceRedactorButton:function(t,e){var i=this.redactor.toolbar.getButtonsKeys();if(-1!=i.indexOf(t)){var r=this.redactor.toolbar.getButtonByIndex(i.indexOf(t)),o=r.$icon.get(0),n=t+"_placeholder",s=this.redactor.toolbar.addButtonAfter(t,n,{title:e});r.remove();var a=this.redactor.toolbar.addButtonAfter(n,t,{title:e});return s.remove(),a.setIcon(o),a}},showContextBar:function(e,i){if(this.justResized)this.justResized=!1;else{var r=this.redactor.selection.getCurrent(),o=this.redactor.inspector.parse(r),n=function(t,e){var i=t.clientY-e.$contextbar.height()-10,r={left:t.clientX-e.$contextbar.width()/2+"px",top:i+"px"};e.$contextbar.css(r)};if(!o.isFigcaption()&&o.isComponentType("image")){var s=o.getComponent(),a=t(s).find("img");if(1===a.length){var c=c=a.attr("src").match(/#asset:(\d+)/i);if(c){var d=c[1];Craft.postActionRequest("redactor",{assetId:d},function(t){if(t.success){var r={"image-editor":{title:this.redactor.lang.get("image-editor"),api:"plugin.craftAssetImageEditor.open",args:d},edit:{title:this.redactor.lang.get("edit"),api:"module.image.open"},remove:{title:this.redactor.lang.get("delete"),api:"module.image.remove",args:s}};i.set(e,s,r)}n(e,i)}.bind(this))}}}n(e,i)}}},{handleRedactorInit:function(){Craft.RedactorInput.currentInstance.onInitRedactor(this)}})}(jQuery);
//# sourceMappingURL=RedactorInput.min.js.map
