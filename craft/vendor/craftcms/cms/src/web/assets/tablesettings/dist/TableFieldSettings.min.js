!function(t){Craft.TableFieldSettings=Garnish.Base.extend({columnsTableName:null,defaultsTableName:null,columnsTableId:null,defaultsTableId:null,columnsTableInputPath:null,defaultsTableInputPath:null,defaults:null,columnSettings:null,columnsTable:null,defaultsTable:null,init:function(t,e,a,l,s){this.columnsTableName=t,this.defaultsTableName=e,this.columnsTableId=Craft.formatInputId(this.columnsTableName),this.defaultsTableId=Craft.formatInputId(this.defaultsTableName),this.columnsTableInputPath=Craft.filterArray(this.columnsTableName.split(/[\[\]]+/)),this.defaultsTableInputPath=Craft.filterArray(this.defaultsTableName.split(/[\[\]]+/)),this.defaults=l,this.columnSettings=s,this.initColumnsTable(),this.initDefaultsTable(a)},initColumnsTable:function(){this.columnsTable=new Craft.EditableTable(this.columnsTableId,this.columnsTableName,this.columnSettings,{rowIdPrefix:"col",defaultValues:{type:"singleline"},onAddRow:t.proxy(this,"onAddColumn"),onDeleteRow:t.proxy(this,"reconstructDefaultsTable")}),this.initColumnSettingInputs(this.columnsTable.$tbody),this.columnsTable.sorter.settings.onSortChange=t.proxy(this,"reconstructDefaultsTable")},initDefaultsTable:function(t){this.defaultsTable=new Craft.EditableTable(this.defaultsTableId,this.defaultsTableName,t,{rowIdPrefix:"row"})},onAddColumn:function(t){this.reconstructDefaultsTable(),this.initColumnSettingInputs(t)},initColumnSettingInputs:function(t){var e=t.find("td:first-child textarea, td:nth-child(3) textarea"),a=t.find("td:nth-child(4) select");this.addListener(e,"textchange","reconstructDefaultsTable"),this.addListener(a,"change","reconstructDefaultsTable")},reconstructDefaultsTable:function(){var e,a,l=Craft.expandPostArray(Garnish.getPostData(this.columnsTable.$tbody)),s=Craft.expandPostArray(Garnish.getPostData(this.defaultsTable.$tbody));for(e=0;e<this.columnsTableInputPath.length;e++)l=l[a=this.columnsTableInputPath[e]];for(e=0;e<this.defaultsTableInputPath.length;e++){if(void 0===s[a=this.defaultsTableInputPath[e]]){s={};break}s=s[a]}var n="<thead><tr>";for(var i in l)l.hasOwnProperty(i)&&(n+='<th scope="col">'+(l[i].heading?l[i].heading:"&nbsp;")+"</th>");n+='<th colspan="2"></th></tr></thead>';var u=t("<table/>",{id:this.defaultsTableId,class:"editable shadow-box"}).append(n),o=t("<tbody/>").appendTo(u);for(var d in s)s.hasOwnProperty(d)&&Craft.EditableTable.createRow(d,l,this.defaultsTableName,s[d]).appendTo(o);this.defaultsTable.$table.replaceWith(u),this.defaultsTable.destroy(),delete this.defaultsTable,this.initDefaultsTable(l)}})}(jQuery);
//# sourceMappingURL=TableFieldSettings.min.js.map