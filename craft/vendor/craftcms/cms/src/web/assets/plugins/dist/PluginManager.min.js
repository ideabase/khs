!function(e){Craft.PluginManager=Garnish.Base.extend({init:function(){Craft.postActionRequest("app/get-plugin-license-info",e.proxy(function(t,a){if("success"===a)for(var s in t)t.hasOwnProperty(s)&&(t[s].isInstalled?new n(e("#plugin-"+s)).update(t[s]):this.addUninstalledPluginRow(s,t[s]))},this))},addUninstalledPluginRow:function(n,t){var a=e("#plugins");a.length||(a=e("<table/>",{id:"plugins",class:"data fullwidth collapsible",html:"<tbody></tbody>"}),e("#no-plugins").replaceWith(a));var s=e("<tr/>").appendTo(a.children("tbody")).append(e("<th/>").append(e("<div/>",{class:"plugin-infos"}).append(e("<div/>",{class:"icon"}).append(e("<img/>",{src:t.iconUrl}))).append(e("<div/>",{class:"details"}).append(e("<h2/>",{text:t.name})).append(t.description?e("<p/>",{text:t.description}):e()).append(t.documentationUrl?e("<p/>",{class:"links"}).append(e("<a/>",{href:t.documentationUrl,target:"_blank",text:Craft.t("app","Documentation")})):e()).append(e("<div/>",{class:"flex license-key"}).append(e("<div/>").append(e("<input/>",{class:"text code",size:29,maxlength:29,value:Craft.PluginManager.normalizeUserKey(t.licenseKey),readonly:!0,disabled:!0}))))))).append(e("<td/>",{class:"nowrap","data-title":Craft.t("app","Status")}).append(e("<span/>",{class:"status"})).append(e("<span/>",{class:"light",text:Craft.t("app","Missing")}))).append(t.latestVersion?e("<td/>",{class:"nowrap thin","data-title":Craft.t("app","Action")}).append(e("<form/>",{method:"post","accept-charset":"UTF-8"}).append(e("<input/>",{type:"hidden",name:"action",value:"pluginstore/install"})).append(e("<input/>",{type:"hidden",name:"packageName",value:t.packageName})).append(e("<input/>",{type:"hidden",name:"handle",value:n})).append(e("<input/>",{type:"hidden",name:"version",value:t.latestVersion})).append(e("<input/>",{type:"hidden",name:"licenseKey",value:t.licenseKey})).append(e("<input/>",{type:"hidden",name:"return",value:"settings/plugins"})).append(Craft.getCsrfInput()).append(e("<div/>",{class:"btngroup"}).append(e("<div/>",{class:"btn menubtn","data-icon":"settings"})).append(e("<div/>",{class:"menu","data-align":"right"}).append(e("<ul/>").append(e("<li/>").append(e("<a/>",{class:"formsubmit",text:Craft.t("app","Install")}))))))):e());Craft.initUiElements(s)}},{normalizeUserKey:function(e){return e.replace(/.{4}/g,"$&-").substr(0,29).toUpperCase()}});var n=Garnish.Base.extend({$row:null,$keyContainer:null,$keyInput:null,$spinner:null,handle:null,updateTimeout:null,init:function(e){this.$row=e,this.$keyContainer=e.find(".license-key"),this.$keyInput=this.$keyContainer.find("input.text").removeAttr("readonly"),this.$spinner=e.find(".spinner"),this.handle=this.$row.data("handle"),this.addListener(this.$keyInput,"focus","onKeyFocus"),this.addListener(this.$keyInput,"textchange","onKeyChange")},getKey:function(){return this.$keyInput.val().replace(/\-/g,"").toUpperCase()},onKeyFocus:function(){this.$keyInput.select()},onKeyChange:function(){this.updateTimeout&&clearTimeout(this.updateTimeout);var n=this.getKey();if(0===n.length||24===n.length){var t=Craft.PluginManager.normalizeUserKey(n);this.$keyInput.val(t).data("garnish-textchange-value",t),this.updateTimeout=setTimeout(e.proxy(this,"updateLicenseStatus"),100)}},updateLicenseStatus:function(){this.$spinner.removeClass("hidden"),Craft.postActionRequest("app/update-plugin-license",{handle:this.handle,key:this.getKey()},e.proxy(function(e,n){this.$spinner.addClass("hidden"),"success"===n&&this.update(e)},this))},update:function(n){var t=this.$row.find(".license-key-status");if("valid"==n.licenseKeyStatus||n.hasIssues){var a=e("<span/>",{class:"license-key-status "+n.licenseKeyStatus});t.length?t.replaceWith(a):a.appendTo(this.$row.find(".icon"))}else t.length&&t.remove();var s=n.licenseKey||"unknown"!==n.licenseKeyStatus;s?this.$keyContainer.removeClass("hidden"):this.$keyContainer.addClass("hidden"),s&&n.hasIssues?this.$keyInput.addClass("error"):this.$keyInput.removeClass("error");var i=this.$row.find("p.error");if(s&&n.licenseStatusMessage){var p=e("<p/>",{class:"error",html:n.licenseStatusMessage});i.length?i.replaceWith(p):p.insertAfter(this.$row.find(".license-key"))}else i.remove()}})}(jQuery);
//# sourceMappingURL=PluginManager.min.js.map